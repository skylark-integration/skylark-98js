/**
 * skylark-98js - A version of 98js.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-98js/
 * @license MIT
 */
!function(e,t){var n=t.define,require=t.require,o="function"==typeof n&&n.amd,i=!o&&"undefined"!=typeof exports;if(!o&&!n){var s={};n=t.define=function(e,t,n){"function"==typeof n?(s[e]={factory:n,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var n=t.split("/"),o=e.split("/");n.pop();for(var i=0;i<o.length;i++)"."!=o[i]&&(".."==o[i]?n.pop():n.push(o[i]));return n.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):s[e]={factory:null,resolved:!0,exports:n}},require=t.require=function(e){if(!s.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=s[e];if(!module.resolved){var n=[];module.deps.forEach(function(e){n.push(require(e))}),module.exports=module.factory.apply(t,n)||null,module.resolved=!0}return module.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-98js/win98",["skylark-langx-ns","skylark-jquery"],function(e,t){return window.$=t,e.attach("intg.win98js")}),e("skylark-98js/helpers",["skylark-jquery","./win98"],function(e,t){Math.PI,Math.PI,e(window);const n=location.href.match(/98.js.org/)?location.href.match(/.*98.js.org/)[0]+"/":"/";return{Cursor:function(e){return"url(images/cursors/"+e[0]+".png) "+e[1].join(" ")+", "+e[2]},DESKTOP_ICON_SIZE:32,TASKBAR_ICON_SIZE:16,TITLEBAR_ICON_SIZE:16,getIconPath:function(e,t){return n+"images/icons/"+e+"-"+t+"x"+t+".png"},Canvas:function(e,t){var n=(i="canvas",document.createElement(i)),o=n.getContext("2d");var i;if(o.imageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1,o.webkitImageSmoothingEnabled=!1,e&&t)n.width=e,n.height=t;else{var s=e;s&&(n.width=s.width,n.height=s.height,o.drawImage(s,0,0))}return n.ctx=o,n},mustHaveMethods:function(e,t){for(const n of t)if("function"!=typeof e[n])throw console.error("Missing method",n,"on object",e),new TypeError("missing method "+n);return!0},windowInterfaceMethods:["close","minimize","unminimize","bringToFront","getTitle","getIconAtSize","focus","blur","onFocus","onBlur","onClosed"],file_name_from_path:function(e){return e.split("\\").pop().split("/").pop()},file_extension_from_path:function(e){return(e.match(/\.(\w+)$/)||[,""])[1]}}}),e("skylark-98js/FolderViewItem",["skylark-jquery","./win98","./helpers"],function(e,t,n){"use strict";return function(t){var o,i=e("<div class='desktop-icon' draggable='true' tabindex=-1/>"),s=e("<div class='icon-wrapper'/>").appendTo(i),r=e("<div class='selection-effect'/>").appendTo(s),a=e("<div class='title'/>").text(t.title);let l;i.append(s,a),i.on("dblclick",e=>{e.ctrlKey||e.metaKey||e.shiftKey||e.altKey||(t.open(),clearTimeout(l))}),a.on("click",()=>{i[0]._was_selected_at_pointerdown&&(l=setTimeout(()=>{i.hasClass("selected")&&this.start_rename()},500))}),t.shortcut&&i.addClass("shortcut");i[0].dataset.filePath=t.file_path,this.element=i[0],this.icons=t.icons,this.iconSize=t.iconSize||n.DESKTOP_ICON_SIZE,this.file_path=t.file_path,this.is_system_folder=t.is_system_folder,this._update_icon=(()=>{if(this.icons){const t=o,n=this.icons[this.iconSize];(o=e("<img class='icon'/>")).attr({draggable:!1,src:n,width:this.iconSize,height:this.iconSize}),r[0].style.setProperty("--icon-image",`url("${n}")`),t?t.replaceWith(o):s.prepend(o)}else o&&o.remove(),o=null,r[0].style.setProperty("--icon-image","none");s[0].style.setProperty("--icon-size",this.iconSize+"px"),s[0].style.setProperty("--shortcut-icon",`url("${n.getIconPath("shortcut",this.iconSize)}")`)}),this.setIcons=(e=>{this.icons=e,this._update_icon()}),this.setIconSize=(e=>{this.iconSize!==e&&(this.iconSize=e,this._update_icon())}),this._update_icon(),this.start_rename=(()=>{if(!t.rename)return;if(i.hasClass("renaming"))return;i.addClass("renaming"),i.attr("draggable",!1);const n=a.text(),o=e("<input type='text'/>");o.val(n),o.on("keydown",e=>{"Enter"===e.key?(i.focus(),e.preventDefault()):"Escape"===e.key&&(o.val(n),i.focus(),e.preventDefault())}),o.on("blur",()=>{const e=o.val();""!==e.trim()?(o.remove(),a.text(e),i.removeClass("renaming"),i.attr("draggable",!0),e!==n&&t.rename(e).catch(e=>{a.text(n),alert("Failed to rename:\n\n"+e)})):showMessageBox({title:"Rename",message:"You must type a filename.",iconID:"error"}).then(()=>{o.focus()})}),a.empty().append(o),o[0].focus(),o[0].select()})}}),e("skylark-98js/filesystem-setup",["skylark-jquery","./win98"],function(e,t){var n,o,i,s=[];const r=location.href.match(/98.js.org/)?location.href.match(/.*98.js.org/)[0]+"/":"/";return BrowserFS.configure({fs:"OverlayFS",options:{writable:{fs:"IndexedDB",options:{storeName:"C:"}},readable:{fs:"XmlHttpRequest",options:{index:r+"filesystem-index.json",baseUrl:r}}}},function(e){if(e)throw o=!0,s.length&&alert("The filesystem is not available. It failed to initialize."),s=[],e;n=!0;for(var t=0;t<s.length;t++)s[t]();s=[]}),setTimeout(function(){i=!0,s.length&&alert("The filesystem is not working."),s=[]},5e3),{withFilesystem:function(e){n?e():o?alert("The filesystem is not available. It failed to initialize."):i?alert("The filesystem is not working."):s.push(e)}}}),e("skylark-98js/FolderView",["skylark-jquery","./win98","./FolderViewItem","./filesystem-setup","./helpers"],function(e,t,n,o,i){const s=75,r=75,a=150,l=17;window.resetAllFolderCustomizations=(()=>{for(let e=0;e<localStorage.length;e++)localStorage.key(e).startsWith("folder-config:")&&localStorage.removeItem(localStorage.key(e))});const c={LARGE_ICONS:32,SMALL_ICONS:16,DETAILS:16,LIST:16,DESKTOP:32};p.VIEW_MODES={THUMBNAILS:"THUMBNAILS",LARGE_ICONS:"LARGE_ICONS",SMALL_ICONS:"SMALL_ICONS",DETAILS:"DETAILS",LIST:"LIST",DESKTOP:"DESKTOP"},p.SORT_MODES={NAME:"NAME",TYPE:"TYPE",SIZE:"SIZE",DATE:"DATE"};var d={txt:"notepad-file",md:"notepad-file",json:"notepad-file",js:"notepad-file",css:"notepad-file",html:"notepad-file",gitattributes:"notepad-file",gitignore:"notepad-file",png:"image-gif",jpg:"image-jpeg",jpeg:"image-jpeg",gif:"image-gif",webp:"image-other",bmp:"paint-file",tif:"kodak-imaging-file",tiff:"kodak-imaging-file",wav:"sound",mp3:"sound",ogg:"sound",wma:"sound",exe:"task",htm:"html",html:"html",url:"html",theme:"themes",themepack:"themes"};const u={"/":"(C:)","/my-pictures/":"My Pictures","/my-documents/":"My Documents","/network-neighborhood/":"Network Neighborhood","/desktop/":"Desktop","/programs/":"Program Files","/recycle-bin/":"Recycle Bin"},m=Object.fromEntries(Object.entries(u).map(([e,t])=>[t,e])),h=(Object.fromEntries(Object.entries(m).map(([e,t])=>[e.toLowerCase(),t])),e=>{window.dragging_file_paths=e;let t=window;for(;t!==t.parent;)(t=t.parent).dragging_file_paths=e});function p(t,{asDesktop:m=!1,onStatus:f,openFolder:w,openFileOrFolder:g,onConfigure:y}={}){const v=this;var b=e('<div class="folder-view" tabindex="0">');this.element=b[0],this.items=[],this.add_item=(e=>{b.append(e.element),this.items.push(e)}),this.config={};var k=`folder-config:${m?"desktop":t}`;try{const e=localStorage.getItem(k),t=JSON.parse(e);t&&Object.assign(this.config,t)}catch(e){console.error("Failed to read folder config:",e)}p.VIEW_MODES[this.config.view_mode]||(this.config.view_mode=m?p.VIEW_MODES.DESKTOP:p.VIEW_MODES.LARGE_ICONS),p.SORT_MODES[this.config.sort_mode]||(this.config.sort_mode=p.SORT_MODES.NAME),this.config.view_as_web_page||(this.config.view_as_web_page="/desktop/"!==t),this.element.dataset.viewMode=this.config.view_mode,this.configure=(e=>{Object.assign(this.config,e),e.view_mode&&(this.element.dataset.viewMode=e.view_mode),this.arrange_icons();try{localStorage.setItem(k,JSON.stringify(this.config))}catch(e){console.error("Can't write to localStorage:",e)}y&&y(e)}),this.cycle_view_mode=(()=>{const e=[p.VIEW_MODES.LARGE_ICONS,p.VIEW_MODES.SMALL_ICONS,p.VIEW_MODES.LIST],t=e.indexOf(this.config.view_mode),n=(t+1)%e.length;this.configure({view_mode:e[n]})});let x=!1;function C(){f&&f({items:v.items,selectedItems:v.items.filter(e=>e.element.classList.contains("selected"))})}function _(e,t){if(e.statSync(t).isDirectory()){for(const n of e.readdirSync(t))_(t+"/"+n);e.rmdirSync(t)}else e.unlinkSync(t)}this.arrange_icons=(()=>{if(x)return;if(!v.element.isConnected)return;const t=this.items.map(e=>e.pendingStatPromise).filter(Boolean),n=t.length>0;n&&(x||Promise.allSettled(t).then(()=>{x=!1,v.arrange_icons()}),x=!0);const o=this.config.view_mode===p.VIEW_MODES.LARGE_ICONS||this.config.view_mode===p.VIEW_MODES.SMALL_ICONS,i=this.config.view_mode===p.VIEW_MODES.LARGE_ICONS||this.config.view_mode===p.VIEW_MODES.DESKTOP,d=c[this.config.view_mode]||32,u=i?s:a,m=i?r:l;var h=0,f=0;const w=e=>e.is_system_folder?2:e.resolvedStats&&e.resolvedStats.isDirectory()?1:0,g=e=>(e.file_path||"").split(".").pop();this.config.sort_mode===p.SORT_MODES.NAME?this.items.sort((e,t)=>w(t)-w(e)||(e.title||"").localeCompare(t.title||"")):this.config.sort_mode===p.SORT_MODES.TYPE?this.items.sort((e,t)=>w(t)-w(e)||(g(e)||"").localeCompare(g(t)||"")):this.config.sort_mode===p.SORT_MODES.SIZE?this.items.sort((e,t)=>w(t)-w(e)||(e.resolvedStats.size||0)-(t.resolvedStats&&t.resolvedStats.size||0)):this.config.sort_mode===p.SORT_MODES.DATE&&this.items.sort((e,t)=>w(t)-w(e)||(e.resolvedStats&&e.resolvedStats.mtime||0)-(t.resolvedStats&&t.resolvedStats.mtime||0));for(const t of this.items)e(t.element).css({left:h,top:f}),o?(h+=u)+u>b[0].clientWidth&&(f+=m,h=0):(f+=m)+m>b[0].clientHeight&&(h+=u,f=0),t.setIconSize(d);n||(this.items.forEach((e,t)=>{e.element.classList.toggle("focused",0===t)}),this.items[0]&&this.items[0].element.focus(),C())}),v.focus=function(){b.is(":focus-within")||(b.focus(),0===b.find(".desktop-icon.focused").length&&this.items[0]&&this.items[0].element.focus())},v.select_all=function(){b.find(".desktop-icon").addClass("selected"),C()},v.select_inverse=function(){b.find(".desktop-icon").each(function(){e(this).toggleClass("selected")}),C()},v.delete_selected=function(){const e=b.find(".desktop-icon.selected").toArray().map(e=>e.dataset.filePath).filter(e=>void 0===u[e]);if(0===e.length)return;const t=b.find(".desktop-icon.selected .title").text().replace(/\.([^.]+)$/,"");showMessageBox({title:1===e.length?"Confirm File Delete":"Confirm Multiple File Delete",message:1===e.length?`Are you sure you want to delete '${t}'?`:`Are you sure you want to delete these ${e.length} items?`,buttons:[{label:"Yes",value:"yes",default:!0},{label:"No",value:"no"}],iconID:"nuke"}).then(t=>{"yes"===t&&o.withFilesystem(function(){const t=BrowserFS.BFSRequire("fs");let n=0;for(const o of e){let e=!1;try{_(t,o),e=!0,n+=1}catch(e){console.log("failed to delete",o,e)}e&&v.items.forEach(e=>{e.element.dataset.filePath===o&&(e.element.remove(),C())})}n<e.length&&alert(`Failed to delete ${e.length-n} items.`)})})},v.start_rename=(()=>{for(const e of v.items)if(e.element.classList.contains("focused")){e.start_rename();break}}),o.withFilesystem(function(){var e=BrowserFS.BFSRequire("fs");e.readdir(t,function(e,n){if(e)throw alert("Failed to read contents of the directory "+t),e;for(var o=0;o<n.length;o++){var i=n[o];W(i,-1e3,-1e3)}v.arrange_icons()})});const S=new ResizeObserver(e=>{v.arrange_icons()});S.observe(v.element),function(){var t=e("<div class='marquee'/>").appendTo(b).hide(),n={x:0,y:0},o={x:0,y:0},i=!1,s=function(){var i=Math.min(n.x,o.x),s=Math.min(n.y,o.y),r=Math.max(n.x,o.x),a=Math.max(n.y,o.y);t.show().css({position:"absolute",left:i,top:s,width:r-i,height:a-s}),b.find(".desktop-icon").each(function(t,n){e(n).offset();var o=parseFloat(e(n).css("left")),l=parseFloat(e(n).css("top")),c=e(n).width(),d=e(n).height();n.classList.toggle("selected",o<r&&l<a&&o+c>i&&l+d>s)}),C()};function r(e){var t=v.element.getBoundingClientRect();o={x:e.pageX-t.left+b[0].scrollLeft,y:e.pageY-t.top+b[0].scrollTop};const n=b.width()-b[0].clientWidth,r=b.height()-b[0].clientHeight,a=b[0].scrollLeft,l=b[0].scrollTop,c=b.width()+b[0].scrollLeft-n,d=b.height()+b[0].scrollTop-r;if(o.x=Math.max(a,Math.min(c,o.x)),o.y=Math.max(l,Math.min(d,o.y)),i){s();const e=10;o.x===a?b[0].scrollLeft-=e:o.x===c&&(b[0].scrollLeft+=e),o.y===l?b[0].scrollTop-=e:o.y===d&&(b[0].scrollTop+=e)}}function a(){t.hide(),i=!1,h([]),e(b[0].ownerDocument).off("pointermove",r),e(b[0].ownerDocument).off("pointerup blur",a)}b.on("pointerdown",".desktop-icon",function(e){const t=e.currentTarget;t._was_selected_at_pointerdown=t.classList.contains("selected"),T(t,e,!0)}),b.on("pointerdown",function(l){var c=b.is(":focus-within");v.focus();var d=e(l.target).closest(".desktop-icon");t.hide();var u=v.element.getBoundingClientRect();if(n={x:l.pageX-u.left+b[0].scrollLeft,y:l.pageY-u.top+b[0].scrollTop},o={x:l.pageX-u.left+b[0].scrollLeft,y:l.pageY-u.top+b[0].scrollTop},d.length>0)t.hide(),h(e(".desktop-icon.selected").get().map(e=>e.dataset.filePath).filter(e=>e));else{h([]);let e=b[0].offsetWidth-b[0].clientWidth,t=b[0].offsetHeight-b[0].clientHeight;e+=2,t+=2;const n=b[0].getBoundingClientRect(),o=l.clientX>n.right-e||l.clientY>n.bottom-t;(i=!o)&&c&&s()}e(b[0].ownerDocument).on("pointermove",r),e(b[0].ownerDocument).on("pointerup blur",a)})}();let E,I="";var $;function T(t,n,o){const i=t instanceof Element?t:t.element,s=n.shiftKey;$&&!v.items.some(e=>e.element===$)&&($=null),s&&!$&&($=v.items.find(e=>e.element.classList.contains("focused")).element||i),b.find(".desktop-icon").each(function(t,o){if(s){const t=$.getBoundingClientRect(),n=i.getBoundingClientRect(),s=o.getBoundingClientRect(),r={top:Math.min(t.top,n.top),left:Math.min(t.left,n.left),bottom:Math.max(t.bottom,n.bottom),right:Math.max(t.right,n.right)};e(o).toggleClass("selected",s.top>=r.top&&s.left>=r.left&&s.bottom<=r.bottom&&s.right<=r.right)}else"pointerdown"===n.type&&(n.ctrlKey||n.metaKey)?o===i&&e(o).toggleClass("selected"):n.ctrlKey||n.metaKey||o.classList.toggle("selected",o===i);o.classList.toggle("focused",o===i)}),o?setTimeout(()=>{i.scrollIntoView({block:"nearest"})},500):i.scrollIntoView({block:"nearest"}),C(),n.shiftKey||($=i)}function D(t,n,o){let i=b.find(".desktop-icon.focused");if(0==i.length&&(i=b.find(".desktop-icon")),0==i.length)return!1;const s=i.outerWidth(),r=i.outerHeight(),a=i[0].getBoundingClientRect();let l=a.left,c=a.top;l+=t*s,c+=n*r;const d=b.find(".desktop-icon").toArray().sort(function(e,t){const n=e.getBoundingClientRect(),o=t.getBoundingClientRect(),i=Math.abs(n.left-l)+Math.abs(n.top-c),s=Math.abs(o.left-l)+Math.abs(o.top-c);return i-s}),u=e(d[0]);return u.length>0&&(T(u[0],o),!0)}b.on("keydown",function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)if("Enter"==e.key)b.find(".desktop-icon.selected").trigger("dblclick");else if(e.ctrlKey&&"a"==e.key)folder_view.select_all(),e.preventDefault();else if("Delete"==e.key)v.delete_selected(),e.preventDefault();else if("ArrowLeft"==e.key||"ArrowRight"==e.key||"ArrowUp"==e.key||"ArrowDown"==e.key){e.preventDefault();const t="ArrowLeft"==e.key?-1:"ArrowRight"==e.key?1:0,n="ArrowUp"==e.key?-1:"ArrowDown"==e.key?1:0;D(t,n,e)}else if("PageUp"==e.key||"PageDown"==e.key)if(e.preventDefault(),v.config.view_mode===p.VIEW_MODES.LIST){const t="PageUp"==e.key?-1:1,n=b.width(),o=b.find(".desktop-icon").outerWidth(),i=n-o;for(let n=i;n>0&&!D(t*n/o,0,e);n-=o);}else{const t="PageUp"==e.key?-1:1,n=b.height(),o=b.find(".desktop-icon").outerHeight(),i=n-o;for(let n=i;n>0&&!D(0,t*n/o,e);n-=o);}else if("Home"==e.key)e.preventDefault(),T(v.items[0],e);else if("End"==e.key)e.preventDefault(),T(v.items[v.items.length-1],e);else if(" "==e.key&&0===I.length)e.preventDefault(),(e.ctrlKey||e.metaKey)&&b.find(".desktop-icon.selected").length>0?b.find(".desktop-icon.focused").toggleClass("selected"):b.find(".desktop-icon.focused").addClass("selected"),C();else if("F2"===e.key)e.preventDefault(),v.start_rename();else{if(e.isDefaultPrevented()||e.ctrlKey||e.altKey||e.metaKey)return;if(E&&clearTimeout(E),I===e.key){const t=v.items.filter(e=>{const t=e.element.querySelector(".title").textContent;return t.toLocaleLowerCase().startsWith(I.toLocaleLowerCase())});if(t.length>0){const n=t.findIndex(e=>e.element.classList.contains("focused"));T(-1===n?t[0]:t[(n+1)%t.length],e)}}else if("Shift"!==e.key&&"Compose"!==e.key&&(I+=e.key),E=setTimeout(function(){I=""},1e3),I.length>0)for(const e of v.items){const t=e.element.querySelector(".title").textContent;if(t.toLocaleLowerCase().startsWith(I.toLocaleLowerCase())){T(e,{});break}}}});var z=function(e,t){if(e.isDirectory())return"folder";var n=i.file_extension_from_path(t),o=d[n.toLowerCase()];return o||"document"},F=function(e){return{16:i.getIconPath(e,16),32:i.getIconPath(e,32),48:i.getIconPath(e,48)}},W=function(o,i,s){var r,a,l=t+o,d=new n({title:o,open:async function(){if(w){let e=d.resolvedStats;if(!e){if(!d.pendingStatPromise)return void alert(`Cannot open '${d.file_path}'. File type information not available.`);try{e=await d.pendingStatPromise}catch(e){return void alert(`Failed to get info about '${d.file_path}':\n\n${e}`)}}if(e.isDirectory())return void w(d.file_path)}g?g(d.file_path):alert("No handler for opening files or folders.")},rename:e=>{var n=BrowserFS.BFSRequire("fs");return new Promise(function(o,i){const s=t+e;n.rename(d.file_path,s,function(t){if(t)return i(t);if(o(),d.file_path=s,d.title=e,d.element.dataset.filePath=s,d.resolvedStats){const e=z(d.resolvedStats,s);d.setIcons(F(e))}})})},shortcut:l.match(/\.url$/),file_path:l,iconSize:c[v.config.view_mode]});d.pendingStatPromise=(r=l,a=BrowserFS.BFSRequire("fs"),new Promise(function(e,t){a.stat(r,function(n,o){if(n)return t(n);e(o)})})),d.pendingStatPromise.then(e=>{d.pendingStatPromise=null,d.resolvedStats=e;const t=z(e,d.file_path);d.setIcons(F(t))},e=>{d.pendingStatPromise=null}),v.add_item(d),e(d.element).css({left:i,top:s})},M=0;b.on("dragover",function(e){e.preventDefault(),M=e.originalEvent.pageX,e.originalEvent.pageY}),b.on("drop",function(n){n.preventDefault();var o=n.originalEvent.pageX||M,i=n.originalEvent.pageY||n.dragover_pageY;withFilesystem(function(){var s=n.originalEvent.dataTransfer.files;e.map(s,function(e){!function(e,n,o){var i=BrowserFS.BFSRequire("buffer").Buffer,s=BrowserFS.BFSRequire("fs"),r=t+e.name,a=new FileReader;a.onerror=function(e){throw e},a.onload=function(t){var l=i.from(a.result);s.writeFile(r,l,{flag:"wx"},function(t){if(t)throw"EEXIST"===t.code&&alert("File already exists!"),t;W(e.name,n,o)})},a.readAsArrayBuffer(e)}(e,o,i)})})})}return p}),e("skylark-98js/os-gui/$Window",["skylark-jquery","../win98"],function(e,t){function n(e){return document.createElement(e)}function o(e){return"object"==typeof e&&"tagName"in e?e.tagName.toLowerCase()+(e.id?"#"+e.id:"")+(e.className?"."+e.className.split(" ").join("."):"")+(e.src?`[src="${e.src}"]`:"")+(e.srcdoc?"[srcdoc]":"")+(e.href?`[href="${e.href}"]`:""):e?e.constructor.name:`${e}`}function i(t){const n=e(t);let o=n.find("\n\t\t\tinput:enabled,\n\t\t\ttextarea:enabled,\n\t\t\tselect:enabled,\n\t\t\tbutton:enabled,\n\t\t\ta[href],\n\t\t\t[tabIndex='0'],\n\t\t\tdetails summary,\n\t\t\tiframe,\n\t\t\tobject,\n\t\t\tembed,\n\t\t\tvideo[controls],\n\t\t\taudio[controls],\n\t\t\t[contenteditable]:not([contenteditable='false'])\n\t\t").filter(":visible");const i={},s=[];for(const e of o.toArray())"input"===e.nodeName.toLowerCase()&&"radio"===e.type&&(i[e.name]?e.checked?(s.push(i[e.name]),i[e.name]=e):s.push(e):i[e.name]=e);const r=o.not(s);return r}var s=e(window);a.Z_INDEX=5;var r=[];function a(t){t=t||{};var l=e(n("div")).addClass("window os-window").appendTo("body");l[0].$window=l,l.element=l[0],l[0].id=`os-window-${Math.random().toString(36).substr(2,9)}`,l.$titlebar=e(n("div")).addClass("window-titlebar").appendTo(l),l.$title_area=e(n("div")).addClass("window-title-area").appendTo(l.$titlebar),l.$title=e(n("span")).addClass("window-title").appendTo(l.$title_area),t.toolWindow&&(t.minimizeButton=!1,t.maximizeButton=!1),!1!==t.minimizeButton&&(l.$minimize=e(n("button")).addClass("window-minimize-button window-action-minimize window-button").appendTo(l.$titlebar),l.$minimize.attr("aria-label","Minimize window"),l.$minimize.append("<span class='window-button-icon'></span>")),!1!==t.maximizeButton&&(l.$maximize=e(n("button")).addClass("window-maximize-button window-action-maximize window-button").appendTo(l.$titlebar),l.$maximize.attr("aria-label","Maximize or restore window"),t.resizable||l.$maximize.attr("disabled",!0),l.$maximize.append("<span class='window-button-icon'></span>")),!1!==t.closeButton&&(l.$x=e(n("button")).addClass("window-close-button window-action-close window-button").appendTo(l.$titlebar),l.$x.attr("aria-label","Close window"),l.$x.append("<span class='window-button-icon'></span>")),l.$content=e(n("div")).addClass("window-content").appendTo(l),l.$content.attr("tabIndex","-1"),l.$content.css("outline","none"),t.toolWindow&&l.addClass("tool-window"),t.parentWindow&&(t.parentWindow.addChildWindow(l),t.toolWindow&&(l[0].dataset.semanticParent=t.parentWindow[0].id));var c=t.$component;if("object"==typeof t.icon&&"tagName"in t.icon)t.icons={any:t.icon};else if(t.icon){if(console.warn("DEPRECATED: use options.icons instead of options.icon, e.g. new $Window({icons: {16: 'app-16x16.png', any: 'app-icon.svg'}})"),"undefined"==typeof $Icon||"undefined"==typeof TITLEBAR_ICON_SIZE)throw new Error("Use {icon: img_element} or {icons: {16: url_or_img_element}} options");l.icon_name=t.icon,l.$icon=$Icon(t.icon,TITLEBAR_ICON_SIZE).prependTo(l.$titlebar)}l.icons=t.icons||{};let d=16;l.setTitlebarIconSize=function(t){l.icons&&(l.$icon&&l.$icon.remove(),l.$icon=e(l.getIconAtSize(t)),l.$icon.prependTo(l.$titlebar)),d=t,l.trigger("icon-change")},l.getTitlebarIconSize=function(){return d},l.getIconAtSize=function(t){let o;if(l.icons[t])o=t;else if(l.icons.any)o="any";else{const e=Object.keys(l.icons).filter(e=>isFinite(e)&&isFinite(parseFloat(e)));e.sort((e,n)=>Math.abs(e-t)-Math.abs(n-t)),o=e[0]}if(o){const i=l.icons[o];let s;if(void 0!==i.nodeType)s=i.cloneNode(!0);else{s=n("img");const r=e(s);i.srcset?r.attr("srcset",i.srcset):r.attr("src",i.src||i),r.attr({width:o,height:o,draggable:!1}),r.css({width:t,height:t})}return s}return null},l.setTitlebarIconSize(d),l.getIconName=(()=>(console.warn("DEPRECATED: use $w.icons object instead of $w.icon_name"),l.icon_name)),l.setIconByID=(e=>{console.warn("DEPRECATED: use $w.setIcons(icons) instead of $w.setIconByID(icon_name)");var t=l.$icon;return l.$icon=$Icon(e,TITLEBAR_ICON_SIZE),t.replaceWith(l.$icon),l.icon_name=e,l.task&&l.task.updateIcon(),l.trigger("icon-change"),l}),l.setIcons=(e=>{l.icons=e,l.setTitlebarIconSize(d),l.task&&l.task.updateIcon()}),c&&l.addClass("component-window"),setTimeout(()=>{"rtl"==(window.get_direction?window.get_direction():getComputedStyle(l[0]).direction)&&l.addClass("rtl")},0);const u=e({}),m=e=>t=>{const n=()=>{t()};u.on(e,n);return()=>{u.off(e,n)}};l.onFocus=m("focus"),l.onBlur=m("blur"),l.onClosed=m("closed"),l.setDimensions=(({innerWidth:e,innerHeight:t,outerWidth:n,outerHeight:o})=>{let i,s;if(e&&(i=l.outerWidth()-l.$content.outerWidth()),t){s=l.outerHeight()-l.$content.outerHeight();const e=l.$content.find(".menus");e.length&&(s+=e.outerHeight())}n&&l.outerWidth(n),o&&l.outerHeight(o),e&&l.outerWidth(e+i),t&&l.outerHeight(t+s)}),l.setDimensions(t);let h=[];l.addChildWindow=(e=>{h.push(e)});const p=()=>{l.hasClass("focused")||(l.addClass("focused"),u.triggerHandler("focus"))},f=()=>{l.hasClass("focused")&&(l.removeClass("focused"),u.triggerHandler("blur"))};if(l.focus=(()=>{l.bringToFront(),M()}),l.blur=(()=>{f(),document.activeElement&&document.activeElement.closest(".window")==l[0]&&document.activeElement.blur()}),t.toolWindow)t.parentWindow?(t.parentWindow.onFocus(p),t.parentWindow.onBlur(f),document.activeElement&&document.activeElement.closest(".window")==t.parentWindow[0]&&p()):(e(window).on("focus",p),e(window).on("blur",f),document.hasFocus()&&p());else{const e=y(l[0],!0);function w(e){if(!_.has(e)){const t=y(e,!1);_.set(e,t),setTimeout(()=>{try{const n=t=>{"complete"==e.contentDocument.readyState?t():setTimeout(()=>{n(t)},100)};n(()=>{e.contentWindow.addEventListener("focusin",t),e.contentWindow.addEventListener("focusout",t),e.contentWindow.addEventListener("blur",t),e.contentWindow.addEventListener("focus",t),g(e.contentDocument)})}catch(t){$(e,t)}},100)}}function g(e){const t=new MutationObserver(e=>{for(const t of e)for(const e of t.addedNodes)"IFRAME"==e.tagName&&w(e)});t.observe(e,{childList:!0,subtree:!0});for(const t of e.querySelectorAll("iframe"))w(t)}function y(e,t){return function(n){const o="IFRAME"==e.tagName?e.contentDocument:e,i=o.ownerDocument||o;let s=n?"focusout"===n.type||"blur"===n.type?n.relatedTarget:n.target:i.activeElement;n&&"blur"===n.type&&(s=null),i.activeElement&&"IFRAME"===i.activeElement.tagName&&(n&&"focusout"===n.type||n&&"blur"===n.type)&&!s&&(s=i.activeElement);const r=!s||s.window===s||!o.contains(s),a=r&&o!==s;if(a&&t&&f(),r||"HTML"===s.tagName||"BODY"===s.tagName||s===o||s.matches(".window-content")||s.closest(".menus")||s.closest(".window-titlebar")||(C.set(e,s),T(i,o,s,t)),!r&&"IFRAME"===s.tagName){const e=s;try{const n=e.contentDocument.activeElement;n&&"HTML"!==n.tagName&&"BODY"!==n.tagName&&!n.closest(".menus")&&(C.set(e,n),T(e.contentDocument,e.contentDocument,n,t))}catch(t){$(e,t)}}if(t)for(;;){const e=s&&s.closest&&s.closest("[data-semantic-parent]");if(!e)break;{const t=e.dataset.semanticParent,n=e.ownerDocument.getElementById(t);if(s=n,!n){console.warn("semantic parent not found with id",t);break}}}if(s&&s.window!==s&&o.contains(s)){if(p(),l.bringToFront(),!t){let t=e;for(;t;)t.dispatchEvent(new Event("focusin",{bubbles:!0,target:t,view:t.ownerDocument.defaultView})),t=t.currentView&&t.currentView.frameElement}}else t&&f()}}window.addEventListener("focusin",e),window.addEventListener("focusout",e),window.addEventListener("blur",e),window.addEventListener("focus",e),g(l.$content[0])}l.css("touch-action","none");let v,b,k,x=null;l.setMinimizeTarget=function(e){x=e},Object.defineProperty(l,"task",{get:()=>v,set(e){console.warn("DEPRECATED: use $w.setMinimizeTarget(taskbar_button_el) instead of setting $window.task object"),v=e}}),l.minimize=(()=>{if(x=x||v&&v.$task[0],H)N.push(l.minimize);else if(l.is(":visible"))if(x&&!l.hasClass("minimized-without-taskbar")){const e=l.$titlebar[0].getBoundingClientRect(),t=x.getBoundingClientRect();l.animateTitlebar(e,t,()=>{l.hide(),l.blur()})}else{const e=150,t=10;if(l.hasClass("minimized-without-taskbar"))r[l._minimize_slot_index]=null;else{let e=0;for(;r[e];)e++;l._minimize_slot_index=e,r[e]=l}const n=l._minimize_slot_index*(e+t)+10,o=l.$titlebar.outerHeight();let i;const s=()=>{b={position:l.css("position"),left:l.css("left"),top:l.css("top"),width:l.css("width"),height:l.css("height")},l.addClass("minimized-without-taskbar"),l.hasClass("maximized")&&(l.removeClass("maximized"),l.addClass("was-maximized"),l.$maximize.removeClass("window-action-restore"),l.$maximize.addClass("window-action-maximize")),l.$minimize.removeClass("window-action-minimize"),l.$minimize.addClass("window-action-restore"),i?l.css({position:i.position,left:i.left,top:i.top,width:i.width,height:i.height}):l.css({position:"fixed",top:`calc(100% - ${o+5}px)`,left:n,width:e,height:o})},a=()=>{i={position:l.css("position"),left:l.css("left"),top:l.css("top"),width:l.css("width"),height:l.css("height")},l.removeClass("minimized-without-taskbar"),l.hasClass("was-maximized")&&(l.removeClass("was-maximized"),l.addClass("maximized"),l.$maximize.removeClass("window-action-maximize"),l.$maximize.addClass("window-action-restore")),l.$minimize.removeClass("window-action-restore"),l.$minimize.addClass("window-action-minimize"),l.css({width:"",height:""}),b&&l.css({position:b.position,left:b.left,top:b.top,width:b.width,height:b.height})},c=l.$titlebar[0].getBoundingClientRect();let d;l.css("transform",""),l.hasClass("minimized-without-taskbar")?(a(),d=l.$titlebar[0].getBoundingClientRect(),s()):(s(),d=l.$titlebar[0].getBoundingClientRect(),a()),l.animateTitlebar(c,d,()=>{l.hasClass("minimized-without-taskbar")?a():(s(),l.blur())})}}),l.unminimize=(()=>{if(H)N.push(l.unminimize);else if(l.hasClass("minimized-without-taskbar"))l.minimize();else if(l.is(":hidden")){const e=x.getBoundingClientRect();l.show();const t=l.$titlebar[0].getBoundingClientRect();l.hide(),l.animateTitlebar(e,t,()=>{l.show(),l.bringToFront(),l.focus()})}}),l.maximize=(()=>{if(!t.resizable)return;if(H)return void N.push(l.maximize);if(l.hasClass("minimized-without-taskbar"))return void l.minimize();const n=()=>{k={position:l.css("position"),left:l.css("left"),top:l.css("top"),width:l.css("width"),height:l.css("height")},l.addClass("maximized");const t=e(".taskbar"),n=window.innerWidth-e(window).width(),o=window.innerHeight-e(window).height(),i=t.length?t.outerHeight()+1:0;l.css({position:"fixed",top:0,left:0,width:`calc(100vw - ${n}px)`,height:`calc(100vh - ${o}px - ${i}px)`})},o=()=>{l.removeClass("maximized"),l.css({width:"",height:""}),k&&l.css({position:k.position,left:k.left,top:k.top,width:k.width,height:k.height})},i=l.$titlebar[0].getBoundingClientRect();let s;l.css("transform","");const r=l.hasClass("maximized");r?(o(),s=l.$titlebar[0].getBoundingClientRect(),n()):(n(),s=l.$titlebar[0].getBoundingClientRect(),o()),l.animateTitlebar(i,s,()=>{r?(o(),l.$maximize.removeClass("window-action-restore"),l.$maximize.addClass("window-action-maximize")):(n(),l.$maximize.removeClass("window-action-maximize"),l.$maximize.addClass("window-action-restore"))})}),l.restore=(()=>{l.is(".minimized-without-taskbar, .minimized")?l.unminimize():l.is(".maximized")&&l.maximize()}),l.$minimize&&l.$minimize.on("click",e=>{l.minimize()}),l.$maximize&&l.$maximize.on("click",e=>{l.maximize()}),l.$x&&l.$x.on("click",e=>{l.close()}),l.$title_area.on("dblclick",e=>{l.maximize()}),l.css({position:"absolute",zIndex:a.Z_INDEX++}),l.bringToFront=(()=>{l.css({zIndex:a.Z_INDEX++});for(const e of h)e.bringToFront()});var C=new Map,_=new Map,S=new Map,E=[],I=new WeakSet;const $=(e,n)=>{const i=t=>[`OS-GUI.js failed to access an iframe (${o(e)}) for focus integration.\n\t${t}\n\tOriginal error:\n\t`,n];let s;if(e.srcdoc)s=!1;else try{const t=new URL(e.src);s=t.origin!==window.location.origin}catch(e){return void console.error(...i(`This may be a bug in OS-GUI. Is this a cross-origin iframe? Failed to parse URL (${e}).`))}s?t.iframes&&t.iframes.ignoreCrossOrigin&&!I.has(e)&&(console.warn(...i("Only same-origin iframes can work with focus integration (showing window as focused, refocusing last focused controls).\n\tIf you can re-host the content on the same origin, you can resolve this and enable focus integration.\n\tYou can also disable this warning by passing {iframes: {ignoreCrossOrigin: true}} to $Window.")),I.add(e)):console.error(...i("This may be a bug in OS-GUI, since it doesn't appear to be a cross-origin iframe."))},T=(e,t,n,o)=>{if(!a.DEBUG_FOCUS)return;let i=S.get(t);i||((i=e.createElementNS("http://www.w3.org/2000/svg","svg")).style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.pointerEvents="none",i.style.zIndex="100000000",i.style.direction="ltr",S.set(t,i),E.push(i),e.body.appendChild(i)),i._container_el=t,i._descendant_el=n,i._is_root=o,F()},D=e=>{const t=e._container_el,n=e._descendant_el,i=e._is_root;for(;e.lastChild;)e.removeChild(e.lastChild);const s=n.getBoundingClientRect&&n.getBoundingClientRect()||{left:0,top:0,width:innerWidth,height:innerHeight,right:innerWidth,bottom:innerHeight},r=t.getBoundingClientRect&&ontainer_el.getBoundingClientRect()||{left:0,top:0,width:innerWidth,height:innerHeight,right:innerWidth,bottom:innerHeight};for(const a of[s,r]){const r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x",a.left),r.setAttribute("y",a.top),r.setAttribute("width",a.width),r.setAttribute("height",a.height),r.setAttribute("stroke","#f44"),r.setAttribute("stroke-width","2"),r.setAttribute("fill","none"),i||r.setAttribute("stroke-dasharray","5,5"),e.appendChild(r);const l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",a.left),l.setAttribute("y",a.top+(a===s?20:0)),l.setAttribute("fill",a===s?"#f44":"aqua"),l.setAttribute("font-size","20"),l.style.textShadow="1px 1px 1px black, 0 0 10px black",l.textContent=o(a===s?n:t),e.appendChild(l)}const a=[[s.left,s.top,r.left,r.top],[s.right,s.top,r.right,r.top],[s.left,s.bottom,r.left,r.bottom],[s.right,s.bottom,r.right,r.bottom]];for(const t of a){const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",t[0]),n.setAttribute("y1",t[1]),n.setAttribute("x2",t[2]),n.setAttribute("y2",t[3]),n.setAttribute("stroke","green"),n.setAttribute("stroke-width","2"),e.appendChild(n)}};let z;const F=()=>{if(cancelAnimationFrame(z),a.DEBUG_FOCUS){z=requestAnimationFrame(F);for(const e of E)D(e)}else W()},W=()=>{cancelAnimationFrame(z);for(const e of E)e.remove();E.length=0,S.clear()},M=(e=l.$content[0])=>{const n=e.matches(".window-content")?l[0]:e,o=C.get(n);if(o){if(o.focus({preventScroll:!0}),"IFRAME"===o.tagName)try{M(o)}catch(e){$(o,e)}return}const s=i(e),r=s.filter(".default");if(r.length)r[0].focus({preventScroll:!0});else if(s.length)if("IFRAME"===s[0].tagName)try{M(s[0])}catch(e){$(s[0],e)}else s[0].focus({preventScroll:!0});else if(t.toolWindow&&t.parentWindow)t.parentWindow.triggerHandler("refocus-window");else if(e.focus({preventScroll:!0}),"IFRAME"===e.tagName)try{M(e.contentDocument.body)}catch(t){$(e,t)}};var B,A,O,L,P;l.on("refocus-window",()=>{M()}),l.on("pointerdown mousedown",function(e){l.bringToFront(),requestAnimationFrame(()=>{const t=C.get(window);if(document.activeElement&&document.activeElement!==document&&document.activeElement!==document.body&&document.activeElement!==l.$content[0]&&document.activeElement!==t)return;if(document.activeElement&&document.activeElement.closest&&document.activeElement.closest(".menus, .menu-popup"))return;const n=getComputedStyle(e.target);if("none"!==n.userSelect)return l.$content.focus(),void l.one("pointerup pointercancel",()=>{requestAnimationFrame(()=>{getSelection().toString().trim()||M()})});M()})}),s.on("focusin",e=>{C.set(window,e.target)}),l.on("keydown",t=>{if(t.isDefaultPrevented())return;if(t.ctrlKey||t.altKey||t.metaKey)return;if(t.target.closest(".menus"))return;const n=l.$content.find("button"),o=e(document.activeElement),s=n.index(o);switch(t.keyCode){case 40:case 39:o.is("button")&&!t.shiftKey&&s<n.length-1&&(n[s+1].focus(),t.preventDefault());break;case 38:case 37:o.is("button")&&!t.shiftKey&&s>0&&(n[s-1].focus(),t.preventDefault());break;case 32:case 13:if(o.is("button")&&!t.shiftKey){o.addClass("pressed");const t=()=>{o.removeClass("pressed"),o.off("focusout",t),e(window).off("keyup",n)},n=e=>{32!==e.keyCode&&13!==e.keyCode||t()};o.on("focusout",t),e(window).on("keyup",n)}break;case 9:{const e=i(l.$content[0]);if(e.length>0){const n=e.index(o);t.shiftKey?0===n&&(t.preventDefault(),e[e.length-1].focus()):n===e.length-1&&(t.preventDefault(),e[0].focus())}break}case 27:l.close()}}),l.applyBounds=(()=>{const e=Math.max(document.body.scrollWidth,innerWidth),t=Math.max(document.body.scrollHeight,innerHeight);l.css({left:Math.max(0,Math.min(e-l.width(),l.position().left)),top:Math.max(0,Math.min(t-l.height(),l.position().top))})}),l.bringTitleBarInBounds=(()=>{const e=Math.max(document.body.scrollWidth,innerWidth),t=Math.max(document.body.scrollHeight,innerHeight);l.css({left:Math.max(40-l.outerWidth(),Math.min(e-40,l.position().left)),top:Math.max(0,Math.min(t-l.$titlebar.outerHeight()-5,l.position().top))})}),l.center=(()=>{l.css({left:(innerWidth-l.width())/2+window.scrollX,top:(innerHeight-l.height())/2+window.scrollY}),l.applyBounds()}),s.on("resize",l.bringTitleBarInBounds);var R=e=>{P===(e.pointerId||e.originalEvent.pointerId)&&(O=e.clientX||O,L=e.clientY||L),l.css({left:O+scrollX-B,top:L+scrollY-A})};if(l.$titlebar.css("touch-action","none"),l.$titlebar.on("selectstart",e=>{e.preventDefault()}),l.$titlebar.on("mousedown","button",t=>{M();const n=t.currentTarget;if(!e(n).is(":enabled"))return;n.classList.add("pressing");const o=t=>{t&&"blur"===t.type&&document.hasFocus()||(n.classList.remove("pressing"),s.off("mouseup blur",o),e(n).off("mouseenter",i),e(n).off("mouseleave",r))},i=()=>{n.classList.add("pressing")},r=()=>{n.classList.remove("pressing")};s.on("mouseup blur",o),e(n).on("mouseenter",i),e(n).on("mouseleave",r)}),l.$titlebar.on("pointerdown",t=>{if(e(t.target).closest("button").length)return;if(l.hasClass("maximized"))return;const n=e.Event("window-drag-start");l.trigger(n),n.isDefaultPrevented()||(B=t.clientX+scrollX-l.position().left,A=t.clientY+scrollY-l.position().top,O=t.clientX,L=t.clientY,P=t.pointerId||t.originalEvent.pointerId,s.on("pointermove",R),s.on("scroll",R),e("body").addClass("dragging"))}),s.on("pointerup pointercancel",t=>{(t.pointerId||t.originalEvent.pointerId)===P&&(s.off("pointermove",R),s.off("scroll",R),e("body").removeClass("dragging"),l.bringTitleBarInBounds(),P=-1)}),l.$titlebar.on("dblclick",e=>{c&&c.dock()}),t.resizable){const n=0,o=-1,i=1,r=o,a=i,c=o,d=i;[[c,a],[c,n],[c,r],[n,r],[d,r],[d,n],[d,a],[n,a]].forEach(([o,i])=>{const u=e("<div>").addClass("handle").appendTo(l);let m="";o===c&&(m+="n"),o===d&&(m+="s"),i===r&&(m+="w"),i===a&&(m+="e"),m+="-resize";const h=(l.outerWidth()-l.width())/2,p=(l.outerWidth()-l.innerWidth())/2,f=l.outerHeight()-l.$content.outerHeight(),w=l.outerWidth()-l.$content.outerWidth();let g,y,v,b,k,x;function C(e){(e.pointerId||e.originalEvent.pointerId)===x&&(b=e.clientX,k=e.clientY,S())}function _(t){(t.pointerId||t.originalEvent.pointerId)===x&&(s.off("pointermove",C),s.off("scroll",onscroll),e("body").removeClass("dragging"),s.off("pointerup pointercancel",_),l.bringTitleBarInBounds())}function S(){const e=b+scrollX-y,n=k+scrollY-v;let s,u,m=0,h=0;i===a?(m=0,s=~~(e-g.x)):i===r?(m=~~(e-g.x),s=~~(g.x+g.width-e)):s=~~g.width,o===d?(h=0,u=~~(n-g.y)):o===c?(h=~~(n-g.y),u=~~(g.y+g.height-n)):u=~~g.height;let p={x:g.x+m,y:g.y+h,width:s,height:u};p.width=Math.max(1,p.width),p.height=Math.max(1,p.height),t.constrainRect&&(p=t.constrainRect(p,i,o)),p.width=Math.max(p.width,t.minOuterWidth||100),p.height=Math.max(p.height,t.minOuterHeight||0),p.width=Math.max(p.width,(t.minInnerWidth||0)+w),p.height=Math.max(p.height,(t.minInnerHeight||0)+f),i===r&&(p.x=Math.min(p.x,g.x+g.width-p.width)),o===c&&(p.y=Math.min(p.y,g.y+g.height-p.height)),l.css({top:p.y,left:p.x}),l.outerWidth(p.width),l.outerHeight(p.height)}u.css({position:"absolute",top:o===c?-p:o===n?`calc(${h}px - ${p}px)`:"",bottom:o===d?-p:"",left:i===r?-p:i===n?`calc(${h}px - ${p}px)`:"",right:i===a?-p:"",width:i===n?`calc(100% - ${h}px * 2 + ${2*p}px)`:`${h}px`,height:o===n?`calc(100% - ${h}px * 2 + ${2*p}px)`:`${h}px`,touchAction:"none",cursor:m}),u.on("pointerdown",t=>{t.preventDefault(),s.on("pointermove",C),s.on("scroll",S),e("body").addClass("dragging"),s.on("pointerup pointercancel",_),g={x:l.position().left,y:l.position().top,width:l.outerWidth(),height:l.outerHeight()},y=t.clientX+scrollX-g.x-(i===a?g.width:0),v=t.clientY+scrollY-g.y-(o===d?g.height:0),b=t.clientX,k=t.clientY,x=t.pointerId||t.originalEvent.pointerId,u[0].setPointerCapture(x)})})}l.$Button=((t,o)=>{var i=e(n("button")).appendTo(l.$content).text(t).on("click",()=>{o&&o(),l.close()});return i}),l.title=(e=>e?(l.$title.text(e),l.trigger("title-change"),l.task&&l.task.updateTitle(),l):l.$title.text()),l.getTitle=(()=>l.title());let j,H=!1,N=[];return l.animateTitlebar=((e,t,n=(()=>{}))=>{H=!0;const o=l.$titlebar.clone(!0);o.find("button").remove(),o.appendTo("body");const i=a.OVERRIDE_TRANSITION_DURATION||200,s=`${i}ms`;o.css({transition:`left ${s} linear, top ${s} linear, width ${s} linear, height ${s} linear`,position:"fixed",zIndex:1e7,pointerEvents:"none",left:e.left,top:e.top,width:e.width,height:e.height}),setTimeout(()=>{o.css({left:t.left,top:t.top,width:t.width,height:t.height})},5);let r=!1;const c=()=>{if(r)return;r=!0,H=!1,o.remove(),n();let e=N.shift();e&&e()};o.on("transitionend transitioncancel",c),setTimeout(c,1.2*i)}),l.close=(t=>{if(t&&!0!==t)throw new TypeError("force must be a boolean or undefined, not "+Object.prototype.toString.call(t));if(!t){var n=e.Event("close");if(l.trigger(n),n.isDefaultPrevented())return}c&&c.detach(),l.closed=!0,u.triggerHandler("closed"),l.trigger("closed"),l.remove();var o=e(e(".window:visible").toArray().sort((e,t)=>t.style.zIndex-e.style.zIndex)[0]);o.triggerHandler("refocus-window"),W()}),l.closed=!1,l.setMenuBar=(e=>{j&&j.element.remove(),e&&(l.$titlebar.after(e.element),e.setKeyboardScope(l[0]),j=e)}),t.title&&l.title(t.title),c||l.center(),l}return a.$FormWindow=function(t){var o=new a;return o.title(t),o.$form=e(n("form")).appendTo(o.$content),o.$main=e(n("div")).appendTo(o.$form),o.$buttons=e(n("div")).appendTo(o.$form).addClass("button-group"),o.$Button=((t,i)=>{var s=e(n("button")).appendTo(o.$buttons).text(t);return s.on("click",e=>{e.preventDefault(),i()}),s.on("pointerdown",()=>{s.focus()}),s}),o},a}),e("skylark-98js/iframe-windows",["skylark-jquery","./win98","./os-gui/$Window"],function(e,t,n){var o=0,i=e(window);function s(t){var n=e(t);e("body").addClass("loading-program"),o+=1,n.on("load",function(){--o<=0&&e("body").removeClass("loading-program");try{console.assert(t.contentWindow.document===t.contentDocument)}catch(e){return void console.warn(`[enhance_iframe] iframe integration is not available for '${t.src}'`)}if(window.themeCSSProperties&&applyTheme(themeCSSProperties,t.contentDocument.documentElement),t.contentDocument.addEventListener("mousedown",e=>{var n=function(){if(t.contentWindow&&t.contentWindow.jQuery&&t.contentWindow.jQuery("body").trigger("pointerup"),t.contentWindow){const e=new t.contentWindow.MouseEvent("mouseup",{button:0});t.contentWindow.dispatchEvent(e);const n=new t.contentWindow.MouseEvent("mouseup",{button:2});t.contentWindow.dispatchEvent(n)}o()};function o(){i.off("mouseup blur",n),t.contentDocument.removeEventListener("mouseup",o)}i.on("mouseup blur",n),t.contentDocument.addEventListener("mouseup",o)}),r(t),t.contentDocument.querySelector("#error #livewebInfo.available")){var s=document.createElement("div");s.style.position="absolute",s.style.left="0",s.style.right="0",s.style.top="0",s.style.bottom="0",s.style.background="#c0c0c0",s.style.color="#000",s.style.padding="50px",t.contentDocument.body.appendChild(s),s.innerHTML='<a target="_blank">Save this url in the Wayback Machine</a>',s.querySelector("a").href="https://web.archive.org/save/https://98.js.org/"+t.src.replace(/.*https:\/\/98.js.org\/?/,""),s.querySelector("a").style.color="blue"}var a=e(t.contentWindow);a.on("pointerdown click",function(n){t.$window&&t.$window.focus(),e(".menu-button").trigger("release"),e(".menu-popup").hide()}),a.on("pointerdown",function(t){n.css("pointer-events","all"),e("body").addClass("drag")}),a.on("pointerup",function(t){e("body").removeClass("drag"),n.css("pointer-events","")}),t.contentWindow.close=function(){t.$window&&t.$window.close()},t.contentWindow.showMessageBox=(e=>showMessageBox({title:e.title||t.contentWindow.defaultMessageBoxTitle,...e}))}),n.css({minWidth:0,minHeight:0,flex:1,border:0})}function r(e){for(const t of["keyup","keydown","keypress"])e.contentWindow.addEventListener(t,n=>{const o=new KeyboardEvent(t,{target:e,view:e.ownerDocument.defaultView,bubbles:!0,cancelable:!0,key:n.key,keyCode:n.keyCode,which:n.which,code:n.code,shiftKey:n.shiftKey,ctrlKey:n.ctrlKey,metaKey:n.metaKey,altKey:n.altKey,repeat:n.repeat}),i=e.dispatchEvent(o);i||n.preventDefault()},!0)}return e(window).on("pointerdown",function(t){e("body").addClass("drag")}),e(window).on("pointerup dragend blur",function(t){"blur"===t.type&&document.activeElement.tagName.match(/iframe/i)||(e("body").removeClass("drag"),e("iframe").css("pointer-events",""))}),{enhance_iframe:s,proxy_keyboard_events:r,make_iframe_window:function(t){void 0==t.resizable&&(t.resizable=!0);var o=new n(t),i=o.$iframe=e("<iframe>").attr({src:t.src});return s(i[0]),o.$content.append(i),(o.iframe=i[0]).$window=o,i.on("load",function(){o.show(),o.focus()}),o.$content.css({display:"flex",flexDirection:"column"}),o.center(),o.hide(),o}}}),e("skylark-98js/Task",["skylark-jquery","./win98"],function(e,t){function n(t){n.all_tasks.push(this),this.$window=t;const o=this.$task=e("<button class='task toggle'/>").appendTo(e(".tasks")),i=e("<span class='title'/>");let s;this.updateTitle=(()=>{i.text(t.getTitle())}),this.updateIcon=(()=>{const e=s;(s=t.getIconAtSize(16))?e?e.replaceWith(s):o.prepend(s):e&&e.remove()}),this.updateTitle(),this.updateIcon(),t.on("title-change",this.updateTitle),t.on("icon-change",this.updateIcon),t.setMinimizeTarget(o[0]),o.append(s,i),o.on("pointerdown",function(e){e.preventDefault()}),o.on("click",function(){o.hasClass("selected")?(t.minimize(),t.blur()):(t.unminimize(),t.bringToFront(),t.focus())}),t.onFocus(()=>{o.addClass("selected")}),t.onBlur(()=>{o.removeClass("selected")}),t.onClosed(()=>{o.remove();const e=n.all_tasks.indexOf(this);-1!==e&&n.all_tasks.splice(e,1)}),t.is&&t.is(":visible")&&t.focus()}return n.all_tasks=[],n}),e("skylark-98js/visualizer-overlay",["skylark-jquery","./win98"],function(e,t){window.monkey_patch_render=(e=>e.render());return class{constructor(e,t){this.visualizerCanvas=e,this.wrappyCanvas=document.createElement("canvas"),this.wrappyCtx=this.wrappyCanvas.getContext("2d"),this.overlayCanvases=[],this.animateFns=[],window.monkey_patch_render=(e=>e.audio&&e.renderer?(e.render(),void this.render(t)):e.render())}makeOverlayCanvas(e){const t=document.createElement("canvas"),n=t.getContext("2d");t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.pointerEvents="none",t.style.mixBlendMode="color-dodge",t.style.willChange="opacity",t.className="visualizer-overlay-canvas",e.appendChild(t),this.overlayCanvases.push(t),this.animateFns.push(o=>{n.clearRect(0,0,t.width,t.height);const i=(e.classList.contains("doubled")?2:1)*(window.devicePixelRatio||1);t.width===e.clientWidth*i&&t.height===e.clientHeight*i||(t.width=e.clientWidth*i,t.height=e.clientHeight*i),t.style.width=e.clientWidth+"px",t.style.height=e.clientHeight+"px";const s=e.querySelectorAll("*");Array.from(s).map(e=>{const t=e.clientWidth,n=e.clientHeight,o=t*n;return{element:e,width:t,height:n,area:o}}).filter(({area:e})=>e>0).sort((e,t)=>t.area-e.area).forEach(({element:t,width:s,height:r,area:a})=>{const{offsetLeft:l,offsetTop:c}=function(e,t){let n=e,o=0,i=0;do{o+=n.offsetLeft,i+=n.offsetTop,n=n.offsetParent}while(n&&n!==t);return{offsetLeft:o,offsetTop:i}}(t,e);n.save(),n.scale(i,i),n.translate(l,c),o.stretch?n.drawImage(this.wrappyCanvas,0,0,s,r):n.drawImage(this.wrappyCanvas,0,0,s,r,0,0,s,r),a<900&&(n.globalCompositeOperation="destination-out",n.globalAlpha=.5,n.fillStyle="black",n.fillRect(0,0,s,r)),n.restore()})})}render(e){const{visualizerCanvas:t,wrappyCanvas:n,wrappyCtx:o,animateFns:i}=this,{width:s,height:r}=t;if(e.mirror){const e=()=>{o.drawImage(t,0,0,s,r,0,0,s,r)};n.width=2*s,n.height=2*r,o.save(),e(),o.translate(0,r),o.scale(1,-1),o.translate(0,-r),e(),o.translate(s,0),o.scale(-1,1),o.translate(-s,0),e(),o.translate(0,r),o.scale(1,-1),o.translate(0,-r),e(),o.restore()}else if(e.tile){n.width=2*s,n.height=2*r;for(let e=0;e<2;e++)for(let n=0;n<2;n++)o.drawImage(t,0,0,s,r,s*e,r*n,s,r)}else n.width=s,n.height=r,o.drawImage(t,0,0,s,r);i.forEach(t=>t(e))}cleanUp(){this.overlayCanvases.forEach(e=>{e.remove()}),window.monkey_patch_render=(e=>e.render())}fadeOutAndCleanUp(){this.fadeOut(),this.overlayCanvases[0].addEventListener("transitionend",()=>{this.cleanUp()})}fadeOut(){this.overlayCanvases.forEach(e=>{e.style.transition="opacity 1s cubic-bezier(0.125, 0.960, 0.475, 0.915)",e.style.opacity="0"})}fadeIn(){this.overlayCanvases.forEach(e=>{e.style.transition="opacity 0.2s ease",e.style.opacity="1"})}}}),e("skylark-98js/programs",["skylark-jquery","./win98","./filesystem-setup","./helpers","./FolderViewItem","./iframe-windows","./Task","./visualizer-overlay","./os-gui/$Window"],function(e,t,n,o,i,s,r,a,l){let c=s.make_iframe_window;function d(t){const n=l({title:t.title||"Help Topics",icons:A("chm"),resizable:!0});n.addClass("help-window");let o=!0,i=0,s=0;const a=e(E("div")).addClass("main"),c=e(E("div")).addClass("toolbar"),d=(t,o,i,s)=>{const r=e("<button class='lightweight'>").append(e("<span>").text(t)).appendTo(c).on("click",()=>{i()});e("<div class='icon'/>").appendTo(r).css({backgroundPosition:`${55*-o}px 0px`});const a=()=>{r[0].disabled=s&&!s()};return a(),n.on("click","*",a),n.on("update-buttons",a),r},u=()=>g.outerWidth()+parseFloat(getComputedStyle(g[0]).getPropertyValue("margin-left"))+parseFloat(getComputedStyle(g[0]).getPropertyValue("margin-right"))+w.outerWidth(),m=d("Hide",0,()=>{const e=u();g.hide(),w.hide(),m.hide(),h.show(),n.width(n.width()-e),n.css("left",n.offset().left+e)}),h=d("Show",5,()=>{g.show(),w.show(),h.hide(),m.show();const e=u();n.width(n.width()+e),n.css("left",n.offset().left-e),n.offset().left<0&&(n.width(n.width()+n.offset().left),n.css("left",0))}).hide();d("Back",1,()=>{p[0].contentWindow.history.back(),o=!0,i-=1,s+=1},()=>i>0),d("Forward",2,()=>{p[0].contentWindow.history.forward(),o=!0,s-=1,i+=1},()=>s>0),d("Options",3,()=>{},()=>!1),d("Web Help",4,()=>{f.src="help/online_support.htm"});const p=e("<iframe sandbox='allow-same-origin allow-scripts allow-forms allow-modals allow-popups allow-downloads'>").attr({src:"help/default.html"}).addClass("inset-deep"),f=p[0];enhance_iframe(f),f.$window=n;const w=e(E("div")).addClass("resizer"),g=e(E("ul")).addClass("contents inset-deep");p.on("load",()=>{o||(i+=1,s=0),f.contentWindow.location.href,o=!1,n.triggerHandler("update-buttons")}),a.append(g,w,p),n.$content.append(c,a),n.css({width:800,height:600}),p.attr({name:"help-frame"}),p.css({backgroundColor:"white",border:"",margin:"1px"}),g.css({margin:"1px"}),n.center(),a.css({position:"relative"});w.css({cursor:"ew-resize",width:4,boxSizing:"border-box",background:"var(--ButtonFace)",borderLeft:"1px solid var(--ButtonShadow)",boxShadow:"inset 1px 0 0 var(--ButtonHilight)",top:0,bottom:0,zIndex:1}),w.on("pointerdown",e=>{let t,o;const i=e=>Math.min(n.width()-100,Math.max(20,e.clientX-n.$content.offset().left));$G.on("pointermove",t=(e=>{w.css({position:"absolute",left:i(e)}),g.css({marginRight:4})})),$G.on("pointerup",o=(e=>{$G.off("pointermove",t),$G.off("pointerup",o),w.css({position:"",left:""}),g.css({flexBasis:i(e)-4,marginRight:""})}))});const y=e=>{const t={};for(const n of e.children("param").get())t[n.name]=n.value;return t};let v;const b=t=>{const n=e(E("div")).addClass("item").text(t);return n.on("mousedown",()=>{g.find(".item").removeClass("selected"),n.addClass("selected")}),n.on("click",()=>{const e=n.parent();e.is(".folder")&&(v&&v.not(e).removeClass("expanded"),e.toggleClass("expanded"),v=e)}),n},k=e(E("li")).addClass("page");k.append(b("Welcome to Help").on("click",()=>{p.attr({src:"help/default.html"})})),g.append(k),e.get(t.contentsFile,n=>{e(e.parseHTML(n)).filter("ul").children().get().forEach(n=>{!function n(o,i){const s=y(e(o).children("object"));if(e(o).find("li").length>0){const t=e(E("li")).addClass("folder");t.append(b(s.Name)),g.append(t);const i=e(E("ul"));t.append(i),e(o).children("ul").children().get().forEach(e=>{n(e,i)})}else{const n=e(E("li")).addClass("page");n.append(b(s.Name).on("click",()=>{p.attr({src:`${t.root}/${s.Local}`})})),i?i.append(n):g.append(n)}}(n,null)})});var x=new r(n);return x.$help_window=n,x}function u(e){var t=e?file_name_from_path(e):"Untitled",n=t+" - Notepad",o=c({src:"programs/notepad/index.html"+(e?"?path="+e:""),icons:A("notepad"),title:n,outerWidth:480,outerHeight:321,resizable:!0});return new r(o)}function m(e){var t=c({src:"programs/jspaint/index.html",icons:A("paint"),title:"untitled - Paint",outerWidth:275,outerHeight:400,minOuterWidth:275,minOuterHeight:400}),o=t.$iframe[0].contentWindow,i=function(e,t,n){e()?n():setTimeout(i,t,e,t,n)};const s={readBlobFromHandle:e=>new Promise((t,o)=>{n.withFilesystem(()=>{var n=BrowserFS.BFSRequire("fs");n.readFile(e,(n,i)=>{if(n)return o(n);const s=new Uint8Array(i),r=new Blob([s]),a=e.replace(/.*\//g,""),l=new File([r],a);t(l)})})}),writeBlobToHandle:async(e,t)=>{const o=await t.arrayBuffer();return new Promise((t,i)=>{n.withFilesystem(()=>{const n=BrowserFS.BFSRequire("fs"),{Buffer:s}=BrowserFS.BFSRequire("buffer"),r=s.from(o);n.writeFile(e,r,e=>{if(e)return i(e);t()})})})},setWallpaperCentered:e=>{e.toBlob(e=>{setDesktopWallpaper(e,"no-repeat",!0)})},setWallpaperTiled:e=>{e.toBlob(e=>{setDesktopWallpaper(e,"repeat",!0)})}};return i(()=>o.systemHooks,500,()=>{let n;Object.assign(o.systemHooks,s),o.show_help=(()=>{n?n.focus():(n=d({title:"Paint Help",contentsFile:"programs/jspaint/help/mspaint.hhc",root:"programs/jspaint/help"}).$help_window).on("close",()=>{n=null})}),e&&s.readBlobFromHandle(e).then(t=>{t&&o.open_from_file(t,e)},t=>{o.show_error_message(`Failed to open file ${e}`,t)});var i=o.update_title;o.update_title=(()=>{i(),t.title(o.document.title)})}),new r(t)}function h(){var e=c({src:"programs/minesweeper/index.html",icons:A("minesweeper"),title:"Minesweeper",innerWidth:280,innerHeight:341,resizable:!1});return new r(e)}function p(e){var t=e?file_name_from_path(e):"Sound",n=t+" - Sound Recorder",o=c({src:"programs/sound-recorder/index.html"+(e?"?path="+e:""),icons:A("speaker"),title:n,innerWidth:270,innerHeight:129,minInnerWidth:270,minInnerHeight:129});return new r(o)}function f(){var e=c({src:"programs/js-solitaire/index.html",icons:A("solitaire"),title:"Solitaire",innerWidth:585,innerHeight:405});return new r(e)}function w(t){const n=e("<iframe>").attr("src",t),o=e("<div>");o.css({position:"fixed",left:0,top:0,width:"100%",height:"100%",zIndex:l.Z_INDEX+9998,cursor:"none",backgroundColor:"black"}),n.css({position:"fixed",left:0,top:0,width:"100%",height:"100%",zIndex:l.Z_INDEX+9999,border:0,pointerEvents:"none"}),o.appendTo("body"),n.appendTo("body");const i=()=>{o.remove(),n.remove();const t=e=>{e.preventDefault()};e(window).on("contextmenu",t),setTimeout(()=>{e(window).off("contextmenu",t),window.removeEventListener("keydown",s,!0)},500)},s=e=>{["F11","F12","ZoomToggle","PrintScreen","MediaRecord","BrightnessDown","BrightnessUp","Dimmer"].includes(e.key)||(e.preventDefault(),e.stopPropagation(),i())};let r,a;o.on("mousemove pointermove",e=>{void 0===r&&(r=e.pageX,a=e.pageY),Math.hypot(r-e.pageX,a-e.pageY)>15&&i()}),o.on("mousedown pointerdown touchstart",e=>{e.preventDefault(),i()}),window.addEventListener("keydown",s,!0)}function g(){w(`programs/pipes/index.html#${encodeURIComponent(JSON.stringify({hideUI:!0}))}`)}function y(){w("programs/3D-FlowerBox/index.html")}function v(){var e=c({src:"programs/command/index.html",icons:A("msdos"),title:"MS-DOS Prompt",innerWidth:640,innerHeight:400,constrainRect(t,n,o){const i=(e.outerWidth()-e.$content.outerWidth())/2,s={x:t.x+i,y:t.y+i+e.$titlebar.outerHeight(),width:t.width-e.outerWidth()+e.$content.outerWidth(),height:t.height-e.outerHeight()+e.$content.outerHeight()},r={width:8*Math.floor(s.width/8),height:16*Math.floor(s.height/16)},a={x:s.x-i,y:s.y-i-e.$titlebar.outerHeight(),width:r.width+e.outerWidth()-e.$content.outerWidth(),height:r.height+e.outerHeight()-e.$content.outerHeight()};return-1===n&&(a.x=t.x+t.width-a.width),-1===o&&(a.y=t.y+t.height-a.height),a}});return new r(e)}function b(){var e=c({src:"programs/calculator/index.html",icons:A("calculator"),title:"Calculator",innerWidth:256,innerHeight:229,minInnerWidth:256,minInnerHeight:229});return new r(e)}function k(){var t=c({src:"programs/pinball/space-cadet.html",icons:A("pinball"),title:"3D Pinball for Windows - Space Cadet",innerWidth:600,innerHeight:436,minInnerWidth:600,minInnerHeight:436,override_alert:!1});const n=e("<div>").css({position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"url(images/pinball-splash.png) no-repeat center center",backgroundColor:"black",zIndex:l.Z_INDEX+6e3}).appendTo("body");return setTimeout(()=>{n.remove()},5e3),t.$content.find("iframe").on("game-loaded",()=>{n.remove()}),t.$content.find("iframe").on("game-load-failed",()=>{n.remove(),t.title("Wormhole Window - Space Cadet")}),new r(t)}function x(e){var t=e,n=t,o=c({src:"programs/explorer/index.html"+(e?"?address="+encodeURIComponent(e):""),icons:A("folder-open"),title:n,innerWidth:Math.min(856,.9*innerWidth),innerHeight:Math.min(547,.7*innerHeight)});return new r(o)}u.acceptsFilePaths=!0,m.acceptsFilePaths=!0,p.acceptsFilePaths=!0,x.acceptsFilePaths=!0;var C=function(t,n){e.getScript("programs/winamp/lib/webamp.bundle.min.js",()=>{t?e.getScript("programs/winamp/lib/butterchurn.min.js",()=>{e.getScript("programs/winamp/lib/butterchurnPresets.min.js",()=>{n()})}):n()})};const _=()=>{const e=document.createElement("canvas");let t;try{t=e.getContext("webgl2")}catch(e){t=null}const n=!!t,o=!(!window.AudioContext&&!window.webkitAudioContext);return n&&o};let S,I,$,T,D=!1;function z(t){const i=e=>new Promise((t,o)=>{n.withFilesystem(function(){var n=BrowserFS.BFSRequire("fs");n.readFile(e,function(e,n){if(e)return o(e);const i=new Uint8Array(n),s=new Blob([i]);t(s)})})}),s=async e=>{const t=await i(e),n=URL.createObjectURL(t),o={url:n,defaultName:file_name_from_path(e).replace(/\.[a-z0-9]+$/i,"")};return o},c=async()=>{if("none"===I.css("display")&&T.unminimize(),T.focus(),t)if(t.match(/(\.wsz|\.zip)$/i)){const e=await i(t),n=URL.createObjectURL(e);S.setSkinFromUrl(n)}else if(t.match(/(\.m3u|\.pls)$/i))alert("Sorry, we don't support playlists yet.");else{const e=await s(t);S.setTracksToPlay([e])}D=!1};if($)return void c();if(D)return;D=!0;const d=_();C(d,function(){const t={initialTracks:[{metaData:{artist:"DJ Mike Llama",title:"Llama Whippin' Intro"},url:"programs/winamp/mp3/llama-2.91.mp3",duration:5.322286}],enableHotkeys:!0,handleTrackDropEvent:e=>Promise.all(dragging_file_paths.map(s))};d&&(t.__butterchurnOptions={importButterchurn:()=>Promise.resolve(window.butterchurn),getPresets:()=>{const e=window.butterchurnPresets.getPresets();return Object.keys(e).map(t=>({name:t,butterchurnPresetObject:e[t]}))},butterchurnOpen:!0},t.__initialWindowLayout={main:{position:{x:0,y:0}},equalizer:{position:{x:0,y:116}},playlist:{position:{x:0,y:232},size:[0,4]},milkdrop:{position:{x:275,y:0},size:[7,12]}}),S=new Webamp(t);var n=document.createElement("div");n.classList.add("webamp-visual-container"),n.style.position="absolute",n.style.left="0",n.style.right="0",n.style.top="0",n.style.bottom="0",n.style.pointerEvents="none",document.body.appendChild(n),S.renderWhenReady(n).then(()=>{window.console&&console.log("Webamp rendered"),(I=e("#webamp")).css({position:"absolute",left:0,top:0,zIndex:l.Z_INDEX++});const t=e({}),n=e=>n=>{const o=()=>{n()};t.on(e,o);return()=>{t.off(e,o)}};let i;(T={}).onFocus=n("focus"),T.onBlur=n("blur"),T.onClosed=n("closed"),T.getIconAtSize=(e=>{32!==e&&16!==e&&(e=32);const t=document.createElement("img");return t.src=o.getIconPath("winamp2",e),t}),T.bringToFront=(()=>{I.css({zIndex:l.Z_INDEX++})}),T.element=T[0]=I[0],T.hasClass=(e=>"focused"===e&&I.hasClass("focused")),T.focus=(()=>{I.hasClass("focused")||(I.addClass("focused"),T.bringToFront(),t.triggerHandler("focus"),I.find("#main-window [tabindex='-1']").focus())}),T.blur=(()=>{I.hasClass("focused")&&(I.removeClass("focused"),t.triggerHandler("blur"))}),T.minimize=(()=>{I.hide()}),T.unminimize=(()=>{I.show()}),T.close=(()=>{S.dispose(),I.remove(),t.triggerHandler("closed"),S=null,I=null,$=null,T=null}),T.getTitle=(()=>{let e="Winamp 2.91";const t=I.find(".playlist-track-titles .track-cell.current");if(t.length)switch(e=`${t.text()} - Winamp`,S.getMediaStatus()){case"STOPPED":e=`${e} [Stopped]`;break;case"PAUSED":e=`${e} [Paused]`}return e}),T.setMinimizeTarget=(()=>{}),T.on=((e,t)=>{"title-change"===e?S.onTrackDidChange(t):"icon-change"===e||console.warn(`Unsupported event: ${e}`)}),o.mustHaveMethods(T,o.windowInterfaceMethods),$=new r(T),S.onClose(function(){T.close(),cancelAnimationFrame(i),s.fadeOutAndCleanUp()}),S.onMinimize(function(){T.minimize()}),I.on("focusin",()=>{T.focus()}),I.on("focusout",()=>{document.activeElement&&document.activeElement.closest&&document.activeElement.closest("#webamp")||T.blur()});const s=new a(I.find(".gen-window canvas")[0],{mirror:!0,stretch:!0}),d=()=>{const t=e(".os-window, .window:not(.gen-window)").toArray();t.forEach(e=>{e.hasOverlayCanvas||(s.makeOverlayCanvas(e),e.hasOverlayCanvas=!0)}),"PLAYING"===S.getMediaStatus()?s.fadeIn():s.fadeOut(),i=requestAnimationFrame(d)};i=requestAnimationFrame(d),c()},e=>{alert("Failed to render Webamp:\n\n"+e),console.error(e)})})}function F(e){n.withFilesystem(function(){var t=BrowserFS.BFSRequire("fs");t.readFile(e,"utf8",function(e,t){if(e)return alert(e);var n=t.match(/URL\s*=\s*([^\n\r]+)/i),o=n?n[1]:t;x(o)})})}function W(e){n.withFilesystem(function(){var t=BrowserFS.BFSRequire("fs");t.readFile(e,"utf8",function(t,n){if(t)return alert(t);loadThemeFromText(n);try{localStorage.setItem("desktop-theme",n),localStorage.setItem("desktop-theme-path",e)}catch(e){}})})}z.acceptsFilePaths=!0,F.acceptsFilePaths=!0,W.acceptsFilePaths=!0;var M={"":u,ahk:u,ai:m,bat:u,check_cache:u,cmake:u,cmd:u,conf:u,cpp:u,css:u,d:u,editorconfig:u,filters:u,gitattributes:u,gitignore:u,gitrepo:u,h:u,hhc:u,hhk:u,html:u,ini:u,js:u,json:u,log:u,make:u,map:u,marks:u,md:u,prettierignore:u,properties:u,rc:u,rsp:u,sh:u,ts:u,txt:u,vcxproj:u,webmanifest:u,xml:u,yml:u,bmp:m,cur:m,eps:m,gif:m,icns:m,ico:m,jpeg:m,jpg:m,kra:m,pbm:m,pdf:m,pdn:m,pgm:m,png:m,pnm:m,ppm:m,ps:m,psd:m,svg:m,tga:m,tif:m,tiff:m,webp:m,xbm:m,xcf:m,xcfbz2:m,xcfgz:m,xpm:m,wsz:z,zip:z,wav:p,mp3:z,ogg:z,wma:z,m4a:z,aac:z,flac:z,mka:z,mpc:z,"mp+":z,m3u:z,pls:z,htm:x,html:x,url:F,theme:W,themepack:W};function B(e){n.withFilesystem(function(){var t=BrowserFS.BFSRequire("fs");t.stat(e,function(t,n){if(t)return alert("Failed to get info about "+e+"\n\n"+t);if(n.isDirectory())x(e);else{var o=file_extension_from_path(e),i=M[o.toLowerCase()];if(i){if(!i.acceptsFilePaths)return void alert(i.name+" does not support opening files via the virtual filesystem yet");i(e)}else alert("No program is associated with "+o+" files")}})})}function A(e){return{16:`images/icons/${e}-16x16.png`,32:`images/icons/${e}-32x32.png`}}return{systemExecuteFile:B,initDesktopFolderView:function(e){var t=function(t){e.add_item(new i({icons:{[o.DESKTOP_ICON_SIZE]:o.getIconPath(t.iconID,o.DESKTOP_ICON_SIZE)},...t}))};t({title:"My Computer",iconID:"my-computer",open:function(){B("/")},is_system_folder:!0}),t({title:"My Documents",iconID:"my-documents-folder",open:function(){B("/my-documents")},is_system_folder:!0}),t({title:"Network Neighborhood",iconID:"network",open:function(){B("/network-neighborhood")},is_system_folder:!0}),t({title:"Recycle Bin",iconID:"recycle-bin",open:function(){x("https://www.epa.gov/recycle/")},is_system_folder:!0}),t({title:"My Pictures",iconID:"folder",open:function(){B("/my-pictures")},is_system_folder:!0}),t({title:"Internet Explorer",iconID:"internet-explorer",open:function(){x("https://www.google.com/")}}),t({title:"Paint",iconID:"paint",open:m,shortcut:!0}),t({title:"Minesweeper",iconID:"minesweeper",open:h,shortcut:!0}),t({title:"Sound Recorder",iconID:"speaker",open:p,shortcut:!0}),t({title:"Solitaire",iconID:"solitaire",open:f,shortcut:!0}),t({title:"Notepad",iconID:"notepad",open:u,shortcut:!0}),t({title:"Winamp",iconID:"winamp2",open:z,shortcut:!0}),t({title:"3D Pipes",iconID:"pipes",open:g,shortcut:!0}),t({title:"3D Flower Box",iconID:"pipes",open:y,shortcut:!0}),t({title:"MS-DOS Prompt",iconID:"msdos",open:v,shortcut:!0}),t({title:"Calculator",iconID:"calculator",open:b,shortcut:!0}),t({title:"Pinball",iconID:"pinball",open:k,shortcut:!0}),e.arrange_icons()}}}),e("skylark-98js/$desktop",["skylark-jquery","./win98","./FolderView","./programs"],function(e,t,n,o){"use strict";var i=e(".desktop");i.css("touch-action","none");var s=new n("/desktop/",{asDesktop:!0,openFileOrFolder:e=>{o.systemExecuteFile(e)}});e(s.element).appendTo(i);try{var r=localStorage.getItem("wallpaper-data-url"),a=localStorage.getItem("wallpaper-repeat"),l=localStorage.getItem("desktop-theme");r&&fetch(r).then(e=>e.blob()).then(e=>{!function(e,t,n){const o=URL.createObjectURL(e);if(i.css({backgroundImage:`url(${o})`,backgroundRepeat:t,backgroundPosition:"center",backgroundSize:"auto"}),n){var s=new FileReader;window.fr=s,s.onload=(()=>{localStorage.setItem("wallpaper-data-url",s.result),localStorage.setItem("wallpaper-repeat",t)}),s.onerror=(()=>{console.error("Error reading file (for setting wallpaper)",e)}),s.readAsDataURL(e)}}(e,a,!1)}),l&&d(l)}catch(e){console.error(e)}function c(e){var t=new FileReader;t.onload=(()=>{d(t.result)}),t.readAsText(e)}function d(e){var t=parseThemeFileString(e);!function(e,t=document.documentElement){applyCSSProperties(e,{element:t,recurseIntoIframes:!0})}(t),window.themeCSSProperties=t}return e("html").on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),e("html").on("dragleave",function(e){e.preventDefault(),e.stopPropagation()}),e("html").on("drop",function(e){e.preventDefault(),e.stopPropagation();var t=[...e.originalEvent.dataTransfer.files];for(var n of t)n.name.match(/\.theme(pack)?$/i)&&c(n)}),e(window).on("scroll focusin",()=>{window.scrollTo(0,0)}),o.initDesktopFolderView(s),i.reflow(),t.$desktop=i}),e("skylark-98js/$start-menu",["skylark-jquery","./win98","./os-gui/$Window"],function(e,t,n){var o=e(".start-menu");o.hide();var i=function(){r.removeClass("selected"),o.attr("hidden","hidden"),o.hide()},s=function(){o.is(":hidden")?(r.addClass("selected"),o.attr("hidden",null),o.slideDown(100),o.css({zIndex:++n.Z_INDEX+5001})):i()},r=e(".start-button");return r.on("pointerdown",function(){s()}),e("body").on("pointerdown",function(t){0===e(t.target).closest(".start-menu, .start-button").length&&i()}),e(window).on("keydown",function(e){27===e.which&&i()}),o}),e("skylark-98js/$taskbar-time",["skylark-jquery","./win98"],function(e,t){var n=e(".taskbar-time"),o=function(){n.text((new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),n.attr("title",(new Date).toLocaleString([],{weekday:"long",month:"long",day:"2-digit",minute:"2-digit",hour:"2-digit"})),setTimeout(o,1e3)};return o(),n}),e("skylark-98js/msgbox",["skylark-jquery","./win98","./os-gui/$Window"],function(e,t,n){var o=new Audio("/audio/CHORD.WAV");window.showMessageBox=window.showMessageBox||(({title:t=window.defaultMessageBoxTitle||"Alert",message:i,messageHTML:s,buttons:r=[{label:"OK",value:"ok",default:!0}],iconID:a="warning",windowOptions:l={}})=>{let c,d;const u=new Promise((o,u)=>{c=new n(Object.assign({title:t,resizable:!1,innerWidth:400,maximizeButton:!1,minimizeButton:!1},l)),d=e("<div>").css({textAlign:"left",fontFamily:"MS Sans Serif, Arial, sans-serif",fontSize:"14px",marginTop:"22px",flex:1,minWidth:0,whiteSpace:"normal"}),s?d.html(s):i&&d.text(i).css({whiteSpace:"pre-wrap",wordWrap:"break-word"}),e("<div>").append(e("<img width='32' height='32'>").attr("src",`../../images/icons/${a}-32x32-8bpp.png`).css({margin:"16px",display:"block"}),d).css({display:"flex",flexDirection:"row"}).appendTo(c.$content),c.$content.css({textAlign:"center"});for(const e of r){const t=c.$Button(e.label,()=>{e.action&&e.action(),o(e.value),c.close()});e.default&&(t.addClass("default"),t.focus(),setTimeout(()=>t.focus(),0)),t.css({minWidth:75,height:23,margin:"16px 2px"})}c.on("focusin","button",t=>{e(t.currentTarget).addClass("default")}),c.on("focusout","button",t=>{e(t.currentTarget).removeClass("default")}),c.on("closed",()=>{o("closed")}),c.center()});u.$window=c,u.$message=d,u.promise=u;try{o.play()}catch(e){console.log(`Failed to play ${o.src}: `,e)}return u}),window.alert=(e=>{showMessageBox({message:e})})}),e("skylark-98js/window-switcher",["skylark-jquery","skylark-clippy","./win98","./Task"],function(e,t,n,o){var i,s,r=e("<div class='window-switcher outset-deep'>"),a=e("<ul class='window-switcher-list'>").appendTo(r),l=e("<div class='window-switcher-window-name inset-deep'>").appendTo(r),c=!1;function d(e){e.unminimize(),e.bringToFront(),e.focus()}function u(t){const n=r.find(".window-switcher-item").toArray(),o=r.find(".active"),i=n.indexOf(o[0]),s=(i+(t?-1:1)+n.length)%n.length;o.removeClass("active");const a=n[s];e(a).addClass("active"),l.text(e(a).data("$window").getTitle())}function m(){r.remove()}window.addEventListener("keydown",function(t){if(t.altKey&&("4"===t.key||"F4"===t.key)){t.preventDefault();const e=t.target.closest(".os-window")&&t.target.closest(".os-window").$window;console.log("Alt+4 detected, closing window",e,t.target),e&&e.close()}!t.altKey||"Backquote"!==t.code&&"Tab"!==t.code?m():function(t){if(r.is(":visible"))return void u(t);a.empty();const n=o.all_tasks;if(1===n.length)return d(n[0].$window),void(c||(i&&i.stopCurrent(),i&&i.speak("If there's only one window, Alt+` will switch to it right away.")));if(n.length<2)return;n.sort((e,t)=>t.$window[0].style.zIndex-e.$window[0].style.zIndex);for(const t of n){var s=t.$window,l=e("<li>").addClass("window-switcher-item");l.append(s.getIconAtSize(32)||e("<img>").attr({src:"/images/icons/task-32x32.png",width:32,height:32,alt:s.getTitle()})),l.data("$window",s),a.append(l),s.hasClass("focused")&&l.addClass("active")}u(t),r.appendTo("body"),c||(i&&i.stopCurrent(),i&&i.speak("There you go! Press grave accent until you get to the window you want."),c=!0)}(t.shiftKey);"Alt"===t.key&&(h=!0,clearInterval(s),s=setInterval(f,200))},!0),window.addEventListener("keyup",function(e){e.altKey||(h=!1,clearInterval(s),function(){if(!r.is(":visible"))return;const e=r.find(".active");if(0===e.length)return;d(e.data("$window")),r.remove()}())},!0),window.addEventListener("blur",m);var h=!1,p=!1;function f(){if(h&&!top.document.hasFocus()){if((!top.document.activeElement||top.document.activeElement===top.document.body||top.document.activeElement===top.document.documentElement)&&(top.focus(),top.document.hasFocus()))return;if(clearInterval(s),h=!1,o.all_tasks.length<2)return;p||(new t.load("Clippy",function(t){(i=t).show();i.speak("It looks like you're trying to switch windows.\n\nUse Alt+` (grave accent) instead of Alt+Tab within the 98.js desktop.\n\nAlso, use Alt+4 instead of Alt+F4 to close windows.",!0),e(i._el).one("dblclick",function(){i.stopCurrent(),i.animate()})}),p=!0)}}}),e("skylark-98js/main",["./$desktop","./$start-menu","./$taskbar-time","./filesystem-setup","./FolderView","./FolderViewItem","./msgbox","./Task","./visualizer-overlay","./window-switcher"],function(){}),e("skylark-98js",["skylark-98js/main"],function(e){return e})}(n),!o){var r=require("skylark-langx-ns");i?module.exports=r:t.skylarkjs=r}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-98js.js.map
