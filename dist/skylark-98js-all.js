/**
 * skylark-98js - A version of 98js.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-98js/
 * @license MIT
 */
!function(factory,globals){var define=globals.define,require=globals.require,isAmd="function"==typeof define&&define.amd,isCmd=!isAmd&&"undefined"!=typeof exports;if(!isAmd&&!define){var map={};define=globals.define=function(t,e,n){"function"==typeof n?(map[t]={factory:n,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var n=e.split("/"),r=t.split("/");n.pop();for(var i=0;i<r.length;i++)"."!=r[i]&&(".."==r[i]?n.pop():n.push(r[i]));return n.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):map[t]={factory:null,resolved:!0,exports:n}},require=globals.require=function(t){if(!map.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=map[t];if(!module.resolved){var e=[];module.deps.forEach(function(t){e.push(require(t))}),module.exports=module.factory.apply(globals,e)||null,module.resolved=!0}return module.exports}}if(!define)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(define,require){define("skylark-langx-ns/_attach",[],function(){return function(t,e,n){"string"==typeof e&&(e=e.split("."));for(var r=e.length,i=t,s=0,o=e[s++];s<r;)i=i[o]=i[o]||{},o=e[s++];if(i[o]){if(n)throw new Error("This namespace already exists:"+e)}else i[o]=n||{};return i[o]}}),define("skylark-langx-ns/ns",["./_attach"],function(t){var e={attach:function(n,r){return t(e,n,r)}};return e}),define("skylark-langx-ns/main",["./ns"],function(t){return t}),define("skylark-langx-ns",["skylark-langx-ns/main"],function(t){return t}),define("skylark-langx/skylark",["skylark-langx-ns"],function(t){return t}),define("skylark-langx-arrays/arrays",["skylark-langx-ns"],function(t){return t.attach("langx.arrays")}),define("skylark-langx-arrays/base-find-index",["./arrays"],function(t){return t.baseFindIndex=function(t,e,n,r){var i=t.length,s=n+(r?1:-1);for(;r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}}),define("skylark-langx-arrays/base-indexof",["./arrays","./base-find-index"],function(t,e){function n(t){return t!=t}return t.baseIndexOf=function(t,r,i){if(r!=r)return e(t,n,i);var s=i-1,o=t.length;for(;++s<o;)if(t[s]===r)return s;return-1}}),define("skylark-langx-arrays/filter",["./arrays"],function(t){var e=Array.prototype.filter;return t.filter=function(t,n){return e.call(t,n)}}),define("skylark-langx-arrays/compact",["./arrays","./filter"],function(t,e){return t.compact=function(t){return e(t,function(t){return null!=t})}}),define("skylark-langx-arrays/in-array",["./arrays"],function(t){return t.inArray=function(t,e){if(!e)return-1;var n;if(e.indexOf)return e.indexOf(t);n=e.length;for(;n--;)if(e[n]===t)return n;return-1}}),define("skylark-langx-arrays/contains",["./arrays","./in-array"],function(t,e){return t.contains=function(t,n){return e(n,t)}}),define("skylark-langx-funcs/funcs",["skylark-langx-ns"],function(t,e,n){return t.attach("langx.funcs",{noop:function(){},returnTrue:function(){return!0},returnFalse:function(){return!1}})}),define("skylark-langx-funcs/rest-arguments",["./funcs"],function(t){return t.restArguments=function(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+e];switch(e){case 0:return t.call(this,r);case 1:return t.call(this,arguments[0],r);case 2:return t.call(this,arguments[0],arguments[1],r)}var s=Array(e+1);for(i=0;i<e;i++)s[i]=arguments[i];return s[e]=r,t.apply(this,s)}}}),define("skylark-langx-funcs/bind-all",["./funcs","./rest-arguments"],function(t,e){return t.bindAll=e(function(t,e){var n=e.length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=e[n];t[r]=t[r].bind(t)}})}),define("skylark-langx-types/types",["skylark-langx-ns"],function(t){var e,n=Array.isArray,r={}.toString,i=(e={},"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(t){e["[object "+t+"]"]=t.toLowerCase()}),function(t){return null==t?String(t):e[r.call(t)]||"object"}),s=n||function(t){return object&&object.constructor===Array};function o(t){var e;for(e in t)if(null!==t[e])return!1;return!0}function a(t){return"function"==i(t)}function l(t){return t&&t.nodeType}function c(t){return"number"==typeof t}function u(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function h(t){return"string"==typeof t}function f(t){return t&&t==t.window}function d(t){return"symbol"==typeof t}var p=1/0,m=1.7976931348623157e308,y=NaN,g=/^\s+|\s+$/g,w=/^[-+]0x[0-9a-f]+$/i,k=/^0b[01]+$/i,x=/^0o[0-7]+$/i,v=parseInt;function _(t){if(!t)return 0===t?t:0;if((t=b(t))===p||t===-p){var e=t<0?-1:1;return e*m}return t==t?t:0}function b(t){if("number"==typeof t)return t;if(d(t))return y;if(u(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=u(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(g,"");var n=k.test(t);return n||x.test(t)?v(t.slice(2),n?2:8):w.test(t)?y:+t}return t.attach("langx.types",{isArray:s,isArrayLike:function(t){return!h(t)&&!l(t)&&"number"==typeof t.length&&!a(t)},isBoolean:function(t){return!0===t||!1===t||"[object Boolean]"===r.call(t)},isDefined:function(t){return void 0!==t},isDocument:function(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE},isElement:function(t){return!(!t||1!==t.nodeType)},isEmpty:o,isEmptyObject:o,isFunction:a,isHtmlNode:l,isNaN:function(t){return isNaN(t)},isNull:function(t){return null===t},isNumber:c,isNumeric:c,isObject:u,isPlainObject:function(t){return u(t)&&!f(t)&&Object.getPrototypeOf(t)==Object.prototype},isString:h,isSameOrigin:function(t){if(t){var e=location.protocol+"//"+location.hostname;return location.port&&(e+=":"+location.port),t.startsWith(e)}},isSymbol:d,isUndefined:function(t){return void 0===t},isWindow:f,type:i,toFinite:_,toNumber:b,toInteger:function(t){var e=_(t),n=e%1;return e==e?n?e-n:e:0}})}),define("skylark-langx-types/main",["./types"],function(t){return t}),define("skylark-langx-types",["skylark-langx-types/main"],function(t){return t}),define("skylark-langx-funcs/defer",["skylark-langx-types","./funcs"],function(t,e){return e.defer=function(e,n,r,i){var s={cancel:null},o=e;t.isNumber(n)||t.isFunction(n)||(i=r,r=n,n=0);r&&(o=function(){e.apply(i,r)});if(t.isFunction(n)){var a=!1;n(function(){a||o()}),s.cancel=function(){a=!0}}else{var l;0==n&&requestAnimationFrame?(l=requestAnimationFrame(o),s.cancel=function(){return cancelAnimationFrame(l)}):(l=setTimeout(o,n),s.cancel=function(){return clearTimeout(l)})}return s}}),define("skylark-langx-funcs/debounce",["./funcs","./defer"],function(t,e){return t.debounce=function(t,n,r){var i,s,o=function(){var o=this,l=arguments;return a(),i=setTimeout(function(){i=null,r?s=e(t,l,o):t.apply(o,l)},n),{cancel:a}},a=o.cancel=function(){i&&clearTimeout(i),s&&s.cancel(),i=void 0,s=void 0};return o}}),define("skylark-langx-objects/objects",["skylark-langx-ns","skylark-langx-types"],function(t,e){return t.attach("langx.objects",{attach:t.attach})}),define("skylark-langx-objects/all-keys",["skylark-langx-types","./objects"],function(t,e){return e.allKeys=function(e){if(!t.isObject(e))return[];var n=[];for(var r in e)n.push(r);return n}}),define("skylark-langx-objects/assign",["skylark-langx-types","./objects"],function(t,e){return e.assign=Object.assign}),define("skylark-langx-objects/to-key",["skylark-langx-types","./objects"],function(t,e){const n=t.isSymbol,r=t.isString,i=1/0;return e.toKey=function(t){if(r(t)||n(t))return t;const e=`${t}`;return"0"==e&&1/t==-i?"-0":e}}),define("skylark-langx-objects/is-key",["skylark-langx-types","./objects"],function(t,e){const n=t.isSymbol,r=t.isArray,i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;return e.isKey=function(t,e){if(r(t))return!1;const o=typeof t;if("number"===o||"boolean"===o||null==t||n(t))return!0;return s.test(t)||!i.test(t)||null!=e&&t in Object(e)}}),define("skylark-langx-objects/_cast_path",["skylark-langx-types","./objects","./is-key"],function(t,e,n){const r=".".charCodeAt(0),i=/\\(\\)?/g,s=RegExp("[^.[\\]]+|\\[(?:([^\"'][^[]*)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))","g"),o=t=>{const e=[];return t.charCodeAt(0)===r&&e.push(""),t.replace(s,(t,n,r,s)=>{let o=t;r?o=s.replace(i,"$1"):n&&(o=n.trim()),e.push(o)}),e};return function(e,r){if(t.isArray(e))return e;return n(e,r)?[e]:o(e)}}),define("skylark-langx-objects/get",["skylark-langx-types","./objects","./to-key","./_cast_path"],function(t,e,n,r){return e.get=function(t,e,i){const s=null==t?void 0:function(t,e){let i=0;const s=(e=r(e,t)).length;for(;null!=t&&i<s;)t=t[n(e[i++])];return i&&i==s?t:void 0}(t,e);return void 0===s?i:s}}),define("skylark-langx-objects/base-at",["./objects","./get"],function(t,e){return t.baseAt=function(t,n){let r=-1;const i=n.length,s=new Array(i),o=null==t;for(;++r<i;)s[r]=o?void 0:e(t,n[r]);return s}}),define("skylark-langx-objects/clone",["skylark-langx-types","./objects"],function(t,e){var n=t.isPlainObject,r=t.isArray;return e.clone=function t(e,i){var s;if(void 0===e||null===e)s=e;else if(i&&e.clone)s=e.clone();else if(r(e)){s=[];for(var o=0;o<e.length;o++)s.push(t(e[o]))}else if(n(e))for(var a in s={},e)s[a]=t(e[a]);else s=e;return s}}),define("skylark-langx-objects/defaults",["./objects","./all-keys"],function(t,e){return t.defaults=(n=e,r=!0,function(t){var e=arguments.length;if(r&&(t=Object(t)),e<2||null==t)return t;for(var i=1;i<e;i++)for(var s=arguments[i],o=n(s),a=o.length,l=0;l<a;l++){var c=o[l];r&&void 0!==t[c]||(t[c]=s[c])}return t});var n,r}),define("skylark-langx-objects/each",["./objects"],function(t){return t.each=function(t,e,n){var r,i,s,o;if(t)if(void 0===(r=t.length)){for(i in t)if(t.hasOwnProperty(i)&&(o=t[i],!1===(n?e.call(o,o,i):e.call(o,i,o))))break}else for(s=0;s<r&&(o=t[s],!1!==(n?e.call(o,o,s):e.call(o,s,o)));s++);return this}}),define("skylark-langx-objects/_mixin",["skylark-langx-types","./objects"],function(t,e){var n=t.isPlainObject;return function t(e,r,i,s){for(var o in r)s&&void 0!==e[o]||(i&&n(r[o])?(n(e[o])||(e[o]={}),t(e[o],r[o],i,s)):void 0!==r[o]&&(e[o]=r[o]));return e}}),define("skylark-langx-objects/_parse_mixin_args",["skylark-langx-types","./objects"],function(t,e){var n=Array.prototype.slice,r=t.isBoolean;return function(t){var e=n.call(arguments,0),i=e.shift(),s=!1;r(e[e.length-1])&&(s=e.pop());return{target:i,sources:e,deep:s}}}),define("skylark-langx-objects/mixin",["skylark-langx-types","./objects","./_mixin","./_parse_mixin_args"],function(t,e,n,r){return e.mixin=function(){var t=r.apply(this,arguments);return t.sources.forEach(function(e){n(t.target,e,t.deep,!1)}),t.target}}),define("skylark-langx-objects/extend",["./objects","./mixin"],function(t,e){var n=Array.prototype.slice;return t.extend=function(t){var r,i=n.call(arguments,1);"boolean"==typeof t&&(r=t,t=i.shift());0==i.length&&(i=[t],t=this);return i.forEach(function(n){e(t,n,r)}),t}}),define("skylark-langx-objects/for-each",["./objects","./each"],function(t,e){return t.forEach=function(t,n){if(!t)return;t.forEach?t.forEach(n):e(t,n,!0)}}),define("skylark-langx-objects/has",["skylark-langx-types","./objects"],function(t,e){var n=Object.prototype.hasOwnProperty;return e.has=function(e,r){if(!t.isArray(r))return null!=e&&n.call(e,r);for(var i=r.length,s=0;s<i;s++){var o=r[s];if(null==e||!n.call(e,o))return!1;e=e[o]}return!!i}}),define("skylark-langx-objects/includes",["./objects"],function(t){return t.includes=function(t,e,n,r){t=isArrayLike(t)?t:values(t),n=n&&!r?toInteger(n):0;var i=t.length;n<0&&(n=nativeMax(i+n,0));return isString(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&baseIndexOf(t,e,n)>-1}}),define("skylark-langx-objects/is-equal",["skylark-langx-types","./objects"],function(t,e){var n,r,i=t.isFunction,s="undefined"!=typeof Symbol?Symbol.prototype:null;return n=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var s=typeof t;return("function"===s||"object"===s||"object"==typeof e)&&r(t,e,n,i)},r=function(t,e,r,o){var a=toString.call(t);if(a!==toString.call(e))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return s.valueOf.call(t)===s.valueOf.call(e)}var l="[object Array]"===a;if(!l){if("object"!=typeof t||"object"!=typeof e)return!1;var c=t.constructor,u=e.constructor;if(c!==u&&!(i(c)&&c instanceof c&&i(u)&&u instanceof u)&&"constructor"in t&&"constructor"in e)return!1}r=r||[],o=o||[];for(var h=r.length;h--;)if(r[h]===t)return o[h]===e;if(r.push(t),o.push(e),l){if((h=t.length)!==e.length)return!1;for(;h--;)if(!n(t[h],e[h],r,o))return!1}else{var f,d=Object.keys(t);if(h=d.length,Object.keys(e).length!==h)return!1;for(;h--;)if(f=d[h],void 0===e[f]||!n(t[f],e[f],r,o))return!1}return r.pop(),o.pop(),!0},e.isEqual=function(t,e){return n(t,e)}}),define("skylark-langx-objects/keys",["skylark-langx-types","./objects","./has"],function(t,e,n){return e.keys=function(e){if(!t.isObject(e))return[];var r=[];for(var i in e)n(e,i)&&r.push(i);return r}}),define("skylark-langx-objects/is-match",["skylark-langx-types","./objects","./keys"],function(t,e,n){return e.isMatch=function(t,e){var n=n(e),r=n.length;if(null==t)return!r;for(var i=Object(t),s=0;s<r;s++){var o=n[s];if(e[o]!==i[o]||!(o in i))return!1}return!0}}),define("skylark-langx-objects/omit",["./objects","./mixin"],function(t,e){return t.omit=function(t,n,r){if(!t)return null;for(var i=e({},t),s=1;s<arguments.length;s++){var o=arguments[s];o in t&&delete i[o]}return i}}),define("skylark-langx-objects/pick",["./objects"],function(t){return t.pick=function(t,e,n){if(!t)return null;for(var r={},i=1;i<arguments.length;i++){var s=arguments[i];s in t&&(r[s]=t[s])}return r}}),define("skylark-langx-objects/remove-items",["skylark-langx-types","./objects"],function(t,e){return e.removeItem=function(e,n){if(t.isArray(e)){var r=e.indexOf(n);-1!=r&&e.splice(r,1)}else if(t.isPlainObject(e))for(var i in e)if(e[i]==n){delete e[i];break}return this}}),define("skylark-langx-objects/result",["skylark-langx-types","./objects","./to-key","./_cast_path"],function(t,e,n,r){t.isArray;var i=t.isFunction;return e.result=function(t,e,s){let o=-1,a=(e=r(e,t)).length;a||(a=1,t=void 0);for(;++o<a;){let r=null==t?void 0:t[n(e[o])];void 0===r&&(o=a,r=s),t=i(r)?r.call(t):r}return t}}),define("skylark-langx-objects/safe-mixin",["./objects","./_mixin","./_parse_mixin_args"],function(t,e,n){return t.safeMixin=function(){var t=n.apply(this,arguments);return t.sources.forEach(function(n){e(t.target,n,t.deep,!0)}),t.target}}),define("skylark-langx-objects/scall",["./objects"],function(t){const e=Array.prototype.slice;return t.scall=function(t,n,r,i){if(t&&t[n]){var s=e.call(arguments,2);return t[n].apply(t,s)}}}),define("skylark-langx-objects/is-index",["skylark-langx-types","./objects"],function(t,e){const n=9007199254740991,r=/^(?:0|[1-9]\d*)$/;return e.isIndex=function(t,e){const i=typeof t;return!!(e=null==e?n:e)&&("number"===i||"symbol"!==i&&r.test(t))&&t>-1&&t%1==0&&t<e}}),define("skylark-langx-objects/set",["skylark-langx-types","./objects","./_cast_path","./is-index","./to-key"],function(t,e,n,r,i){return e.set=function(e,s,o){return null==e?e:function(e,s,o,a){if(!t.isObject(e))return e;const l=(s=n(s,e)).length,c=l-1;let u=-1,h=e;for(;null!=h&&++u<l;){const e=i(s[u]);let n=o;if(u!=c){const i=h[e];void 0===(n=a?a(i,e,h):void 0)&&(n=t.isObject(i)?i:r(s[u+1])?[]:{})}h[e]=n,h=h[e]}return e}(e,s,o)}}),define("skylark-langx-objects/shadow",["./objects"],function(t){return t.shadow=function(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!1}),n}}),define("skylark-langx-objects/unset",["skylark-langx-types","./objects","./set"],function(t,e,n){return e.unset=function(t,e){return null==t||n(t,e,void 0)}}),define("skylark-langx-objects/values",["skylark-langx-types","./objects","./all-keys"],function(t,e,n){return e.values=function(t){for(var e=n(t),r=e.length,i=Array(r),s=0;s<r;s++)i[s]=t[e[s]];return i}}),define("skylark-langx-objects/main",["./objects","./all-keys","./assign","./base-at","./clone","./defaults","./each","./extend","./for-each","./get","./has","./includes","./is-equal","./is-key","./is-match","./keys","./mixin","./omit","./pick","./remove-items","./result","./safe-mixin","./scall","./set","./shadow","./to-key","./unset","./values"],function(t){return t}),define("skylark-langx-objects",["skylark-langx-objects/main"],function(t){return t}),define("skylark-langx-funcs/delegate",["skylark-langx-objects","./funcs"],function(t,e){var n=t.mixin,r=function(){function t(){}return function(e,r){t.prototype=e;var i=new t;return t.prototype=null,r&&n(i,r),i}}();return e.delegate=r}),define("skylark-langx-funcs/loop",["./funcs"],function(t){function e(t){this.callback=t,this.running=!1,this.id=-1}return e.prototype.start=function(){if(!this.running){this.running=!0;var t=this;!function e(){t.callback();t.running&&(t.id=requestAnimationFrame(e))}()}},e.prototype.stop=function(){this.running=!1,cancelAnimationFrame(this.id)},t.loop=function(t){return new e(t)}}),define("skylark-langx-funcs/negate",["./funcs"],function(t){return t.negate=function(t){if("function"!=typeof t)throw new TypeError("Expected a function");return function(...e){return!t.apply(this,e)}}}),define("skylark-langx-funcs/proxy",["skylark-langx-types","./funcs"],function(t,e){var n=Array.prototype.slice,r=t.isFunction,i=t.isString;return e.bind=e.proxy=function t(e,s){var o=2 in arguments&&n.call(arguments,2);if(r(e)){return function(){return e.apply(s,o?o.concat(n.call(arguments)):arguments)}}if(i(s))return o?(o.unshift(e[s],e),t.apply(null,o)):t(e[s],e);throw new TypeError("expected function")}}),define("skylark-langx-funcs/template",["skylark-langx-objects","./funcs","./proxy"],function(t,e,n){Array.prototype.slice;var r={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},i=/(.)^/,s={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},o=/\\|'|\r|\n|\t|\u2028|\u2029/g;function a(e,a,l){var c;l=t.defaults({},l,r);var u=RegExp([(l.escape||i).source,(l.interpolate||i).source,(l.evaluate||i).source].join("|")+"|$","g"),h=0,f="__p+='";e.replace(u,function(t,n,r,i,a){return f+=e.slice(h,a).replace(o,function(t){return"\\"+s[t]}),n&&(f+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(f+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(f+="';\n"+i+"\n__p+='"),h=a+t.length,t}),f+="';\n",l.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{c=new Function(l.variable||"obj","_",f)}catch(t){throw t.source=f,t}if(a)return c(a,this);var d=n(function(t){return c.call(this,t,this)},this),p=l.variable||"obj";return d.source="function("+p+"){\n"+f+"}",d}return a.templateSettings=e.templateSettings=r,e.template=a}),define("skylark-langx-funcs/throttle",["./funcs"],function(t){return t.throttle=function(t,e){let n=window.performance.now();return function(...r){const i=window.performance.now();i-n>=e&&(t(...r),n=i)}}}),define("skylark-langx-funcs/main",["./funcs","./bind-all","./debounce","./defer","./delegate","./loop","./negate","./proxy","./rest-arguments","./template","./throttle"],function(t){return t}),define("skylark-langx-funcs",["skylark-langx-funcs/main"],function(t){return t}),define("skylark-langx-arrays/flatten",["skylark-langx-types","./arrays"],function(t,e){return e.flatten=function(e){if(t.isArrayLike(e)){for(var n=[],r=0;r<e.length;r++){var i=e[r];if(t.isArrayLike(i))for(var s=0;s<i.length;s++)n.push(i[s]);else n.push(i)}return n}return e}}),define("skylark-langx-arrays/difference",["skylark-langx-funcs","./arrays","./flatten","./filter","./contains"],function(t,e,n,r,i){var s=t.restArguments(function(t,e){return e=n(e,!0,!0),r(t,function(t){return!i(e,t)})});return e.difference=s}),define("skylark-langx-arrays/find",["./arrays"],function(t){var e=Array.prototype.find;return t.find=function(t,n){return e.call(t,n)}}),define("skylark-langx-arrays/first",["./arrays"],function(t){return t.first=function(t,e){return e?t.slice(0,e):t[0]}}),define("skylark-langx-arrays/grep",["skylark-langx-objects","./arrays"],function(t,e){return e.grep=function(e,n){var r=[];return t.each(e,function(t,e){n(e,t)&&r.push(e)}),r}}),define("skylark-langx-arrays/indexof",["./arrays"],function(t){return t.indexOf=function(t,e){return t.indexOf(e)}}),define("skylark-langx-arrays/last",["./arrays"],function(t){return t.last=function(t){return t[t.length-1]}}),define("skylark-langx-arrays/make-array",["skylark-langx-types","./arrays"],function(t,e){return e.makeArray=function(e,n,r){if(t.isArrayLike(e))return(r||[]).concat(Array.prototype.slice.call(e,n||0));return[e]}}),define("skylark-langx-arrays/map",["skylark-langx-types","./arrays","./flatten"],function(t,e,n){return e.map=function(e,r){var i,s,o,a=[];if(t.isArrayLike(e))for(s=0;s<e.length;s++)null!=(i=r.call(e[s],e[s],s))&&a.push(i);else for(o in e)null!=(i=r.call(e[o],e[o],o))&&a.push(i);return n(a)}}),define("skylark-langx-arrays/merge",["./arrays"],function(t){return t.merge=function(t,e){var n=e.length,r=t.length,i=0;if("number"==typeof n)for(;i<n;i++)t[r++]=e[i];else for(;void 0!==e[i];)t[r++]=e[i++];return t.length=r,t}}),define("skylark-langx-arrays/pull-at",["skylark-langx-types","skylark-langx-objects","./arrays"],function(t,e,n){return n.pullAt=function(t,...n){null==t||t.length;const r=e.baseAt(t,n);n.sort(function(t,e){return t-e});for(let e=n.length-1;e>=0;e--)t.slice(n[e],1);return r}}),define("skylark-langx-arrays/reduce",["./arrays"],function(t){return t.reduce=function(t,e,n){return Array.prototype.reduce.call(t,e,n)}}),define("skylark-langx-arrays/uniq",["./arrays","./filter"],function(t,e){return t.uniq=function(t){return e(t,function(e,n){return t.indexOf(e)==n})}}),define("skylark-langx-arrays/without",["skylark-langx-funcs","./arrays","./difference"],function(t,e,n){var r=t.restArguments(function(t,e){return n(t,e)});return e.without=r}),define("skylark-langx-arrays/main",["./arrays","./base-find-index","./base-indexof","./compact","./contains","./difference","./filter","./find","./first","./flatten","./grep","./in-array","./indexof","./last","./make-array","./map","./merge","./pull-at","./reduce","./uniq","./without"],function(t){return t}),define("skylark-langx-arrays",["skylark-langx-arrays/main"],function(t){return t}),define("skylark-langx/arrays",["skylark-langx-arrays"],function(t){return t}),define("skylark-langx-constructs/constructs",["skylark-langx-ns"],function(t){return t.attach("langx.constructs",{})}),define("skylark-langx-constructs/inherit",["./constructs"],function(t){return t.inherit=function(t,e){if("function"!=typeof e&&e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Object.setPrototypeOf(t,e)}}),define("skylark-langx-constructs/klass",["skylark-langx-ns","skylark-langx-types","skylark-langx-objects","skylark-langx-arrays","./constructs","./inherit"],function(t,e,n,r,i,s){var o=r.uniq,a=n.has,l=n.mixin,c=e.isArray,u=e.isDefined,h=function(){function t(){return this._construct?this._construct.apply(this,arguments):this.init?this.init.apply(this,arguments):void 0}return function n(r,i,h,f){c(i)&&(f=h,h=i,i=null),i=i||Object,u(h)&&!c(h)&&(f=h,h=!1);var d=i;h&&(h=function(t,e){var n=[];return e.forEach(function(t){if(a(t,"__mixins__"))throw new Error("nested mixins");for(var e=[];t;)e.unshift(t),t=t.superclass;n=n.concat(e)}),(n=(n=o(n)).filter(function(e){for(var n=t;n;){if(e===n)return!1;if(a(n,"__mixins__"))for(var r=n.__mixins__,i=0;i<r.length;i++)if(r[i]===e)return!1;n=n.superclass}return!0})).length>0&&n}(d,h)),h&&(d=function(t,e){for(var n=t,r=0;r<e.length;r++){var i=new Function;s(i,n),i.superclass=null,l(i.prototype,e[r].prototype),i.prototype.__mixin__=e[r],n=i}return n}(d,h));var p=r.klassName||"",m=new Function("return function "+p+"() {var inst = this, ctor = arguments.callee;if (!(inst instanceof ctor)) {inst = Object.create(ctor.prototype);}return ctor._constructor.apply(inst, arguments) || inst;}")();return s(m,d),m.superclass=i,m._constructor||(m._constructor=t),h&&(m.__mixins__=h),m.partial||(m.partial=function(t,n){return function(t,n,r){var i=t.prototype,s=t.superclass.prototype,o=r&&r.noOverrided;r&&r.overrides;for(var a in n)if("constructor"!==a){var l=n[a];"function"==typeof n[a]?i[a]=l._constructor||o||"function"!=typeof s[a]?l:function(t,e,n){return function(){var t=this.overrided;this.overrided=n;var r=e.apply(this,arguments);return this.overrided=t,r}}(0,l,s[a]):e.isPlainObject(l)&&null!==l&&l.get?Object.defineProperty(i,a,l):i[a]=l}return t}(this,t,n)}),m.inherit||(m.inherit=function(t,e,r){return n(t,this,e,r)}),m.partial(r,f),m}}();return i.klass=h}),define("skylark-langx-constructs/main",["./constructs","./inherit","./klass"],function(t){return t}),define("skylark-langx-constructs",["skylark-langx-constructs/main"],function(t){return t}),define("skylark-langx-klass/klass",["skylark-langx-ns","skylark-langx-constructs"],function(t,e){return t.attach("langx.klass",e.klass)}),define("skylark-langx-klass/main",["./klass"],function(t){return t}),define("skylark-langx-klass",["skylark-langx-klass/main"],function(t){return t}),define("skylark-langx/klass",["skylark-langx-klass"],function(t){return t}),define("skylark-langx/array-store",["./klass"],function(t){var e=function(t){if(!t)return t;var n=!!t.then;function r(r){t[r]=function(){var i=arguments,s=Deferred.when(t,function(t){return e(Array.prototype[r].apply(t,i))});if("forEach"!==r||n)return s}}return n&&(t=Object.delegate(t)),r("forEach"),r("filter"),r("map"),null==t.total&&(t.total=Deferred.when(t,function(t){return t.length})),t},n=t({klassName:"ArrayStore",queryEngine:function(t,e){switch(typeof t){default:throw new Error("Can not query with a "+typeof t);case"object":case"undefined":var n=t;t=function(t){for(var e in n){var r=n[e];if(r&&r.test){if(!r.test(t[e],t))return!1}else if(r!=t[e])return!1}return!0};break;case"string":if(!this[t])throw new Error("No filter function "+t+" was found in store");t=this[t];case"function":}function r(n){var r=function(t,e,n){var r,i=0,s=t&&t.length||0,o=[];s&&"string"==typeof t&&(t=t.split(""));"string"==typeof e&&(e=cache[e]||buildFn(e));if(n)for(;i<s;++i)r=t[i],e.call(n,r,i,t)&&o.push(r);else for(;i<s;++i)r=t[i],e(r,i,t)&&o.push(r);return o}(n,t),i=e&&e.sort;if(i&&r.sort("function"==typeof i?i:function(t,e){for(var n,r=0;n=i[r];r++){var s=t[n.attribute],o=e[n.attribute];if(s=null!=s?s.valueOf():s,o=null!=o?o.valueOf():o,s!=o)return!!n.descending==(null==s||s>o)?-1:1}return 0}),e&&(e.start||e.count)){var s=r.length;(r=r.slice(e.start||0,(e.start||0)+(e.count||1/0))).total=s}return r}return r.matches=t,r},idProperty:"id",get:function(t){return this.data[this.index[t]]},getIdentity:function(t){return t[this.idProperty]},put:function(t,e){var n=this.data,r=this.index,i=this.idProperty,s=t[i]=e&&"id"in e?e.id:i in t?t[i]:Math.random();if(s in r){if(e&&!1===e.overwrite)throw new Error("Object already exists");n[r[s]]=t}else r[s]=n.push(t)-1;return s},add:function(t,e){return(e=e||{}).overwrite=!1,this.put(t,e)},remove:function(t){var e=this.index,n=this.data;if(t in e)return n.splice(e[t],1),this.setData(n),!0},query:function(t,n){return e(this.queryEngine(t,n)(this.data))},setData:function(t){t.items?(this.idProperty=t.identifier||this.idProperty,t=this.data=t.items):this.data=t,this.index={};for(var e=0,n=t.length;e<n;e++)this.index[t[e][this.idProperty]]=e},init:function(t){for(var e in t)this[e]=t[e];this.setData(this.data||[])}});return n}),define("skylark-langx-aspect/aspect",["skylark-langx-ns"],function(t){var e,n=0;function r(t){return function(r,i,s,o){var a,l=r[i];l&&l.target==r||(r[i]=a=function(){for(var t=n,r=arguments,i=a.before;i;)r=i.advice.apply(this,r)||r,i=i.next;if(a.around)var s=a.around.advice(this,r);for(var o=a.after;o&&o.id<t;){if(o.receiveArguments){var l=o.advice.apply(this,r);s=l===e?s:l}else s=o.advice.call(this,s,r);o=o.next}return s},l&&(a.around={advice:function(t,e){return l.apply(t,e)}}),a.target=r);var c=function(t,e,r,i){var s,o=t[e],a="around"==e;if(a){var l=r(function(){return o.advice(this,arguments)});s={remove:function(){l&&(l=t=r=null)},advice:function(t,e){return l?l.apply(t,e):o.advice(t,e)}}}else s={remove:function(){if(s.advice){var n=s.previous,i=s.next;i||n?(n?n.next=i:t[e]=i,i&&(i.previous=n)):delete t[e],t=r=s.advice=null}},id:n++,advice:r,receiveArguments:i};if(o&&!a)if("after"==e){for(;o.next&&(o=o.next););o.next=s,s.previous=o}else"before"==e&&(t[e]=s,s.next=o,o.previous=s);else t[e]=s;return s}(a||l,t,s,o);return s=null,c}}return t.attach("langx.aspect",{after:r("after"),around:r("around"),before:r("before")})}),define("skylark-langx-aspect/main",["./aspect"],function(t){return t}),define("skylark-langx-aspect",["skylark-langx-aspect/main"],function(t){return t}),define("skylark-langx/aspect",["skylark-langx-aspect"],function(t){return t}),define("skylark-langx-async/async",["skylark-langx-ns"],function(t){return t.attach("langx.async")}),define("skylark-langx-async/deferred",["skylark-langx-arrays","skylark-langx-funcs","skylark-langx-objects","./async"],function(t,e,n,r){"use strict";var i=Array.prototype.slice,s=e.proxy,o=t.makeArray,a=n.result,l=n.mixin;l(Promise.prototype,{always:function(t){return this.then(t,t),this},done:function(){for(var t=0;t<arguments.length;t++)this.then(arguments[t]);return this},fail:function(t){return this.catch(t),this}});var c=function(){var t=this;this.promise=u(new Promise(function(e,n){t._resolve=e,t._reject=n}))};function u(t){if(t.isResolved)return t;var e=!0,n=!1,r=!1,i=t.then(function(t){return r=!0,e=!1,t},function(t){throw n=!0,e=!1,t});i.isResolved=function(){return r},i.isPending=function(){return e},i.isRejected=function(){return n},i.state=function(){return r?"resolved":n?"rejected":"pending"};var s=[],o=[];return i.then=function(t,e,n){return n&&this.progress(n),u(Promise.prototype.then.call(this,t&&function(e){return e&&void 0!==e.__ctx__?t.apply(e.__ctx__,e):t(e)},e&&function(t){return t&&void 0!==t.__ctx__?e.apply(t.__ctx__,t):e(t)}))},i.progress=function(t){return s.forEach(function(e){t(e)}),o.push(t),this},i.pipe=i.then,i.notify=function(t){try{return s.push(t),o.forEach(function(e){return e(t)})}catch(t){this.reject(t)}return this},i}return c.prototype.resolve=function(t){var e=i.call(arguments);return this.resolveWith(null,e)},c.prototype.resolveWith=function(t,e){return(e=e?o(e):[]).__ctx__=t,this._resolve(e),this._resolved=!0,this},c.prototype.notify=function(t){var e=a(this,"promise");return e.notify(t),this},c.prototype.reject=function(t){var e=i.call(arguments);return this.rejectWith(null,e)},c.prototype.rejectWith=function(t,e){return(e=e?o(e):[]).__ctx__=t,this._reject(e),this._rejected=!0,this},c.prototype.isResolved=function(){var t=a(this,"promise");return t.isResolved()},c.prototype.isRejected=function(){var t=a(this,"promise");return t.isRejected()},c.prototype.state=function(){var t=a(this,"promise");return t.state()},c.prototype.then=function(t,e,n){var r=a(this,"promise");return r.then(t,e,n)},c.prototype.progress=function(t){var e=a(this,"promise");return e.progress(t)},c.prototype.catch=function(t){var e=a(this,"promise");return e.catch(t)},c.prototype.always=function(){var t=a(this,"promise");return t.always.apply(t,arguments),this},c.prototype.done=function(){var t=a(this,"promise");return t.done.apply(t,arguments),this},c.prototype.fail=function(t){var e=a(this,"promise");return e.fail(t),this},c.all=function(t){var e=new c;return Promise.all(t).then(e.resolve.bind(e),e.reject.bind(e)),a(e,"promise")},c.first=function(t){return u(Promise.race(t))},c.when=function(t,e,n,r){var i=t&&"function"==typeof t.then,o=i&&t instanceof Promise;if(!i)return arguments.length>1?e?e(t):t:(new c).resolve(t);if(!o){var a=new c(t.cancel);t.then(s(a.resolve,a),s(a.reject,a),a.notify),t=a.promise}return e||n||r?t.then(e,n,r):t},c.reject=function(t){var e=new c;return e.reject(t),e.promise},c.immediate=c.resolve=function(t){var e=new c;return e.resolve.apply(e,arguments),e.promise},c.promise=function(t){var e=new c;return t(e.resolve.bind(e),e.reject.bind(e),e.progress.bind(e)),e.promise},r.Deferred=c}),define("skylark-langx-async/each",["./async"],function(t){return t.each=function(t,e,n){if(0===t.length)return n(void 0,t);var r=new Array(t.length),i=0,s=!1;t.forEach(function(o,a){e(o,function(e,o){if(!s)return e?(s=!0,n(e)):(r[a]=o,(i+=1)===t.length?n(void 0,r):void 0)})})}}),define("skylark-langx-async/parallel",["skylark-langx-objects","./async","./deferred"],function(t,e,n){return e.parallel=function(e,r,i){var s=[];return i=i||null,r=r||[],t.each(e,function(t,e){s.push(e.apply(i,r))}),n.all(s)}}),define("skylark-langx-async/series",["skylark-langx-objects","./async","./deferred"],function(t,e,n){return e.series=function(e,r,i){var s=[],o=new n,a=o.promise;return i=i||null,r=r||[],o.resolve(),t.each(e,function(t,e){a=a.then(function(){return e.apply(i,r)}),s.push(a)}),n.all(s)}}),define("skylark-langx-async/waterful",["skylark-langx-objects","./async","./deferred"],function(t,e,n){return e.waterful=function(e,r,i){var s=new n,o=s.promise;return i=i||null,r=r||[],s.resolveWith(i,r),t.each(e,function(t,e){o=o.then(e)}),o}}),define("skylark-langx-async/main",["./async","./deferred","./each","./parallel","./series","./waterful"],function(t){return t}),define("skylark-langx-async",["skylark-langx-async/main"],function(t){return t}),define("skylark-langx/async",["skylark-langx-async"],function(t){return t}),define("skylark-langx-binary/binary",["skylark-langx-ns"],function(t){"use strict";return t.attach("langx.binary",{fromBase64:function(t){for(var e,n,r,i,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=t.length/4*3,a=new ArrayBuffer(o),l=new Uint8Array(a),c=0,u=0;c<o;c+=3)e=s.indexOf(t.charAt(u++)),n=s.indexOf(t.charAt(u++)),r=s.indexOf(t.charAt(u++)),i=s.indexOf(t.charAt(u++)),l[c]=e<<2|n>>4,64!==r&&(l[c+1]=(15&n)<<4|r>>2),64!==i&&(l[c+2]=(3&r)<<6|i);return a},fromBinaryString:function(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),i=0;i<e;i++)r[i]=t.charCodeAt(i);return n},fromBuffer:function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r++)n[r]=t[r];return e},readInt8:function(t,e){return t[e]<<24>>24},readUint16:function(t,e){return t[e]<<8|t[e+1]},readUint32:function(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}})}),define("skylark-langx-binary/main",["./binary"],function(t){return t}),define("skylark-langx-binary",["skylark-langx-binary/main"],function(t){return t}),define("skylark-langx/binary",["skylark-langx-binary"],function(t){return t}),define("skylark-langx/constructs",["skylark-langx-constructs"],function(t){return t}),define("skylark-langx-datetimes/datetimes",["skylark-langx-ns"],function(t){return t.attach("langx.datetimes",{parseMilliSeconds:function(t){var e=t.split(" "),n=parseInt(e[0]);if(isNaN(n))return 0;switch(e[1].trim().replace(/\./g,"")){case"minutes":case"minute":case"min":case"mm":case"m":return 6e4*n;case"hours":case"hour":case"HH":case"hh":case"h":case"H":return 36e5*n;case"seconds":case"second":case"sec":case"ss":case"s":return 1e3*n;case"days":case"day":case"DD":case"dd":case"d":return 864e5*n;case"months":case"month":case"MM":case"M":return 24192e5*n;case"weeks":case"week":case"W":case"w":return 6048e5*n;case"years":case"year":case"yyyy":case"yy":case"y":return 31536e6*n;default:return 0}}})}),define("skylark-langx-datetimes/to_date",["skylark-langx-types","./datetimes"],function(t,e){let n;return e.toDate=function(e){if(!e||!t.isString(e))return null;n||(n=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const r=n.exec(e);if(!r)return null;const i=parseInt(r[1],10);let s=parseInt(r[2],10);s=s>=1&&s<=12?s-1:0;let o=parseInt(r[3],10);o=o>=1&&o<=31?o:1;let a=parseInt(r[4],10);a=a>=0&&a<=23?a:0;let l=parseInt(r[5],10);l=l>=0&&l<=59?l:0;let c=parseInt(r[6],10);c=c>=0&&c<=59?c:0;const u=r[7]||"Z";let h=parseInt(r[8],10);h=h>=0&&h<=23?h:0;let f=parseInt(r[9],10)||0;f=f>=0&&f<=59?f:0,"-"===u?(a+=h,l+=f):"+"===u&&(a-=h,l-=f);return new Date(Date.UTC(i,s,o,a,l,c))}}),define("skylark-langx-datetimes/main",["./datetimes","./to_date"],function(t){return t}),define("skylark-langx-datetimes",["skylark-langx-datetimes/main"],function(t){return t}),define("skylark-langx/datetimes",["skylark-langx-datetimes"],function(t){return t}),define("skylark-langx/deferred",["skylark-langx-async"],function(t){return t.Deferred}),define("skylark-langx-events/events",["skylark-langx-ns"],function(t){return t.attach("langx.events",{})}),define("skylark-langx-hoster/hoster",["skylark-langx-ns"],function(t){var e={isBrowser:!0,isNode:null,global:this,browser:null,node:null};"object"==typeof process&&process.versions&&process.versions.node&&process.versions.v8&&(e.isNode=!0,e.isBrowser=!1),e.global=function(){return"undefined"!=typeof global&&"function"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this}();var n=null;if(Object.defineProperty(e,"document",function(){if(!n){var t="undefined"==typeof window?require("html-element"):window;n=t.document}return n}),void 0===e.global.CustomEvent&&(e.global.CustomEvent=function(t,e){this.type=t,this.props=e}),e.isBrowser){var r=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}}(navigator.userAgent),i=e.browser={};r.browser&&(i[r.browser]=!0,i.version=r.version),i.chrome?i.webkit=!0:i.webkit&&(i.safari=!0)}return e.detects={},t.attach("langx.hoster",e)}),define("skylark-langx-hoster/detects/mobile",["../hoster"],function(t){var e=/iPhone/i,n=/iPod/i,r=/iPad/i,i=/\biOS-universal(?:.+)Mac\b/i,s=/\bAndroid(?:.+)Mobile\b/i,o=/Android/i,a=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,l=/Silk/i,c=/Windows Phone/i,u=/\bWindows(?:.+)ARM\b/i,h=/BlackBerry/i,f=/BB10/i,d=/Opera Mini/i,p=/\b(CriOS|Chrome)(?:.+)Mobile/i,m=/Mobile(?:.+)Firefox\b/i,y=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};return t.detects.mobile=function(t){var g={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?g.userAgent=t:t&&t.userAgent&&(g={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):g={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var w=g.userAgent,k=w.split("[FBAN");void 0!==k[1]&&(w=k[0]);void 0!==(k=w.split("Twitter"))[1]&&(w=k[0]);var x=function(t){return function(e){return e.test(t)}}(w),v={apple:{phone:x(e)&&!x(c),ipod:x(n),tablet:!x(e)&&(x(r)||y(g))&&!x(c),universal:x(i),device:(x(e)||x(n)||x(r)||x(i)||y(g))&&!x(c)},amazon:{phone:x(a),tablet:!x(a)&&x(l),device:x(a)||x(l)},android:{phone:!x(c)&&x(a)||!x(c)&&x(s),tablet:!x(c)&&!x(a)&&!x(s)&&(x(l)||x(o)),device:!x(c)&&(x(a)||x(l)||x(s)||x(o))||x(/\bokhttp\b/i)},windows:{phone:x(c),tablet:x(u),device:x(c)||x(u)},other:{blackberry:x(h),blackberry10:x(f),opera:x(d),firefox:x(m),chrome:x(p),device:x(h)||x(f)||x(d)||x(m)||x(p)},any:!1,phone:!1,tablet:!1};return v.any=v.apple.device||v.android.device||v.windows.device||v.other.device,v.phone=v.apple.phone||v.android.phone||v.windows.phone,v.tablet=v.apple.tablet||v.android.tablet||v.windows.tablet,v}}),define("skylark-langx-hoster/is-mobile",["./hoster","./detects/mobile"],function(t,e){return void 0==t.isMobile&&(t.isMobile=e()),t.isMobile}),define("skylark-langx-hoster/main",["./hoster","./is-mobile"],function(t){return t}),define("skylark-langx-hoster",["skylark-langx-hoster/main"],function(t){return t}),define("skylark-langx-events/event",["skylark-langx-objects","skylark-langx-funcs","skylark-langx-klass","skylark-langx-hoster","./events"],function(t,e,n,r){var i={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};function s(n,r){return!r&&n.isDefaultPrevented||(r||(r=n),t.each(i,function(t,i){var s=r[t];n[t]=function(){return this[i]=e.returnTrue,s&&s.apply(r,arguments)},n[i]=e.returnFalse})),n}class o extends CustomEvent{constructor(e,n){super(e,n),t.safeMixin(this,n),s(this)}}return o.compatible=s,r.Event=o}),define("skylark-langx-events/listener",["skylark-langx-types","skylark-langx-objects","skylark-langx-arrays","skylark-langx-klass","./events","./event"],function(t,e,n,r,i,s){Array.prototype.slice;var o=n.compact,a=(t.isDefined,t.isUndefined),l=(t.isPlainObject,t.isFunction,t.isBoolean),c=t.isString,u=t.isEmptyObject,h=(e.mixin,e.safeMixin,r({listenTo:function(e,n,r,i,s){if(!e)return this;if(t.isPlainObject(n)){t.isBoolean(r)?(s=r,r=null):t.isBoolean(i)&&(s=i);var o=n;for(var u in o){var h=u.match(/^([\w:-]*)\s*(.*)$/),f=h[1],d=h[2]||r;d?this.listenTo(e,f,d,o[u],s):this.listenTo(e,f,o[u],s)}return this}l(i)?(s=i,i=r,r=null):l(r)?(s=r,i=r=null):a(i)&&(s=!1,i=r,r=null),i||(i="handleEvent"),c(i)&&(i=this[i]),s?r?e.one(n,r,i,this):e.one(n,i,this):r?e.on(n,r,i,this):e.on(n,i,this);for(var p,m=this._listeningTo||(this._listeningTo=[]),y=0;y<m.length;y++)if(m[y].obj==e){p=m[y];break}p||m.push(p={obj:e,events:{}});var g=p.events,w=g[n]=g[n]||[];return-1==w.indexOf(i)&&w.push(i),this},listenToOnce:function(t,e,n,r){return this.listenTo(t,e,n,r,1)},unlistenTo:function(t,e,n){var r=this._listeningTo;if(!r)return this;c(n)&&(n=this[n]);for(var i=0;i<r.length;i++){var s=r[i];if(!t||t==s.obj){var a=s.events;for(var l in a)if(!e||e==l){var h=a[l];if(h){for(var f=0;f<h.length;f++)n&&n!=h[i]||(s.obj.off(l,h[i],this),h[i]=null);h=a[l]=o(h),u(h)&&(a[l]=null)}}u(a)&&(r[i]=null)}}return r=this._listeningTo=o(r),u(r)&&(this._listeningTo=null),this}}));return i.Listener=h}),define("skylark-langx-events/emitter",["skylark-langx-types","skylark-langx-objects","skylark-langx-arrays","skylark-langx-klass","./events","./event","./listener"],function(t,e,n,r,i,s,o){var a=Array.prototype.slice,l=n.compact,c=t.isDefined,u=t.isPlainObject,h=t.isFunction,f=t.isString,d=(t.isEmptyObject,e.mixin);e.safeMixin;function p(t){var e=(""+t).split(".");return{name:e[0],ns:e.slice(1).join(" ")}}var m=new Map,y=o.inherit({_prepareArgs:function(t,e){return e=c(e)?[t].concat(e):[t]},on:function(t,e,n,r,i,s){var o=this,a=this._hub||(this._hub={});if(u(t))return i=r,each(t,function(t,r){o.on(t,e,n,r,i,s)}),this;if(f(e)||h(r)||(i=r,r=n,n=e,e=void 0),h(n)&&(i=r,r=n,n=null),!r)throw new Error("No callback function");if(!h(r))throw new Error("The callback  is not afunction");return f(t)&&(t=t.split(/\s/)),t.forEach(function(t){var o=p(t),l=o.name,c=o.ns;(a[l]||(a[l]=[])).push({fn:r,selector:e,data:n,ctx:i,ns:c,one:s})}),this},one:function(t,e,n,r,i){return this.on(t,e,n,r,i,1)},emit:function(t){if(!this._hub)return this;var e=this;f(t)&&(t=new s(t)),Object.defineProperty(t,"target",{value:this});var n=a.call(arguments,1);return n=this._prepareArgs(t,n),[t.type||t.name,"all"].forEach(function(r){var i=p(r),s=i.name,o=i.ns,a=e._hub[s];if(a){for(var c=a.length,h=!1,f=0;f<c;f++){if(t.isImmediatePropagationStopped&&t.isImmediatePropagationStopped())return this;var m=a[f];(!o||m.ns&&m.ns.startsWith(o))&&(m.data&&(t.data=d({},m.data,t.data)),2==n.length&&u(n[1])&&(t.data=t.data||{},d(t.data,n[1])),m.fn.apply(m.ctx,n),m.one&&(a[f]=null,h=!0))}h&&(e._hub[r]=l(a))}}),this},queueEmit:function(t){const e=t.type||t;let n=m.get(this);n||(n=new Map,m.set(this,n));const r=n.get(e);n.delete(e),window.clearTimeout(r);const i=window.setTimeout(()=>{0===n.size&&(n=null,m.delete(this)),this.trigger(t)},0);n.set(e,i)},listened:function(t){var e=(this._hub||(this._events={}))[t]||[];return e.length>0},off:function(t,e){if(t){var n=this._hub||(this._hub={});return f(t)&&(t=t.split(/\s/)),t.forEach(function(t){var r=p(t),i=r.name,s=r.ns,o=n[i];if(o){var a=[];if(e||s)for(var l=0,c=o.length;l<c;l++)e&&o[l].fn!==e&&o[l].fn._!==e?a.push(o[l]):!s||o[l].ns&&0==o[l].ns.indexOf(s)||a.push(o[l]);a.length?n[i]=a:delete n[i]}}),this}this._hub=null},trigger:function(){return this.emit.apply(this,arguments)},queueTrigger:function(t){return this.queueEmit.apply(this,arguments)}});return i.Emitter=y}),define("skylark-langx-events/create-event",["./events","./event"],function(t,e){return t.createEvent=function(t,n){return new e(t,n)}}),define("skylark-langx-events/main",["./events","./event","./listener","./emitter","./create-event"],function(t){return t}),define("skylark-langx-events",["skylark-langx-events/main"],function(t){return t}),define("skylark-langx/emitter",["skylark-langx-events"],function(t){return t.Emitter}),define("skylark-langx/evented",["./emitter"],function(t){return t}),define("skylark-langx/events",["skylark-langx-events"],function(t){return t}),define("skylark-langx/funcs",["skylark-langx-funcs"],function(t){return t}),define("skylark-langx-globals/globals",["skylark-langx-ns"],function(t){var e=function(){return"undefined"!=typeof global&&"function"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this}();return t.attach("langx.globals",e)}),define("skylark-langx-globals/console",["./globals"],function(t){return t.console=console}),define("skylark-langx-globals/document",["./globals"],function(t){var e;"undefined"!=typeof global?global:"undefined"!=typeof window&&window;if("undefined"!=typeof document)e=document;else try{e=require("min-document")}catch(t){console.warn("min-document is not finded!",t)}return t.document=e}),define("skylark-langx-globals/window",["./globals"],function(t){var e="undefined"!=typeof window?window:{};return t.window=e}),define("skylark-langx-globals/main",["./globals","./console","./document","./window"],function(t){return t}),define("skylark-langx-globals",["skylark-langx-globals/main"],function(t){return t}),define("skylark-langx/globals",["skylark-langx-globals"],function(t){return t}),define("skylark-langx/hoster",["skylark-langx-hoster"],function(t){return t}),define("skylark-langx-maths/maths",["skylark-langx-ns","skylark-langx-types"],function(t,e){for(var n=[],r=0;r<256;r++)n[r]=(r<16?"0":"")+r.toString(16);var i={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*i.DEG2RAD},radToDeg:function(t){return t*i.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){var s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),f=o((e-r)/2),d=s((r-e)/2),p=o((r-e)/2);"XYX"===i?t.set(a*u,l*h,l*f,a*c):"YZY"===i?t.set(l*f,a*u,l*h,a*c):"ZXZ"===i?t.set(l*h,l*f,a*u,a*c):"XZX"===i?t.set(a*u,l*p,l*d,a*c):"YXY"===i?t.set(l*d,a*u,l*p,a*c):"ZYZ"===i?t.set(l*p,l*d,a*u,a*c):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};return t.attach("langx.maths",i)}),define("skylark-langx-maths/main",["./maths"],function(t){return t}),define("skylark-langx-maths",["skylark-langx-maths/main"],function(t){return t}),define("skylark-langx/maths",["skylark-langx-maths"],function(t){return t}),define("skylark-langx-numerics/numerics",["skylark-langx-ns","skylark-langx-types"],function(t,e){return t.attach("langx.numerics",{toFinite:e.toFinite,toNumber:e.toNumber,toInteger:e.toInteger})}),define("skylark-langx-numerics/maths",["skylark-langx-ns","skylark-langx-types","./numerics"],function(t,e,n){for(var r=[],i=0;i<256;i++)r[i]=(i<16?"0":"")+i.toString(16);var s={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*s.DEG2RAD},radToDeg:function(t){return t*s.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){var s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),c=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),f=o((e-r)/2),d=s((r-e)/2),p=o((r-e)/2);"XYX"===i?t.set(a*u,l*h,l*f,a*c):"YZY"===i?t.set(l*f,a*u,l*h,a*c):"ZXZ"===i?t.set(l*h,l*f,a*u,a*c):"XZX"===i?t.set(a*u,l*p,l*d,a*c):"YXY"===i?t.set(l*d,a*u,l*p,a*c):"ZYZ"===i?t.set(l*p,l*d,a*u,a*c):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};return n.maths=s}),define("skylark-langx-numerics/quaternion",["skylark-langx-klass","./numerics","./maths"],function(t,e,n){var r=t({klassName:"Quaternion",x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}},set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("mathsQuaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,r=t._y,i=t._z,s=t.order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),h=a(n/2),f=a(r/2),d=a(i/2);return"XYZ"===s?(this._x=h*c*u+l*f*d,this._y=l*f*u-h*c*d,this._z=l*c*d+h*f*u,this._w=l*c*u-h*f*d):"YXZ"===s?(this._x=h*c*u+l*f*d,this._y=l*f*u-h*c*d,this._z=l*c*d-h*f*u,this._w=l*c*u+h*f*d):"ZXY"===s?(this._x=h*c*u-l*f*d,this._y=l*f*u+h*c*d,this._z=l*c*d+h*f*u,this._w=l*c*u-h*f*d):"ZYX"===s?(this._x=h*c*u-l*f*d,this._y=l*f*u+h*c*d,this._z=l*c*d-h*f*u,this._w=l*c*u+h*f*d):"YZX"===s?(this._x=h*c*u+l*f*d,this._y=l*f*u+h*c*d,this._z=l*c*d-h*f*u,this._w=l*c*u-h*f*d):"XZY"===s&&(this._x=h*c*u-l*f*d,this._y=l*f*u-h*c*d,this._z=l*c*d+h*f*u,this._w=l*c*u+h*f*d),!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e,n=t.elements,r=n[0],i=n[4],s=n[8],o=n[1],a=n[5],l=n[9],c=n[2],u=n[6],h=n[10],f=r+a+h;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(u-l)*e,this._y=(s-c)*e,this._z=(o-i)*e):r>a&&r>h?(e=2*Math.sqrt(1+r-a-h),this._w=(u-l)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(s+c)/e):a>h?(e=2*Math.sqrt(1+a-r-h),this._w=(s-c)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(l+u)/e):(e=2*Math.sqrt(1+h-r-a),this._w=(o-i)/e,this._x=(s+c)/e,this._y=(l+u)/e,this._z=.25*e),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(n.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var n=this.angleTo(t);if(0===n)return this;var r=Math.min(1,e/n);return this.slerp(t,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("mathsQuaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,c=e._w;return this._x=n*c+s*o+r*l-i*a,this._y=r*c+s*a+i*o-n*l,this._z=i*c+s*l+n*a-r*o,this._w=s*c-n*o-r*a-i*l,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,s=this._w,o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;var a=1-o*o;if(a<=Number.EPSILON){var l=1-e;return this._w=l*s+e*this._w,this._x=l*n+e*this._x,this._y=l*r+e*this._y,this._z=l*i+e*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(a),u=Math.atan2(c,o),h=Math.sin((1-e)*u)/c,f=Math.sin(e*u)/c;return this._w=s*h+this._w*f,this._x=n*h+this._x*f,this._y=r*h+this._y*f,this._z=i*h+this._z*f,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){},_construct:function(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==r?r:1}});return Object.assign(r,{slerp:function(t,e,n,r){return n.copy(t).slerp(e,r)},slerpFlat:function(t,e,n,r,i,s,o){var a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3],h=i[s+0],f=i[s+1],d=i[s+2],p=i[s+3];if(u!==p||a!==h||l!==f||c!==d){var m=1-o,y=a*h+l*f+c*d+u*p,g=y>=0?1:-1,w=1-y*y;if(w>Number.EPSILON){var k=Math.sqrt(w),x=Math.atan2(k,y*g);m=Math.sin(m*x)/k,o=Math.sin(o*x)/k}var v=o*g;if(a=a*m+h*v,l=l*m+f*v,c=c*m+d*v,u=u*m+p*v,m===1-o){var _=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=_,l*=_,c*=_,u*=_}}t[e]=a,t[e+1]=l,t[e+2]=c,t[e+3]=u}}),Object.assign(r.prototype,{}),e.Quaternion=r}),define("skylark-langx-numerics/vector3",["skylark-langx-klass","./numerics","./maths","./quaternion"],function(t,e,n,r){var i=new r,s=t({klassName:"Vector3",set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("mathsVector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("mathsVector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("mathsVector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("mathsVector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(i.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(i.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*r-o*n,c=a*n+o*e-i*r,u=a*r+i*n-s*e,h=-i*e-s*n-o*r;return this.x=l*a+h*-i+c*-o-u*-s,this.y=c*a+h*-s+u*-i-l*-o,this.z=u*a+h*-o+l*-s-c*-i,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},cross:function(t,e){return void 0!==e?(console.warn("mathsVector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this},projectOnVector:function(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);var n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)},projectOnPlane:function(t){return o.copy(this).projectOnVector(t),this.sub(o)},reflect:function(t){return this.sub(o.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(MathUtils.clamp(n,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,n){var r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("mathsVector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},_construct:function(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}}),o=new s;return e.Vector3=s}),define("skylark-langx-numerics/matrix4",["skylark-langx-klass","./numerics","./vector3"],function(t,e,n){var r=new n,i=new n(0,0,0),s=new n(1,1,1),o=new n,a=new n,l=new n,c=t({set:function(t,e,n,r,i,s,o,a,l,c,u,h,f,d,p,m){var y=this.elements;return y[0]=t,y[4]=e,y[8]=n,y[12]=r,y[1]=i,y[5]=s,y[9]=o,y[13]=a,y[2]=l,y[6]=c,y[10]=u,y[14]=h,y[3]=f,y[7]=d,y[11]=p,y[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new c).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,n=t.elements,i=1/r.setFromMatrixColumn(t,0).length(),s=1/r.setFromMatrixColumn(t,1).length(),o=1/r.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("mathsMatrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){var h=s*c,f=s*u,d=o*c,p=o*u;e[0]=a*c,e[4]=-a*u,e[8]=l,e[1]=f+d*l,e[5]=h-p*l,e[9]=-o*a,e[2]=p-h*l,e[6]=d+f*l,e[10]=s*a}else if("YXZ"===t.order){var m=a*c,y=a*u,g=l*c,w=l*u;e[0]=m+w*o,e[4]=g*o-y,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-o,e[2]=y*o-g,e[6]=w+m*o,e[10]=s*a}else if("ZXY"===t.order){var m=a*c,y=a*u,g=l*c,w=l*u;e[0]=m-w*o,e[4]=-s*u,e[8]=g+y*o,e[1]=y+g*o,e[5]=s*c,e[9]=w-m*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){var h=s*c,f=s*u,d=o*c,p=o*u;e[0]=a*c,e[4]=d*l-f,e[8]=h*l+p,e[1]=a*u,e[5]=p*l+h,e[9]=f*l-d,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){var k=s*a,x=s*l,v=o*a,_=o*l;e[0]=a*c,e[4]=_-k*u,e[8]=v*u+x,e[1]=u,e[5]=s*c,e[9]=-o*c,e[2]=-l*c,e[6]=x*u+v,e[10]=k-_*u}else if("XZY"===t.order){var k=s*a,x=s*l,v=o*a,_=o*l;e[0]=a*c,e[4]=-u,e[8]=l*c,e[1]=k*u+_,e[5]=s*c,e[9]=x*u-v,e[2]=v*u-x,e[6]=o*c,e[10]=_*u+k}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(i,t,s)},lookAt:function(t,e,n){var r=this.elements;return l.subVectors(t,e),0===l.lengthSq()&&(l.z=1),l.normalize(),o.crossVectors(n,l),0===o.lengthSq()&&(1===Math.abs(n.z)?l.x+=1e-4:l.z+=1e-4,l.normalize(),o.crossVectors(n,l)),o.normalize(),a.crossVectors(l,o),r[0]=o.x,r[4]=a.x,r[8]=l.x,r[1]=o.y,r[5]=a.y,r[9]=l.y,r[2]=o.z,r[6]=a.z,r[10]=l.z,this},multiply:function(t,e){return void 0!==e?(console.warn("mathsMatrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],f=n[13],d=n[2],p=n[6],m=n[10],y=n[14],g=n[3],w=n[7],k=n[11],x=n[15],v=r[0],_=r[4],b=r[8],E=r[12],S=r[1],T=r[5],I=r[9],F=r[13],A=r[2],C=r[6],O=r[10],M=r[14],N=r[3],D=r[7],z=r[11],L=r[15];return i[0]=s*v+o*S+a*A+l*N,i[4]=s*_+o*T+a*C+l*D,i[8]=s*b+o*I+a*O+l*z,i[12]=s*E+o*F+a*M+l*L,i[1]=c*v+u*S+h*A+f*N,i[5]=c*_+u*T+h*C+f*D,i[9]=c*b+u*I+h*O+f*z,i[13]=c*E+u*F+h*M+f*L,i[2]=d*v+p*S+m*A+y*N,i[6]=d*_+p*T+m*C+y*D,i[10]=d*b+p*I+m*O+y*z,i[14]=d*E+p*F+m*M+y*L,i[3]=g*v+w*S+k*A+x*N,i[7]=g*_+w*T+k*C+x*D,i[11]=g*b+w*I+k*O+x*z,i[15]=g*E+w*F+k*M+x*L,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],c=t[2],u=t[6],h=t[10],f=t[14],d=t[3],p=t[7],m=t[11],y=t[15];return d*(+i*a*u-r*l*u-i*o*h+n*l*h+r*o*f-n*a*f)+p*(+e*a*f-e*l*h+i*s*h-r*s*f+r*l*c-i*a*c)+m*(+e*l*u-e*o*f-i*s*u+n*s*f+i*o*c-n*l*c)+y*(-r*o*c-e*a*u+e*o*h+r*s*u-n*s*h+n*a*c)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t,e,n){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this},getInverse:function(t,e){void 0!==e&&console.warn("mathsMatrix4: .getInverse() can no longer be configured to throw on degenerate.");var n=this.elements,r=t.elements,i=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],f=r[8],d=r[9],p=r[10],m=r[11],y=r[12],g=r[13],w=r[14],k=r[15],x=d*w*h-g*p*h+g*u*m-c*w*m-d*u*k+c*p*k,v=y*p*h-f*w*h-y*u*m+l*w*m+f*u*k-l*p*k,_=f*g*h-y*d*h+y*c*m-l*g*m-f*c*k+l*d*k,b=y*d*u-f*g*u-y*c*p+l*g*p+f*c*w-l*d*w,E=i*x+s*v+o*_+a*b;if(0===E)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var S=1/E;return n[0]=x*S,n[1]=(g*p*a-d*w*a-g*o*m+s*w*m+d*o*k-s*p*k)*S,n[2]=(c*w*a-g*u*a+g*o*h-s*w*h-c*o*k+s*u*k)*S,n[3]=(d*u*a-c*p*a-d*o*h+s*p*h+c*o*m-s*u*m)*S,n[4]=v*S,n[5]=(f*w*a-y*p*a+y*o*m-i*w*m-f*o*k+i*p*k)*S,n[6]=(y*u*a-l*w*a-y*o*h+i*w*h+l*o*k-i*u*k)*S,n[7]=(l*p*a-f*u*a+f*o*h-i*p*h-l*o*m+i*u*m)*S,n[8]=_*S,n[9]=(y*d*a-f*g*a-y*s*m+i*g*m+f*s*k-i*d*k)*S,n[10]=(l*g*a-y*c*a+y*s*h-i*g*h-l*s*k+i*c*k)*S,n[11]=(f*c*a-l*d*a-f*s*h+i*d*h+l*s*m-i*c*m)*S,n[12]=b*S,n[13]=(f*g*o-y*d*o+y*s*p-i*g*p-f*s*w+i*d*w)*S,n[14]=(y*c*o-l*g*o-y*s*u+i*g*u+l*s*w-i*c*w)*S,n[15]=(l*d*o-f*c*o+f*s*u-i*d*u-l*s*p+i*c*p)*S,this},scale:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,c=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,c*o+n,c*a-r*s,0,l*a-r*o,c*a+r*s,i*a*a+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){var r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,c=s+s,u=o+o,h=i*l,f=i*c,d=i*u,p=s*c,m=s*u,y=o*u,g=a*l,w=a*c,k=a*u,x=n.x,v=n.y,_=n.z;return r[0]=(1-(p+y))*x,r[1]=(f+k)*x,r[2]=(d-w)*x,r[3]=0,r[4]=(f-k)*v,r[5]=(1-(h+y))*v,r[6]=(m+g)*v,r[7]=0,r[8]=(d+w)*_,r[9]=(m-g)*_,r[10]=(1-(h+p))*_,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(t,e,n){var i=this.elements,s=r.set(i[0],i[1],i[2]).length(),o=r.set(i[4],i[5],i[6]).length(),a=r.set(i[8],i[9],i[10]).length(),l=this.determinant();l<0&&(s=-s),t.x=i[12],t.y=i[13],t.z=i[14],u.copy(this);var c=1/s,h=1/o,f=1/a;return u.elements[0]*=c,u.elements[1]*=c,u.elements[2]*=c,u.elements[4]*=h,u.elements[5]*=h,u.elements[6]*=h,u.elements[8]*=f,u.elements[9]*=f,u.elements[10]*=f,e.setFromRotationMatrix(u),n.x=s,n.y=o,n.z=a,this},makePerspective:function(t,e,n,r,i,s){void 0===s&&console.warn("mathsMatrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,a=2*i/(e-t),l=2*i/(n-r),c=(e+t)/(e-t),u=(n+r)/(n-r),h=-(s+i)/(s-i),f=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,n,r,i,s){var o=this.elements,a=1/(e-t),l=1/(n-r),c=1/(s-i),u=(e+t)*a,h=(n+r)*l,f=(s+i)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t},_construct:function(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("mathsMatrix4: the constructor no longer reads arguments. use .set() instead.")}}),u=new c;return e.Matrix4=c}),define("skylark-langx-numerics/euler",["skylark-langx-klass","./numerics","./maths","./quaternion","./vector3","./matrix4"],function(t,e,n,r,i,s){var o=new s,a=new r,l=t({x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}},isEuler:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var i=n.clamp,s=t.elements,o=s[0],a=s[4],l=s[8],c=s[1],u=s[5],h=s[9],f=s[2],d=s[6],p=s[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(i(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-i(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(l,p),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-f,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-f,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,o))):"ZYX"===e?(this._y=Math.asin(-i(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,u))):"YZX"===e?(this._z=Math.asin(i(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(l,p))):"XZY"===e?(this._z=Math.asin(-i(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-h,p),this._y=0)):console.warn("skylark-nunustudio/editor/gui/element/RendererCanvasEuler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,n){return o.makeRotationFromQuaternion(t),this.setFromRotationMatrix(o,e,n)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return a.setFromEuler(this),this.setFromQuaternion(a,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new i(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){},_construct:function(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||l.DefaultOrder}});return l.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],l.DefaultOrder="XYZ",e.Euler=l}),define("skylark-langx-numerics/matrix3",["skylark-langx-klass","./numerics"],function(t,e){var n=t({klassName:"Matrix3",isMatrix3:!0,set:function(t,e,n,r,i,s,o,a,l){var c=this.elements;return c[0]=t,c[1]=r,c[2]=o,c[3]=e,c[4]=i,c[5]=a,c[6]=n,c[7]=s,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},extractBasis:function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],f=n[5],d=n[8],p=r[0],m=r[3],y=r[6],g=r[1],w=r[4],k=r[7],x=r[2],v=r[5],_=r[8];return i[0]=s*p+o*g+a*x,i[3]=s*m+o*w+a*v,i[6]=s*y+o*k+a*_,i[1]=l*p+c*g+u*x,i[4]=l*m+c*w+u*v,i[7]=l*y+c*k+u*_,i[2]=h*p+f*g+d*x,i[5]=h*m+f*w+d*v,i[8]=h*y+f*k+d*_,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*s*c-e*o*l-n*i*c+n*o*a+r*i*l-r*s*a},getInverse:function(t,e){void 0!==e&&console.warn("mathsMatrix3: .getInverse() can no longer be configured to throw on degenerate.");var n=t.elements,r=this.elements,i=n[0],s=n[1],o=n[2],a=n[3],l=n[4],c=n[5],u=n[6],h=n[7],f=n[8],d=f*l-c*h,p=c*u-f*a,m=h*a-l*u,y=i*d+s*p+o*m;if(0===y)return this.set(0,0,0,0,0,0,0,0,0);var g=1/y;return r[0]=d*g,r[1]=(o*h-f*s)*g,r[2]=(c*s-o*l)*g,r[3]=p*g,r[4]=(f*i-o*u)*g,r[5]=(o*a-c*i)*g,r[6]=m*g,r[7]=(s*u-h*i)*g,r[8]=(l*i-s*a)*g,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,r,i,s,o){var a=Math.cos(i),l=Math.sin(i);this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1)},scale:function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],s=r[3],o=r[6],a=r[1],l=r[4],c=r[7];return r[0]=e*i+n*a,r[3]=e*s+n*l,r[6]=e*o+n*c,r[1]=-n*i+e*a,r[4]=-n*s+e*l,r[7]=-n*o+e*c,this},translate:function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t},_construct:function(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("Matrix3: the constructor no longer reads arguments. use .set() instead.")}});return e.Matrix3=n}),define("skylark-langx-numerics/transform",["skylark-langx-klass","./numerics"],function(t,e){var n=t({klassName:"Transform",value:{get:function(){return this._.value}}});return e.Transform=n}),define("skylark-langx-numerics/matrix-transform",["./numerics","./transform"],function(t,e){var n=e.inherit({klassName:"MatrixTransform",value:{get:function(){return this.matrix.clone()}},matrix:{get:function(){return this._.matrix}},clone:function(){},transform:function(t){},transformBounds:function(t){},_construct:function(t){var e=this._={};e.matrix=t}});return t.MatrixTransform=n}),define("skylark-langx-numerics/plane",["skylark-langx-klass","./numerics","./matrix3","./vector3"],function(t,e,n,r){var i=new r,s=new r,o=new n,a=t({klassName:"Plane",set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,n){var r=i.subVectors(n,e).cross(s.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("mathsPlane: .projectPoint() target is now required"),e=new r),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){void 0===e&&(console.warn("mathsPlane: .intersectLine() target is now required"),e=new r);var n=t.delta(i),s=this.normal.dot(n);if(0===s)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;var o=-(t.start.dot(this.normal)+this.constant)/s;return o<0||o>1?void 0:e.copy(n).multiplyScalar(o).add(t.start)},intersectsLine:function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("mathsPlane: .coplanarPoint() target is now required"),t=new r),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){var n=e||o.getNormalMatrix(t),r=this.coplanarPoint(i).applyMatrix4(t),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant},_construct:function(t,e){this.normal=void 0!==t?t:new r(1,0,0),this.constant=void 0!==e?e:0}});return e.Plane=a}),define("skylark-langx-numerics/rotate-transform",["./numerics","./transform","./matrix-transform"],function(t,e,n){var r=t.RotateTransform=e.inherit({klassName:"RotateTransform",value:{get:function(){return n.rotateAt(this.angle,this.centerX,this.centerY)}},angle:{get:function(){return this._.angle}},centerX:{get:function(){return this._.centerX}},centerY:{get:function(){return this._.centerY}},clone:function(){},transform:function(t){},transformBounds:function(t){},init:function(t,e,n){var r=this._={};r.angle=t||0,r.centerX=e||0,r.centerY=n||0}});return r}),define("skylark-langx-numerics/scale-transform",["./numerics","./transform","./matrix-transform"],function(t,e,n){var r=e.inherit({klassName:"ScaleTransform",value:{get:function(){return n.scaleAt(this.scaleX,this.scaleY,this.centerX,this.centerY)}},scaleX:{get:function(){return this._.scaleX}},scaleY:{get:function(){return this._.scaleY}},centerX:{get:function(){return this._.centerX}},centerY:{get:function(){return this._.centerY}},clone:function(){},transform:function(t){},transformBounds:function(t){},_construct:function(t,e,n,r){var i=this._={};i.scaleX=t||1,i.scaleY=e||1,i.centerX=n||0,i.centerY=r||0}});return t.ScaleTransform=r}),define("skylark-langx-numerics/skew-transform",["./numerics","./transform","./matrix-transform"],function(t,e,n){var r=e.inherit({klassName:"SkewTransform",value:{get:function(){return n.scaleAt(this.skewX,this.skewY)}},skewX:{get:function(){return this._.skewX}},skewY:{get:function(){return this._.skewY}},clone:function(){},transform:function(t){},transformBounds:function(t){},_construct:function(t,e){var n=this._={};n.skewX=t||0,n.skewY=e||0}});return t.SkewTransform=r}),define("skylark-langx-numerics/vector2",["skylark-langx-klass","./numerics"],function(t,e){var n=t({klassName:"Vector2",set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(-this.y,-this.x)+Math.PI;return t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},rotateAround:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this},_construct:function(t,e){this.x=t||0,this.y=e||0}});return e.Vector2=n}),define("skylark-langx-numerics/transform-matrix",["skylark-langx-klass","./numerics","./vector2"],function(t,e,n){var r=Math.PI/180,i={},s=function(t){return i[t]||(i[t]=Math.PI*t/180)},o=t({klassName:"TransformMatrix",_multiplyPoint:function(t){var e=this._,r=t.x*e.m11+t.y*e.m21+e.dx,i=t.x*e.m12+t.y*e.m22+e.dy;return new n(r,i)},m11:{get:function(){return this._.m11}},m12:{get:function(){return this._.m12}},m21:{get:function(){return this._.m21}},m22:{get:function(){return this._.m22}},dx:{get:function(){return this._.dx}},dy:{get:function(){return this._.dy}},alpha:{get:function(){return this._.alpha}},shadow:{get:function(){return this._.shadow}},compositeOperation:{get:function(){return this._.compositeOperation}},multiplyPoint:function(t){return this._multiplyPoint(t)},multiplyRectangle:function(t){if(this.isIdentity())return t.clone();var e=this.multiplyPoint(t.leftTop),n=this.multiplyPoint(t.leftBottom),r=this.multiplyPoint(t.right),i=this.multiplyPoint(t.rightBottom),s=Math.min(e.x,n.x,r.x,i.x),o=Math.min(e.y,n.y,r.y,i.y),a=Math.max(e.x,n.x,r.x,i.x),l=Math.max(e.y,n.y,r.y,i.y);return new Rect(s,o,a-s,l-o)},prepend:function(t,e,n,r,i,s){var o=this.dx;if(1!=t||0!=e||0!=n||1!=r){var a=this.m11,l=this.m21;this.m11=a*t+this.m12*n,this.m12=a*e+this.m12*r,this.m21=l*t+this.m22*n,this.m22=l*e+this.m22*r}return this.dx=o*t+this.dy*n+i,this.dy=o*e+this.dy*r+s,this},append:function(t,e,n,r,i,s){var o=this.m11,a=this.m12,l=this.m21,c=this.m22;return this.m11=t*o+e*l,this.m12=t*a+e*c,this.m21=n*o+r*l,this.m22=n*a+r*c,this.dx=i*o+s*l+this.dx,this.dy=i*a+s*c+this.dy,this},prependMatrix:function(t){return this.prepend(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy),this.prependProperties(t.alpha,t.shadow,t.compositeOperation),this},appendMatrix:function(t){return this.append(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy),this.appendProperties(t.alpha,t.shadow,t.compositeOperation),this},prependTransform:function(t,e,n,i,s,o,a,l,c){if(s%360)var u=s*r,h=Math.cos(u),f=Math.sin(u);else h=1,f=0;return(l||c)&&(this.dx-=l,this.dy-=c),o||a?(o*=r,a*=r,this.prepend(h*n,f*n,-f*i,h*i,0,0),this.prepend(Math.cos(a),Math.sin(a),-Math.sin(o),Math.cos(o),t,e)):this.prepend(h*n,f*n,-f*i,h*i,t,e),this},appendTransform:function(t,e,n,i,s,o,a,l,c){if(s%360)var u=s*r,h=Math.cos(u),f=Math.sin(u);else h=1,f=0;return o||a?(o*=r,a*=r,this.append(Math.cos(a),Math.sin(a),-Math.sin(o),Math.cos(o),t,e),this.append(h*n,f*n,-f*i,h*i,0,0)):this.append(h*n,f*n,-f*i,h*i,t,e),(l||c)&&(this.dx-=l*this.m11+c*this.m21,this.dy-=l*this.m12+c*this.m22),this},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=this.m11,i=this.m21,s=this.dx;return this.m11=r*e-this.m12*n,this.m12=r*n+this.m12*e,this.m21=i*e-this.m22*n,this.m22=i*n+this.m22*e,this.dx=s*e-this.dy*n,this.dy=s*n+this.dy*e,this},skew:function(t,e){return t*=r,e*=r,this.append(Math.cos(e),Math.sin(e),-Math.sin(t),Math.cos(t),0,0),this},scale:function(t,e){return this.m11*=t,this.m22*=e,this.dx*=t,this.dy*=e,this},translate:function(t,e){return this.dx+=t,this.dy+=e,this},identity:function(){return this.alpha=this.m11=this.m22=1,this.m12=this.m21=this.dx=this.dy=0,this.shadow=this.compositeOperation=null,this},invert:function(){var t=this.m11,e=this.m12,n=this.m21,r=this.m22,i=this.dx,s=t*r-e*n;return this.m11=r/s,this.m12=-e/s,this.m21=-n/s,this.m22=t/s,this.dx=(n*this.dy-r*i)/s,this.dy=-(t*this.dy-e*i)/s,this},isIdentity:function(){return 0==this.dx&&0==this.dy&&1==this.m11&&0==this.m12&&0==this.m21&&1==this.m22},decompose:function(t){null==t&&(t={}),t.x=this.dx,t.y=this.dy,t.scaleX=Math.sqrt(this.m11*this.m11+this.m12*this.m12),t.scaleY=Math.sqrt(this.m21*this.m21+this.m22*this.m22);var e=Math.atan2(-this.m21,this.m22),n=Math.atan2(this.m12,this.m11);return e==n?(t.rotation=n/r,this.m11<0&&this.m22>=0&&(t.rotation+=t.rotation<=0?180:-180),t.skewX=t.skewY=0):(t.skewX=e/r,t.skewY=n/r),t},reinitialize:function(t,e,n,r,i,s,o,a,l){return this._initialize(t,e,n,r,i,s),this.alpha=o||1,this.shadow=a,this.compositeOperation=l,this},appendProperties:function(t,e,n){return this.alpha*=t,this.shadow=e||this.shadow,this.compositeOperation=n||this.compositeOperation,this},prependProperties:function(t,e,n){return this.alpha*=t,this.shadow=this.shadow||e,this.compositeOperation=this.compositeOperation||n,this},multiply:function(t){var e=this.m11,n=this.m12,r=this.m21,i=this.m22,s=this.dx,o=this.dy,a=t;return this.m11=e*a.m11+r*a.m12,this.m12=n*a.m11+i*a.m12,this.m21=e*a.m21+r*a.m22,this.m22=n*a.m21+i*a.m22,this.dx=e*a.dx+r*a.dy+s,this.dy=n*a.dx+i*a.dy+o,this},clone:function(){var t=this._,e=new o(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy);return e.shadow=this.shadow,e.alpha=this.alpha,e.compositeOperation=this.compositeOperation,e},toString:function(){var t=this._;return"[TransformMatrix (m11="+t.m11+" m12="+t.m12+" m21="+t.m21+" m22="+t.m22+" dx="+t.dx+" dy="+t.dy+")]"},_construct:function(t,e,n,r,i,s){var o=this._={};o.m11=t||1,o.m12=e||0,o.m21=n||0,o.m22=r||1,o.dx=i||0,o.dy=s||0}});return Object.assign(o,{translate:function(t,e){return new o(1,0,0,1,t,e)},scale:function(t,e){return new o(t,0,0,e||t,0,0)},rotate:function(t){var e=Math.cos(t),n=Math.sin(t);return new o(e,n,-n,e,0,0)},rotateg:function(t){return this.rotate(s(t))},skewX:function(t){var e=Math.tan(t);return new o(1,0,e,1)},skewXg:function(t){return this.skewX(s(t))},skewY:function(t){var e=Math.tan(t);return new o(1,e,0,1)},skewYg:function(t){return this.skewY(s(t))},reflect:function(t,e){1==arguments.length&&(e=t.y,t=t.x);var n=t*t,r=e*e,i=n+r,s=2*n/i-1,a=2*t*e/i,l=a,c=2*r/i-1;return new o(s,l,a,c)},project:function(t,e){var n=t*t,r=e*e,i=n+r,s=n/i,a=t*e/i;return yx=a,yy=r/i,new o(s,yx,a,yy)},_sandwich:function(t,e,n){return this.translate(e,n).multiply(t).multiply(this.translate(-e,-n))},scaleAt:function(t,e,n,r){switch(arguments.length){case 4:return this._sandwich(this.scale(t,e),n,r);case 3:return"number"==typeof n?this._sandwich(this.scale(t),e,n):this._sandwich(this.scale(t,e),n.x,n.y)}return this._sandwich(this.scale(t),e.x,e.y)},rotateAt:function(t,e,n){return arguments.length>2?this._sandwich(this.rotate(t),e,n):this._sandwich(this.rotate(t),e.x,e.y)},rotategAt:function(t,e,n){return arguments.length>2?this._sandwich(this.rotateg(t),e,n):this._sandwich(this.rotateg(t),e.x,e.y)},skewXAt:function(t,e,n){return arguments.length>2?this._sandwich(this.skewX(t),e,n):this._sandwich(this.skewX(t),e.x,e.y)},skewXgAt:function(t,e,n){return arguments.length>2?this._sandwich(this.skewXg(t),e,n):this._sandwich(this.skewXg(t),e.x,e.y)},skewYAt:function(t,e,n){return arguments.length>2?this._sandwich(this.skewY(t),e,n):this._sandwich(this.skewY(t),e.x,e.y)},skewYgAt:function(t,e,n){return arguments.length>2?this._sandwich(this.skewYg(t),e,n):this._sandwich(this.skewYg(t),e.x,e.y)}}),e.TransformMatrix=o}),define("skylark-langx-numerics/translate-transform",["./numerics","./transform","./matrix-transform"],function(t,e,n,r,i){var s=e.inherit({klassName:"TranslateTransform",value:{get:function(){return n.scaleAt(this.x,this.y)}},x:{get:function(){return this._.x}},y:{get:function(){return this._.y}},clone:function(){},transform:function(t){},transformBounds:function(t){},init:function(t,e){var n=this._;n.x=t||0,n.y=e||0}});return t.TranslateTransform=s}),define("skylark-langx-numerics/vector4",["skylark-langx-klass","./numerics"],function(t,e){var n=t({klassName:"Vector4",set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,n,r,i,s=t.elements,o=s[0],a=s[4],l=s[8],c=s[1],u=s[5],h=s[9],f=s[2],d=s[6],p=s[10];if(Math.abs(a-c)<.01&&Math.abs(l-f)<.01&&Math.abs(h-d)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+f)<.1&&Math.abs(h+d)<.1&&Math.abs(o+u+p-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(o+1)/2,y=(u+1)/2,g=(p+1)/2,w=(a+c)/4,k=(l+f)/4,x=(h+d)/4;return m>y&&m>g?m<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(m),r=w/n,i=k/n):y>g?y<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(y),n=w/r,i=x/r):g<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(g),n=k/i,r=x/i),this.set(n,r,i,e),this}var v=Math.sqrt((d-h)*(d-h)+(l-f)*(l-f)+(c-a)*(c-a));return Math.abs(v)<.001&&(v=1),this.x=(d-h)/v,this.y=(l-f)/v,this.z=(c-a)/v,this.w=Math.acos((o+u+p-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},_construct:function(t,e,n,r){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==r?r:1}});return e.Vector4=n}),define("skylark-langx-numerics/main",["./numerics","./euler","./maths","./matrix3","./matrix4","./matrix-transform","./plane","./quaternion","./rotate-transform","./scale-transform","./skew-transform","./transform","./transform-matrix","./translate-transform","./vector2","./vector3","./vector4"],function(t){return t}),define("skylark-langx-numerics",["skylark-langx-numerics/main"],function(t){return t}),define("skylark-langx/numerics",["skylark-langx-numerics"],function(t){return t}),define("skylark-langx/objects",["skylark-langx-objects"],function(t){return t}),define("skylark-langx/Evented",["./emitter"],function(t){return t}),define("skylark-langx-strings/strings",["skylark-langx-ns"],function(t){return t.attach("langx.strings")}),define("skylark-langx-strings/base64",["./strings"],function(t){return t.base64={decode:function(t,e){e=null!=e&&e;var n,r,i,s,o,a,l,c="",u=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(;u<t.length;)s=this._keyStr.indexOf(t.charAt(u++)),o=this._keyStr.indexOf(t.charAt(u++)),a=this._keyStr.indexOf(t.charAt(u++)),l=this._keyStr.indexOf(t.charAt(u++)),n=s<<2|o>>4,r=(15&o)<<4|a>>2,i=(3&a)<<6|l,c+=String.fromCharCode(n),64!=a&&(c+=String.fromCharCode(r)),64!=l&&(c+=String.fromCharCode(i));e||(c=function(t){var e="",n=0,r=c1=c2=0;for(;n<t.length;)(r=t.charCodeAt(n))<128?(e+=String.fromCharCode(r),n++):r>191&&r<224?(c2=t.charCodeAt(n+1),e+=String.fromCharCode((31&r)<<6|63&c2),n+=2):(c2=t.charCodeAt(n+1),c3=t.charCodeAt(n+2),e+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),n+=3);return e}(c));return c},encode:function(t,e){var n,r,i,s,o,a,l,c="",u=0;(e=null!=e&&e)||(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e+=String.fromCharCode(r):r>127&&r<2048?(e+=String.fromCharCode(r>>6|192),e+=String.fromCharCode(63&r|128)):(e+=String.fromCharCode(r>>12|224),e+=String.fromCharCode(r>>6&63|128),e+=String.fromCharCode(63&r|128))}return e}(t));for(;u<t.length;)n=t.charCodeAt(u++),r=t.charCodeAt(u++),i=t.charCodeAt(u++),s=n>>2,o=(3&n)<<4|r>>4,a=(15&r)<<2|i>>6,l=63&i,isNaN(r)?a=l=64:isNaN(i)&&(l=64),c=c+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(a)+this._keyStr.charAt(l);return c}}}),define("skylark-langx-strings/camel-case",["./strings"],function(t){return t.camelCase=function(t){return t.replace(/-([\da-z])/g,function(t){return t.toUpperCase().replace("-","")})}}),define("skylark-langx-strings/dasherize",["./strings"],function(t){return t.dasherize=function(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}}),define("skylark-langx-strings/deserialize-value",["./strings"],function(t){return t.deserializeValue=function(t){try{return t?"true"==t||"false"!=t&&("null"==t?null:+t+""==t?+t:/^[\[\{]/.test(t)?JSON.parse(t):t):t}catch(e){return t}}}),define("skylark-langx-strings/escape-html",["./strings"],function(t){var e=Object.freeze({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"});function n(t){return e[t]}var r=/[&<>"'`=]/g;return t.escapeHTML=function(t){if(null==t)return"";if(!t)return String(t);return t.toString().replace(r,n)}}),define("skylark-langx-strings/generate-uuid",["./strings"],function(t){return t.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"===t?e:3&e|8;return n.toString(16)})}}),define("skylark-langx-strings/lower-first",["./strings"],function(t){return t.lowerFirst=function(t){return t.charAt(0).toLowerCase()+t.slice(1)}}),define("skylark-langx-strings/ltrim",["./strings"],function(t){return t.ltrim=function(t){return t.replace(/^\s+/,"")}}),define("skylark-langx-strings/rtrim",["./strings"],function(t){return t.rtrim=function(t){return t.replace(/\s+$/,"")}}),define("skylark-langx-strings/serialize-value",["./strings"],function(t){return t.serializeValue=function(t){return JSON.stringify(t)}}),define("skylark-langx-strings/slugify",["./strings"],function(t){return t.slugify=function(t){t=(t=t.replace(/^\s+|\s+$/g,"")).toLowerCase();for(var e="a/_,:;",n=0,r=e.length;n<r;n++)t=t.replace(new RegExp(e.charAt(n),"g"),"AAAAAACCCDEEEEEEEEIIIINNOOOOOORRSTUUUUUYYZaaaaaacccdeeeeeeeeiiiinnooooooorrstuuuuuyyzbBDdBAa------".charAt(n));return t=t.replace(/\s+/g,"-").replace(/-+/g,"-")}}),define("skylark-langx-strings/substitute",["./strings"],function(t){return t.substitute=function(t,e,n,r){function i(t,e){if(t.match(/\./)){var n,r=function(t,e){var i=t.pop();return i?e[i]?r(t,n=e[i]):null:n};return r(t.split(".").reverse(),e)}return e[t]}return r=r||window,n=n?proxy(r,n):function(t){return t},t.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(t,s,o){var a=i(s,e);return o&&(a=i(o,r).call(r,a,s)),n(a,s).toString()})}}),define("skylark-langx-strings/trim",["./strings"],function(t){return t.trim=function(t){return null==t?"":String.prototype.trim.call(t)}}),define("skylark-langx-strings/trim-null",["./strings"],function(t){const e=/\x00/g;return t.trimNull=function(t){if("string"!=typeof t)return warn("The argument for removeNullCharacters must be a string."),t;return t.replace(e,"")}}),define("skylark-langx-strings/unique-id",["./strings"],function(t){var e=0;return t.uniqueId=function(t){var n=++e+"";return t?t+n:n}}),define("skylark-langx-strings/upper-first",["./strings"],function(t){return t.upperFirst=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}}),define("skylark-langx-strings/words",["./strings"],function(t){const e="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",n=`[${e}]`,r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\u1ab0-\\u1aff\\u1dc0-\\u1dff]",i="[\\u2700-\\u27bf]",s="[a-z\\xdf-\\xf6\\xf8-\\xff]",o=`[^\\ud800-\\udfff${e+"\\d\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde"}]`,a=`(?:${r}|\\ud83c[\\udffb-\\udfff])`,l="[^\\ud800-\\udfff]",c="(?:\\ud83c[\\udde6-\\uddff]){2}",u="[\\ud800-\\udbff][\\udc00-\\udfff]",h="[A-Z\\xc0-\\xd6\\xd8-\\xde]",f=`(?:${s}|${o})`,d=`(?:${h}|${o})`,p="(?:['](?:d|ll|m|re|s|t|ve))?",m="(?:['](?:D|LL|M|RE|S|T|VE))?",y=`${a}?`,g="[\\ufe0e\\ufe0f]?",w=`(?:\\u200d(?:${[l,c,u].join("|")})${g+y})*`,k=g+y+w,x=`(?:${[i,c,u].join("|")})${k}`,v=RegExp([`${h}?${s}+${p}(?=${[n,h,"$"].join("|")})`,`${d}+${m}(?=${[n,h+f,"$"].join("|")})`,`${h}?${f}+${p}`,`${h}+${m}`,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])","\\d+",x].join("|"),"g");const _=RegExp.prototype.test.bind(/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/),b=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;return t.words=function(t,e){if(void 0===e){const e=_(t)?function(t){return t.match(v)}(t):function(t){return t.match(b)}(t);return e||[]}return t.match(e)||[]}}),define("skylark-langx-strings/main",["./strings","./base64","./camel-case","./dasherize","./deserialize-value","./escape-html","./generate-uuid","./lower-first","./ltrim","./rtrim","./serialize-value","./slugify","./substitute","./trim","./trim-null","./unique-id","./upper-first","./words"],function(t){return t}),define("skylark-langx-strings",["skylark-langx-strings/main"],function(t){return t}),define("skylark-langx/strings",["skylark-langx-strings"],function(t){return t}),define("skylark-langx/stateful",["./Evented","./strings","./objects"],function(t,e,n){var r=n.isEqual,i=n.mixin,s=n.result,o=n.isEmptyObject,a=n.clone,l=e.uniqueId,c=t.inherit({_construct:function(t,e){var n=t||{};e||(e={}),this.cid=l(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{});var r=s(this,"defaults");n=i({},r,n),this.set(n,e),this.changed={}},changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",toJSON:function(t){return a(this.attributes)},get:function(t){return this.attributes[t]},has:function(t){return null!=this.get(t)},set:function(t,e,n){if(null==t)return this;var i;if("object"==typeof t?(i=t,n=e):(i={})[t]=e,n||(n={}),!this._validate(i,n))return!1;var s=n.unset,o=n.silent,l=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=a(this.attributes),this.changed={});var u=this.attributes,h=this.changed,f=this._previousAttributes;for(var d in i)e=i[d],r(u[d],e)||l.push(d),r(f[d],e)?delete h[d]:h[d]=e,s?delete u[d]:u[d]=e;if(this.idAttribute in i&&(this.id=this.get(this.idAttribute)),!o){l.length&&(this._pending=n);for(var p=0;p<l.length;p++)this.trigger("change:"+l[p],this,u[l[p]],n)}if(c)return this;if(!o)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,i({},t,{unset:!0}))},hasChanged:function(t){return null==t?!o(this.changed):void 0!==this.changed[t]},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&a(this.changed);var e=this._changing?this._previousAttributes:this.attributes,n={};for(var i in t){var s=t[i];r(e[i],s)||(n[i]=s)}return!o(n)&&n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return a(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,i(e,{validationError:n})),!1)}});return c}),define("skylark-langx-topic/topic",["skylark-langx-ns","skylark-langx-events"],function(t,e){var n=new e.Emitter;return t.attach("langx.topic",{publish:function(t,e,r){var i=[].slice.call(arguments,1);return n.trigger({type:t,data:i})},subscribe:function(t,e,r){var i=function(t){e.apply(r,t.data)};return n.on(t,i),{remove:function(){n.off(t,i)}}}})}),define("skylark-langx-topic/main",["./topic"],function(t){return t}),define("skylark-langx-topic",["skylark-langx-topic/main"],function(t){return t}),define("skylark-langx/topic",["skylark-langx-topic"],function(t){return t}),define("skylark-langx/types",["skylark-langx-types"],function(t){return t}),define("skylark-langx-urls/urls",["skylark-langx-ns"],function(t){return t.attach("langx.urls",{})}),define("skylark-langx-urls/create_object_url",["./urls"],function(t){"use strict";const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return t.createObjectURL=function(t,n,r=!1){if(!r&&URL.createObjectURL){const e=new Blob([t],{type:n});return URL.createObjectURL(e)}let i=`data:${n};base64,`;for(let n=0,r=t.length;n<r;n+=3){const s=255&t[n],o=255&t[n+1],a=255&t[n+2],l=s>>2,c=(3&s)<<4|o>>4,u=n+1<r?(15&o)<<2|a>>6:64,h=n+2<r?63&a:64;i+=e[l]+e[c]+e[u]+e[h]}return i}}),define("skylark-langx-urls/create_valid_absolute_url",["./urls"],function(t){"use strict";return t.createValidAbsoluteUrl=function(t,e){if(!t)return null;try{const n=e?new URL(t,e):new URL(t);if(function(t){if(!t)return!1;switch(t.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(n))return n}catch(t){}return null}}),define("skylark-langx-urls/get-absolute-url",["./urls"],function(t){"use strict";return t.getAbsoluteUrl=function(t){if(!t.match(/^https?:\/\//)){const e=document.createElement("div");e.innerHTML=`<a href="${t}">x</a>`,t=e.firstChild.href}return t}}),define("skylark-langx-urls/get-file-extension",["./urls"],function(t){"use strict";return t.getFileExtension=function(t){if("string"==typeof t){const e=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/,n=e.exec(t);if(n)return n.pop().toLowerCase()}return""}}),define("skylark-langx-urls/get-file-name",["./urls"],function(t){"use strict";return t.getFileName=function(t){const e=t.indexOf("#"),n=t.indexOf("?"),r=Math.min(e>0?e:t.length,n>0?n:t.length);return t.substring(t.lastIndexOf("/",r)+1,r)}}),define("skylark-langx-urls/get-query",["./urls"],function(t){"use strict";return t.getQuery=function(t){for(var e={},n=t.split("&"),r=n.length,i=[],s=0;s<r;s++){i=n[s].split("=",2);try{i[0]=decodeURIComponent(i[0]),i[1]=decodeURIComponent(i[1])}catch(t){}void 0===e[i[0]]?e[i[0]]=i[1]:e[i[0]]+=","+i[1]}return e}}),define("skylark-langx-urls/parse-url",["./urls"],function(t){"use strict";return t.parseUrl=function(t){const e=["protocol","hostname","port","pathname","search","hash","host"];let n=document.createElement("a");n.href=t;const r=""===n.host&&"file:"!==n.protocol;let i;r&&((i=document.createElement("div")).innerHTML=`<a href="${t}"></a>`,n=i.firstChild,i.setAttribute("style","display:none; position:absolute;"),document.body.appendChild(i));const s={};for(let t=0;t<e.length;t++)s[e[t]]=n[e[t]];"http:"===s.protocol&&(s.host=s.host.replace(/:80$/,""));"https:"===s.protocol&&(s.host=s.host.replace(/:443$/,""));s.protocol||(s.protocol=window.location.protocol);r&&document.body.removeChild(i);return s}}),define("skylark-langx-urls/is-cross-origin",["./urls","./parse-url"],function(t,e){"use strict";return t.isCrossOrigin=function(t,n=window.location){const r=e(t);return(":"===r.protocol?n.protocol:r.protocol)+r.host!==n.protocol+n.host}}),define("skylark-langx-urls/is_same_origin",["./urls"],function(t){"use strict";return t.isSameOrigin=function(t,e){let n;try{if(!(n=new URL(t)).origin||"null"===n.origin)return!1}catch(t){return!1}const r=new URL(e,n);return n.origin===r.origin}}),define("skylark-langx-urls/path",["skylark-langx-types","skylark-langx-constructs","./urls"],function(t,e,n){var r=e.klass({_construct:function(){var e=this._={segments:null,hasLeading:!1,hasTrailing:!1};1==arguments.length&&t.isString(arguments[0])?this._parse(arguments[0]):t.isArray(arguments[0])&&(e.segments=arguments[0],e.hasLeading=arguments[1]||!1,e.hasTrailing=arguments[2]||!1,this._canonicalize())},_canonicalize:function(){for(var t,e=this._.segments,n=0;n<e.length;n++)if("."==e[n]||".."==e[n]){t=!0;break}if(t){for(var r=[],n=0;n<e.length;n++)".."==e[n]?0==r.length?this.hasLeading||r.push(e[n]):".."==r[r.length-1]?r.push(".."):r.pop():"."==e[n]&&1!=e.length||r.push(e[n]);if(r.length==e.length)return;this._.segments=r}},_length:function(t){return this._.segments.length},_parse:function(t){t||(t=".");var e=this._,n=t.split("/");"/"==t.charAt(0)&&(e.hasLeading=!0,n.shift()),"/"==t.charAt(t.length-1)&&(e.hasTrailing=!0,n.pop()),e.segments=n,e.path=t,this._canonicalize()},append:function(e){return t.isString(e)?this.appendPathStr(e):this.appendPath(e)},appendPath:function(t){if(t.isAbsolute())return t;var e=this.segments,n=t.segments,i=e.concat(n),s=new r(i,this.hasLeading,t.hasTrailing);return s},appendPathStr:function(t){return t=new r(t||""),this.appendPath(t)},clone:function(){return new r(this.segments,this.hasLeading,this.hasTrailing)},endsWith:function(t){for(var e=this.segments,n=new r(t).segments;n.length>0&&e.length>0;)if(n.pop()!=e.pop())return!1;return!0},equals:function(t){var e=this._.segments,n=t._.segments;if(e.length!=n.length)return!1;for(var r=0;r<e.length;r++)if(n[r]!=e[r])return!1;return!0},firstSegment:function(t){var e=this._.segments;return e[t||0]},getExtension:function(){var t=this._.extension,e=this._.path;return textension||(t=this._.extension=e.substr(e.lastIndexOf(".")+1)),t},getSegments:function(){return this.segments},getParentPath:function(){var t=this._.parentPath;if(!t){var e=this.segments;e.pop(),t=this._.parentPath=new r(e,this.hasLeading)}return t},getRoot:function(){},isAbsolute:function(){return this.hasLeading},lastSegment:function(){var t=this._.segments;return t[t.length-1]},matchingFirstSegments:function(t){for(var e=this.segments,n=t.segments,r=Math.min(e.length,n.length),i=0,s=0;s<r;s++){if(e[s]!=n[s])return i;i++}return i},normalize:function(){},removeFirstSegments:function(t){var e=this._.segments,n=this._.hasLeading;return hasTrailing=this._.hasTrailing,new r(e.slice(t,e.length),n,hasTrailing)},removeLastSegments:function(t){var e=this._.segments,n=this._.hasLeading;return hasTrailing=this._.hasTrailing,t||(t=1),new r(e.slice(0,e.length-t),n,hasTrailing)},removeMatchingFirstSegments:function(t){var e=this.matchingFirstSegments(t);return this.removeFirstSegments(e)},removeMatchingLastSegments:function(t){var e=this.matchingFirstSegments(anotherPath);return this.removeLastSegments(e)},removeRelative:function(){var t=this.segments;return t.length>0&&"."==t[1]?this.removeFirstSegments(1):this},relativeTo:function(t,e){"string"==typeof t&&(t=new r(t));var n=this.segments;if(this.isAbsolute())return this;var i=t.segments,s=this.matchingFirstSegments(t),o=i.length;e&&(o-=1);var a=o-s,l=a+n.length-s;if(0==l)return r.EMPTY;for(var c=[],u=0;u<a;u++)c.push("..");for(var u=s;u<n.length;u++)c.push(n[u]);return new r(c,!1,this.hasTrailing)},segment:function(t){var e=this._.segments;return e.length<t?null:e[t]},startsWith:function(t){var e=this.matchingFirstSegments(t);return t._length()==e},toString:function(){var t=[],e=this._.segments;this.hasLeading&&t.push("/");for(var n=0;n<e.length;n++)n>0&&t.push("/"),t.push(e[n]);return this.hasTrailing&&t.push("/"),t.join("")},hasLeading:{get:function(){return this._.hasLeading}},hasTrailing:{get:function(){return this._.hasTrailing}}});return r.EMPTY=new r(""),n.Path=r}),define("skylark-langx-urls/main",["./urls","./create_object_url","./create_valid_absolute_url","./get-absolute-url","./get-file-extension","./get-file-name","./get-query","./is-cross-origin","./is_same_origin","./parse-url","./path"],function(t){return t}),define("skylark-langx-urls",["skylark-langx-urls/main"],function(t){return t}),define("skylark-langx/urls",["skylark-langx-urls"],function(t){return t}),define("skylark-langx/langx",["./skylark","./arrays","./array-store","./aspect","./async","./binary","./constructs","./datetimes","./deferred","./emitter","./evented","./events","./funcs","./globals","./hoster","./klass","./maths","./numerics","./objects","./stateful","./strings","./topic","./types","./urls"],function(t,e,n,r,i,s,o,a,l,c,u,h,f,d,p,m,y,g,w,k,x,v,_,b){"use strict";Array.prototype.concat,Array.prototype.indexOf,Array.prototype.slice,Array.prototype.filter;var E=w.mixin,S=(w.safeMixin,_.isFunction);var T=1;function I(){return I}return E(I,{createEvent:c.createEvent,funcArg:function(t,e,n,r){return S(e)?e.call(t,n,r):e},getQueryParams:function(t){var e=(t=t||window.location.href).split("?"),n={};e.length>1&&e[1].split("&").forEach(function(t){var e=t.split("=");n[e[0]]=e[1]});return n},toPixel:function(t){return parseFloat(t)||0},uid:function(t){return t._uid||(t._uid=T++)},URL:"undefined"!=typeof window?window.URL||window.webkitURL:null}),E(I,e,r,a,f,g,w,x,_,{ArrayStore:n,async:i,Deferred:l,Emitter:c,Evented:u,hoster:p,klass:m,Stateful:k,topic:v}),t.langx=I}),define("skylark-domx-browser/browser",["skylark-langx/skylark","skylark-langx/langx"],function(t,e){"use strict";var n=e.hoster.browser;return e.mixin(n,{isIE:!!/msie/i.exec(window.navigator.userAgent),location:function(){return window.location},support:{}}),t.attach("domx.browser",n)}),define("skylark-domx-browser/support/css3",["skylark-langx/langx","../browser"],function(t,e){"use strict";var n,r,i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},s=null,o="",a="",l={},c={},u=/^(Webkit|webkit|O|Moz|moz|ms)(.*)$/,h=window.document,f=h.createElement("div"),d=f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.matchesSelector,p=f.style;for(var m in p){var y=m.match(r||u);if(y){r||(n=y[1],r=new RegExp("^("+n+")(.*)$"),n,o="-"+n.toLowerCase()+"-",a=n.toLowerCase()),l[t.lowerFirst(y[2])]=m;var g=t.dasherize(y[2]);c[g]=o+g,i[m]&&(s=i[m])}}s||void 0!==p.transition&&(s=i.transition);var w={normalizeStyleProperty:function(t){return l[t]||t},normalizeCssProperty:function(t){return c[t]||t},normalizeCssEvent:function(t){return a?a+t:t.toLowerCase()},matchesSelector:d};return t.mixin(e,w),e.css3PropPrefix=w.propPrefix=o,s&&(e.support.transition=w.transition={end:s}),e.support.cssPointerEvents=w.pointerEvents=(f.style.cssText="pointer-events:auto","auto"===f.style.pointerEvents),f=null,e.support.css3=w}),define("skylark-domx-browser/support/fullscreen",["../browser"],function(t){const e={prefixed:!0},n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],r=n[0];let i;for(let t=0;t<n.length;t++)if(n[t][1]in document){i=n[t];break}if(i){for(let t=0;t<i.length;t++)e[r[t]]=i[t];e.prefixed=i[0]!==r[0],t.requestFullscreen=function(){return document.body[e.requestFullscreen].apply(this,arguments)},t.exitFullscreen=function(){return document[e.exitFullscreen].apply(this,arguments)},t.support.fullscreen=e}else t.support.fullscreen=null;return t.support.fullscreen}),define("skylark-domx-browser/support/touch",["../browser"],function(t){return t.support.tocuh=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)}),define("skylark-domx-browser/main",["./browser","./support/css3","./support/fullscreen","./support/touch"],function(t){return t}),define("skylark-domx-browser",["skylark-domx-browser/main"],function(t){return t}),define("skylark-langx/main",["./langx"],function(t){return t}),define("skylark-langx",["skylark-langx/main"],function(t){return t}),define("skylark-langx-scripter/scripter",["skylark-langx/skylark","skylark-langx"],function(t,e){var n=document.getElementsByTagName("head")[0],r={},i={},s=0;function o(){return o}var a={type:!0,src:!0,nonce:!0,noModule:!0};return e.mixin(o,{loadJavaScript:function(t,e,o){var a=r[t];if(a||(a=r[t]={state:0,loadedCallbacks:[],errorCallbacks:[]}),a.loadedCallbacks.push(e),a.errorCallbacks.push(o),1===a.state)a.node.onload();else if(-1===a.state)a.node.onerror();else{var l=a.node=document.createElement("script"),c=a.id=s++;l.type="text/javascript",l.async=!1,l.defer=!1,startTime=(new Date).getTime(),n.appendChild(l),l.onload=function(){a.state=1;for(var t=a.loadedCallbacks,e=t.length;e--;)t[e]();a.loadedCallbacks=[],a.errorCallbacks=[]},l.onerror=function(){a.state=-1;for(var t=a.errorCallbacks,e=t.length;e--;)t[e]();a.loadedCallbacks=[],a.errorCallbacks=[]},l.src=t,i[c]=l}return a.id},deleteJavaScript:function(t){var e=i[t];if(e){var n=e.src;e.parentNode&&e.parentNode.remove(e),delete i[t],delete r[n]}},evaluate:function(t,e,n){var r,i,s=(n=n||document).createElement("script");if(s.text=t,e)for(r in a)(i=e[r]||e.getAttribute&&e.getAttribute(r))&&s.setAttribute(r,i);return n.head.appendChild(s).parentNode.removeChild(s),this},loadScript:function(t){var n=new e.Deferred;return n.promise.scriptId=this.loadJavaScript(t,function(){n.resolve()},function(t){n.reject(t)}),n.promise}}),t.attach("langx.scripter",o)}),define("skylark-langx-scripter/main",["./scripter"],function(t){return t}),define("skylark-langx-scripter",["skylark-langx-scripter/main"],function(t){return t}),define("skylark-domx-noder/noder",["skylark-langx-ns","skylark-langx-types","skylark-langx-arrays","skylark-langx-strings","skylark-langx-scripter","skylark-domx-browser"],function(t,e,n,r,i,s){Array.prototype.map,Array.prototype.slice;function o(){return o}return Object.assign(o,{blur:function(t){t.blur()},generateId:function(t){var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,r=0;for(;n--;)r+=e.charCodeAt(n);return r.toString(36)}}),t.attach("domx.noder",o)}),define("skylark-domx-noder/active",["./noder"],function(t){return t.active=function(t){var e;t=t||document;try{e=t.activeElement}catch(n){e=t.body}e||(e=t.body);e.nodeName||(e=t.body);return e}}),define("skylark-domx-noder/_enhance_place_content",["skylark-langx-types","skylark-langx-arrays","./noder"],function(t,e,n){return function(n,r){if(t.isFunction(n))return n.apply(r,[]);if(t.isArrayLike(n)){for(var i,s=0;s<n.length;s++)t.isFunction(n[s])&&(n[s]=n[s].apply(r,[]),t.isArrayLike(n[s])&&(i=!0));i&&(n=e.flatten(n))}return n}}),define("skylark-domx-noder/is-element",["./noder"],function(t){return t.isElement=function(t){return t&&1===t.nodeType}}),define("skylark-domx-noder/is-text-node",["./noder"],function(t){return t.isTextNode=function(t){return t&&3===t.nodeType}}),define("skylark-domx-noder/is-fragment",["./noder"],function(t){return t.isFragment=function(t){return t&&11===t.nodeType}}),define("skylark-domx-noder/_normalize_content",["skylark-langx-types","./noder","./is-element","./is-text-node","./is-fragment"],function(t,e,n,r,i){var s=Array.prototype.map;return function(e){"function"==typeof e&&(e=e());return s.call(t.isArrayLike(e)?e:[e],t=>("function"==typeof t&&(t=t()),n(t)||r(t)||i(t)?t:"string"==typeof t&&/\S/.test(t)?document.createTextNode(t):void 0)).filter(t=>t)}}),define("skylark-domx-noder/_ensure_nodes",["skylark-langx-arrays","./noder","./_normalize_content"],function(t,e,n){var r=Array.prototype.map;return function(e,i){var s=n(e);i&&(s=r.call(s,function(t){return t.cloneNode(!0)}));return t.flatten(s)}}),define("skylark-domx-noder/after",["./noder","./_enhance_place_content","./_ensure_nodes"],function(t,e,n){return t.after=function(t,r,i){r=e(r,t);var s=(a=t).parentNode;if(s)for(var o=n(r,i),a=a.nextSibling,l=0;l<o.length;l++)a?s.insertBefore(o[l],a):s.appendChild(o[l]);return this}}),define("skylark-domx-noder/append",["./noder","./_enhance_place_content","./_ensure_nodes"],function(t,e,n){return t.append=function(t,r,i){r=e(r,t);for(var s=t,o=n(r,i),a=0;a<o.length;a++)s.appendChild(o[a]);return this}}),define("skylark-domx-noder/before",["./noder","./_enhance_place_content","./_ensure_nodes"],function(t,e,n){return t.before=function(t,r,i){r=e(r,t);var s=t,o=s.parentNode;if(o)for(var a=n(r,i),l=0;l<a.length;l++)o.insertBefore(a[l],s);return this}}),define("skylark-domx-noder/body",["./noder"],function(t){return t.body=function(){return document.body}}),define("skylark-domx-noder/clone",["./noder"],function(t){return t.clone=function(t,e){return t.cloneNode(e)}}),define("skylark-domx-noder/is-child-of",["./noder"],function(t){return t.isChildOf=function(t,e,n){if(n)return t.parentNode===e;if(document.documentElement.contains)return e.contains(t);for(;t;){if(e===t)return!0;t=t.parentNode}return!1}}),define("skylark-domx-noder/contains",["./noder","./is-child-of"],function(t,e){return t.contains=function(t,n){return e(n,t)}}),define("skylark-domx-noder/create-element",["skylark-langx-types","./noder"],function(t,e){return e.createElement=function(n,r,i,s){var o;o=/svg/i.test(n)?document.createElementNS("http://www.w3.org/2000/svg",n):document.createElement(n);t.isHtmlNode(r)?(s=r,r=null,i=null):t.isHtmlNode(i)&&(s=i,i=null);if(r)for(var a in r)o[a]=r[a];if(i)for(var a in i)o.setAttribute(a,i[a]);s&&e.append(s,o);return o}}),define("skylark-domx-noder/create-fragment",["skylark-langx-strings","./noder","./create-element"],function(t,e,n){var r=/^\s*<(\w+|!)[^>]*>/,i=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,s=document.createElement("div"),o=document.createElement("table"),a=document.createElement("tbody"),l=document.createElement("tr"),c={tr:a,tbody:o,thead:o,tfoot:o,td:l,th:l,"*":s},u=Array.prototype.slice;return e.createFragment=function(e){if(e=t.trim(e),i.test(e))return[n(RegExp.$1)];var s=r.test(e)&&RegExp.$1;s in c||(s="*");var o=c[s];return o.innerHTML=function(t){for(var e=t.split("/>"),n="",r=0;r<e.length-1;r++){var i=e[r].split("<");n+=e[r]+"></"+i[i.length-1].split(" ")[0]+">"}return n+e[e.length-1]}(""+e),dom=u.call(o.childNodes),dom.forEach(function(t){o.removeChild(t)}),dom}}),define("skylark-domx-noder/create-text-node",["./noder"],function(t){return t.createTextNode=function(t){return document.createTextNode(t)}}),define("skylark-domx-noder/doc",["./noder"],function(t){return t.doc=function(){return document}}),define("skylark-domx-noder/empty",["./noder"],function(t){return t.empty=function(t){for(;t.hasChildNodes();){var e=t.firstChild;t.removeChild(e)}return this}}),define("skylark-domx-noder/focusable",["./noder"],function(t){return t.focusable=function(t,e){var n,r,i,s,o,a=t.nodeName.toLowerCase();if("area"===a)return n=t.parentNode,r=n.name,!(!t.href||!r||"map"!==n.nodeName.toLowerCase())&&((i=$("img[usemap='#"+r+"']")).length>0&&i.is(":visible"));/^(input|select|textarea|button|object)$/.test(a)?(s=!t.disabled)&&(o=$(t).closest("fieldset")[0])&&(s=!o.disabled):s="a"===a&&t.href||e;return s&&$(t).is(":visible")&&visible($(t))}}),define("skylark-domx-noder/from-point",["./noder"],function(t){return t.fromPoint=function(t,e){return document.elementFromPoint(t,e)}}),define("skylark-domx-noder/fullscreen",["skylark-domx-browser","./noder"],function(t,e){return e.fullscreen=function(e){return!1===e?t.exitFullscreen.apply(document):e?e[t.support.fullscreen.requestFullscreen]():document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement}}),define("skylark-domx-noder/html",["skylark-langx-types","skylark-langx-scripter","./noder","./empty"],function(t,e,n,r){var i=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,s=/^$|^module$|\/(?:java|ecma)script/i;return n.html=function(n,o){var a=function(e,n){if(void 0===n)return e.innerHTML;if(r(e),n=n||"",t.isString(n)&&(n=n.replace(i,"<$1></$2>")),t.isString(n)||t.isNumber(n))e.innerHTML=n;else if(t.isArrayLike(n))for(var s=0;s<n.length;s++)e.appendChild(n[s]);else e.appendChild(n);return this}(n,o);if(void 0!==o){for(var l=n.querySelectorAll("script"),c=0;c<l.length;c++){var u=l[c];s.test(u.type||"")&&e.evaluate(u.textContent,u)}return this}return a}}),define("skylark-domx-noder/is-active",["./noder"],function(t){return t.isActive=function(t){return t===document.activeElement&&(t.type||t.href)}}),define("skylark-domx-noder/is-block-node",["./noder"],function(t){var e=["div","p","ul","ol","li","blockquote","hr","pre","h1","h2","h3","h4","h5","table"];return t.isBlockNode=function(t){if(!t||3===t.nodeType)return!1;return new RegExp("^("+e.join("|")+")$").test(t.nodeName.toLowerCase())}}),define("skylark-domx-noder/is-doc",["./noder"],function(t){return t.isDoc=function(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}}),define("skylark-domx-noder/is-editable",["./noder"],function(t){return t.isEditable=function t(e){if(!e)return!1;if("false"===e.contentEditable)return!1;if("true"===e.contentEditable)return!0;return t(e.parentNode)}}),define("skylark-domx-noder/is-fullscreen",["./noder","./fullscreen"],function(t,e){return t.isFullscreen=function(t){return e()===t}}),define("skylark-domx-noder/is-in-document",["./noder"],function(t){return t.isInDocument=function(t){return t===document.body||document.body.contains(t)}}),define("skylark-domx-noder/is-in-frame",["./noder"],function(t){return t.isInFrame=function(){try{return window.parent!==window.self}catch(t){return!0}}}),define("skylark-domx-noder/is-input",["./noder","./is-editable"],function(t,e){return t.isInput=function(t){return"INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName||e(t)}}),define("skylark-domx-noder/is-window",["skylark-langx-types","./noder"],function(t,e){return e.isWindow=t.isWindow}),define("skylark-domx-noder/node-name",["./noder"],function(t){return t.nodeName=function(t,e){var n=t.nodeName&&t.nodeName.toLowerCase();if(void 0!==e)return n===e.toLowerCase();return n}}),define("skylark-domx-noder/offset-parent",["./noder"],function(t){var e=/^(?:body|html)$/i;return t.offsetParent=function(t){var n=t.offsetParent||document.body;for(;n&&!e.test(n.nodeName)&&"static"==document.defaultView.getComputedStyle(n).position;)n=n.offsetParent;return n}}),define("skylark-domx-styler/styler",["skylark-langx/skylark","skylark-langx/langx"],function(t,e){Array.prototype.every;var n=Array.prototype.forEach,r=e.camelCase,i=e.dasherize;function s(t,e){return"number"!=typeof e||o[i(t)]?e:e+"px"}var o={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},a={};function l(t){return t in a?a[t]:a[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function c(t,e){var n=t.className||"",r=n&&void 0!==n.baseVal;if(void 0===e)return r?n.baseVal:n;r?n.baseVal=e:t.className=e}var u={};function h(t,n){if(!n)return this;var r=c(t);return(e.isString(n)?n.split(/\s+/g):n).forEach(function(t){var e=l(t);r.match(e)||(r+=(r?" ":"")+t)}),c(t,r),this}function f(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=window),e.getComputedStyle(t)}function d(t,e){var n=l(e);return t.className&&t.className.match(n)}function p(t,n){if(n){var r=c(t);(e.isString(n)?n.split(/\s+/g):n).forEach(function(t){var e=l(t);r.match(e)&&(r=r.replace(e," "))}),c(t,r.trim())}else c(t,"");return this}var m=function(){return m};return e.mixin(m,{autocssfix:!1,cssHooks:{},addClass:h,className:c,css:function(t,o,a){if(void 0==a){var l=f(t);if(void 0==o)return l;if(e.isString(o))return t.style[r(o)]||l.getPropertyValue(i(o));if(e.isArrayLike(o)){var c={};return n.call(o,function(e){c[e]=t.style[r(e)]||l.getPropertyValue(i(e))}),c}}var u="";if("string"==typeof o)a||0===a?u=i(o)+":"+s(o,a):t.style.removeProperty(i(o));else for(key in o)void 0!==o[key]&&(o[key]||0===o[key]?u+=i(key)+":"+s(key,o[key])+";":t.style.removeProperty(i(key)));return t.style.cssText+=";"+u,this},disabled:function(t,e){if(arguments.length<2)return!!this.dom.disabled;return t.disabled=e,this},hasClass:d,hide:function(t){return m.css(t,"display","none"),this},isInvisible:function(t){return"none"==m.css(t,"display")||0==m.css(t,"opacity")||"hidden"==m.css(t,"visibility")},removeClass:p,show:function(t){m.css(t,"display",""),"none"==m.css(t,"display")&&m.css(t,"display",function(t){var e,n;u[t]||(e=document.createElement(t),document.body.appendChild(e),n=f(e).getPropertyValue("display"),e.parentNode.removeChild(e),"none"==n&&(n="block"),u[t]=n);return u[t]}(t.nodeName));return this},toggleClass:function(t,e,n){return e.split(/\s+/g).forEach(function(e){void 0===n&&(n=!d(t,e)),n?h(t,e):p(t,e)}),this}}),t.attach("domx.styler",m)}),define("skylark-domx-styler/main",["./styler"],function(t,e,n){return t}),define("skylark-domx-styler",["skylark-domx-styler/main"],function(t){return t}),define("skylark-domx-noder/overlay",["skylark-domx-styler","./noder"],function(t,e){return e.overlay=function(n,r){var i=e.createElement("div",r);return t.css(i,{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:2147483647,opacity:.7}),n.appendChild(i),i}}),define("skylark-domx-noder/owner-doc",["./noder"],function(t){return t.ownerDoc=function(t){if(!t)return document;if(9==t.nodeType)return t;return t.ownerDocument}}),define("skylark-domx-noder/owner-window",["./noder","./owner-doc"],function(t,e){return t.ownerWindow=function(t){var n=e(t);return n.defaultView||n.parentWindow}}),define("skylark-domx-noder/picture-in-picture",["skylark-domx-browser","./noder"],function(t,e){return e.pictureInPicture=function(t){if(!1===t)return document.exitPictureInPicture();if(!t)return document.pictureInPictureElement;t!==document.pictureInPictureElement&&(t.requestPictureInPicture(),t)}}),define("skylark-domx-noder/prepend",["./noder","./_enhance_place_content","./_ensure_nodes"],function(t,e,n){return t.prepend=function(t,e,r){for(var i=t,s=i.firstChild,o=n(e,r),a=0;a<o.length;a++)s?i.insertBefore(o[a],s):i.appendChild(o[a]);return this}}),define("skylark-domx-noder/reflow",["./noder"],function(t){return t.reflow=function(t){t||(t=document);return t.offsetHeight,this}}),define("skylark-domx-noder/remove-child",["skylark-langx-types","./noder"],function(t,e){return e.removeChild=function(e,n){t.isArrayLike(n)||(n=[n]);for(var r=0;r<n.length;r++)e.removeChild(n[r]);return this}}),define("skylark-domx-noder/remove",["./noder"],function(t){return t.remove=function(t){if(t&&t.parentNode)try{t.parentNode.removeChild(t)}catch(t){console.warn("The node is already removed",t)}return this}}),define("skylark-domx-noder/replace",["./noder"],function(t){return t.replace=function(t,e){return e.parentNode.replaceChild(t,e),this}}),define("skylark-domx-noder/reverse",["./noder"],function(t){return t.reverse=function(t){for(var e=t.firstChild,n=t.children.length-1;n>0;n--)if(n>0){var r=t.children[n];t.insertBefore(r,e)}}}),define("skylark-domx-noder/root",["./noder"],function(t){return t.root=function(){return document.documentElement}}),define("skylark-domx-noder/scrolling-element",["./noder"],function(t){return t.scrollingElement=function(){return document.scrollingElement||document.documentElement}}),define("skylark-domx-noder/selectable",["./noder"],function(t){return t.selectable=function(t,e){if(void 0===t||void 0===t.style)return;t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off"}}),define("skylark-domx-noder/throb",["skylark-langx/langx","skylark-domx-styler","./noder"],function(t,e,n){return n.throb=function(t,r){(r=r||{}).text,r.style;var i,s=r.time,o=r.callback,a=n.createElement("div",{className:r.className||"throbber"}),l=function(){i&&(clearTimeout(i),i=null),a&&(n.remove(a),a=null)};r.style&&e.css(a,r.style);var c=r.content||'<span class="throb"></span>';n.html(a,c),t.appendChild(a),s&&(i=setTimeout(function(){l(),o&&o()},s));return{throbber:a,remove:l,update:function(t){t&&t.text&&a&&(textNode.nodeValue=t.text)}}}}),define("skylark-domx-noder/traverse",["./noder"],function(t){return t.traverse=function t(e,n){n(e);for(var r=0,i=e.childNodes.length;r<i;r++)t(e.childNodes[r],n);return this}}),define("skylark-domx-noder/unwrap",["./noder","./is-doc"],function(t,e){return t.unwrap=function(t){var n=t.parentNode;if(n){if(e(n.parentNode))return;n.parentNode.insertBefore(t,n)}}}),define("skylark-domx-noder/wrapper-inner",["./noder"],function(t){var e=Array.prototype.slice;return t.wrapperInner=function(t,n){var r=e.call(t.childNodes);t.appendChild(n);for(var i=0;i<r.length;i++)n.appendChild(r[i]);return this}}),define("skylark-domx-noder/wrapper",["./noder"],function(t){return t.wrapper=function(t,e){types.isString(e)&&(e=this.createFragment(e).firstChild);t.parentNode.insertBefore(e,t),e.appendChild(t)}}),define("skylark-domx-noder/main",["./noder","./active","./after","./append","./before","./body","./clone","./contains","./create-element","./create-fragment","./create-text-node","./doc","./empty","./focusable","./from-point","./fullscreen","./html","./is-active","./is-block-node","./is-child-of","./is-doc","./is-editable","./is-element","./is-fragment","./is-fullscreen","./is-in-document","./is-in-frame","./is-input","./is-text-node","./is-window","./node-name","./offset-parent","./overlay","./owner-doc","./owner-window","./picture-in-picture","./prepend","./reflow","./remove-child","./remove","./replace","./reverse","./root","./scrolling-element","./selectable","./throb","./traverse","./unwrap","./wrapper-inner","./wrapper","./throb"],function(t){return t}),define("skylark-domx-noder",["skylark-domx-noder/main"],function(t){return t}),define("skylark-domx-finder/finder",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-styler"],function(t,e,n,r,s){var o={},a=Array.prototype.filter,l=Array.prototype.slice,c=n.matchesSelector;(function(){var t,e,n,r,i,s={},o={},a=/\\/g,l=function(n,i){if(null==n)return null;if(!0===n.Slick)return n;n=(""+n).replace(/^\s+|\s+$/g,"");var a=(r=!!i)?o:s;if(a[n])return a[n];for(t={Slick:!0,expressions:[],raw:n,reverse:function(){return l(this.raw,!0)}},e=-1;n!=(n=n.replace(f,d)););return t.length=t.expressions.length,a[t.raw]=r?u(t):t},c=function(t){return"!"===t?" ":" "===t?"!":/^!/.test(t)?t.replace(/^!/,""):"!"+t},u=function(t){for(var e=t.expressions,n=0;n<e.length;n++){for(var r=e[n],i={parts:[],tag:"*",combinator:c(r[0].combinator)},s=0;s<r.length;s++){var o=r[s];o.reverseCombinator||(o.reverseCombinator=" "),o.combinator=o.reverseCombinator,delete o.reverseCombinator}r.reverse().push(i)}return t},h=(i=/(?=[\-\[\]{}()*+?.\\\^$|,#\s])/g,function(t){return t.replace(i,"\\")}),f=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+h(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])"));function d(i,s,o,l,u,f,d,p,m,y,g,w,k,x,v,_){if((s||-1===e)&&(t.expressions[++e]=[],n=-1,s))return"";if(o||l||-1===n){o=o||" ";var b=t.expressions[e];r&&b[n]&&(b[n].reverseCombinator=c(o)),b[++n]={combinator:o,tag:"*"}}var E=t.expressions[e][n];if(u)E.tag=u.replace(a,"");else if(f)E.id=f.replace(a,"");else if(d)d=d.replace(a,""),E.classList||(E.classList=[]),E.classes||(E.classes=[]),E.classList.push(d),E.classes.push({value:d,regexp:new RegExp("(^|\\s)"+h(d)+"(\\s|$)")});else if(k)_=(_=_||v)?_.replace(a,""):null,E.pseudos||(E.pseudos=[]),E.pseudos.push({key:k.replace(a,""),value:_,type:1==w.length?"class":"element"});else if(p){var S,T;switch(p=p.replace(a,""),g=(g||"").replace(a,""),m){case"^=":T=new RegExp("^"+h(g));break;case"$=":T=new RegExp(h(g)+"$");break;case"~=":T=new RegExp("(^|\\s)"+h(g)+"(\\s|$)");break;case"|=":T=new RegExp("^"+h(g)+"(-|$)");break;case"=":S=function(t){return g==t};break;case"*=":S=function(t){return t&&t.indexOf(g)>-1};break;case"!=":S=function(t){return g!=t};break;default:S=function(t){return!!t}}""==g&&/^[*$^]=$/.test(m)&&(S=function(){return!1}),S||(S=function(t){return t&&T.test(t)}),E.attributes||(E.attributes=[]),E.attributes.push({key:p,operator:m,value:g,test:S})}return""}var p=this.Slick||{};p.parse=function(t){return l(t)},p.escapeRegExp=h,this.Slick||(this.Slick=p)}).apply(o);var u=/^(?:input|select|textarea|button)$/i,h=/^h\d$/i,l=Array.prototype.slice;o.parseSelector=o.Slick.parse;var f=o.pseudos={button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},checked:function(t){return!!t.checked},contains:function(t,e,n,r){if($(this).text().indexOf(r)>-1)return this},disabled:function(t){return!!t.disabled},enabled:function(t){return!t.disabled},eq:function(t,e,n,r){return e==r},even:function(t,e,n,r){return e%2==0},focus:function(t){return document.activeElement===t&&(t.href||t.type||t.tabindex)},focusable:function(t){return r.focusable(t,null!=t.tabindex)},first:function(t,e){return 0===e},gt:function(t,e,n,r){return e>r},has:function(t,e,n,r){return x(t,r)},header:function(t){return h.test(t.nodeName)},hidden:function(t){return!o.pseudos.visible(t)},input:function(t){return u.test(t.nodeName)},last:function(t,e,n){return e===n.length-1},lt:function(t,e,n,r){return e<r},not:function(t,e,n,r){return!b(t,r)},odd:function(t,e,n,r){return e%2==1},parent:function(t){return!!t.parentElement},selected:function(t){return!!t.selected},tabbable:function(t){var e=t.tabindex,n=null!=e;return(!n||e>=0)&&r.focusable(element,n)},text:function(t){return"text"===t.type},visible:function(t){return t.offsetWidth&&t.offsetWidth},empty:function(t){return!t.hasChildNodes()}};function d(t){return function(e){var n=e.nodeName.toLowerCase();return"input"===n&&e.type===t}}function p(t){return function(e){var n=e.nodeName.toLowerCase();return("input"===n||"button"===n)&&e.type===t}}for(i in["first","eq","last"].forEach(function(t){f[t].isArrayFilter=!0}),f.nth=f.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})f[i]=d(i);for(i in{submit:!0,reset:!0})f[i]=p(i);function m(t,n,r){for(var i=[],s=r&&e.isString(r);(t=t.parentElement)&&9!==t.nodeType;){if(r)if(s){if(b(t,r))break}else if(e.isArrayLike(r)){if(e.inArray(t,r)>-1)break}else if(t==r)break;n&&!b(t,n)||i.push(t)}return i}function y(t,e){for(var n=t.childNodes,r=[],i=0;i<n.length;i++){var t=n[i];1==t.nodeType&&r.push(t)}return e&&(r=o.filter(r,e)),r}function g(t,e,n,r){if(t){n=n||document;do{if(null!=e&&(">"===e[0]?t.parentElement===n&&b(t,e):b(t,e))||r&&t===n)return t;if(t===n)break}while(t=T(t))}return null}function w(t,e){try{return l.call(t.querySelectorAll(e))}catch(t){}return o.query(t,e)}function k(t,e){try{return t.querySelector(e)}catch(t){}var n=o.query(t,e);return n.length>0?n[0]:null}function x(t,e){return e||(e=t,t=document.body),b(t,e)?t:k(t,e)}function v(t,e,n){for(var r=t.childNodes,i=r[0];i;){if(1==i.nodeType){if(!e||b(i,e))return i;if(n)break}i=i.nextSibling}return null}function _(t,e,n){for(var r=t.childNodes,i=r[r.length-1];i;){if(1==i.nodeType){if(!e||b(i,e))return i;if(n)break}i=i.previousSibling}return null}function b(t,n){if(!n||!t||1!==t.nodeType)return!1;if(e.isString(n)){try{return c.call(t,n.replace(/\[([^=]+)=\s*([^'"\]]+?)\s*\]/g,'[$1="$2"]'))}catch(t){}return o.match(t,n)}return e.isArrayLike(n)?e.inArray(t,n)>-1:e.isPlainObject(n)?o.check(t,n):t===n}function E(t,e,n){for(var r=t.nextSibling;r;){if(1==r.nodeType){if(!e||b(r,e))return r;if(n)break}r=r.nextSibling}return null}function S(t,e){for(var n=t.nextSibling,r=[];n;)1==n.nodeType&&(e&&!b(n,e)||r.push(n)),n=n.nextSibling;return r}function T(t,e){var n=t.host&&t!==document&&t.host.nodeType?t.host:t.parentElement;return!n||e&&!b(n,e)?null:n}function I(t,e,n){for(var r=t.previousSibling;r;){if(1==r.nodeType){if(!e||b(r,e))return r;if(n)break}r=r.previousSibling}return null}function F(t,e){for(var n=t.previousSibling,r=[];n;)1==n.nodeType&&(e&&!b(n,e)||r.push(n)),n=n.previousSibling;return r}function A(t,e){for(var n=t.parentElement.firstChild,r=[];n;)1==n.nodeType&&n!==t&&(e&&!b(n,e)||r.push(n)),n=n.nextSibling;return r}o.divide=function(t){var e,n,r,i,s,o="",a=[];if((n=t.id)&&(o+="#"+n),r=t.classes)for(var l=r.length;l--;)o+="."+r[l].value;if(i=t.attributes)for(var l=0;l<i.length;l++)i[l].operator?o+="["+i[l].key+i[l].operator+JSON.stringify(i[l].value)+"]":o+="["+i[l].key+"]";if(s=t.pseudos)for(l=s.length;l--;)part=s[l],this.pseudos[part.key]?a.push(part):void 0!==part.value&&(o+=":"+part.key+"("+JSON.stringify(part));return(e=t.tag)&&"*"!==e&&(o=e.toUpperCase()+o),o||(o="*"),{nativeSelector:o,customPseudos:a}},o.check=function(t,e,n,r,i){var s,o,a,l,u,h,f,d,p;if(!i){if(s=e.tag){var m=t.nodeName.toUpperCase();if("*"==s){if(m<"@")return!1}else if(m!=(s||"").toUpperCase())return!1}if((o=e.id)&&t.getAttribute("id")!=o)return!1;if(a=e.classes)for(h=a.length;h--;)if(!(d=t.getAttribute("class"))||!a[h].regexp.test(d))return!1;if(l=e.attributes)for(h=l.length;h--;)if((f=l[h]).operator?!f.test(t.getAttribute(f.key)):!t.hasAttribute(f.key))return!1}if(u=e.pseudos)for(h=u.length;h--;)if(f=u[h],p=this.pseudos[f.key]){if((i&&p.isArrayFilter||!i&&!p.isArrayFilter)&&!p(t,n,r,f.value))return!1}else if(!i&&!c.call(t,f.key))return!1;return!0},o.match=function(t,n){var r;if(!(r=e.isString(n)?o.Slick.parse(n):n))return!0;var i,s,a=r.expressions,l=0;for(i=0;s=a[i];i++)if(1==s.length){var c=s[0];if(this.check(t,c))return!0;l++}if(l==r.length)return!1;var u,h=this.query(document,r);for(i=0;u=h[i++];)if(u===t)return!0;return!1},o.filterSingle=function(t,e){var n=a.call(t,function(n,r){return o.check(n,e,r,t,!1)});return n=a.call(n,function(t,r){return o.check(t,e,r,n,!0)})},o.filter=function(t,n){if(!e.isString(n))return o.filterSingle(t,n);var r,i,s=o.Slick.parse(n).expressions,a=[];for(r=0;i=s[r];r++){if(1!=i.length)throw new Error("not supported selector:"+n);var l=i[0],c=o.filterSingle(t,l);a=e.uniq(a.concat(c))}return a},o.combine=function(t,e){var n,r=e.combinator,i=e,s=[];switch(r){case">":s=y(t,i);break;case"+":(n=E(t,i,!0))&&s.push(n);break;case"^":(n=v(t,i,!0))&&s.push(n);break;case"~":s=S(t,i);break;case"++":var c=I(t,i,!0),u=E(t,i,!0);c&&s.push(c),u&&s.push(u);break;case"~~":s=A(t,i);break;case"!":s=m(t,i);break;case"!>":(n=T(t,i))&&s.push(n);break;case"!+":s=I(t,i,!0);break;case"!^":(n=_(t,i,!0))&&s.push(n);break;case"!~":s=F(t,i);break;default:var h=this.divide(e);if(s=l.call(t.querySelectorAll(h.nativeSelector)),h.customPseudos)for(var f=h.customPseudos.length-1;f>=0;f--)s=a.call(s,function(t,e){return o.check(t,{pseudos:[h.customPseudos[f]]},e,s,!1)}),s=a.call(s,function(t,e){return o.check(t,{pseudos:[h.customPseudos[f]]},e,s,!0)})}return s},o.query=function(t,n,r){for(var i,s,a=this.Slick.parse(n),l=[],c=a.expressions,u=0;i=c[u];u++){for(var h,f=[t],d=0;s=i[d];d++)(h=e.map(f,function(t,e){return o.combine(t,s)}))&&(f=h);h&&(l=l.concat(h))}return l};var C=function(){return C};return e.mixin(C,{ancestor:function(t,n,r){var i=r&&e.isString(r);for(;t=t.parentElement;){if(b(t,n))return t;if(r)if(i){if(b(t,r))break}else if(t==r)break}return null},ancestors:m,byId:function(t,e){return(e=e||r.doc()).getElementById(t)},childAt:function(t,n,r){var i=0,o=t.children;r=e.mixin({ignoreHidden:!0,excluding:null,closesting:null},r);for(var a=0;a<o.length;a++){var l=o[a];if((!r.ignoreHidden||"none"!==s.css(l))&&((!r.excluding||!r.excluding.includes(l))&&(!r.closesting||g(l,r.closesting,t,!1)))){if(i===n)return l;i++}}return null},children:y,closest:g,descendant:k,descendants:w,find:x,findAll:function(t,e){e||(e=t,t=document.body);return w(t,e)},firstChild:v,index:function(t,n){var r=0;if(!t||!t.parentNode)return-1;for(;t&&(t=t.previousElementSibling);)e.isString(n)?b(t,n)&&r++:e.isFunction(n)&&n(t)&&r++,r++;return r},lastChild:_,matches:b,nextSibling:E,nextSiblings:S,parent:T,previousSibling:I,previousSiblings:F,pseudos:o.pseudos,scrollableParent:function(t,e){if(!t||!t.getBoundingClientRect)return r.scrollingElement();var n=t,i=!1;do{if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var o=s.css(n);if(n.clientWidth<n.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||n.clientHeight<n.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!n||!n.getBoundingClientRect||n===document.body)return r.scrollingElement();if(i||e)return n;i=!0}}}while(n=n.parentNode);return r.scrollingElement()},siblings:A}),t.attach("domx.finder",C)}),define("skylark-domx-finder/main",["./finder"],function(t){return t}),define("skylark-domx-finder",["skylark-domx-finder/main"],function(t){return t}),define("skylark-domx-data/data",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-finder","skylark-domx-noder"],function(t,e,n,r){var i=Array.prototype.map,s=(Array.prototype.filter,e.camelCase),o=e.deserializeValue,a=/([A-Z])/g,l={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"};var c={option:{get:function(t){var e=t.getAttribute("value");return null!=e?e:(m(t).match(/[^\x20\t\r\n\f]+/g)||[]).join(" ")}},select:{get:function(t){var e,n,i,s=t.options,o=t.selectedIndex,a="select-one"===t.type,l=a?null:[],c=a?o+1:s.length;for(i=o<0?c:a?o:0;i<c;i++)if((n=s[i]).selected&&!n.disabled&&(!n.parentNode.disabled||!r.nodeName(n.parentNode,"optgroup"))){if(e=y(n),a)return e;l.push(e)}return l},set:function(t,n){for(var r,i,s=t.options,o=e.makeArray(n),a=s.length;a--;)((i=s[a]).selected=e.inArray(c.option.get(i),o)>-1)&&(r=!0);return r||(t.selectedIndex=-1),o}}};function u(t,e,n){if(void 0===n){if("object"==typeof e){for(var r in e)u(t,r,e[r]);return this}return t.getAttribute?t.getAttribute(e):t[e]}return t.setAttribute?t.setAttribute(e,n):t[e]=n,this}function h(t,n){var r=t._$_store;return!r&&n&&(r=t._$_store=function(t){var n={};return e.each(t.attributes||[],function(t,e){0==e.name.indexOf("data-")&&(n[s(e.name.replace("data-",""))]=o(e.value))}),n}(t)),r}function f(t,e,n){var r=h(t,!0);r[s(e)]=n}function d(t,n,r){if(void 0===r){if("object"==typeof n){for(var i in n)f(t,i,n[i]);return this}return function(t,n){if(void 0===n)return h(t,!0);var r=h(t);if(r){if(n in r)return r[n];var i=s(n);if(i in r)return r[i]}var o="data-"+n.replace(a,"-$1").toLowerCase(),l=u(t,o);return e.isString(l)||(l=void 0),l}(t,n)}return f(t,n,r),this}function p(t){t._$_store&&delete t._$_store}function m(t,e){return void 0===e?void 0!==t.textContent?t.textContent:t.innerText:(e=null==e?"":""+e,void 0!==t.textContent?t.textContent=e:t.innerText=e,this)}function y(t,n){var r=c[t.type]||c[t.nodeName.toLowerCase()];if(void 0===n)return r&&"get"in r&&void 0!==(ret=r.get(t,"value"))?ret:(ret=t.value,"string"==typeof ret?ret.replace(/\r/g,""):null==ret?"":ret);null==n?n="":"number"==typeof n?n+="":e.isArray(n)&&(n=e.map(n,function(t){return null==t?"":t+""})),r&&"set"in r&&void 0!==r.set(t,n,"value")||(t.value=n)}function g(){return g}return e.each(["radio","checkbox"],function(){c[this]={set:function(t,n){if(e.isArray(n))return t.checked=e.inArray(y(t),n)>-1}}}),n.pseudos.data=function(t,e,n,r){return!!d(t,r||n[3])},e.mixin(g,{aria:function(t,e,n){return this.attr(t,"aria-"+e,n)},attr:u,cleanData:p,data:d,pluck:function(t,e){return i.call(t,function(t){return t[e]})},prop:function t(e,n,r){if(void 0===r&&"object"==typeof n){for(var i in n)t(e,i,n[i]);return this}n=l[n]||n;return void 0===r?e[n]:(e[n]=r,this)},removeAttr:function(t,e){return e.split(" ").forEach(function(e){!function(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}(t,e)}),this},removeData:function(t,n){if(n){e.isString(n)&&(n=n.split(/\s+/));var r=h(t,!0);n.forEach(function(t){delete r[t]})}else p(t);return this},removeProp:function(t,e){return e.split(" ").forEach(function(e){delete t[e]}),this},text:m,val:y,valHooks:c}),t.attach("domx.data",g)}),define("skylark-domx-query/query",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-noder","skylark-domx-finder"],function(t,e,n,r){var i,s=Array.prototype.some,o=Array.prototype.push,a=(Array.prototype.every,Array.prototype.concat,Array.prototype.slice),l=(Array.prototype.map,Array.prototype.filter),c=Array.prototype.forEach,u=Array.prototype.indexOf,h=Array.prototype.sort,f=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,d=e.funcArg,p=e.isArrayLike,m=e.isString,y=e.uniq,g=e.isFunction,w=e.type,k=(e.isArray,e.isWindow,e.isDocument,e.isObject);e.isPlainObject,e.compact,e.flatten,e.camelCase,e.dasherize,r.children;function x(t,r,i){return function(i){var s,o=e.map(arguments,function(t){return"function"==(s=w(t))||"object"==s||"array"==s||null==t?t:n.createFragment(t)});return o.length<1?this:(this.each(function(e){t.apply(r,[this,o,e>0])}),this)}}function v(t,n,r){return function(){var i=a.call(arguments),s=e.map(this,function(e,r){return t.apply(n,[e].concat(i))});return r?s:F(y(s))}}function _(t,e,n){return function(r){a.call(arguments);var i=this.map(function(i,s){return s.querySelector?t.apply(e,n?[s]:[s,r]):[]});return n&&r?i.filter(r):i}}function b(t,e,n){return function(r,i){a.call(arguments);var s=this.map(function(s,o){return t.apply(e,n?[o,r]:[o,i,r])});return n&&i?s.filter(i):s}}function E(t,e){return function(){var n=a.call(arguments);return this.each(function(r,i){t.apply(e,[this].concat(n))}),this}}function S(t,n,r){return function(i){return e.isDefined(i)?(c.call(this,function(e,s){var o;o=r?d(e,i,s,r(e)):i,t.apply(n,[e,o])}),this):this[0]?t.apply(n,[this[0]]):void 0}}var T,I=e.klass({klassName:"SkNodeList",init:function(t,i){var s,a,l,c;if(t&&(this.context=i=i||n.doc(),m(t)?(this.selector=t,(s="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&t.length>=3?[null,t,null]:f.exec(t))?s[1]?(a=n.createFragment(t),e.isPlainObject(i)&&(c=i)):(l=r.byId(s[2],n.ownerDoc(i)))&&(a=[l]):(e.isString(i)&&(i=r.find(i)),a=r.descendants(i,t))):a=!n.isWindow(t)&&p(t)?t:[t]),a&&(o.apply(this,a),c))for(var u in c)e.isFunction(this[u])?this[u](c[u]):this.attr(u,c[u]);return this}}),F=function(){i=function(t){return t instanceof I},init=function(t,e){return new I(t,e)};var t=function(e,n){return g(e)?(t.ready(function(){e(t)}),f):i(e)?e:n&&i(n)&&m(e)?n.find(e):init(e,n)},f=t(document);t.fn=I.prototype,e.mixin(t.fn,{length:0,map:function(n){return t(y(e.map(this,function(t,e){return n.call(t,e,t)})))},slice:function(){return t(a.apply(this,arguments))},forEach:function(){return c.apply(this,arguments)},get:function(t){return void 0===t?a.call(this):this[t>=0?t:t+this.length]},indexOf:function(){return u.apply(this,arguments)},sort:function(){return h.apply(this,arguments)},toArray:function(){return a.call(this)},size:function(){return this.length},remove:function(t){return t?this.find(t).remove():(this.each(function(t,e){n.remove(e)}),this)},each:function(t){return e.each(this,t),this},filter:function(e){return g(e)?this.not(this.not(e)):t(l.call(this,function(t){return r.matches(t,e)}))},add:function(e,n){return t(y(this.toArray().concat(t(e,n).toArray())))},is:function(t){if(this.length>0){if(e.isString(t))return s.call(this,function(e){return r.matches(e,t)});if(e.isArrayLike(t))return s.call(this,function(n){return e.inArray(n,t)>-1});if(e.isHtmlNode(t))return s.call(this,function(e){return e==t})}return!1},not:function(e){var n=[];if(g(e)&&void 0!==e.call)this.each(function(t,r){e.call(this,t,r)||n.push(this)});else{var r="string"==typeof e?this.filter(e):p(e)&&g(e.item)?a.call(e):t(e);this.forEach(function(t){r.indexOf(t)<0&&n.push(t)})}return t(n)},has:function(e){return this.filter(function(){return k(e)?n.contains(this,e):t(this).find(e).size()})},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:_(r.descendants,r),closest:_(r.closest,r),parents:_(r.ancestors,r),parentsUntil:b(r.ancestors,r),parent:_(r.parent,r),children:_(r.children,r),contents:v(n.contents,n),empty:E(n.empty,n),html:S(n.html,n),pluck:function(t){return e.map(this,function(e){return e[t]})},pushStack:function(e){var n=t(e);return n.prevObject=this,n},replaceWith:function(t){return this.before(t).remove()},wrap:function(e){var n="function"==typeof e;return this.each(function(r){t(this).wrapAll(n?e.call(this,r):e)})},wrapAll:function(e){var n;return this[0]&&("function"==typeof e&&(e=e.call(this[0])),n=t(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&n.insertBefore(this[0]),n.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this},wrapInner:function(e){return"function"==typeof e?this.each(function(n){t(this).wrapInner(e.call(this,n))}):this.each(function(){var n=t(this),r=n.contents();r.length?r.wrapAll(e):n.append(e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){t(this).replaceWith(this.childNodes)}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},toggle:function(e){return this.each(function(){var n=t(this);(void 0===e?"none"==n.css("display"):e)?n.show():n.hide()})},prev:function(e){return t(this.pluck("previousElementSibling")).filter(e||"*")},prevAll:_(r.previousSiblings,r),next:function(e){return t(this.pluck("nextElementSibling")).filter(e||"*")},nextAll:_(r.nextSiblings,r),siblings:_(r.siblings,r),index:function(e){return e?this.indexOf(t(e)[0]):this.parent().children().indexOf(this[0])}}),t.fn.detach=t.fn.remove,t.fn.hover=function(t,e){return this.mouseenter(t).mouseleave(e||t)};n.traverse;return t.fn.after=x(n.after,n),t.fn.prepend=x(n.prepend,n),t.fn.before=x(n.before,n),t.fn.append=x(n.append,n),e.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,n){t.fn[e]=function(e){for(var r,i=[],s=t(e),a=s.length-1,l=0;l<=a;l++)r=l===a?this:this.clone(!0),t(s[l])[n](r),o.apply(i,r.get());return this.pushStack(i)}}),t}();return(T=F).fn.scrollParent=function(t){var e=this.css("position"),n="absolute"===e,r=t?/(auto|scroll|hidden)/:/(auto|scroll)/,i=this.parents().filter(function(){var t=T(this);return(!n||"static"!==t.css("position"))&&r.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==e&&i.length?i:T(this[0].ownerDocument||document)},function(t){t.fn.end=function(){return this.prevObject||t()},t.fn.andSelf=function(){return this.add(this.prevObject||t())},t.fn.addBack=function(t){return this.prevObject?t?this.add(this.prevObject.filter(t)):this.add(this.prevObject):this},"filter,add,not,eq,first,last,find,closest,parents,parent,children,siblings,prev,prevAll,next,nextAll".split(",").forEach(function(e){var n=t.fn[e];t.fn[e]=function(){var t=n.apply(this,arguments);return t.prevObject=this,t}})}(F),function(t){var s;t.fn.query=t.fn.find,t.fn.place=function(t,s){return e.isString(t)?t=r.descendant(t):i(t)&&(t=t[0]),this.each(function(e,r){switch(s){case"before":n.before(t,r);break;case"after":n.after(t,r);break;case"replace":n.replace(t,r);break;case"only":n.empty(t),n.append(t,r);break;case"first":n.prepend(t,r);break;default:n.append(t,r)}})},t.fn.addContent=function(t,n){return t.template&&(t=e.substitute(t.template,t)),this.append(t)},t.fn.disableSelection=(s="onselectstart"in document.createElement("div")?"selectstart":"mousedown",function(){return this.on(s+".ui-disableSelection",function(t){t.preventDefault()})}),t.fn.enableSelection=function(){return this.off(".ui-disableSelection")},t.fn.reflow=function(){return n.reflow(this[0])},t.fn.isBlockNode=function(){return n.isBlockNode(this[0])}}(F),F.fn.plugin=function(t,e){var n=a.call(arguments,1),r=this,i=this;return this.each(function(){i=plugins.instantiate.apply(r,[this,t].concat(n))}),i},F.wraps={wrapper_node_operation:x,wrapper_map:v,wrapper_value:S,wrapper_selector:_,wrapper_some_chk:function(t,e){return function(){var n=a.call(arguments);return s.call(this,function(r){return t.apply(e,[r].concat(n))})}},wrapper_selector_until:b,wrapper_every_act_firstArgFunc:function(t,e,n){return function(r){var i=a.call(arguments);return c.call(this,function(s,o){var a=d(s,r,o,n(s));t.apply(e,[s,a].concat(i.slice(1)))}),this}},wrapper_every_act:E,wrapper_name_value:function(t,n,r){return function(i,s){return e.isPlainObject(i)||e.isDefined(s)?(c.call(this,function(e,o){var a;a=r?d(e,s,o,r(e,i)):s,t.apply(n,[e,i,a])}),this):this[0]?t.apply(n,[this[0],i]):void 0}}},t.attach("domx.query",F)}),define("skylark-domx-query/main",["./query","skylark-domx-styler"],function(t,e){return t.fn.disabled=t.wraps.wrapper_name_value(e.disabled,e),t.fn.style=t.wraps.wrapper_name_value(e.css,e),t.fn.css=t.wraps.wrapper_name_value(e.css,e),t.fn.hasClass=t.wraps.wrapper_some_chk(e.hasClass,e),t.fn.addClass=t.wraps.wrapper_every_act_firstArgFunc(e.addClass,e,e.className),t.fn.removeClass=t.wraps.wrapper_every_act_firstArgFunc(e.removeClass,e,e.className),t.fn.toggleClass=t.wraps.wrapper_every_act_firstArgFunc(e.toggleClass,e,e.className),t.fn.replaceClass=function(t,e){return this.removeClass(e),this.addClass(t),this},t.fn.replaceClass=function(t,e){return this.removeClass(e),this.addClass(t),this},t}),define("skylark-domx-query",["skylark-domx-query/main"],function(t){return t}),define("skylark-domx-velm/velm",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-noder","skylark-domx-finder","skylark-domx-query"],function(t,e,n,r,i){var s=Array.prototype.map,o=Array.prototype.slice,a=e.klass({klassName:"VisualElement",_construct:function(t){e.isString(t)&&(t="<"===(t=e.trim(t)).charAt(0)?n.createFragment(t)[0]:document.getElementById(t)),this._elm=t}});a.prototype.$=a.prototype.query=function(t){return i(t,this._elm)},a.prototype.elm=function(){return this._elm};var l=new a(document.body),c=function(t){return t?t instanceof a?t:new a(t):l};return e.mixin(c,{batch:function(t,e,n){return t.forEach(function(t){var r=t instanceof a?t:c(t);r[e].apply(r,n)}),this},root:new a(document.body),VisualElement:a,partial:function(t,e){var n={};n[t]=e,a.partial(n)},delegate:function(t,n,r){var i={};t.forEach(function(t){var l=t;r&&r[t]&&(l=r[t]),i[t]=function(t,n){return function(){var r=this._elm,i=t.apply(n,[r].concat(o.call(arguments)));if(i){if(i===n)return this;i instanceof HTMLElement?i=new a(i):e.isArrayLike(i)&&(i=s.call(i,function(t){return t instanceof HTMLElement?new a(t):t}))}return i}}(n[l],n)}),a.partial(i)}}),c.delegate(["ancestor","ancestors","children","descendant","find","findAll","firstChild","lastChild","matches","nextSibling","nextSiblings","parent","previousSibling","previousSiblings","siblings"],r),c.find=function(t){return"body"===t?this.root:this.root.descendant(t)},c.delegate(["after","append","before","clone","contains","contents","empty","fullscreen","html","isChildOf","isDocument","isInDocument","isWindow","ownerDoc","prepend","remove","removeChild","replace","reverse","throb","traverse","wrapper","wrapperInner","unwrap"],n),t.attach("domx.velm",c)}),define("skylark-domx-velm/main",["./velm","skylark-domx-styler"],function(t,e){t.delegate(["addClass","className","css","disabled","hasClass","hide","isInvisible","removeClass","show","toggleClass"],e);return["position","left","top","right","bottom","width","height","border","borderLeft","borderTop","borderRight","borderBottom","borderColor","display","overflow","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","background","backgroundColor","opacity","fontSize","fontWeight","textAlign","textDecoration","textTransform","cursor","zIndex"].forEach(function(e){var n=e;t.VisualElement.prototype[n]=function(t){return this.css(e,t),this}}),t}),define("skylark-domx-velm",["skylark-domx-velm/main"],function(t){return t}),define("skylark-domx-data/main",["./data","skylark-domx-velm","skylark-domx-query"],function(t,e,n){return e.delegate(["attr","data","prop","removeAttr","removeData","text","val"],t),n.fn.text=n.wraps.wrapper_value(t.text,t,t.text),n.fn.attr=n.wraps.wrapper_name_value(t.attr,t,t.attr),n.fn.removeAttr=n.wraps.wrapper_every_act(t.removeAttr,t),n.fn.prop=n.wraps.wrapper_name_value(t.prop,t,t.prop),n.fn.removeProp=n.wraps.wrapper_every_act(t.removeProp,t),n.fn.data=n.wraps.wrapper_name_value(t.data,t),n.fn.removeData=n.wraps.wrapper_every_act(t.removeData),n.fn.val=n.wraps.wrapper_value(t.val,t,t.val),t}),define("skylark-domx-data",["skylark-domx-data/main"],function(t){return t}),define("skylark-domx-eventer/eventer",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-finder","skylark-domx-noder","skylark-domx-data"],function(t,e,n,r,i,s){e.mixin;var o=e.each,a=(Array.prototype.slice,e.uid),l=/^([A-Z]|returnValue$|layer[XY]$)/,c={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"},u=/complete|loaded|interactive/;function h(t,n){return!n&&t.isDefaultPrevented||(n||(n=t),e.each(c,function(r,i){var s=n[r];t[r]=function(){return this[i]=e.returnTrue,s&&s.apply(n,arguments)},t[i]=e.returnFalse})),t}function f(t){if(t){var e=(""+t).split(".");return{type:e[0],ns:e.slice(1).sort().join(" ")}}return{type:null,ns:null}}function d(t){return t&&(e.isFunction(t)||e.isFunction(t.handleEvent))}var p=[window.CustomEvent,window.CompositionEvent,window.DragEvent,window.Event,window.FocusEvent,window.KeyboardEvent,window.MessageEvent,window.MouseEvent,window.MouseScrollEvent,window.MouseWheelEvent,window.MutationEvent,window.ProgressEvent,window.TextEvent,window.TouchEvent,window.UIEvent,window.WheelEvent,window.ClipboardEvent],m={compositionstart:1,compositionend:1,compositionupdate:1,beforecopy:16,beforecut:16,beforepaste:16,copy:16,cut:16,paste:16,drag:2,dragend:2,dragenter:2,dragexit:2,dragleave:2,dragover:2,dragstart:2,drop:2,abort:3,change:3,error:3,selectionchange:3,submit:3,reset:3,fullscreenchange:3,fullscreenerror:3,focus:4,blur:4,focusin:4,focusout:4,keydown:5,keypress:5,keyup:5,message:6,click:7,contextmenu:7,dblclick:7,mousedown:7,mouseup:7,mousemove:7,mouseover:7,mouseout:7,mouseenter:7,mouseleave:7,progress:11,textInput:12,tap:13,touchstart:13,touchmove:13,touchend:13,load:14,resize:14,select:14,scroll:14,unload:14,wheel:15},y=function(){return function(t,n){e.isString(t)?n=n||{}:t=(n=t||{}).type||"";var r=f(t);t=r.type,n=e.mixin({bubbles:!0,cancelable:!0},n),r.ns&&(n.namespace=r.ns);var i=function(t){var e=m[t];e||(e=0);return p[e]}(t),s=new i(t,n);return e.safeMixin(s,n),h(s)}}();function g(t,n){var r,i={originalEvent:t};for(r in t)"keyIdentifier"===r||l.test(r)||void 0===t[r]||(i[r]=t[r]);return n&&e.mixin(i,n),h(i,t)}var w={},k="onfocusin"in window,x={focus:"focusin",blur:"focusout"},v={mouseenter:"mouseover",mouseleave:"mouseout"},_=function(t){return v[t]||k&&x[t]||t},b={},E=e.klass({init:function(t,e){this._target=t,this._event=e,this._bindings=[]},add:function(t,n){var s=this._bindings,o={fn:t,options:e.mixin({},n)};s.push(o);var a=this;if(!a._listener){a._listener=function(t){var n=this,s=g(t),o=t._args,l=a._bindings,c=s.namespace;o=e.isDefined(o)?[s].concat(o):[s],s.type=a._event,e.each(l,function(t,l){var u=n;if(s.isImmediatePropagationStopped&&s.isImmediatePropagationStopped())return!1;var h=l.fn,f=l.options||{},d=f.selector,p=f.one,m=f.data;if(!c||c==f.ns||-1!==f.ns.indexOf(c)){if(d){if(!(u=r.closest(s.target,d))||u===n)return;e.mixin(s,{currentTarget:u,liveFired:n})}var y=a._event;if(y in v){var g=s.relatedTarget;if(g&&(g===u||i.contains(u,g)))return}e.isDefined(m)&&(s.data=m),p&&a.remove(h,f),!1===(h.handleEvent?h.handleEvent.apply(h,o):f.ctx?h.apply(f.ctx,o):h.apply(u,o))&&(s.preventDefault(),s.stopPropagation())}})};var l=a._event;a._target.addEventListener?a._target.addEventListener(_(l),a._listener,!1):console.warn("invalid eventer object",a._target)}},remove:function(t,n){var r,i;(n=e.mixin({},n)).ns&&(i=n.ns,r=new RegExp("(?:^| )"+i.replace(" "," .* ?")+"(?: |$)")),this._bindings=this._bindings.filter(function(e){var i=(!t||t===e.fn)&&(!r||r.test(e.options.ns))&&(!n.selector||n.selector==e.options.selector);return!i}),0==this._bindings.length&&(this._target.removeEventListener&&this._target.removeEventListener(_(this._event),this._listener,!1),this._listener=null)}}),S=e.klass({init:function(t){this._target=t,this._handler={}},register:function(t,n,r){var i=f(t),t=i.type,s=w[t],o=s&&(s.bindType||s.bindEventName),a=this._handler;void 0===a[t]&&(a[t]=new E(this._target,o||t)),a[t].add(n,e.mixin({ns:i.ns},r))},unregister:function(t,n,r){var i=this._handler,s=f(t);if(t=s.type){var o=i[t];o&&o.remove(n,e.mixin({ns:s.ns},r))}else for(t in i){var o=i[t];o.remove(n,e.mixin({ns:s.ns},r))}}}),T=function(t){var e=a(t),n=b[e];return n||(n=b[e]=new S(t)),n};var I=[],F=e.loop(function(){for(var t=0;t<I.length;t++)C(I[t],"focused");I=[]});function A(t,n,r,i,s,o,a){if(e.isPlainObject(n))return e.each(n,function(e,n){A(t,e,r,i,n,a)}),this;e.isString(r)||d(s)||(a=o,o=s,s=i,i=r,r=void 0),d(i)&&(a=o,o=s,s=i,i=void 0),e.isBoolean(o)&&(a=o,o=void 0),!1===s&&(s=e.returnFalse),"string"==typeof n&&(n=n.indexOf(",")>-1?n.split(","):n.split(/\s/));var l=T(t);return n.forEach(function(t){if("ready"==t)return O(s);l.register(t,s,{data:i,selector:r,ctx:o,one:!!a})}),this}function C(t,e,n){var r;(r=e instanceof Event?e:y(e,n))._args=n;var i=t.dispatchEvent||t.trigger;return i?i.call(t,r):console.warn("The evented parameter is not a eventable object"),this}function O(t){return u.test(document.readyState)&&document.body?e.defer(t):document.addEventListener("DOMContentLoaded",t,!1),this}F.start();var M=[],N=e.loop(function(){for(var t=0;t<M.length;t++)C(M[t],"resized");M=[]});N.start();var D={backspace:8,comma:188,delete:46,down:40,end:35,enter:13,escape:27,home:36,left:37,page_down:34,page_up:33,period:190,right:39,space:32,tab:9,up:38};function z(){return z}return n.support.transition&&(w.transitionEnd={bindType:n.support.transition.end,delegateType:n.support.transition.end}),e.mixin(z,{NativeEvents:m,clear:function(t){return T(t).unregister(),this},create:y,focused:function(t){I.includes(t)||I.push(t)},keys:D,isNativeEvent:function(t){if(e.isString(t))return!!m[t];if(e.isArray(t)){for(var n=0;n<t.length;n++)if(m[t])return!1;return t.length>0}},off:function t(n,r,i,s){if(e.isPlainObject(r))return e.each(r,function(e,r){t(n,e,i,r)}),this;e.isString(i)||d(s)||!1===s||(s=i,i=void 0);!1===s&&(s=e.returnFalse);"string"==typeof r&&(r=r.indexOf(",")>-1?r.split(","):r.split(/\s/));var o=T(n);r&&r.forEach(function(t){o.unregister(t,s,{selector:i})});return this},on:A,one:function(...t){return A(...t,!0),this},proxy:g,ready:O,resized:function(t){M.includes(t)||M.push(t)},shortcuts:function(t){var e=s.data(t,"shortcuts");if(!e){e={},s.data(t,"shortcuts",e);var n=function(t,e){var n=e.metaKey||e.ctrlKey;if(t.ctrl==n&&t.alt==e.altKey&&t.shift==e.shiftKey&&(e.keyCode==t.keyCode||e.charCode&&e.charCode==t.charCode))return e.preventDefault(),"keydown"==e.type&&t.fn(e),!0};A(t,"keyup keypress keydown",function(t){if(!/INPUT|TEXTAREA/.test(t.target.nodeName))for(var r in e)n(e[r],t)})}return{add:function(t,n){(t.indexOf(",")>-1?t.toLowerCase().split(","):t.toLowerCase().split(" ")).forEach(function(t){var r={fn:n,alt:!1,ctrl:!1,shift:!1};t.split("+").forEach(function(t){switch(t){case"alt":case"ctrl":case"shift":r[t]=!0;break;default:r.charCode=t.charCodeAt(0),r.keyCode=D[t]||t.toUpperCase().charCodeAt(0)}});var i=(r.ctrl?"ctrl":"")+","+(r.alt?"alt":"")+","+(r.shift?"shift":"")+","+r.keyCode;e[i]=r})}}},special:w,stop:function(t){window.document.all&&(t.keyCode=0);t.preventDefault&&(t.preventDefault(),t.stopPropagation());return this},trigger:C}),o(m,function(t){z[t]=function(e,n,r,i){return arguments.length>1?this.on(e,t,n,r,i):("focus"==t?e.focus&&e.focus():"blur"==t?e.blur&&e.blur():"click"==t?e.click&&e.click():this.trigger(e,t),this)}}),t.attach("domx.eventer",z)}),define("skylark-domx-eventer/main",["skylark-langx/langx","./eventer","skylark-domx-velm","skylark-domx-query"],function(t,e,n,r){var i=["off","on","one","trigger"];return t.each(e.NativeEvents,function(t){i.push(t)}),n.delegate(i,e),t.each(i,function(t,n){r.fn[n]=r.wraps.wrapper_every_act(e[n],e)}),r.ready=e.ready,e}),define("skylark-domx-eventer",["skylark-domx-eventer/main"],function(t){return t}),define("skylark-domx-forms/forms",["skylark-langx/skylark"],function(t){return t.attach("domx.forms",{})}),define("skylark-domx-forms/deserialize",["skylark-langx/langx","skylark-domx-query","./forms"],function(t,e,n){function r(t,e,n){var r=n[t];return void 0===r?n[t]=[e]:r.push(e),n}var i={checked:["radio","checkbox"],selected:["option","select-one","select-multiple"],value:["button","color","date","datetime","datetime-local","email","hidden","month","number","password","range","reset","search","submit","tel","text","textarea","time","url","week"]};function s(e,n,r,s,o){var a=function(e){var n=function(t){return(t.type||t.nodeName).toLowerCase()}(e),r=void 0;return t.each(i,function(e,i){if(t.inArray(n,i)>-1)return r=e,!1}),r}(e);if("value"==a&&n==s)e.value=r,o.call(e,r);else if("checked"==a||"selected"==a){var l=[];e.options?t.each(e.options,function(t,e){l.push(e)}):l.push(e),e.multiple&&0==s&&(e.selectedIndex=-1),t.each(l,function(t,e){e.value==r&&(e[a]=!0,o.call(e,r))})}}var o={change:t.noop,complete:t.noop};return n.deserialize=function(n,i,a){t.isFunction(a)&&(a={complete:a});a=t.extend(o,a||{}),i=function(e){var n={},i=/\+/g;t.isPlainObject(e)?(t.extend(n,e),t.each(n,function(e,r){t.isArray(r)||(n[e]=[r])})):t.isArray(e)?t.each(e,function(t,e){r(e.name,e.value,n)}):"string"==typeof e&&t.each(e.split("&"),function(t,e){var s=e.split("="),o=decodeURIComponent(s[0].replace(i,"%20")),a=decodeURIComponent(s[1].replace(i,"%20"));r(o,a,n)});return n}(i);var l=function(n,i){var s={},o=e(n).map(function(){return this.elements?t.makeArray(this.elements):this}).filter(i||":input:not(:disabled)").get();return t.each(o,function(t,e){r(e.name,e,s)}),s}(n,a.filter);return t.each(i,function(e,n){t.each(l[e],function(e,r){t.each(n,function(t,n){s(r,e,n,t,a.change)})})}),a.complete.call(n),this}}),define("skylark-domx-forms/serialize-array",["skylark-langx/langx","skylark-domx-data","./forms"],function(t,e,n){return n.serializeArray=function(n){var r,i,s,o=[],a=function(t){if(t.forEach)return t.forEach(a);o.push({name:r,value:t})};s=n.elements?n.elements:t.isArrayLike(n)?n:[n];return t.each(s,function(t,n){i=n.type,(r=n.name)&&"fieldset"!=n.nodeName.toLowerCase()&&!n.disabled&&"submit"!=i&&"reset"!=i&&"button"!=i&&"file"!=i&&("radio"!=i&&"checkbox"!=i||n.checked)&&a(e.val(n))}),o}}),define("skylark-domx-forms/serialize-object",["skylark-langx/langx","./forms","./serialize-array"],function(t,e,n){return e.serializeObject=function(e){var r={};return t.each(n(e),function(e,n){var i=n.name,s=n.value;r[i]=void 0===r[i]?s:t.isArray(r[i])?r[i].concat(s):[r[i],s]}),r}}),define("skylark-domx-forms/serialize",["skylark-langx/langx","./forms","./serialize-array"],function(t,e,n){return e.serialize=function(t){var e=[];return n(t).forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")}}),define("skylark-domx-forms/main",["skylark-langx","skylark-domx-data","./forms","skylark-domx-velm","skylark-domx-query","./deserialize","./serialize-array","./serialize-object","./serialize"],function(t,e,n,r,i){return r.delegate(["deserialize","serializeArray","serializeObject","serialize"],n),i.fn.deserialize=i.wraps.wrapper_every_act(n.deserialize,n,n.deserialize),i.fn.serializeArray=i.wraps.wrapper_map(n.serializeArray,n,n.serializeArray,!0),i.fn.serializeObject=i.wraps.wrapper_map(n.serializeObject,n,n.serializeObject,!0),i.fn.serialize=i.wraps.wrapper_value(n.serialize,n,n.serialize),n}),define("skylark-domx-forms",["skylark-domx-forms/main"],function(t){return t}),define("skylark-domx-transits/transits",["skylark-langx/skylark","skylark-langx/langx"],function(t,e){function n(){return n}return e.mixin(n,{off:!1,speeds:{normal:400,fast:200,slow:600}}),t.attach("domx.transits",n)}),define("skylark-domx-geom/geom",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-noder","skylark-domx-styler"],function(t,e,n,r){"use strict";var i,s=/^(?:body|html)$/i,o=e.toPixel,a=n.offsetParent;function l(t){if(n.isWindow(t))return{left:0,top:0,right:0,bottom:0};var e=getComputedStyle(t);return{left:o(e.borderLeftWidth,t),top:o(e.borderTopWidth,t),right:o(e.borderRightWidth,t),bottom:o(e.borderBottomWidth,t)}}function c(t,e){if(void 0===e)return s.test(t.nodeName)?{top:0,left:0}:t.getBoundingClientRect();var n=a(t),r=c(n),i=d(t),o=l(n);return y(t,{top:e.top-r.top-i.top-o.top+(k(n)||0),left:e.left-r.left-i.left-o.left+(w(n)||0)}),this}function u(t,e){return void 0!==e?(c(t,e),x(t,e),this):t==window||t==document.documentElement||t==document.body?{top:0,left:0,bottom:window.innerHeight,right:window.innerWidth,height:window.innerHeight,width:window.innerWidth}:t.getBoundingClientRect?t.getBoundingClientRect():void 0}function h(t,e){if(void 0==e)return{width:t.clientWidth,height:t.clientHeight};var n="border-box"===r.css(t,"box-sizing"),i={width:e.width,height:e.height};if(n){var s=l(t);void 0!==i.width&&(i.width=i.width+s.left+s.right),void 0!==i.height&&(i.height=i.height+s.top+s.bottom)}else{var o=p(t);void 0!==i.width&&(i.width=i.width-o.left-o.right),void 0!==i.height&&(i.height=i.height-o.top-o.bottom)}return r.css(t,i),this}function f(t){var e=t.documentElement,n=t.body,r=Math.max,i=r(e.scrollWidth,n.scrollWidth),s=r(e.clientWidth,n.clientWidth),o=r(e.offsetWidth,n.offsetWidth),a=r(e.scrollHeight,n.scrollHeight),l=r(e.clientHeight,n.clientHeight),c=r(e.offsetHeight,n.offsetHeight);return{width:i<o?s:i,height:a<c?l:a}}function d(t){if(n.isWindow(t))return{left:0,top:0,right:0,bottom:0};var e=getComputedStyle(t);return{left:o(e.marginLeft),top:o(e.marginTop),right:o(e.marginRight),bottom:o(e.marginBottom)}}function p(t){if(n.isWindow(t))return{left:0,top:0,right:0,bottom:0};var e=getComputedStyle(t);return{left:o(e.paddingLeft),top:o(e.paddingTop),right:o(e.paddingRight),bottom:o(e.paddingBottom)}}function m(t,e){if(void 0===e){var n=t.getBoundingClientRect(),r=t.ownerDocument.defaultView;return{left:n.left+r.pageXOffset,top:n.top+r.pageYOffset}}var i=a(t),s=m(i),o=d(t),c=l(i);return y(t,{top:e.top-s.top-o.top-c.top,left:e.left-s.left-o.left-c.left}),this}function y(t,e){if(void 0==e){var n=a(t),i=c(t),s=c(n),o=d(t),u=l(n);return{top:i.top-s.top-u.top-o.top,left:i.left-s.left-u.left-o.left}}var n=a(t),h={top:e.top,left:e.left};return"static"==r.css(t,"position")&&(h.position="relative"),r.css(t,h),this}function g(t,e){if(void 0===e){var n=a(t),r=u(t),i=c(n),s=(d(t),l(n));return{top:r.top-i.top-s.top,left:r.left-i.left-s.left,width:r.width,height:r.height}}return y(t,e),x(t,e),this}function w(t,e){9===t.nodeType?t=t.defaultView:t==document.body&&(t=document.scrollingElement||document.documentElement);var n="scrollLeft"in t;return void 0===e?n?t.scrollLeft:t.pageXOffset:(n?t.scrollLeft=e:t.scrollTo(e,t.scrollY),this)}function k(t,e){9===t.nodeType?t=t.defaultView:t==document.body&&(t=document.scrollingElement||document.documentElement);var n="scrollTop"in t;return void 0===e?n?t.scrollTop:t.pageYOffset:(n?t.scrollTop=e:t.scrollTo(t.scrollX,e),this)}function x(t,n){if(void 0==n)return e.isWindow(t)?{width:t.innerWidth,height:t.innerHeight}:e.isDocument(t)?f(document):{width:t.offsetWidth,height:t.offsetHeight};var i="border-box"===r.css(t,"box-sizing"),s={width:n.width,height:n.height};if(!i){var o=p(t),a=l(t);void 0!==s.width&&""!==s.width&&null!==s.width&&(s.width=s.width-o.left-o.right-a.left-a.right),void 0!==s.height&&""!==s.height&&null!==s.height&&(s.height=s.height-o.top-o.bottom-a.top-a.bottom)}return r.css(t,s),this}function v(t){return u(t=t||window)}function _(){return _}return e.mixin(_,{borderExtents:l,boundingPosition:c,boundingRect:u,clientHeight:function(t,e){return void 0==e?h(t).height:h(t,{height:e})},clientSize:h,clientWidth:function(t,e){return void 0==e?h(t).width:(h(t,{width:e}),this)},contentRect:function(t){var e=h(t),n=p(t);return{left:n.left,top:n.top,width:e.width-n.left-n.right,height:e.height-n.top-n.bottom}},getDocumentSize:f,hasScrollbar:function(){return document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)},height:function(t,e){return void 0==e?x(t).height:(x(t,{height:e}),this)},inview:function(t,e){var n=function(t,e){var n={};return e=+e||0,n.width=(n.right=t.right+e)-(n.left=t.left-e),n.height=(n.bottom=t.bottom+e)-(n.top=t.top-e),n}(u(t),e),r=v();return!!n&&n.bottom>=0&&n.right>=0&&n.top<=r.height&&n.left<=r.width},marginExtents:d,marginRect:function(t){var e=g(t),n=d(t);return{left:e.left,top:e.top,width:e.width+n.left+n.right,height:e.height+n.top+n.bottom}},marginSize:function(t){var e=x(t),n=d(t);return{width:e.width+n.left+n.right,height:e.height+n.top+n.bottom}},offsetParent:a,paddingExtents:p,pagePosition:m,pageRect:function(t,e){if(void 0===e){var n=t.getBoundingClientRect(),r=t.ownerDocument.defaultView;return{left:n.left+r.pageXOffset,top:n.top+r.pageYOffset,width:Math.round(n.width),height:Math.round(n.height)}}return m(t,e),x(t,e),this},relativePosition:y,relativeRect:g,scrollbarWidth:function(){if(void 0!==i)return i;var t,e,s=n.createFragment("<div style='display:block;position:absolute;width:200px;height:200px;overflow:hidden;'><div style='height:300px;width:auto;'></div></div>")[0],o=s.childNodes[0];n.append(document.body,s),t=o.offsetWidth,r.css(s,"overflow","scroll"),e=o.offsetWidth,t===e&&(e=s[0].clientWidth);return n.remove(s),i=t-e},scrollIntoView:function(t,e){var n,r,i,s,o,a,l=t.parentNode,c=function(t,e){var n,r,i=t;n=r=0;for(;i&&i!=e&&i.nodeType;)n+=i.offsetLeft||0,r+=i.offsetTop||0,i=i.offsetParent;return{x:n,y:r}}(t,l);n=c.x,r=c.y,i=t.offsetWidth,s=t.offsetHeight,o=l.clientWidth,a=l.clientHeight,"end"==e?(n-=o-i,r-=a-s):"center"==e&&(n-=o/2-i/2,r-=a/2-s/2);return l.scrollLeft=n,l.scrollTop=r,this},scrollLeft:w,scrollTop:k,scrollBy:function(t,e,n){t.scrollLeft+=e,t.scrollTop+=n},size:x,testAxis:function(t){var e=t.offsetTop,n=t.offsetLeft,r=t.offsetWidth,i=t.offsetHeight;for(;t.offsetParent;)t=t.offsetParent,e+=t.offsetTop,n+=t.offsetLeft;var s={x:0,y:0};e<window.pageYOffset?s.y=e-window.pageYOffset:e+i>window.pageYOffset+window.innerHeight&&(s.y=e+i-(window.pageYOffset+window.innerHeight));n<window.pageXOffset?s.x=n-window.pageXOffset:n+r>window.pageXOffset+window.innerWidth&&(s.x=n+r-(window.pageXOffset+window.innerWidth));return s},viewportSize:v,width:function(t,e){return void 0==e?x(t).width:(x(t,{width:e}),this)}}),t.attach("domx.geom",_)}),define("skylark-domx-geom/posit",["skylark-langx/langx","skylark-domx-noder","skylark-domx-styler","./geom"],function(t,e,n,r){"use strict";var i=Math.max,s=Math.abs,o=/left|center|right/,a=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/;function h(t,e,n){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?n/100:1)]}function f(t,e){return parseInt(n.css(t,e),10)||0}var d={fit:{left:function(t,e){var n,r=e.within,s=r.isWindow?r.scrollLeft:r.offset.left,o=r.width,a=t.left-e.collisionPosition.marginLeft,l=s-a,c=a+e.collisionWidth-o-s;e.collisionWidth>o?l>0&&c<=0?(n=t.left+l+e.collisionWidth-o-s,t.left+=l-n):t.left=c>0&&l<=0?s:l>c?s+o-e.collisionWidth:s:l>0?t.left+=l:c>0?t.left-=c:t.left=i(t.left-a,t.left)},top:function(t,e){var n,r=e.within,s=r.isWindow?r.scrollTop:r.offset.top,o=e.within.height,a=t.top-e.collisionPosition.marginTop,l=s-a,c=a+e.collisionHeight-o-s;e.collisionHeight>o?l>0&&c<=0?(n=t.top+l+e.collisionHeight-o-s,t.top+=l-n):t.top=c>0&&l<=0?s:l>c?s+o-e.collisionHeight:s:l>0?t.top+=l:c>0?t.top-=c:t.top=i(t.top-a,t.top)}},flip:{left:function(t,e){var n,r,i=e.within,o=i.offset.left+i.scrollLeft,a=i.width,l=i.isWindow?i.scrollLeft:i.offset.left,c=t.left-e.collisionPosition.marginLeft,u=c-l,h=c+e.collisionWidth-a-l,f="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,d="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,p=-2*e.offset[0];u<0?((n=t.left+f+d+p+e.collisionWidth-a-o)<0||n<s(u))&&(t.left+=f+d+p):h>0&&((r=t.left-e.collisionPosition.marginLeft+f+d+p-l)>0||s(r)<h)&&(t.left+=f+d+p)},top:function(t,e){var n,r,i=e.within,o=i.offset.top+i.scrollTop,a=i.height,l=i.isWindow?i.scrollTop:i.offset.top,c=t.top-e.collisionPosition.marginTop,u=c-l,h=c+e.collisionHeight-a-l,f="top"===e.my[1],d=f?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,p="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,m=-2*e.offset[1];u<0?((r=t.top+d+p+m+e.collisionHeight-a-o)<0||r<s(u))&&(t.top+=d+p+m):h>0&&((n=t.top-e.collisionPosition.marginTop+d+p+m-l)>0||s(n)<h)&&(t.top+=d+p+m)}},flipfit:{left:function(){d.flip.left.apply(this,arguments),d.fit.left.apply(this,arguments)},top:function(){d.flip.top.apply(this,arguments),d.fit.top.apply(this,arguments)}}};return r.posit=function(u,p){var m,y,g,w,k,x,v=(p=t.extend({},p)).of,_=(T=p.within,I=T||window,F=e.isWindow(I),A=!!I&&9===I.nodeType,C=!F&&!A,O=r.marginSize(I),{element:I,isWindow:F,isDocument:A,offset:C?r.pagePosition(T):{left:0,top:0},scrollLeft:r.scrollLeft(I),scrollTop:r.scrollTop(I),width:O.width,height:O.height}),b=function(t){var e=t.isWindow||t.isDocument?"":n.css(t.element,"overflow-x"),i=t.isWindow||t.isDocument?"":n.css(t.element,"overflow-y"),s="scroll"===e||"auto"===e&&t.width<r.scrollWidth(t.element);return{width:"scroll"===i||"auto"===i&&t.height<r.scrollHeight(t.element)?r.scrollbarWidth():0,height:s?r.scrollbarWidth():0}}(_),E=(p.collision||"flip").split(" "),S={};var T,I,F,A,C,O;M=v,x=9===M.nodeType?{size:size(M),offset:{top:0,left:0}}:e.isWindow(M)?{size:r.size(M),offset:{top:r.scrollTop(M),left:r.scrollLeft(M)}}:M.preventDefault?{size:{width:0,height:0},offset:{top:M.pageY,left:M.pageX}}:{size:r.size(M),offset:r.pagePosition(M)},v.preventDefault&&(p.at="left top");var M;y=x.size.width,g=x.size.height,w=x.offset,k=t.extend({},w),t.each(["my","at"],function(){var t,e,n=(p[this]||"").split(" ");1===n.length&&(n=o.test(n[0])?n.concat(["center"]):a.test(n[0])?["center"].concat(n):["center","center"]),n[0]=o.test(n[0])?n[0]:"center",n[1]=a.test(n[1])?n[1]:"center",t=l.exec(n[0]),e=l.exec(n[1]),S[this]=[t?t[0]:0,e?e[0]:0],p[this]=[c.exec(n[0])[0],c.exec(n[1])[0]]}),1===E.length&&(E[1]=E[0]);"right"===p.at[0]?k.left+=y:"center"===p.at[0]&&(k.left+=y/2);"bottom"===p.at[1]?k.top+=g:"center"===p.at[1]&&(k.top+=g/2);return m=h(S.at,y,g),k.left+=m[0],k.top+=m[1],function(e){var n,o,a=r.marginSize(e),l=a.width,c=a.height,u=f(e,"marginLeft"),x=f(e,"marginTop"),T=l+u+f(e,"marginRight")+b.width,I=c+x+f(e,"marginBottom")+b.height,F=t.extend({},k),A=h(S.my,a.width,a.height);"right"===p.my[0]?F.left-=l:"center"===p.my[0]&&(F.left-=l/2),"bottom"===p.my[1]?F.top-=c:"center"===p.my[1]&&(F.top-=c/2),F.left+=A[0],F.top+=A[1],n={marginLeft:u,marginTop:x},t.each(["left","top"],function(t,r){d[E[t]]&&d[E[t]][r](F,{targetWidth:y,targetHeight:g,elemWidth:l,elemHeight:c,collisionPosition:n,collisionWidth:T,collisionHeight:I,offset:[m[0]+A[0],m[1]+A[1]],my:p.my,at:p.at,within:_,elem:e})}),p.using&&(o=function(t){var n=w.left-F.left,r=n+y-l,o=w.top-F.top,a=o+g-c,u={target:{element:v,left:w.left,top:w.top,width:y,height:g},element:{element:e,left:F.left,top:F.top,width:l,height:c},horizontal:r<0?"left":n>0?"right":"center",vertical:a<0?"top":o>0?"bottom":"middle"};y<l&&s(n+r)<y&&(u.horizontal="center"),g<c&&s(o+a)<g&&(u.vertical="middle"),i(s(n),s(r))>i(s(o),s(a))?u.important="horizontal":u.important="vertical",p.using.call(this,t,u)}),r.pagePosition(e,t.extend(F,{using:o}))}(u)}}),define("skylark-domx-geom/scroll-to-top",["skylark-langx","skylark-domx-styler","./geom"],function(t,e,n){return n.scrollToTop=function(e,n,r,i){var s=parseInt(e.scrollTop),o=0,a=1e3*r/5,l=parseInt(n),c=setInterval(function(){++o<=a&&(e.scrollTop=(l-s)/a*o+s),o>=a+1&&(clearInterval(c),i&&t.debounce(i,1e3)())},5);return this}}),define("skylark-domx-geom/main",["skylark-langx/langx","./geom","skylark-domx-velm","skylark-domx-query","./posit","./scroll-to-top"],function(t,e,n,r){return n.delegate(["borderExtents","boundingPosition","boundingRect","clientHeight","clientSize","clientWidth","contentRect","height","marginExtents","marginRect","marginSize","offsetParent","paddingExtents","pagePosition","pageRect","relativePosition","relativeRect","scrollIntoView","scrollLeft","scrollTop","pageSize","width"],e,{pageSize:"size"}),r.fn.offset=r.wraps.wrapper_value(e.pagePosition,e,e.pagePosition),r.fn.scrollTop=r.wraps.wrapper_value(e.scrollTop,e),r.fn.scrollLeft=r.wraps.wrapper_value(e.scrollLeft,e),r.fn.position=function(n){if(!this.length)return this;if(n)return n.of&&n.of.length&&((n=t.clone(n)).of=n.of[0]),this.each(function(){e.posit(this,n)});var r=this[0];return e.relativePosition(r)},r.fn.offsetParent=r.wraps.wrapper_map(e.offsetParent,e),r.fn.pageSize=r.wraps.wrapper_value(e.size,e),r.fn.width=r.wraps.wrapper_value(e.width,e,e.width),r.fn.height=r.wraps.wrapper_value(e.height,e,e.height),r.fn.clientSize=r.wraps.wrapper_value(e.clientSize,e.clientSize),["width","height"].forEach(function(t){var n=t.replace(/./,function(t){return t[0].toUpperCase()});r.fn["outer"+n]=function(n,r){if(arguments.length?"boolean"!=typeof n&&(r=n,n=!1):(n=!1,r=void 0),void 0===r){var i=this[0];if(!i)return;var s=e.size(i);if(n){var o=e.marginExtents(i);s.width=s.width+o.left+o.right,s.height=s.height+o.top+o.bottom}return"width"===t?s.width:s.height}return this.each(function(i,s){var o={},a=e.marginExtents(s);"width"===t?(o.width=r,n&&(o.width=o.width-a.left-a.right)):(o.height=r,n&&(o.height=o.height-a.top-a.bottom)),e.size(s,o)})}}),r.fn.innerWidth=r.wraps.wrapper_value(e.clientWidth,e,e.clientWidth),r.fn.innerHeight=r.wraps.wrapper_value(e.clientHeight,e,e.clientHeight),e}),define("skylark-domx-geom",["skylark-domx-geom/main"],function(t){return t}),define("skylark-domx-transits/transit",["skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-geom","skylark-domx-styler","skylark-domx-eventer","./transits"],function(t,e,n,r,i,s,o){var a,l,c,u,h=e.normalizeCssEvent("TransitionEnd"),f=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,d=e.css3PropPrefix+"transform",p={};return p[a=e.normalizeCssProperty("transition-property")]=p[l=e.normalizeCssProperty("transition-duration")]=p[u=e.normalizeCssProperty("transition-delay")]=p[c=e.normalizeCssProperty("transition-timing-function")]="",o.transit=function(e,n,m,y,g,w){var k,x,v,_={},b=[],E="",S=this,T=!1,I=!1;t.isPlainObject(m)&&(y=m.easing,g=m.complete,w=m.delay,m=m.duration);t.isString(m)&&(m=o.speeds[m]);void 0===m&&(m=o.speeds.normal);m/=1e3,o.off&&(m=0);t.isFunction(y)?(g=y,eace="swing"):y=y||"swing";w?w/=1e3:w=0;for(k in n){var F=n[k];if(f.test(k))E+=k+"("+F+") ";else{if("scrollTop"===k&&(I=!0),"clip"==k&&t.isPlainObject(F)){if(_[k]="rect("+F.top+"px,"+F.right+"px,"+F.bottom+"px,"+F.left+"px)","auto"==i.css(e,"clip")){var A=r.size(e);i.css(e,"clip","rect(0px,"+A.width+"px,"+A.height+"px,0px)"),!0}}else _[k]=F;b.push(t.dasherize(k))}}x=h,E&&(_[d]=E,b.push(d));m>0&&(_[a]=b.join(", "),_[l]=m+"s",_[u]=w+"s",_[c]=y);v=function(t){if(T=!0,t){if(t.target!==t.currentTarget)return;s.off(t.target,x,v)}else s.off(e,x,v);i.css(e,p),g&&g.call(this)},m>0&&(s.on(e,x,v),t.debounce(function(){T||v.call(S)},1e3*(m+w)+25)());e.clientLeft,i.css(e,_),m<=0&&t.debounce(function(){T||v.call(S)},0)();I&&r.scrollToTop(e,n.scrollTop,m,g);return this}}),define("skylark-domx-transits/bounce",["skylark-langx/langx","skylark-domx-geom","skylark-domx-styler","./transits","./transit"],function(t,e,n,r,i){return r.bounce=function(r,s,o){var a,l,c,u,h=s.mode,f="hide"===h,d="show"===h,p=s.direction||"up",m=s.distance,y=s.times||5,g=2*y+(d||f?1:0),w=s.duration/g,k=s.easing,x="up"===p||"down"===p?"top":"left",v="up"===p||"left"===p,_=0,b=t.Deferred,E=[];if(c=n.css(r,x),!m){var S=e.size(r);m=("top"===x?S.height:S.width)/3}u=e.relativePosition(r)[x],d&&((l={opacity:1})[x]=c,n.css(r,"opacity",0),n.css(r,x,u+(v?2*-m:2*m)),E.push(T(r,l,w,k)));f&&(m/=Math.pow(2,y-1));function T(t,e,n,r){return function(){var s=new b;return i(t,e,n,r,function(){s.resolve()}),s.promise}}for((l={})[x]=c;_<y;_++)(a={})[x]=u+(v?-m:m),E.push(T(r,a,w,k)),E.push(T(r,l,w,k)),m=f?2*m:m/2;f&&((a={opacity:0})[x]=u+(v?-1*m:m),E.push(T(r,a,w,k)));return E.push(o),E.reduce(function(t,e,n,r){return t.then(e)},b.resolve()),this}}),define("skylark-domx-transits/emulate-transition-end",["skylark-langx/langx","skylark-domx-browser","skylark-domx-eventer","./transits"],function(t,e,n,r){return r.emulateTransitionEnd=function(t,r){var i=!1;n.one(t,"transitionEnd",function(){i=!0});return setTimeout(function(){i||n.trigger(t,e.support.transition.end)},r),this}}),define("skylark-domx-transits/show",["skylark-langx/langx","skylark-domx-styler","./transits","./transit"],function(t,e,n,r){return n.show=function(n,i,s){e.show(n),i&&(!s&&t.isFunction(i)&&(s=i,i="normal"),e.css(n,"opacity",0),r(n,{opacity:1,scale:"1,1"},i,s));return this}}),define("skylark-domx-transits/hide",["skylark-langx/langx","skylark-domx-styler","./transits","./transit"],function(t,e,n,r){return n.hide=function(n,i,s){i?(!s&&t.isFunction(i)&&(s=i,i="normal"),r(n,{opacity:0,scale:"0,0"},i,function(){e.hide(n),s&&s.call(n)})):e.hide(n);return this}}),define("skylark-domx-transits/explode",["skylark-langx/langx","skylark-domx-styler","skylark-domx-geom","skylark-domx-noder","skylark-domx-query","./transits","./transit","./show","./hide"],function(t,e,n,r,i,s,o,a,l){return s.explode=function(t,r,s){e.show(t),e.css(t,"visibility","hidden");var o,a,l,c,u,h=r.pieces?Math.round(Math.sqrt(r.pieces)):3,f=h,d="show"===r.mode,p=n.pagePosition(t),m=n.marginSize(t),y=Math.ceil(m.width/f),g=Math.ceil(m.height/h),w=[];function k(){w.push(this),w.length===h*f&&(e.css(t,{visibility:"visible"}),i(w).remove(),s())}for(var x=0;x<h;x++)for(l=p.top+x*g,u=x-(h-1)/2,o=0;o<f;o++)a=p.left+o*y,c=o-(f-1)/2,i(t).clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*y,top:-x*g}).parent().addClass(r.explodeClass||"ui-effects-explode").css({position:"absolute",overflow:"hidden",width:y,height:g,left:a+(d?c*y:0),top:l+(d?u*g:0),opacity:d?0:1}).transit({left:a+(d?0:c*y),top:l+(d?0:u*g),opacity:d?1:0},r.duration||500,r.easing,k);return this}}),define("skylark-domx-transits/fade",["skylark-langx/langx","skylark-domx-styler","./transits","./transit"],function(t,e,n,r){return n.fade=function(e,n,i,s){t.isFunction(i)&&(s=i,i={});return r(e,{opacity:n},(i=i||{}).duration,i.easing,s),this}}),define("skylark-domx-transits/fade-in",["skylark-langx/langx","skylark-domx-styler","./transits","./fade"],function(t,e,n,r){return n.fadeIn=function(t,n,i){var s=e.css(t,"opacity");s>0?e.css(t,"opacity",0):s=1;return e.show(t),r(t,s,n,i),this}}),define("skylark-domx-transits/fade-out",["skylark-langx/langx","skylark-domx-styler","./transits","./fade"],function(t,e,n,r){return n.fadeOut=function(t,e,n){return r(t,0,e,n),this}}),define("skylark-domx-transits/fade-toggle",["skylark-langx/langx","skylark-domx-styler","./transits","./fade-in","./fade-out"],function(t,e,n,r,i){return n.fadeToggle=function(t,n,s,o){e.isInvisible(t)?r(t,n,s,o):i(t,n,s,o);return this}}),define("skylark-domx-transits/pulsate",["skylark-langx/langx","skylark-domx-geom","skylark-domx-styler","./transits","./transit"],function(t,e,n,r,i){return r.pulsate=function(e,r,s){var o=r.mode,a="show"===o||!o,l=a||"hide"===o,c=2*(r.times||5)+(l?1:0),u=r.duration/c,h=0,f=1;(a||n.isInvisible(e))&&(n.css(e,"opacity",0),n.show(e),h=1);var d=t.Deferred,p=[];function m(t,e,n,r){return function(){var s=new d;return i(t,e,n,r,function(){s.resolve()}),s.promise}}for(;f<c;f++)p.push(m(e,{opacity:h},u,r.easing)),h=1-h;return p.push(m(e,{opacity:h},u,r.easing)),p.push(s),p.reduce(function(t,e,n,r){return t.then(e)},d.resolve()),this}}),define("skylark-domx-transits/shake",["skylark-langx/langx","skylark-domx-geom","skylark-domx-styler","./transits","./transit"],function(t,e,n,r,i){return r.shake=function(n,r,s){var o=1,a=r.direction||"left",l=r.distance||20,c=r.times||3,u=2*c+1,h=Math.round(r.duration/u),f="up"===a||"down"===a?"top":"left",d="up"===a||"left"===a,p={},m={},y={},g={},w=t.Deferred;function k(t,e,n,r){return function(){var s=new w;return i(t,e,n,r,function(){s.resolve()}),s.promise}}for(start=e.relativePosition(n)[f],funcs=[],p[f]=start,m[f]=start+(d?-1:1)*l,y[f]=m[f]+(d?1:-1)*l*2,g[f]=y[f]+(d?-1:1)*l*2,funcs.push(k(n,m,h,r.easing));o<c;o++)funcs.push(k(n,y,h,r.easing)),funcs.push(k(n,g,h,r.easing));return funcs.push(k(n,p,h/2,r.easing)),funcs.push(s),funcs.reduce(function(t,e,n,r){return t.then(e)},w.resolve()),this}}),define("skylark-domx-transits/slide",["skylark-langx/langx","skylark-domx-styler","./transits","./transit"],function(t,e,n,r){return n.slide=function(i,s,o){t.isFunction(s)&&(o=s,s={});var a=(s=s||{}).direction||"down",l="up"===a||"left"===a,c="up"===a||"down"===a,u=s.duration||n.speeds.normal,h=e.css(i,"position");if(l){if(e.isInvisible(i))return this}else e.show(i),e.css(i,{position:"absolute",visibility:"hidden"});if(c){var f=e.css(i,"margin-top"),d=e.css(i,"margin-bottom"),p=e.css(i,"padding-top"),m=e.css(i,"padding-bottom"),y=e.css(i,"height");l?(e.css(i,{visibility:"visible",overflow:"hidden",height:y,marginTop:f,marginBottom:d,paddingTop:p,paddingBottom:m}),r(i,{height:0,marginTop:0,marginBottom:0,paddingTop:0,paddingBottom:0},{duration:u,queue:!1,complete:function(){e.hide(i),e.css(i,{visibility:"visible",overflow:"hidden",height:y,marginTop:f,marginBottom:d,paddingTop:p,paddingBottom:m}),o&&o.apply(i)}})):(e.css(i,{position:h,visibility:"visible",overflow:"hidden",height:0,marginTop:0,marginBottom:0,paddingTop:0,paddingBottom:0}),r(i,{height:y,marginTop:f,marginBottom:d,paddingTop:p,paddingBottom:m},{duration:u,complete:function(){o&&o.apply(i)}}))}else{var g=e.css(i,"margin-left"),w=e.css(i,"margin-right"),k=e.css(i,"padding-left"),x=e.css(i,"padding-right"),v=e.css(i,"width");l?(e.css(i,{visibility:"visible",overflow:"hidden",width:v,marginLeft:g,marginRight:w,paddingLeft:k,paddingRight:x}),r(i,{width:0,marginLeft:0,marginRight:0,paddingLeft:0,paddingRight:0},{duration:u,queue:!1,complete:function(){e.hide(i),e.css(i,{visibility:"visible",overflow:"hidden",width:v,marginLeft:g,marginRight:w,paddingLeft:k,paddingRight:x}),o&&o.apply(i)}})):(e.css(i,{position:h,visibility:"visible",overflow:"hidden",width:0,marginLeft:0,marginRight:0,paddingLeft:0,paddingRight:0}),r(i,{width:v,marginLeft:g,marginRight:w,paddingLeft:k,paddingRight:x},{duration:u,complete:function(){o&&o.apply(i)}}))}return this}}),define("skylark-domx-transits/slide-down",["./transits","./slide"],function(t,e){return t.slideDown=function(t,n,r){return e(t,{direction:"down",duration:n},r)}}),define("skylark-domx-transits/slide-up",["./transits","./slide"],function(t,e){return t.slideUp=function(t,n,r){return e(t,{direction:"up",duration:n},r)}}),define("skylark-domx-transits/slide-toggle",["skylark-langx/langx","skylark-domx-geom","./transits","./slide-down","./slide-up"],function(t,e,n,r,i){return n.slideToggle=function(t,n,s){0==e.height(t)?r(t,n,s):i(t,n,s);return this}}),define("skylark-domx-transits/throb",["skylark-langx/langx","skylark-domx-styler","skylark-domx-noder","./transits","./transit"],function(t,e,n,r,i){return r.throb=function(t,r){(r=r||{}).text,r.style;var i,s=r.time,o=r.callback,a=n.createElement("div",{class:r.className||"throbber"}),l=function(){i&&(clearTimeout(i),i=null),a&&(n.remove(a),a=null)};r.style&&e.css(a,r.style);var c=r.content||'<span class="throb"></span>';n.html(a,c),t.appendChild(a),s&&(i=setTimeout(function(){l(),o&&o()},s));return{throbber:a,remove:l,update:function(t){t&&t.text&&a&&(textNode.nodeValue=t.text)}}}}),define("skylark-domx-transits/toggle",["skylark-langx/langx","skylark-domx-styler","./transits","./show","./hide"],function(t,e,n,r,i){return n.toggle=function(t,n,s){e.isInvisible(t)?r(t,n,s):i(t,n,s);return this}}),define("skylark-domx-transits/main",["./transits","skylark-domx-velm","skylark-domx-query","./transit","./bounce","./emulate-transition-end","./explode","./fade-in","./fade-out","./fade","./fade-toggle","./hide","./pulsate","./shake","./show","./slide","./slide-down","./slide-toggle","./slide-up","./throb","./toggle"],function(t,e,n){return e.delegate(["transit","emulateTransitionEnd","fadeIn","fadeOut","fade","fadeToggle","hide","scrollToTop","slideDown","slideToggle","slideUp","show","toggle"],t),n.fn.hide=n.wraps.wrapper_every_act(t.hide,t),n.fn.transit=n.wraps.wrapper_every_act(t.transit,t),n.fn.emulateTransitionEnd=n.wraps.wrapper_every_act(t.emulateTransitionEnd,t),n.fn.show=n.wraps.wrapper_every_act(t.show,t),n.fn.hide=n.wraps.wrapper_every_act(t.hide,t),n.fn.toogle=n.wraps.wrapper_every_act(t.toogle,t),n.fn.fadeTo=n.wraps.wrapper_every_act(t.fadeTo,t),n.fn.fadeIn=n.wraps.wrapper_every_act(t.fadeIn,t),n.fn.fadeOut=n.wraps.wrapper_every_act(t.fadeOut,t),n.fn.fadeToggle=n.wraps.wrapper_every_act(t.fadeToggle,t),n.fn.slideDown=n.wraps.wrapper_every_act(t.slideDown,t),n.fn.slideToggle=n.wraps.wrapper_every_act(t.slideToggle,t),n.fn.slideUp=n.wraps.wrapper_every_act(t.slideUp,t),t}),define("skylark-domx-transits",["skylark-domx-transits/main"],function(t){return t}),define("skylark-domx-fx/fx",["skylark-langx/skylark","skylark-langx/langx"],function(t,e){function n(){return n}return e.mixin(n,{off:!1,speeds:{normal:400,fast:200,slow:600}}),t.attach("domx.fx",n)}),define("skylark-domx-animates/animates",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser"],function(t,e,n){function r(){return r}return e.mixin(r,{off:!1,speeds:{normal:400,fast:200,slow:600},animationName:n.normalizeCssProperty("animation-name"),animationDuration:n.normalizeCssProperty("animation-duration"),animationDelay:n.normalizeCssProperty("animation-delay"),animationTiming:n.normalizeCssProperty("animation-timing-function"),animationEnd:n.normalizeCssEvent("AnimationEnd"),animateBaseClass:"animated"}),t.attach("domx.animates",r)}),define("skylark-domx-animates/animation",["skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-geom","skylark-domx-styler","skylark-domx-eventer","./animates"],function(t,e,n,r,i,s,o){var a=o.animationName,l=o.animationDuration,c=o.animationTiming,u=o.animationDelay,h=o.animationEnd,f={};return f[a]=f[l]=f[u]=f[c]="",o.animation=function(e,n,r,u,f,d){var p={};t.isPlainObject(r)&&(u=r.easing,f=r.complete,d=r.delay,r=r.duration);t.isString(r)&&(r=o.speeds[r]);void 0===r&&(r=o.speeds.normal);r/=1e3,t.isFunction(u)?(f=u,eace="swing"):u=u||"swing";d?d/=1e3:d=0;p[a]=n,p[l]=r+"s",p[c]=u,r>0&&s.on(e,h,f);return e.clientLeft,i.css(e,p),this}}),define("skylark-domx-fx/animate",["skylark-langx/langx","skylark-domx-transits/transit","skylark-domx-animates/animation","./fx"],function(t,e,n,r){return r.animate=function(r,i,s,o,a,l){return t.isString(i)?n(r,i,s,o,a,l):e(r,i,s,o,a,l)}}),define("skylark-domx-fx/bounce",["skylark-domx-transits","./fx"],function(t,e){return e.bounce=t.bounce}),define("skylark-domx-fx/emulateTransitionEnd",["skylark-domx-transits","./fx"],function(t,e){return e.emulateTransitionEnd=t.emulateTransitionEnd}),define("skylark-domx-fx/explode",["skylark-domx-transits","./fx"],function(t,e){return e.explode=t.explode}),define("skylark-domx-fx/fadeIn",["skylark-domx-transits","./fx"],function(t,e){return e.fadeIn=t.fadeIn}),define("skylark-domx-fx/fadeOut",["skylark-domx-transits","./fx"],function(t,e){return e.fadeOut=t.fadeOut}),define("skylark-domx-fx/fade",["skylark-domx-transits","./fx"],function(t,e){return e.fade=t.fade}),define("skylark-domx-fx/fadeToggle",["skylark-domx-transits","./fx"],function(t,e){return e.fadeToggle=t.fadeToggle}),define("skylark-domx-fx/hide",["skylark-domx-transits","./fx"],function(t,e){return e.hide=t.hide}),define("skylark-domx-fx/pulsate",["skylark-domx-transits","./fx"],function(t,e){return e.pulsate=t.pulsate}),define("skylark-domx-fx/shake",["skylark-domx-transits","./fx"],function(t,e){return e.shake=t.shake}),define("skylark-domx-fx/show",["skylark-domx-transits","./fx"],function(t,e){return e.show=t.show}),define("skylark-domx-fx/slide",["skylark-domx-transits","./fx"],function(t,e){return e.slide=function(t,n,r){langx.isFunction(n)&&(r=n,n={});var i=(n=n||{}).direction||"down",s="up"===i||"left"===i,o="up"===i||"down"===i,a=n.duration||e.speeds.normal,l=styler.css(t,"position");if(s){if(styler.isInvisible(t))return this}else styler.show(t),styler.css(t,{position:"absolute",visibility:"hidden"});if(o){var c=styler.css(t,"margin-top"),u=styler.css(t,"margin-bottom"),h=styler.css(t,"padding-top"),f=styler.css(t,"padding-bottom"),d=styler.css(t,"height");s?(styler.css(t,{visibility:"visible",overflow:"hidden",height:d,marginTop:c,marginBottom:u,paddingTop:h,paddingBottom:f}),animate(t,{height:0,marginTop:0,marginBottom:0,paddingTop:0,paddingBottom:0},{duration:a,queue:!1,complete:function(){styler.hide(t),styler.css(t,{visibility:"visible",overflow:"hidden",height:d,marginTop:c,marginBottom:u,paddingTop:h,paddingBottom:f}),r&&r.apply(t)}})):(styler.css(t,{position:l,visibility:"visible",overflow:"hidden",height:0,marginTop:0,marginBottom:0,paddingTop:0,paddingBottom:0}),animate(t,{height:d,marginTop:c,marginBottom:u,paddingTop:h,paddingBottom:f},{duration:a,complete:function(){r&&r.apply(t)}}))}else{var p=styler.css(t,"margin-left"),m=styler.css(t,"margin-right"),y=styler.css(t,"padding-left"),g=styler.css(t,"padding-right"),w=styler.css(t,"width");s?(styler.css(t,{visibility:"visible",overflow:"hidden",width:w,marginLeft:p,marginRight:m,paddingLeft:y,paddingRight:g}),animate(t,{width:0,marginLeft:0,marginRight:0,paddingLeft:0,paddingRight:0},{duration:a,queue:!1,complete:function(){styler.hide(t),styler.css(t,{visibility:"visible",overflow:"hidden",width:w,marginLeft:p,marginRight:m,paddingLeft:y,paddingRight:g}),r&&r.apply(t)}})):(styler.css(t,{position:l,visibility:"visible",overflow:"hidden",width:0,marginLeft:0,marginRight:0,paddingLeft:0,paddingRight:0}),animate(t,{width:w,marginLeft:p,marginRight:m,paddingLeft:y,paddingRight:g},{duration:a,complete:function(){r&&r.apply(t)}}))}return this}}),define("skylark-domx-fx/slideDown",["skylark-domx-transits","./fx"],function(t,e){return e.slideDown=function(t,e,n){return slide(t,{direction:"down",duration:e},n)}}),define("skylark-domx-fx/slideToggle",["skylark-domx-transits","./fx"],function(t,e){return e.slideToggle=function(t,e,n){0==geom.height(t)?slideDown(t,e,n):slideUp(t,e,n);return this}}),define("skylark-domx-fx/slideUp",["skylark-domx-transits","./fx"],function(t,e){return e.slideUp=function(t,e,n){return slide(t,{direction:"up",duration:e},n)}}),define("skylark-domx-fx/throb",["skylark-domx-noder","./fx"],function(t,e){return e.throb=t.throb}),define("skylark-domx-fx/toggle",["skylark-domx-transits","./fx"],function(t,e){return e.toggle=function(t,e,n){styler.isInvisible(t)?show(t,e,n):hide(t,e,n);return this}}),define("skylark-domx-fx/main",["./fx","./animate","./bounce","./emulateTransitionEnd","./explode","./fadeIn","./fadeOut","./fade","./fadeToggle","./hide","./pulsate","./shake","./show","./slide","./slideDown","./slideToggle","./slideUp","./throb","./toggle"],function(t){return t}),define("skylark-domx-fx",["skylark-domx-fx/main"],function(t){return t}),define("skylark-jquery/core",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-data","skylark-domx-eventer","skylark-domx-finder","skylark-domx-forms","skylark-domx-transits","skylark-domx-fx","skylark-domx-styler","skylark-domx-query","skylark-langx-scripter"],function(t,e,n,r,i,s,o,a,l,c,u,h,f){var d,p=Array.prototype.filter;Array.prototype.slice;return(d=h).fn.jquery="2.2.0",d.browser=n,d.camelCase=e.camelCase,d.cleanData=function(t){for(var e,n=0;void 0!==(e=t[n]);n++)i.cleanData(e)},d.removeData=function(t,e){i.removeData(t,e)},d.each=e.each,d.extend=e.extend,d.grep=function(t,e){return p.call(t,e)},d.attr=function(t,e){return i.attr(t,e)},d.isArray=e.isArray,d.isEmptyObject=e.isEmptyObject,d.isFunction=e.isFunction,d.isWindow=e.isWindow,d.isPlainObject=e.isPlainObject,d.isNumeric=e.isNumber,d.inArray=e.inArray,d.makeArray=e.makeArray,d.map=e.map,d.noop=function(){},d.parseJSON=window.JSON.parse,d.proxy=e.proxy,d.trim=e.trim,d.type=e.type,d.fn.extend=function(t){e.mixin(d.fn,t)},function(t){t.Event=function(t,n){if(e.isString(t)){var r=t;return s.create(r,n)}return s.proxy(t,n)},t.event={},t.event.special=s.special,t.fn.submit=function(e){if(0 in arguments)this.bind("submit",e);else if(this.length){var n=t.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this},t.fn.triggerHandler=t.fn.trigger,t.fn.delegate=function(t,e,n){return this.on(e,t,n)},t.fn.undelegate=function(t,e,n){return this.off(e,t,n)},t.fn.live=function(e,n){return t(document.body).delegate(this.selector,e,n),this},t.fn.die=function(e,n){return t(document.body).undelegate(this.selector,e,n),this},t.fn.bind=function(t,e,n,r){return this.on(t,e,n,r)},t.fn.unbind=function(t,e){return this.off(t,e)},t.fn.ready=function(t){return s.ready(t),this},t.fn.stop=function(){return this},t.fn.moveto=function(t,e){return this.transit({left:t+"px",top:e+"px"},.4)},t.ready=s.ready,t.on=s.on,t.off=s.off}(h),function(t){t.uuid=0,t.support=n.support,t.expr={},t.expr[":"]=t.expr.pseudos=t.expr.filters=o.pseudos,t.expr.createPseudo=function(t){return t},t.cssHooks=u.cssHooks,t.contains=r.contains,t.css=u.css,t.data=i.data,t.fx=c,t.fx.step={},t.speed=function(e,n,r){var i=e&&"object"==typeof e?t.extend({},e):{complete:r||!r&&n||t.isFunction(e)&&e,duration:e,easing:r&&n||n&&!t.isFunction(n)&&n};return t.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in t.fx.speeds?i.duration=t.fx.speeds[i.duration]:i.duration=t.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){t.isFunction(i.old)&&i.old.call(this),i.queue&&t.dequeue(this,i.queue)},i},t.easing={},t.offset={},t.offset.setOffset=function(e,n,r){var i=t.css(e,"position");"static"===i&&(e.style.position="relative");var s,o,a=t(e),l=a.offset(),c=t.css(e,"top"),u=t.css(e,"left"),h=("absolute"===i||"fixed"===i)&&t.inArray("auto",[c,u])>-1,f={},d={};h?(d=a.position(),s=d.top,o=d.left):(s=parseFloat(c)||0,o=parseFloat(u)||0),t.isFunction(n)&&(n=n.call(e,r,l)),null!=n.top&&(f.top=n.top-l.top+s),null!=n.left&&(f.left=n.left-l.left+o),"using"in n?n.using.call(e,f):a.css(f)},t._data=function(t,e){return t.hasAttribute?i.data(t,e):{}};var e=t.fn.text;t.fn.text=function(t){var n=e.apply(this,arguments);return void 0===n&&(n=""),n},t.fn.pos=t.fn.position}(h),h.parseHTML=function(t){return r.createFragment(t)},h.uniqueSort=h.unique=e.uniq,h.skylark=t,window.jQuery=window.$=h}),define("skylark-langx-emitter/emitter",["skylark-langx-events"],function(t){return t.Emitter}),define("skylark-langx-emitter/evented",["./emitter"],function(t){return t}),define("skylark-net-http/http",["skylark-langx-ns/ns"],function(t){return t.attach("net.http",{})}),define("skylark-net-http/xhr",["skylark-langx-ns/ns","skylark-langx-types","skylark-langx-objects","skylark-langx-arrays","skylark-langx-funcs","skylark-langx-async/deferred","skylark-langx-emitter/evented","skylark-langx-urls/is-cross-origin","./http"],function(skylark,types,objects,arrays,funcs,Deferred,Evented,isCrossOrigin,http){var each=objects.each,mixin=objects.mixin,noop=funcs.noop,isArray=types.isArray,isFunction=types.isFunction,isPlainObject=types.isPlainObject,type=types.type,getAbsoluteUrl=function(t){return a||(a=document.createElement("a")),a.href=t,a.href},a,Xhr=function(){var jsonpID=0,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/,XhrDefaultOptions={async:!0,type:"GET",beforeSend:noop,success:noop,error:noop,complete:noop,context:null,global:!0,accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0,processData:!1,cache:!0,traditional:!1,xhrFields:{}};function mimeToDataType(t){if(t&&(t=t.split(";",2)[0]),t){if(t==htmlType)return"html";if(t==jsonType)return"json";if(scriptTypeRE.test(t))return"script";if(xmlTypeRE.test(t))return"xml"}return"text"}function appendQuery(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function serializeData(t){t.data=t.data||t.query,t.processData&&t.data&&"string"!=type(t.data)&&(t.data=param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||("string"!=type(t.data)&&(t.data=param(t.data,t.traditional)),t.url=appendQuery(t.url,t.data),t.data=void 0)}function serialize(t,e,n,r){var i,s=isArray(e),o=isPlainObject(e);each(e,function(e,a){i=type(a),r&&(e=n?r:r+"["+(o||"object"==i||"array"==i?e:"")+"]"),!r&&s?t.add(a.name,a.value):"array"==i||!n&&"object"==i?serialize(t,a,n,e):t.add(e,a)})}var param=function(t,e){var n=[];return n.add=function(t,e){isFunction(e)&&(e=e()),null==e&&(e=""),this.push(encodeURIComponent(t)+"="+encodeURIComponent(e))},serialize(n,t,e),n.join("&").replace(/%20/g,"+")},Xhr=Evented.inherit({klassName:"Xhr",_request:function(args){var _=this._,self=this,options=mixin({},XhrDefaultOptions,_.options,args),xhr=_.xhr=new XMLHttpRequest;serializeData(options),options.beforeSend&&options.beforeSend.call(this,xhr,options);var dataType=options.dataType||options.handleAs,mime=options.mimeType||options.accepts[dataType],headers=options.headers,xhrFields=options.xhrFields,isFormData=options.data&&options.data instanceof FormData,basicAuthorizationToken=options.basicAuthorizationToken,type=options.type,url=options.url,async=options.async,user=options.user,password=options.password,deferred=new Deferred,contentType=options.contentType||!isFormData&&"application/x-www-form-urlencoded";if(xhrFields)for(name in xhrFields)xhr[name]=xhrFields[name];mime&&mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),mime&&xhr.overrideMimeType&&xhr.overrideMimeType(mime),"blob"!=dataType&&"arraybuffer"!=dataType||(xhr.responseType=dataType);var finish=function(){xhr.onloadend=noop,xhr.onabort=noop,xhr.onprogress=noop,xhr.ontimeout=noop,xhr=null},onloadend=function(){var result,error=!1;if(xhr.status>=200&&xhr.status<300||304==xhr.status||0==xhr.status&&getAbsoluteUrl(url).startsWith("file:")){dataType=dataType||mimeToDataType(options.mimeType||xhr.getResponseHeader("content-type"));try{"script"==dataType?eval(xhr.responseText):result="xml"==dataType?xhr.responseXML:"json"==dataType?blankRE.test(xhr.responseText)?null:JSON.parse(xhr.responseText):"blob"==dataType?xhr.response:"arraybuffer"==dataType?xhr.response:xhr.responseText}catch(t){error=t}error?deferred.reject(error,xhr.status,xhr):deferred.resolve(result,xhr.status,xhr)}else deferred.reject(new Error(xhr.statusText),xhr.status,xhr);finish()},onabort=function(){deferred&&deferred.reject(new Error("abort"),xhr.status,xhr),finish()},ontimeout=function(){deferred&&deferred.reject(new Error("timeout"),xhr.status,xhr),finish()},onprogress=function(t){deferred&&deferred.notify(t,xhr.status,xhr)};if(xhr.onloadend=onloadend,xhr.onabort=onabort,xhr.ontimeout=ontimeout,xhr.onprogress=onprogress,xhr.open(type,url,async,user,password),headers)for(var key in headers){var value=headers[key];"content-type"===key.toLowerCase()?contentType=value:xhr.setRequestHeader(key,value)}return contentType&&!1!==contentType&&xhr.setRequestHeader("Content-Type",contentType),headers&&"X-Requested-With"in headers||isCrossOrigin(url)||xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),basicAuthorizationToken&&xhr.setRequestHeader("Authorization",basicAuthorizationToken),xhr.send(options.data?options.data:null),deferred.promise},abort:function(){var t=this._,e=t.xhr;e&&e.abort()},request:function(t){return this._request(t)},get:function(t){return(t=t||{}).type="GET",this._request(t)},post:function(t){return(t=t||{}).type="POST",this._request(t)},patch:function(t){return(t=t||{}).type="PATCH",this._request(t)},put:function(t){return(t=t||{}).type="PUT",this._request(t)},del:function(t){return(t=t||{}).type="DELETE",this._request(t)},init:function(t){this._={options:t||{}}}});return["request","get","post","put","del","patch"].forEach(function(t){Xhr[t]=function(e,n){var r=new Xhr({url:e});return r[t](n)}}),Xhr.defaultOptions=XhrDefaultOptions,Xhr.param=param,Xhr}();return http.Xhr=Xhr}),define("skylark-jquery/ajax",["skylark-langx/langx","skylark-net-http/xhr","./core"],function(t,e,n){var r=0;function i(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function s(t,e,r,i){return n.isFunction(t)?(i=e,r=t,e=void 0,t=void 0):n.isFunction(e)&&(i=r,r=e,e=void 0),n.isFunction(r)||(i=r,r=void 0),{url:t,data:e,success:r,dataType:i}}n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){n.fn[e]=function(t){return this.on(e,t)}}),n.ajaxJSONP=function(e){var s,o,a=new t.Deferred,l=e.jsonpCallback,c=(n.isFunction(l)?l():l)||"jsonp"+ ++r,u=document.createElement("script"),h=window[c],f=function(t){n(u).triggerHandler("error",t||"abort")},d={abort:f};for(var p in e.data)e.url=i(e.url,p+"="+e.data[p]);return n(u).on("load error",function(t,e){clearTimeout(o),n(u).off().remove(),"error"!=t.type&&s?a.resolve(s[0],200,d):a.reject(t),window[c]=h,s&&n.isFunction(h)&&h(s[0]),h=s=void 0}),window[c]=function(){s=arguments},u.src=e.url.replace(/\?(.+)=\?/,"?$1="+c),document.head.appendChild(u),e.timeout>0&&(o=setTimeout(function(){f("timeout")},e.timeout)),a},n.ajaxSettings={processData:!0},n.ajax=function(r,s){if(r?s?s.url=r:s=t.isString(r)?{url:r}:r:s={url:"./"},"jsonp"==(s=t.mixin({},n.ajaxSettings,s)).dataType){var o=/\?.+=\?/.test(s.url);return o||(s.url=i(s.url,s.jsonp?s.jsonp+"=?":!1===s.jsonp?"":"callback=?")),n.ajaxJSONP(s)}var a=e.request(s.url,s);return(a=a.then(function(t,e,r){n(document).trigger("ajaxSucess"),s.success&&s.success.apply(this,arguments);s.complete&&s.complete.apply(this,arguments);return t},function(){n(document).trigger("ajaxError"),s.error&&s.error.apply(this,arguments)})).success=a.done,a.error=a.fail,a.complete=a.always,a},n.get=function(){return n.ajax(s.apply(null,arguments))},n.post=function(){var t=s.apply(null,arguments);return t.type="POST",n.ajax(t)},n.getJSON=function(){var t=s.apply(null,arguments);return t.dataType="json",n.ajax(t)};var o=n.fn.load;function a(t){return function(e,n){"string"!=typeof e&&(n=e,e="*");var r,i=0,s=e.toLowerCase().match(l)||[];if(jQuery.isFunction(n))for(;r=s[i++];)"+"===r[0]?(r=r.slice(1)||"*",(t[r]=t[r]||[]).unshift(n)):(t[r]=t[r]||[]).push(n)}}n.fn.load=function(t,e,r){if("string"!=typeof t&&o)return o.apply(this,arguments);if(!this.length)return this;var i,a=this,l=s(t,e,r),c=l.url&&l.url.split(/\s/),u=l.success;return c&&c.length>1&&(l.url=c[0],i=c[1]),l.data&&"object"==typeof l.data&&(l.type="POST"),l.success=function(t){a.html(i?n("<div>").html(t.replace(rscript,"")).find(i):t),u&&u.apply(a,arguments)},n.ajax(l),this},n.param=e.param;var l=/\S+/g;return n.ajaxPrefilter=a({}),n.ajaxTransport=a({}),n.ajaxSetup=function(n,r){t.mixin(e.defaultOptions,n,r)},n.getScript=function(t,e){return n.get(t,void 0,e,"script")},n}),define("skylark-jquery/callbacks",["./core"],function(t){return t.Callbacks=function(e){var n,r,i,s,o,a,l=[],c=!(e=t.extend({},e)).once&&[],u=function(t){for(n=e.memory&&t,r=!0,a=s||0,s=0,o=l.length,i=!0;l&&a<o;++a)if(!1===l[a].apply(t[0],t[1])&&e.stopOnFalse){n=!1;break}i=!1,l&&(c?c.length&&u(c.shift()):n?l.length=0:h.disable())},h={add:function(){if(l){var r=l.length,a=function(n){t.each(n,function(t,n){"function"==typeof n?e.unique&&h.has(n)||l.push(n):n&&n.length&&"string"!=typeof n&&a(n)})};a(arguments),i?o=l.length:n&&(s=r,u(n))}return this},remove:function(){return l&&t.each(arguments,function(e,n){for(var r;(r=t.inArray(n,l,r))>-1;)l.splice(r,1),i&&(r<=o&&--o,r<=a&&--a)}),this},has:function(e){return!(!l||!(e?t.inArray(e,l)>-1:l.length))},empty:function(){return o=l.length=0,this},disable:function(){return l=c=n=void 0,this},disabled:function(){return!l},lock:function(){return c=void 0,n||h.disable(),this},locked:function(){return!c},fireWith:function(t,e){return!l||r&&!c||(e=[t,(e=e||[]).slice?e.slice():e],i?c.push(e):u(e)),this},fire:function(){return h.fireWith(this,arguments)},fired:function(){return!!r}};return h},t}),define("skylark-jquery/deferred",["./core","skylark-langx/langx"],function(t,e){return t.Deferred=function(){var t=new e.Deferred,n={promise:function(){return t.promise}};return["resolve","resolveWith","reject","rejectWith","notify","then","done","fail","progress","always","state"].forEach(function(e){n[e]=function(){var r=t[e].apply(t,arguments);return r==t&&(r=n),r}}),n},t.when=function(){var t=e.Deferred.all(e.makeArray(arguments)),n=t.then;return t.then=function(e,r){return n.call(t,function(t){return e&&e.apply(null,t)},r)},t},t}),define("skylark-jquery/queue",["skylark-langx/langx","./core","./callbacks"],function(t,e){var n="Sky"+("1.0"+Math.random()).replace(/\D/g,""),r=/\S+/g,i=[].push;function s(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n+Math.random()}s.uid=1,s.accepts=function(t){return!t.nodeType||(1===t.nodeType||9===t.nodeType)},s.prototype={key:function(t){if(!s.accepts(t))return 0;var n={},r=t[this.expando];if(!r){r=s.uid++;try{n[this.expando]={value:r},Object.defineProperties(t,n)}catch(i){n[this.expando]=r,e.extend(t,n)}}return this.cache[r]||(this.cache[r]={}),r},set:function(t,n,r){var i,s=this.key(t),o=this.cache[s];if("string"==typeof n)o[n]=r;else if(e.isEmptyObject(o))e.extend(this.cache[s],n);else for(i in n)o[i]=n[i];return o},get:function(t,e){var n=this.cache[this.key(t)];return void 0===e?n:n[e]},access:function(t,n,r){var i;return void 0===n||n&&"string"==typeof n&&void 0===r?void 0!==(i=this.get(t,n))?i:this.get(t,e.camelCase(n)):(this.set(t,n,r),void 0!==r?r:n)},remove:function(t,n){var i,s,o,a=this.key(t),l=this.cache[a];if(void 0===n)this.cache[a]={};else{e.isArray(n)?s=n.concat(n.map(e.camelCase)):(o=e.camelCase(n),s=n in l?[n,o]:(s=o)in l?[s]:s.match(r)||[]),i=s.length;for(;i--;)delete l[s[i]]}},hasData:function(t){return!e.isEmptyObject(this.cache[t[this.expando]]||{})},discard:function(t){t[this.expando]&&delete this.cache[t[this.expando]]}};var o=new s;return e.extend(e,{queue:function(t,n,r){var i;if(t)return n=(n||"fx")+"queue",i=o.get(t,n),r&&(!i||e.isArray(r)?i=o.access(t,n,e.makeArray(r)):i.push(r)),i||[]},dequeue:function(t,n){n=n||"fx";var r=e.queue(t,n),i=r.length,s=r.shift(),o=e._queueHooks(t,n);"inprogress"===s&&(s=r.shift(),i--),s&&("fx"===n&&r.unshift("inprogress"),delete o.stop,s.call(t,function(){e.dequeue(t,n)},o)),!i&&o&&o.empty.fire()},_queueHooks:function(t,n){var r=n+"queueHooks";return o.get(t,r)||o.access(t,r,{empty:e.Callbacks("once memory").add(function(){o.remove(t,[n+"queue",r])})})},makeArray:function(t,n){var r=n||[];return null!=t&&(!function(t){var n=t.length,r=e.type(t);if(e.isWindow(t))return!1;if(1===t.nodeType&&n)return!0;return"array"===r||"function"!==r&&(0===n||"number"==typeof n&&n>0&&n-1 in t)}(Object(t))?i.call(r,t):e.merge(r,"string"==typeof t?[t]:t)),r},merge:function(t,e){var n=e.length,r=t.length,i=0;if("number"==typeof n)for(;i<n;i++)t[r++]=e[i];else for(;void 0!==e[i];)t[r++]=e[i++];return t.length=r,t}}),e.extend(e.fn,{queue:function(t,n){var r=2;return"string"!=typeof t&&(n=t,t="fx",r--),arguments.length<r?e.queue(this[0],t):void 0===n?this:this.each(function(){var r=e.queue(this,t,n);e._queueHooks(this,t),"fx"===t&&"inprogress"!==r[0]&&e.dequeue(this,t)})},dequeue:function(t){return this.each(function(){e.dequeue(this,t)})},delay:function(t,n){return t=e.fx&&e.fx.speeds[t]||t,n=n||"fx",this.queue(n,function(e,n){var r=setTimeout(e,t);n.stop=function(){clearTimeout(r)}})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,n){var r,i=1,s=e.Deferred(),a=this,l=this.length,c=function(){--i||s.resolveWith(a,[a])};for("string"!=typeof t&&(n=t,t=void 0),t=t||"fx";l--;)(r=o.get(a[l],t+"queueHooks"))&&r.empty&&(i++,r.empty.add(c));return c(),s.promise(n)}}),e}),define("skylark-domx-plugins-base/plugins",["skylark-langx-ns"],function(t){"use strict";return t.attach("domx.plugins",{pluginKlasses:{},shortcuts:{}})}),define("skylark-langx-events/Emitter",["skylark-langx-types","skylark-langx-objects","skylark-langx-arrays","skylark-langx-klass","./events","./event","./listener"],function(t,e,n,r,i,s,o){var a=Array.prototype.slice,l=n.compact,c=t.isDefined,u=t.isPlainObject,h=t.isFunction,f=t.isString,d=(t.isEmptyObject,e.mixin);e.safeMixin;function p(t){var e=(""+t).split(".");return{name:e[0],ns:e.slice(1).join(" ")}}var m=new Map,y=o.inherit({_prepareArgs:function(t,e){return e=c(e)?[t].concat(e):[t]},on:function(t,e,n,r,i,s){var o=this,a=this._hub||(this._hub={});if(u(t))return i=r,each(t,function(t,r){o.on(t,e,n,r,i,s)}),this;if(f(e)||h(r)||(i=r,r=n,n=e,e=void 0),h(n)&&(i=r,r=n,n=null),!r)throw new Error("No callback function");if(!h(r))throw new Error("The callback  is not afunction");return f(t)&&(t=t.split(/\s/)),t.forEach(function(t){var o=p(t),l=o.name,c=o.ns;(a[l]||(a[l]=[])).push({fn:r,selector:e,data:n,ctx:i,ns:c,one:s})}),this},one:function(t,e,n,r,i){return this.on(t,e,n,r,i,1)},emit:function(t){if(!this._hub)return this;var e=this;f(t)&&(t=new s(t)),Object.defineProperty(t,"target",{value:this});var n=a.call(arguments,1);return n=this._prepareArgs(t,n),[t.type||t.name,"all"].forEach(function(r){var i=p(r),s=i.name,o=i.ns,a=e._hub[s];if(a){for(var c=a.length,h=!1,f=0;f<c;f++){if(t.isImmediatePropagationStopped&&t.isImmediatePropagationStopped())return this;var m=a[f];(!o||m.ns&&m.ns.startsWith(o))&&(m.data&&(t.data=d({},m.data,t.data)),2==n.length&&u(n[1])&&(t.data=t.data||{},d(t.data,n[1])),m.fn.apply(m.ctx,n),m.one&&(a[f]=null,h=!0))}h&&(e._hub[r]=l(a))}}),this},queueEmit:function(t){const e=t.type||t;let n=m.get(this);n||(n=new Map,m.set(this,n));const r=n.get(e);n.delete(e),window.clearTimeout(r);const i=window.setTimeout(()=>{0===n.size&&(n=null,m.delete(this)),this.trigger(t)},0);n.set(e,i)},listened:function(t){var e=(this._hub||(this._events={}))[t]||[];return e.length>0},off:function(t,e){if(t){var n=this._hub||(this._hub={});return f(t)&&(t=t.split(/\s/)),t.forEach(function(t){var r=p(t),i=r.name,s=r.ns,o=n[i];if(o){var a=[];if(e||s)for(var l=0,c=o.length;l<c;l++)e&&o[l].fn!==e&&o[l].fn._!==e?a.push(o[l]):!s||o[l].ns&&0==o[l].ns.indexOf(s)||a.push(o[l]);a.length?n[i]=a:delete n[i]}}),this}this._hub=null},trigger:function(){return this.emit.apply(this,arguments)},queueTrigger:function(t){return this.queueEmit.apply(this,arguments)}});return i.Emitter=y}),define("skylark-domx-animates/animate",["skylark-langx/langx","skylark-domx-styler","skylark-domx-eventer","./animates"],function(t,e,n,r){return r.animate=function(i,s,o){if(t.isString(s)){let t=s;return r.animateBaseClass&&(t=r.animateBaseClass+" "+t),e.addClass(i,t),n.one(i,r.animationEnd,function(){e.removeClass(i,t)}),this}return i.animate(s,o)}}),define("skylark-domx-animates/main",["./animates","skylark-domx-velm","skylark-domx-query","./animation","./animate"],function(t,e,n){return e.delegate(["animate"],t),n.fn.animate=n.wraps.wrapper_every_act(t.animate,t),t}),define("skylark-domx-animates",["skylark-domx-animates/main"],function(t){return t}),define("skylark-domx/animates",["skylark-domx-animates"],function(t){return t}),define("skylark-domx/browser",["skylark-domx-browser"],function(t){"use strict";return t}),define("skylark-domx-css/css",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-noder"],function(t,e,n){"use strict";var r,i=document.getElementsByTagName("head")[0],s=0,o={},a={},l=d(),c=a[l],u="cssRules"in c?"cssRules":"rules",h=c.deleteRule||c.removeRule;if(c.insertRule){var f=c.insertRule;r=function(t,e,n){f.call(this,t+"{"+e+"}",n)}}else r=c.addRule;function d(t,r){var o,l={type:"text/css"},c=s++;return(r=r||{}).media&&(l.media=r.media),o=t?n.create("link",e.mixin(l,{rel:"stylesheet",async:!1})):n.createElement("style",l),n.append(i,o),a[c]={id:c,node:o},c}function p(t,n){var r=a[t];return e.isNumber(n)?h.call(r,n):e.each(r[u],function(t,e){if(n===e)return h.call(r,t),!1}),this}function m(t,r){var i,s=a[t];return i=e.isString(r)?r:g(r),n.append(s.node,n.createTextNode(i)),this}function y(t){return t.startsWith("@")}function g(t){var n=function(t,e,n){return t&&(y(t)?n+=1:e=t+" "+e),{name:e,depth:n}},r=function(t,i,s){var o="",a=y(t);if(y(t))e.isString(i)?o=w.SPACE.repeat(s)+t.trim()+' "'+i.trim()+' ";\n':(o+=w.SPACE.repeat(s)+t.trim()+" {\n",o+=r("",i,s+1),o+=w.SPACE.repeat(s)+" }\n");else if(e.isString(i))o=w.SPACE.repeat(s)+t.trim(),o=a?o+' "'+i.trim()+' ";\n':o+": "+i.trim()+";\n";else if(e.isArray(i))for(var l=0;l<i.length;l++)o+=r(t,i[l],s);else{if(t){for(var l in o+=w.SPACE.repeat(s)+t.trim()+" {\n",i){var c=i[l];e.isString(c)&&(o+=r(l,c,s+1))}o+=w.SPACE.repeat(s)+"}\n"}for(var l in i){var c=i[l];if(!e.isString(c)){var u=n(t,l,s);o+=r(u.name,c,u.depth)}}}return o};return r("",t,0)}function w(){return w}return e.mixin(w,{SPACE:"\t",addRules:function(t){return this.addRules(l,t)},addSheetRules:m,createStyleSheet:function(t,e){e||(e={});var n=d(!1,e);t&&m(n,t);return n},deleteSheetRule:p,deleteRule:function(t){return p(l,t),this},insertRule:function(t,e,n){return this.insertSheetRule(l,t,e,n)},insertSheetRule:function(t,e,n,i){if(!e||!n)return-1;var s=a[t];return i=i||s[u].length,r.call(s,e,n,i)},loadStyleSheet:function(t,n,r,i){e.isFunction(n)&&(i=r,r=n,n={});var s=o[t];if(!s){var l=d(!0,n);s=o[t]=a[l],e.mixin(s,{state:0,url:t,deferred:new e.Deferred});var c=s.node;startTime=(new Date).getTime(),c.onload=function(){s.state=1,s.deferred.resolve(s.id)},c.onerror=function(t){s.state=-1,s.deferred.reject(t)},c.href=s.url}(r||i)&&s.deferred.promise.then(r,i);return s.id},removeStyleSheet:function(t){if(t===l)throw new Error("The default stylesheet can not be deleted");var e=a[t];return delete a[t],n.remove(e.node),this},toString:g}),t.attach("domx.css",w)}),define("skylark-domx-css/main",["./css"],function(t){return t}),define("skylark-domx-css",["skylark-domx-css/main"],function(t){return t}),define("skylark-domx/css",["skylark-domx-css"],function(t){"use strict";return t}),define("skylark-domx/data",["skylark-domx-data"],function(t){return t}),define("skylark-domx/eventer",["skylark-domx-eventer"],function(t){return t}),define("skylark-domx/finder",["skylark-domx-finder"],function(t){return t}),define("skylark-domx/fx",["skylark-domx-fx"],function(t){return t}),define("skylark-domx/geom",["skylark-domx-geom"],function(t){return t}),define("skylark-domx-iframes/iframes",["skylark-langx-ns"],function(t){return t.attach("domx.iframes")}),define("skylark-domx-iframes/create",["skylark-domx-noder","./iframes"],function(t,e){"use strict";return e.create=function(e,n){let r={},i={};(e=e||{}).id&&(r.id=e.id);e.url&&(r.src=e.url);e.style&&(r.style=e.style);e.onload&&(r.onload=e.onload);e.onerror&&(r.onload=e.onerror);e.className&&(r.className=e.className);e.sandbox&&(i.sandbox=e.sandbox);e.frameBorder&&(i.frameBorder=e.frameBorder);e.name&&(i.name=e.name);let s=t.create("iframe",r,i,n);e.contentWindowName&&(s.contentWindow.name=e.contentWindowName);return s}}),define("skylark-domx-iframes/hook-sizing",["skylark-domx-eventer","./iframes"],function(t,e){"use strict";return e.hookSizing=function(e){t.on(window,"message",function(t){t||(t=window.event);e.style.height=1*t.data.height+2+"px"})}}),define("skylark-domx-iframes/load-real",["skylark-domx-noder","skylark-domx-data","./iframes","./hook-sizing"],function(t,e,n,r){return n.loadReal=function(n,r){r=r||{};var i=t.clone(n),s=r.url;s||(s=e.attr(i,r.urlAttrName||"data-url"));s=s.split("&")[0],e.prop(i,"src",s),e.prop(i,"_src",s),t.replace(i,ifame)}}),define("skylark-domx-iframes/lazy-load",["skylark-domx-eventer","skylark-domx-data","skylark-domx-geom","./iframes","./load-real"],function(t,e,n,r,i){var s;function o(){s||(s=[],t.on(window,"scroll",function(){!function(){var t=0,e=[];for(t=0;t<s.length;t++)n.inview(s[t],400)&&e.unshift({iframe:s[t],i:t});for(t=e.length-1;t>=0;t--)s.splice(e[t].i,1),i(e[t].iframe)}()}))}return r.lazyLoad=function(t,n){o(),(n=n||{}).url&&e.attr(t,n.urlAttrName||"data-url",n.url);n.holdingUrl&&e.prop(t,"src",n.holdingUrl);s.push(t)}}),define("skylark-domx-iframes/replace",["skylark-langx-urls/get-query","skylark-domx-noder","skylark-domx-geom","skylark-domx-styler","./iframes","./create","./load-real","./lazy-load"],function(t,e,n,r,i,s,o,a){"use strict";return i.replace=function(i,l){l=l||{};s({className:i.className,id:i.id,style:{border:"1px solid #aaa"}});var c=l.url||i.href,u=l.size||t(i.search),h=l.holdingUrl;r.css(iframe,"width",u.width||"100%"),r.css(iframe,"minHeight",u.height||"300px"),u.height&&r.css(iframe,"maxHeight",u.height);n.inview(i,100)?o(iframe,{url:c}):a(iframe,{url:c,holdingUrl:h});e.replace(iframe,i)}}),define("skylark-domx-iframes/main",["./iframes","./create","./lazy-load","./load-real","./replace"],function(){}),define("skylark-domx-iframes",["skylark-domx-iframes/main"],function(t){return t}),define("skylark-domx/iframes",["skylark-domx-iframes"],function(t){return t}),define("skylark-domx-lists/lists",["skylark-langx-ns","skylark-domx-query","skylark-domx-data","skylark-domx-geom","skylark-domx-finder","skylark-domx-noder","skylark-domx-styler"],function(t){return t.attach("domx.lists")}),define("skylark-domx-lists/multitier",["skylark-langx","skylark-domx-query","./lists"],function(t,e,n){"use strict";return n.multitier=function(n,r){var i=(r=t.mixin({classes:{active:"active",collapse:"collapse",in:"in"},selectors:{item:"li",sublist:"ul",hasSublist:":has(ul)",handler:" > a"},mode:"",levels:2,togglable:!1,multiExpand:!1},r,!0)).selectors.item,s=e(i,n),o=r.classes.active,a="."+o,l=(r.mode,r.selectors.sublist),c=r.togglable,u=r.multiExpand,h=r.selectors.handler,f=r.classes.collapse,d=r.classes.in,p=r.show||function(t){t.addClass(d)},m=r.hide||function(t){t.addClass(f).removeClass(d)};r.toggle;s.find(h).on("click.multitier",function(t){t.preventDefault();let n,s=e(this).closest(i);u||(n=s.siblings().removeClass(o).children(l))&&m(n);let a=s.hasClass(o);a&&!c||(n=s.children(r.selectors.sublist),a?(s.removeClass(o),m(n)):(s.addClass(o),p(n)))}),m(s.has(l).children(l)),p(s.filter(a).has(l).children(l))}}),define("skylark-domx-lists/main",["./lists","./multitier"],function(t){return t}),define("skylark-domx-lists",["skylark-domx-lists/main"],function(t){return t}),define("skylark-domx/lists",["skylark-domx-lists"],function(t){return t}),define("skylark-domx/noder",["skylark-domx-noder"],function(t){return t}),define("skylark-domx/styler",["skylark-domx-styler"],function(t){return t}),define("skylark-domx/query",["skylark-domx-query","./data","./eventer","./fx","./geom","./styler"],function(t){return t}),define("skylark-domx-transforms/transforms",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-data","skylark-domx-styler"],function(t,e,n,r,i){var s=n.normalizeCssProperty("transform");function o(t,e){return t>0&&t>-e?e:t<0&&t<e?-e:0}function a(t,e){var n,r,o,a,l,c=(n=e.radian,r=e.y,o=e.x,a=Math.cos(n),l=Math.sin(n),{M11:a*r,M12:-l*o,M21:l*r,M22:a*o});i.css(t,s,"matrix("+c.M11.toFixed(16)+","+c.M21.toFixed(16)+","+c.M12.toFixed(16)+","+c.M22.toFixed(16)+", 0, 0)")}function l(t,e){if(!e)return(e=r.data(t,"transform")||{}).radian=e.radian||0,e.x=e.x||1,e.y=e.y||1,e.zoom=e.zoom||1,e;r.data(t,"transform",e)}var c={vertical:function(t){t.radian=Math.PI-t.radian,t.y*=-1},horizontal:function(t){t.radian=Math.PI-t.radian,t.x*=-1},rotate:function(t,e){t.radian=e*Math.PI/180},left:function(t){t.radian-=Math.PI/2},right:function(t){t.radian+=Math.PI/2},scale:function(t,e){var n=o(t.y,e),r=o(t.x,e);n&&r&&(t.y+=n,t.x+=r)},zoomin:function(t){c.scale(t,.1)},zoomout:function(t){c.scale(t,-.1)}};function u(){return u}return["vertical","horizontal","rotate","left","right","scale","zoom","zoomin","zoomout"].forEach(function(t){var n;u[t]=(n=c[t],function(){var t=e.makeArray(arguments),r=t.shift(),i=l(r);t.unshift(i),n.apply(this,t),a(r,i),l(r,i)})}),e.mixin(u,{reset:function(t){var e={x:1,y:1,radian:0};a(t,e),l(t,e)},matrix:function(t){var e="";do{var n=i.css(t,"transform");n&&"none"!==n&&(e=n+" "+e)}while(t=t.parentElement);if(window.DOMMatrix)return new DOMMatrix(e);if(window.WebKitCSSMatrix)return new WebKitCSSMatrix(e);if(window.CSSMatrix)return new CSSMatrix(e)}}),t.attach("domx.transforms",u)}),define("skylark-domx-transforms/main",["./transforms"],function(t){return t}),define("skylark-domx-transforms",["skylark-domx-transforms/main"],function(t){return t}),define("skylark-domx/transforms",["skylark-domx-transforms"],function(t){return t}),define("skylark-domx/transits",["skylark-domx-transits"],function(t){return t}),define("skylark-domx/velm",["skylark-domx-velm","./data","./eventer","./fx","./geom","./styler"],function(t){return t}),define("skylark-domx/main",["./animates","./browser","./css","./data","./eventer","./finder","./fx","./geom","./iframes","./lists","./noder","./query","./styler","./transforms","./transits","./velm"],function(t,e,n,r,i,s,o,a,l,c,u,h,f,d,p,m){return{animates:t,browser:e,css:n,data:r,eventer:i,finder:s,geom:a,lists:c,noder:u,iframes:l,query:h,styler:f,transforms:d,transits:p,velm:m}}),define("skylark-domx",["skylark-domx/main"],function(t){return t}),define("skylark-domx-plugins-base/plugin",["skylark-langx-ns","skylark-langx-types","skylark-langx-objects","skylark-langx-funcs","skylark-langx-events/Emitter","skylark-domx-noder","skylark-domx-data","skylark-domx-eventer","skylark-domx-finder","skylark-domx-geom","skylark-domx-styler","skylark-domx-fx","skylark-domx-query","skylark-domx-velm","skylark-domx","./plugins"],function(t,e,n,r,i,s,o,a,l,c,u,h,f,d,p,m){"use strict";Array.prototype.slice,Array.prototype.concat;function y(t){return t.hasOwnProperty("superclass")?t.superclass:Object.getPrototypeOf(t)}var g=i.inherit({klassName:"Plugin",_domx:p,_construct:function(t,e){this._elm=t,this._initOptions(e)},_initOptions:function(t){var e=this.constructor,r=e.cache=e.hasOwnProperty("cache")?e.cache:{},i=r.defaults;if(!i){var s=[];do{if(s.unshift(e),e===g)break;e=y(e)}while(e);i=r.defaults={};for(var o=0;o<s.length;o++)(e=s[o]).prototype.hasOwnProperty("options")&&n.mixin(i,e.prototype.options,!0),e.hasOwnProperty("options")&&n.mixin(i,e.options,!0)}return Object.defineProperty(this,"options",{value:n.mixin({},i,t,!0)}),this.options},destroy:function(){this._destroy(),this.unlistenTo(),o.removeData(this._elm,this.pluginName)},_destroy:r.noop,_delay:function(t,e){var n=this;return setTimeout(function(){return("string"==typeof t?n[t]:t).apply(n,arguments)},e||0)},elmx:function(t){return t?d(t):(this._velm||(this._velm=d(this._elm)),this._velm)},$:function(t){return t?f(t,this._elm):(this._$elm||(this._$elm=f(this._elm)),this._$elm)},option:function(t,e){var r,i,s,o=t;if(0===arguments.length)return n.mixin({},this.options);if("string"==typeof t)if(o={},r=t.split("."),t=r.shift(),r.length){for(i=o[t]=n.mixin({},this.options[t]),s=0;s<r.length-1;s++)i[r[s]]=i[r[s]]||{},i=i[r[s]];if(t=r.pop(),1===arguments.length)return void 0===i[t]?null:i[t];i[t]=e}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=e}return this._setOptions(o),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,this},getUID:function(t){t=t||"plugin";do{t+=~~(1e6*Math.random())}while(document.getElementById(t));return t},elm:function(){return this._elm}});return m.Plugin=g}),define("skylark-domx-plugins-base/instantiate",["skylark-domx-data","./plugins","./plugin"],function(t,e,n){"use strict";var r=e.pluginKlasses;function i(e,n,i){var s=n.split(":"),o=s[1];n=s[0],o||(o=n);var a=t.data(e,o);if("instance"===i)return a;if("destroy"===i){if(!a)throw new Error("The plugin instance is not existed");a.destroy(),a=void 0}else if(a)i&&a.reset(i);else{if(void 0!==i&&"object"!=typeof i)throw new Error("The options must be a plain object");var l=r[n];a=new l(e,i),t.data(e,o,a)}return a}return n.instantiate=function(t,e){return i(t,this.prototype.pluginName,e)},e.instantiate=i}),define("skylark-domx-plugins-base/shortcutter",["skylark-langx-types","./plugins","./instantiate"],function(t,e,n){"use strict";var r=Array.prototype.slice;return e.shortcutter=function(e,i){return function(s,o){var a=n(s,e,"instance");if("instance"===o)return a||null;if(!a&&(a=n(s,e,"object"==typeof o&&o||{}),"string"!=typeof o))return this;if(o){var l=r.call(arguments,1);if(i)return i.apply(a,l);if("string"==typeof o){var c=o;if(!a)throw new Error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+c+"'");if(!t.isFunction(a[c])||"_"===c.charAt(0))throw new Error("no such method '"+c+"' for "+e+" plugin instance");l=r.call(l,1);var u=a[c].apply(a,l);return u==a&&(u=void 0),u}}}}}),define("skylark-domx-plugins-base/register",["skylark-langx-types","skylark-domx-query","skylark-domx-velm","./plugins","./shortcutter"],function(t,e,n,r,i){"use strict";var s=Array.prototype.slice,o=r.pluginKlasses,a=r.shortcuts;return r.register=function(r,l,c,u){var h=r.prototype.pluginName;if(o[h]=r,l){c&&t.isFunction(c)&&(u=c,c=null),c&&(h=h+":"+c);var f=a[l]=i(h,u);e.fn[l]=function(t){var e=this;if(this.length||"instance"!==t){var n=s.call(arguments);this.each(function(){var t=s.call(n);t.unshift(this);var r=f.apply(void 0,t);void 0!==r&&(e=r)})}else e=void 0;return e},n.partial(l,function(t){var e=f(this._elm,t);return void 0===e&&(e=this),e})}}}),define("skylark-domx-plugins-base/main",["skylark-domx-query","skylark-domx-velm","./plugins","./instantiate","./plugin","./register","./shortcutter"],function(t,e,n,r,i,s,o){"use strict";var a=Array.prototype.slice;return t.fn.plugin=function(t,e){var n,i=a.call(arguments,1),s=this;return this.each(function(){n=r.apply(s,[this,t].concat(i))}),n},e.partial("plugin",function(t,e){var n=a.call(arguments,1);return r.apply(this,[this._elm,t].concat(n))}),n}),define("skylark-domx-plugins-base",["skylark-domx-plugins-base/main"],function(t){return t}),define("skylark-jquery/jquery-plugin",["skylark-langx-types","skylark-langx-objects","skylark-langx-arrays","skylark-langx/langx","skylark-domx-data","skylark-domx-eventer","skylark-domx-plugins-base","skylark-domx-query"],function(t,e,n,r,i,s,o,a){var l=0,c=o.Plugin.inherit({klassName:"JqPlugin",pluginEventPrefix:"",options:{create:null},destroy:function(){this.overrided(),this.element.off(this.eventNamespace),this.bindings.off(this.eventNamespace)},_construct:function(t,e){t=a(t||this.defaultElement||this)[0],this.element=a(t),this.uuid=l++,this.eventNamespace="."+this.pluginName+this.uuid,this.bindings=a(),this.classesElementLookup={},this.hoverable=a(),this.focusable=a(),t!==this&&(i.data(t,this.pluginName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=a(t.style?t.ownerDocument:t.document||t),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this.overrided(t,e),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_initOptions:function(t){t=r.mixin(this._getCreateOptions(),t),this.overrided(t)},_getCreateOptions:function(){return{}},_getCreateEventData:r.noop,_super:function(){if(this.overrided)return this.overrided.apply(this,arguments)},_superApply:function(t){if(this.overrided)return this.overrided.apply(this,t)},_create:r.noop,_init:r.noop,_classes:function(t){var n=[],i=this;function s(e,s){var o,l;for(l=0;l<e.length;l++)o=i.classesElementLookup[e[l]]||a(),t.add?(t.element.each(function(t,e){var n=r.map(i.classesElementLookup,function(t){return t}).some(function(t){return a(t).is(e)});n||i._on(a(e),{remove:"_untrackClassesElement"})}),o=a(r.uniq(o.get().concat(t.element.get())))):o=a(o.not(t.element).get()),i.classesElementLookup[e[l]]=o,n.push(e[l]),s&&t.classes[e[l]]&&n.push(t.classes[e[l]])}return(t=e.mixin({element:this.element,classes:this.options.classes||{}},t)).keys&&s(t.keys.match(/\S+/g)||[],!0),t.extra&&s(t.extra.match(/\S+/g)||[]),n.join(" ")},_untrackClassesElement:function(t){var e=this;r.each(e.classesElementLookup,function(r,i){-1!==n.inArray(t.target,i)&&(e.classesElementLookup[r]=a(i.not(t.target).get()))}),this._off(a(t.target))},_removeClass:function(t,e,n){return this._toggleClass(t,e,n,!1)},_addClass:function(t,e,n){return this._toggleClass(t,e,n,!0)},_toggleClass:function(t,e,n,r){r="boolean"==typeof r?r:n;var i="string"==typeof t||null===t,s={extra:i?e:n,keys:i?t:e,element:i?this.element:t,add:r};return s.element.toggleClass(this._classes(s),r),this},_on:function(t,n,r){var i,s=this;"boolean"!=typeof t&&(r=n,n=t,t=!1),r?(n=i=a(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(e,r){function o(){if(t||!0!==s.options.disabled&&!a(this).hasClass("ui-state-disabled"))return("string"==typeof r?s[r]:r).apply(s,arguments)}"string"!=typeof r&&(o.guid=r.guid=r.guid||o.guid||a.guid++);var l=e.match(/^([\w:-]*)\s*(.*)$/),c=l[1]+s.eventNamespace,u=l[2];u?i.on(c,u,o):n.on(c,o)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.off(e),this.bindings=a(this.bindings.not(t).get()),this.focusable=a(this.focusable.not(t).get()),this.hoverable=a(this.hoverable.not(t).get())},_trigger:function(e,n,r){var i,o,a=this.options[e];if(r=r||{},(n=s.proxy(n)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),n.target=this.element[0],o=n.originalEvent)for(i in o)i in n||(n[i]=o[i]);return this.element.trigger(n,r),!(t.isFunction(a)&&!1===a.apply(this.element[0],[n].concat(r))||n.isDefaultPrevented())},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){this._addClass(a(t.currentTarget),null,"ui-state-hover")},mouseleave:function(t){this._removeClass(a(t.currentTarget),null,"ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){this._addClass(a(t.currentTarget),null,"ui-state-focus")},focusout:function(t){this._removeClass(a(t.currentTarget),null,"ui-state-focus")}})},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})}});return c}),define("skylark-jquery/widget",["skylark-langx/langx","skylark-domx-plugins-base","./core","./jquery-plugin"],function(t,e,n,r){var i,s=Array.prototype.hasOwnProperty,o=Array.prototype.slice;return n.cleanData=(i=n.cleanData,function(t){var e,r,s;for(s=0;null!=(r=t[s]);s++)(e=n._data(r,"events"))&&e.remove&&n(r).triggerHandler("remove");i(t)}),n.widget=function(t,r,i){var s,o,a=t.split(".")[0];t=t.split(".")[1];var l=a+"-"+t;i||(i=r,r=n.Widget),n.isArray(i)&&(i=n.extend.apply(null,[{}].concat(i))),n.expr.pseudos[l.toLowerCase()]=function(t){return!!n.data(t,l)},n[a]=n[a]||{},s=n[a][t];var c=r.prototype,u={};for(var h in i){var f=i[h];n.isPlainObject(f)?u[h]=n.isPlainObject(c[h])?n.widget.extend({},c[h],f):n.widget.extend({},f):u[h]=f}var d=n.widget.extend({widgetEventPrefix:s&&r.prototype.widgetEventPrefix||t},{options:r.prototype.options},u,{name:l,namespace:a,widgetName:t,pluginName:"jqueryui."+(a?a+".":"")+t,widgetFullName:l});return o=n[a][t]=r.inherit(d),n.extend(o,s,{version:i.version,_proto:d,_childConstructors:[]}),s?(n.each(s._childConstructors,function(t,e){var r=e.prototype;n.widget(r.namespace+"."+r.widgetName,o,e._proto)}),delete s._childConstructors):r._childConstructors&&r._childConstructors.push(o),e.register(o,t,l),o},n.widget.extend=function(t){for(var e,r,i=o.call(arguments,1),a=0,l=i.length;a<l;a++)for(e in i[a])r=i[a][e],s.call(i[a],e)&&void 0!==r&&(n.isPlainObject(r)?t[e]=n.isPlainObject(t[e])?n.widget.extend({},t[e],r):n.widget.extend({},r):t[e]=r);return t},n.Widget=r.inherit({widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},widget:function(){return this.element},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(t){var e,r,i;for(e in t)i=this.classesElementLookup[e],t[e]!==this.options.classes[e]&&i&&i.length&&(r=n(i.get()),this._removeClass(i,e),r.addClass(this._classes({element:r,keys:e,classes:t,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_delay:function(t,e){var n=this;return setTimeout(function(){return("string"==typeof t?n[t]:t).apply(n,arguments)},e||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){this._addClass(n(t.currentTarget),null,"ui-state-hover")},mouseleave:function(t){this._removeClass(n(t.currentTarget),null,"ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){this._addClass(n(t.currentTarget),null,"ui-state-focus")},focusout:function(t){this._removeClass(n(t.currentTarget),null,"ui-state-focus")}})}}),n.Widget._childConstructors=[],n.each({show:"fadeIn",hide:"fadeOut"},function(t,e){n.Widget.prototype["_"+t]=function(r,i,s){var o;"string"==typeof i&&(i={effect:i});var a=i?!0===i||"number"==typeof i?e:i.effect||e:t;"number"==typeof(i=i||{})&&(i={duration:i}),o=!n.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&n.effects&&n.effects.effect[a]?r[t](i):a!==t&&r[a]?r[a](i.duration,i.easing,s):r.queue(function(e){n(this)[t](),s&&s.call(r[0]),e()})}}),n.widget}),define("skylark-jquery/main",["./core","./ajax","./callbacks","./deferred","./queue","./jquery-plugin","./widget"],function(t){return t}),define("skylark-jquery",["skylark-jquery/main"],function(t){return t}),define("skylark-98js/win98",["skylark-langx-ns","skylark-jquery"],function(t,e){return window.$=e,t.attach("intg.win98js")}),define("skylark-browserfs/libs/process",[],function(){var t,e,n={};function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{e="function"==typeof clearTimeout?clearTimeout:i}catch(t){e=i}}();var o,a=[],l=!1,c=-1;function u(){l&&o&&(l=!1,o.length?a=o.concat(a):c=-1,a.length&&h())}function h(){if(!l){var t=s(u);l=!0;for(var n=a.length;n;){for(o=a,a=[];++c<n;)o&&o[c].run();c=-1,n=a.length}o=null,l=!1,function(t){if(e===clearTimeout)return clearTimeout(t);if((e===i||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function d(){}return n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];a.push(new f(t,e)),1!==a.length||l||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=d,n.addListener=d,n.once=d,n.off=d,n.removeListener=d,n.removeAllListeners=d,n.emit=d,n.prependListener=d,n.prependOnceListener=d,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0},n}),define("skylark-browserfs/libs/base64",[],function(){"use strict";for(var exports={byteLength:function(t){var e=o(t),n=e[0],r=e[1];return 3*(n+r)/4-r},toByteArray:function(t){var r,i,s=o(t),a=s[0],l=s[1],c=new n(function(t,e,n){return 3*(e+n)/4-n}(0,a,l)),u=0,h=l>0?a-4:a;for(i=0;i<h;i+=4)r=e[t.charCodeAt(i)]<<18|e[t.charCodeAt(i+1)]<<12|e[t.charCodeAt(i+2)]<<6|e[t.charCodeAt(i+3)],c[u++]=r>>16&255,c[u++]=r>>8&255,c[u++]=255&r;2===l&&(r=e[t.charCodeAt(i)]<<2|e[t.charCodeAt(i+1)]>>4,c[u++]=255&r);1===l&&(r=e[t.charCodeAt(i)]<<10|e[t.charCodeAt(i+1)]<<4|e[t.charCodeAt(i+2)]>>2,c[u++]=r>>8&255,c[u++]=255&r);return c},fromByteArray:function(e){for(var n,r=e.length,i=r%3,s=[],o=0,l=r-i;o<l;o+=16383)s.push(a(e,o,o+16383>l?l:o+16383));1===i?(n=e[r-1],s.push(t[n>>2]+t[n<<4&63]+"==")):2===i&&(n=(e[r-2]<<8)+e[r-1],s.push(t[n>>10]+t[n>>4&63]+t[n<<2&63]+"="));return s.join("")}},t=[],e=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,s=r.length;i<s;++i)t[i]=r[i],e[r.charCodeAt(i)]=i;function o(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");-1===n&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function a(e,n,r){for(var i,s,o=[],a=n;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(t[(s=i)>>18&63]+t[s>>12&63]+t[s>>6&63]+t[63&s]);return o.join("")}return e["-".charCodeAt(0)]=62,e["_".charCodeAt(0)]=63,exports}),define("skylark-browserfs/libs/ieee754",[],function(){"use strict";var exports={read:function(t,e,n,r,i){var s,o,a=8*i-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?i-1:0,f=n?-1:1,d=t[e+h];for(h+=f,s=d&(1<<-u)-1,d>>=-u,u+=a;u>0;s=256*s+t[e+h],h+=f,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+t[e+h],h+=f,u-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),s-=c}return(d?-1:1)*o*Math.pow(2,s-r)},write:function(t,e,n,r,i,s){var o,a,l,c=8*s-i-1,u=(1<<c)-1,h=u>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+h>=1?f/l:f*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*l-1)*Math.pow(2,i),o+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[n+d]=255&a,d+=p,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;t[n+d]=255&o,d+=p,o/=256,c-=8);t[n+d-p]|=128*m}};return exports}),define("skylark-browserfs/libs/buffers",["./base64","./ieee754"],function(t,e){"use strict";var exports={};exports.Buffer=i,exports.SlowBuffer=function(t){+t!=t&&(t=0);return i.alloc(+t)},exports.INSPECT_MAX_BYTES=50;var n=2147483647;function r(t){if(t>n)throw new RangeError("Invalid typed array length");var e=new Uint8Array(t);return e.__proto__=i.prototype,e}function i(t,e,n){if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return a(t)}return s(t,e,n)}function s(t,e,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return P(t)||t&&P(t.buffer)?function(t,e,n){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;r=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n);return r.__proto__=i.prototype,r}(t,e,n):"string"==typeof t?function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!i.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var n=0|u(t,e),s=r(n),o=s.write(t,e);o!==n&&(s=s.slice(0,o));return s}(t,e):function(t){if(i.isBuffer(t)){var e=0|c(t.length),n=r(e);return 0===n.length?n:(t.copy(n,0,0,e),n)}if(t){if(ArrayBuffer.isView(t)||"length"in t)return"number"!=typeof t.length||R(t.length)?r(0):l(t);if("Buffer"===t.type&&Array.isArray(t.data))return l(t.data)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object.")}(t)}function o(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('"size" argument must not be negative')}function a(t){return o(t),r(t<0?0:0|c(t))}function l(t){for(var e=t.length<0?0:0|c(t.length),n=r(e),i=0;i<e;i+=1)n[i]=255&t[i];return n}function c(t){if(t>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|t}function u(t,e){if(i.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||P(t))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return D(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(t).length;default:if(r)return D(t).length;e=(""+e).toLowerCase(),r=!0}}function h(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function f(t,e,n,r,s){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),R(n=+n)&&(n=s?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(s)return-1;n=t.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e&&(e=i.from(e,r)),i.isBuffer(e))return 0===e.length?-1:d(t,e,n,r,s);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):d(t,[e],n,r,s);throw new TypeError("val must be string, number or Buffer")}function d(t,e,n,r,i){var s,o=1,a=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,a/=2,l/=2,n/=2}function c(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var u=-1;for(s=n;s<a;s++)if(c(t,s)===c(e,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===l)return u*o}else-1!==u&&(s-=s-u),u=-1}else for(n+l>a&&(n=a-l),s=n;s>=0;s--){for(var h=!0,f=0;f<l;f++)if(c(t,s+f)!==c(e,f)){h=!1;break}if(h)return s}return-1}function p(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=e.length;r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(e.substr(2*o,2),16);if(R(a))return o;t[n+o]=a}return o}function m(t,e,n,r){return L(D(e,t.length-n),t,n,r)}function y(t,e,n,r){return L(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function g(t,e,n,r){return y(t,e,n,r)}function w(t,e,n,r){return L(z(e),t,n,r)}function k(t,e,n,r){return L(function(t,e){for(var n,r,i,s=[],o=0;o<t.length&&!((e-=2)<0);++o)n=t.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}(e,t.length-n),t,n,r)}function x(e,n,r){return 0===n&&r===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(n,r))}function v(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var s,o,a,l,c=t[i],u=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=n)switch(h){case 1:c<128&&(u=c);break;case 2:128==(192&(s=t[i+1]))&&(l=(31&c)<<6|63&s)>127&&(u=l);break;case 3:s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&(l=(15&c)<<12|(63&s)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:s=t[i+1],o=t[i+2],a=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(l=(15&c)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=h}return function(t){var e=t.length;if(e<=_)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=_));return n}(r)}exports.kMaxLength=n,i.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}(),i.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(i.prototype,"parent",{get:function(){if(this instanceof i)return this.buffer}}),Object.defineProperty(i.prototype,"offset",{get:function(){if(this instanceof i)return this.byteOffset}}),"undefined"!=typeof Symbol&&Symbol.species&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),i.poolSize=8192,i.from=function(t,e,n){return s(t,e,n)},i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,i.alloc=function(t,e,n){return function(t,e,n){if(o(t),t<=0)return r(t);if(void 0!==e)return"string"==typeof n?r(t).fill(e,n):r(t).fill(e);return r(t)}(t,e,n)},i.allocUnsafe=function(t){return a(t)},i.allocUnsafeSlow=function(t){return a(t)},i.isBuffer=function(t){return null!=t&&!0===t._isBuffer},i.compare=function(t,e){if(!i.isBuffer(t)||!i.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o;++s)if(t[s]!==e[s]){n=t[s],r=e[s];break}return n<r?-1:r<n?1:0},i.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return i.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=i.allocUnsafe(e),s=0;for(n=0;n<t.length;++n){var o=t[n];if(ArrayBuffer.isView(o)&&(o=i.from(o)),!i.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,s),s+=o.length}return r},i.byteLength=u,i.prototype._isBuffer=!0,i.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)h(this,e,e+1);return this},i.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)h(this,e,e+3),h(this,e+1,e+2);return this},i.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)h(this,e,e+7),h(this,e+1,e+6),h(this,e+2,e+5),h(this,e+3,e+4);return this},i.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?v(this,0,t):function(t,e,n){var r=!1;(void 0===e||e<0)&&(e=0);if(e>this.length)return"";(void 0===n||n>this.length)&&(n=this.length);if(n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";t||(t="utf8");for(;;)switch(t){case"hex":return S(this,e,n);case"utf8":case"utf-8":return v(this,e,n);case"ascii":return b(this,e,n);case"latin1":case"binary":return E(this,e,n);case"base64":return x(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},i.prototype.toLocaleString=i.prototype.toString,i.prototype.equals=function(t){if(!i.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===i.compare(this,t)},i.prototype.inspect=function(){var t="",e=exports.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},i.prototype.compare=function(t,e,n,r,s){if(!i.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),e<0||n>t.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&e>=n)return 0;if(r>=s)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,s>>>=0,this===t)return 0;for(var o=s-r,a=n-e,l=Math.min(o,a),c=this.slice(r,s),u=t.slice(e,n),h=0;h<l;++h)if(c[h]!==u[h]){o=c[h],a=u[h];break}return o<a?-1:a<o?1:0},i.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},i.prototype.indexOf=function(t,e,n){return f(this,t,e,n,!0)},i.prototype.lastIndexOf=function(t,e,n){return f(this,t,e,n,!1)},i.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return p(this,t,e,n);case"utf8":case"utf-8":return m(this,t,e,n);case"ascii":return y(this,t,e,n);case"latin1":case"binary":return g(this,t,e,n);case"base64":return w(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function b(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function E(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function S(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=e;s<n;++s)i+=N(t[s]);return i}function T(t,e,n){for(var r=t.slice(e,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function I(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function F(t,e,n,r,s,o){if(!i.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function A(t,e,n,r,i,s){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function C(t,n,r,i,s){return n=+n,r>>>=0,s||A(t,n,r,4,3.4028234663852886e38,-3.4028234663852886e38),e.write(t,n,r,i,23,4),r+4}function O(t,n,r,i,s){return n=+n,r>>>=0,s||A(t,n,r,8,1.7976931348623157e308,-1.7976931348623157e308),e.write(t,n,r,i,52,8),r+8}i.prototype.slice=function(t,e){var n=this.length;t=~~t,e=void 0===e?n:~~e,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),e<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t);var r=this.subarray(t,e);return r.__proto__=i.prototype,r},i.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||I(t,e,this.length);for(var r=this[t],i=1,s=0;++s<e&&(i*=256);)r+=this[t+s]*i;return r},i.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||I(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},i.prototype.readUInt8=function(t,e){return t>>>=0,e||I(t,1,this.length),this[t]},i.prototype.readUInt16LE=function(t,e){return t>>>=0,e||I(t,2,this.length),this[t]|this[t+1]<<8},i.prototype.readUInt16BE=function(t,e){return t>>>=0,e||I(t,2,this.length),this[t]<<8|this[t+1]},i.prototype.readUInt32LE=function(t,e){return t>>>=0,e||I(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},i.prototype.readUInt32BE=function(t,e){return t>>>=0,e||I(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},i.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||I(t,e,this.length);for(var r=this[t],i=1,s=0;++s<e&&(i*=256);)r+=this[t+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},i.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||I(t,e,this.length);for(var r=e,i=1,s=this[t+--r];r>0&&(i*=256);)s+=this[t+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},i.prototype.readInt8=function(t,e){return t>>>=0,e||I(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},i.prototype.readInt16LE=function(t,e){t>>>=0,e||I(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},i.prototype.readInt16BE=function(t,e){t>>>=0,e||I(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},i.prototype.readInt32LE=function(t,e){return t>>>=0,e||I(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},i.prototype.readInt32BE=function(t,e){return t>>>=0,e||I(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},i.prototype.readFloatLE=function(t,n){return t>>>=0,n||I(t,4,this.length),e.read(this,t,!0,23,4)},i.prototype.readFloatBE=function(t,n){return t>>>=0,n||I(t,4,this.length),e.read(this,t,!1,23,4)},i.prototype.readDoubleLE=function(t,n){return t>>>=0,n||I(t,8,this.length),e.read(this,t,!0,52,8)},i.prototype.readDoubleBE=function(t,n){return t>>>=0,n||I(t,8,this.length),e.read(this,t,!1,52,8)},i.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;F(this,t,e,n,i,0)}var s=1,o=0;for(this[e]=255&t;++o<n&&(s*=256);)this[e+o]=t/s&255;return e+n},i.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;F(this,t,e,n,i,0)}var s=n-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+n},i.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||F(this,t,e,1,255,0),this[e]=255&t,e+1},i.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||F(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},i.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||F(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},i.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||F(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},i.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||F(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},i.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e>>>=0,!r){var i=Math.pow(2,8*n-1);F(this,t,e,n,i-1,-i)}var s=0,o=1,a=0;for(this[e]=255&t;++s<n&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+n},i.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e>>>=0,!r){var i=Math.pow(2,8*n-1);F(this,t,e,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+n},i.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||F(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},i.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||F(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},i.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||F(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},i.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||F(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},i.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||F(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},i.prototype.writeFloatLE=function(t,e,n){return C(this,t,e,!0,n)},i.prototype.writeFloatBE=function(t,e,n){return C(this,t,e,!1,n)},i.prototype.writeDoubleLE=function(t,e,n){return O(this,t,e,!0,n)},i.prototype.writeDoubleBE=function(t,e,n){return O(this,t,e,!1,n)},i.prototype.copy=function(t,e,n,r){if(!i.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var s=r-n;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,n,r);else if(this===t&&n<e&&e<r)for(var o=s-1;o>=0;--o)t[o+e]=this[o+n];else Uint8Array.prototype.set.call(t,this.subarray(n,r),e);return s},i.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!i.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){var s=t.charCodeAt(0);("utf8"===r&&s<128||"latin1"===r)&&(t=s)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var a=i.isBuffer(t)?t:new i(t,r),l=a.length;if(0===l)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<n-e;++o)this[o+e]=a[o%l]}return this};var M=/[^+/0-9A-Za-z-_]/g;function N(t){return t<16?"0"+t.toString(16):t.toString(16)}function D(t,e){var n;e=e||1/0;for(var r=t.length,i=null,s=[],o=0;o<r;++o){if((n=t.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function z(e){return t.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(e))}function L(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function P(t){return t instanceof ArrayBuffer||null!=t&&null!=t.constructor&&"ArrayBuffer"===t.constructor.name&&"number"==typeof t.byteLength}function R(t){return t!=t}return exports}),define("skylark-browserfs/core/api_error",["../libs/buffers"],function(t){const{Buffer:e}=t;var n;!function(t){t[t.EPERM=1]="EPERM",t[t.ENOENT=2]="ENOENT",t[t.EIO=5]="EIO",t[t.EBADF=9]="EBADF",t[t.EACCES=13]="EACCES",t[t.EBUSY=16]="EBUSY",t[t.EEXIST=17]="EEXIST",t[t.ENOTDIR=20]="ENOTDIR",t[t.EISDIR=21]="EISDIR",t[t.EINVAL=22]="EINVAL",t[t.EFBIG=27]="EFBIG",t[t.ENOSPC=28]="ENOSPC",t[t.EROFS=30]="EROFS",t[t.ENOTEMPTY=39]="ENOTEMPTY",t[t.ENOTSUP=95]="ENOTSUP"}(n||(n={}));const r={};r[n.EPERM]="Operation not permitted.",r[n.ENOENT]="No such file or directory.",r[n.EIO]="Input/output error.",r[n.EBADF]="Bad file descriptor.",r[n.EACCES]="Permission denied.",r[n.EBUSY]="Resource busy or locked.",r[n.EEXIST]="File exists.",r[n.ENOTDIR]="File is not a directory.",r[n.EISDIR]="File is a directory.",r[n.EINVAL]="Invalid argument.",r[n.EFBIG]="File is too big.",r[n.ENOSPC]="No space left on disk.",r[n.EROFS]="Cannot modify a read-only file system.",r[n.ENOTEMPTY]="Directory is not empty.",r[n.ENOTSUP]="Operation is not supported.";class i extends Error{constructor(t,e=r[t],i){super(e),this.syscall="",this.errno=t,this.code=n[t],this.path=i,this.stack=(new Error).stack,this.message=`Error: ${this.code}: ${e}${this.path?`, '${this.path}'`:""}`}static fromJSON(t){const e=new i(0);return e.errno=t.errno,e.code=t.code,e.path=t.path,e.stack=t.stack,e.message=t.message,e}static fromBuffer(t,e=0){return i.fromJSON(JSON.parse(t.toString("utf8",e+4,e+4+t.readUInt32LE(e))))}static FileError(t,e){return new i(t,r[t],e)}static ENOENT(t){return this.FileError(n.ENOENT,t)}static EEXIST(t){return this.FileError(n.EEXIST,t)}static EISDIR(t){return this.FileError(n.EISDIR,t)}static ENOTDIR(t){return this.FileError(n.ENOTDIR,t)}static EPERM(t){return this.FileError(n.EPERM,t)}static ENOTEMPTY(t){return this.FileError(n.ENOTEMPTY,t)}toString(){return this.message}toJSON(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message}}writeToBuffer(t=e.alloc(this.bufferSize()),n=0){const r=t.write(JSON.stringify(this.toJSON()),n+4);return t.writeUInt32LE(r,n),t}bufferSize(){return 4+e.byteLength(JSON.stringify(this.toJSON()))}}return{ApiError:i,ErrorCode:n,ErrorStrings:r}}),define("skylark-browserfs/core/file_flag",["./api_error"],function(t){"use strict";const{ErrorCode:e,ApiError:n}=t;var r;!function(t){t[t.NOP=0]="NOP",t[t.THROW_EXCEPTION=1]="THROW_EXCEPTION",t[t.TRUNCATE_FILE=2]="TRUNCATE_FILE",t[t.CREATE_FILE=3]="CREATE_FILE"}(r||(r={}));class i{constructor(t){if(this.flagStr=t,i.validFlagStrs.indexOf(t)<0)throw new n(e.EINVAL,"Invalid flag: "+t)}static getFileFlag(t){return i.flagCache.hasOwnProperty(t)?i.flagCache[t]:i.flagCache[t]=new i(t)}getFlagString(){return this.flagStr}isReadable(){return-1!==this.flagStr.indexOf("r")||-1!==this.flagStr.indexOf("+")}isWriteable(){return-1!==this.flagStr.indexOf("w")||-1!==this.flagStr.indexOf("a")||-1!==this.flagStr.indexOf("+")}isTruncating(){return-1!==this.flagStr.indexOf("w")}isAppendable(){return-1!==this.flagStr.indexOf("a")}isSynchronous(){return-1!==this.flagStr.indexOf("s")}isExclusive(){return-1!==this.flagStr.indexOf("x")}pathExistsAction(){return this.isExclusive()?r.THROW_EXCEPTION:this.isTruncating()?r.TRUNCATE_FILE:r.NOP}pathNotExistsAction(){return(this.isWriteable()||this.isAppendable())&&"r+"!==this.flagStr?r.CREATE_FILE:r.THROW_EXCEPTION}}return i.flagCache={},i.validFlagStrs=["r","r+","rs","rs+","w","wx","w+","wx+","a","ax","a+","ax+"],{ActionType:r,FileFlag:i}}),define("skylark-browserfs/libs/path",[],function(){var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var e=function(){function e(){}return e.normalize=function(t){""===t&&(t=".");for(var n=t.charAt(0)===e.sep,r=(t=e._removeDuplicateSeps(t)).split(e.sep),i=[],s=0;s<r.length;s++){var o=r[s];"."!==o&&(".."===o&&(n||!n&&i.length>0&&".."!==i[0])?i.pop():i.push(o))}if(!n&&i.length<2)switch(i.length){case 1:""===i[0]&&i.unshift(".");break;default:i.push(".")}return t=i.join(e.sep),n&&t.charAt(0)!==e.sep&&(t=e.sep+t),t},e.join=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];for(var r=[],i=0;i<t.length;i++){var s=t[i];if("string"!=typeof s)throw new TypeError("Invalid argument type to path.join: "+typeof s);""!==s&&r.push(s)}return e.normalize(r.join(e.sep))},e.resolve=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];for(var r=[],i=0;i<t.length;i++){var s=t[i];if("string"!=typeof s)throw new TypeError("Invalid argument type to path.join: "+typeof s);""!==s&&(s.charAt(0)===e.sep&&(r=[]),r.push(s))}var o=e.normalize(r.join(e.sep));if(o.length>1&&o.charAt(o.length-1)===e.sep)return o.substr(0,o.length-1);if(o.charAt(0)!==e.sep){"."!==o.charAt(0)||1!==o.length&&o.charAt(1)!==e.sep||(o=1===o.length?"":o.substr(2));var a=process.cwd();o=""!==o?this.normalize(a+("/"!==a?e.sep:"")+o):a}return o},e.relative=function(t,n){var r;t=e.resolve(t),n=e.resolve(n);var i=t.split(e.sep),s=n.split(e.sep);s.shift(),i.shift();var o=0,a=[];for(r=0;r<i.length;r++){var l=i[r];if(l!==s[r]){o=i.length-r;break}}a=s.slice(r),1===i.length&&""===i[0]&&(o=0),o>i.length&&(o=i.length);var c="";for(r=0;r<o;r++)c+="../";return(c+=a.join(e.sep)).length>1&&c.charAt(c.length-1)===e.sep&&(c=c.substr(0,c.length-1)),c},e.dirname=function(t){var n=(t=e._removeDuplicateSeps(t)).charAt(0)===e.sep,r=t.split(e.sep);return""===r.pop()&&r.length>0&&r.pop(),r.length>1||1===r.length&&!n?r.join(e.sep):n?e.sep:"."},e.basename=function(t,n){if(void 0===n&&(n=""),""===t)return t;var r=(t=e.normalize(t)).split(e.sep),i=r[r.length-1];if(""===i&&r.length>1)return r[r.length-2];if(n.length>0){var s=i.substr(i.length-n.length);if(s===n)return i.substr(0,i.length-n.length)}return i},e.extname=function(t){var n=(t=e.normalize(t)).split(e.sep);if(""===(t=n.pop())&&n.length>0&&(t=n.pop()),".."===t)return"";var r=t.lastIndexOf(".");return-1===r||0===r?"":t.substr(r)},e.isAbsolute=function(t){return t.length>0&&t.charAt(0)===e.sep},e._makeLong=function(t){return t},e.parse=function(e){var n,r,i=(n=e,(r=t.exec(n)).shift(),r);return{root:i[0],dir:i[0]+i[1].slice(0,-1),base:i[2],ext:i[3],name:i[2].slice(0,i[2].length-i[3].length)}},e.format=function(t){if(null===t||"object"!=typeof t)throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof t);var n=t.root||"";if("string"!=typeof n)throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof t.root);var r=t.dir?t.dir+e.sep:"",i=t.base||"";return r+i},e._removeDuplicateSeps=function(t){return t=t.replace(this._replaceRegex,this.sep)},e.sep="/",e._replaceRegex=new RegExp("//+","g"),e.delimiter=":",e.posix=e,e.win32=e,e}();return e}),define("skylark-browserfs/core/node_fs_stats",["../libs/buffers"],function(t){"use strict";const{Buffer:e}=t;var n;!function(t){t[t.FILE=32768]="FILE",t[t.DIRECTORY=16384]="DIRECTORY",t[t.SYMLINK=40960]="SYMLINK"}(n||(n={}));class r{constructor(t,e,r,i,s,o,a){this.dev=0,this.ino=0,this.rdev=0,this.nlink=1,this.blksize=4096,this.uid=0,this.gid=0,this.fileData=null,this.size=e;let l=0;if("number"!=typeof i&&(l=Date.now(),i=l),"number"!=typeof s&&(l||(l=Date.now()),s=l),"number"!=typeof o&&(l||(l=Date.now()),o=l),"number"!=typeof a&&(l||(l=Date.now()),a=l),this.atimeMs=i,this.ctimeMs=o,this.mtimeMs=s,this.birthtimeMs=a,r)this.mode=r;else switch(t){case n.FILE:this.mode=420;break;case n.DIRECTORY:default:this.mode=511}this.blocks=Math.ceil(e/512),this.mode<4096&&(this.mode|=t)}static fromBuffer(t){const e=t.readUInt32LE(0),n=t.readUInt32LE(4),i=t.readDoubleLE(8),s=t.readDoubleLE(16),o=t.readDoubleLE(24);return new r(61440&n,e,4095&n,i,s,o)}static clone(t){return new r(61440&t.mode,t.size,4095&t.mode,t.atimeMs,t.mtimeMs,t.ctimeMs,t.birthtimeMs)}get atime(){return new Date(this.atimeMs)}get mtime(){return new Date(this.mtimeMs)}get ctime(){return new Date(this.ctimeMs)}get birthtime(){return new Date(this.birthtimeMs)}toBuffer(){const t=e.alloc(32);return t.writeUInt32LE(this.size,0),t.writeUInt32LE(this.mode,4),t.writeDoubleLE(this.atime.getTime(),8),t.writeDoubleLE(this.mtime.getTime(),16),t.writeDoubleLE(this.ctime.getTime(),24),t}isFile(){return(61440&this.mode)===n.FILE}isDirectory(){return(61440&this.mode)===n.DIRECTORY}isSymbolicLink(){return(61440&this.mode)===n.SYMLINK}chmod(t){this.mode=61440&this.mode|t}isSocket(){return!1}isBlockDevice(){return!1}isCharacterDevice(){return!1}isFIFO(){return!1}}return{FileType:n,Stats:r}}),define("skylark-browserfs/core/global",[],function(){"use strict";const t="undefined"!=typeof window?window:"undefined"!=typeof self?self:global;return t}),define("skylark-browserfs/generic/setImmediate",["../core/global"],function(t){"use strict";let e;if("undefined"!=typeof setImmediate)e=setImmediate;else{const n=t,r=[],i="zero-timeout-message",s=function(){if(void 0!==n.importScripts||!n.postMessage)return!1;let t=!0;const e=n.onmessage;return n.onmessage=function(){t=!1},n.postMessage("","*"),n.onmessage=e,t};if(s()){e=function(t){r.push(t),n.postMessage(i,"*")};const t=function(t){if(t.source===self&&t.data===i&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,r.length>0)){const t=r.shift();return t()}};n.addEventListener?n.addEventListener("message",t,!0):n.attachEvent("onmessage",t)}else if(n.MessageChannel){const t=new n.MessageChannel;t.port1.onmessage=(t=>{if(r.length>0)return r.shift()()}),e=(e=>{r.push(e),t.port2.postMessage("")})}else e=function(t){return setTimeout(t,0)}}return e}),define("skylark-browserfs/core/FS",["../libs/buffers","./api_error","./file_flag","../libs/path","./node_fs_stats","../generic/setImmediate"],function(t,e,n,r,i,s){"use strict";const{ApiError:o,ErrorCode:a}=e,{FileFlag:l}=n,{Stats:c}=i,{Buffer:u}=t;let h=function(t,e){return t};function f(t,e){if("function"!=typeof t)throw new Error("Callback must be a function.");const n=h(t,e);switch(e){case 1:return function(t){s(function(){return n(t)})};case 2:return function(t,e){s(function(){return n(t,e)})};case 3:return function(t,e,r){s(function(){return n(t,e,r)})};default:throw new Error("Invalid invocation of wrapCb.")}}function d(t){if(t)return t;throw new o(a.EIO,"Initialize BrowserFS with a file system using BrowserFS.initialize(filesystem)")}function p(t,e){switch(typeof t){case"number":return t;case"string":const n=parseInt(t,8);return isNaN(n)?e:n;default:return e}}function m(t){if(t instanceof Date)return t;if("number"==typeof t)return new Date(1e3*t);throw new o(a.EINVAL,"Invalid time.")}function y(t){if(t.indexOf("\0")>=0)throw new o(a.EINVAL,"Path must be a string without null bytes.");if(""===t)throw new o(a.EINVAL,"Path must not be empty.");return r.resolve(t)}function g(t,e,n,r){switch(null===t?"null":typeof t){case"object":return{encoding:void 0!==t.encoding?t.encoding:e,flag:void 0!==t.flag?t.flag:n,mode:p(t.mode,r)};case"string":return{encoding:t,flag:n,mode:r};case"null":case"undefined":case"function":return{encoding:e,flag:n,mode:r};default:throw new TypeError(`"options" must be a string or an object, got ${typeof t} instead.`)}}function w(){}class k{constructor(){this.F_OK=0,this.R_OK=4,this.W_OK=2,this.X_OK=1,this.root=null,this.fdMap={},this.nextFd=100}initialize(t){if(!t.constructor.isAvailable())throw new o(a.EINVAL,"Tried to instantiate BrowserFS with an unavailable file system.");return this.root=t}_toUnixTimestamp(t){if("number"==typeof t)return t;if(t instanceof Date)return t.getTime()/1e3;throw new Error("Cannot parse time: "+t)}getRootFS(){return this.root?this.root:null}rename(t,e,n=w){const r=f(n,1);try{d(this.root).rename(y(t),y(e),r)}catch(t){r(t)}}renameSync(t,e){d(this.root).renameSync(y(t),y(e))}exists(t,e=w){const n=f(e,1);try{return d(this.root).exists(y(t),n)}catch(t){return n(!1)}}existsSync(t){try{return d(this.root).existsSync(y(t))}catch(t){return!1}}stat(t,e=w){const n=f(e,2);try{return d(this.root).stat(y(t),!1,n)}catch(t){return n(t)}}statSync(t){return d(this.root).statSync(y(t),!1)}lstat(t,e=w){const n=f(e,2);try{return d(this.root).stat(y(t),!0,n)}catch(t){return n(t)}}lstatSync(t){return d(this.root).statSync(y(t),!0)}truncate(t,e=0,n=w){let r=0;"function"==typeof e?n=e:"number"==typeof e&&(r=e);const i=f(n,1);try{if(r<0)throw new o(a.EINVAL);return d(this.root).truncate(y(t),r,i)}catch(t){return i(t)}}truncateSync(t,e=0){if(e<0)throw new o(a.EINVAL);return d(this.root).truncateSync(y(t),e)}unlink(t,e=w){const n=f(e,1);try{return d(this.root).unlink(y(t),n)}catch(t){return n(t)}}unlinkSync(t){return d(this.root).unlinkSync(y(t))}open(t,e,n,r=w){const i=p(n,420),s=f(r="function"==typeof n?n:r,2);try{d(this.root).open(y(t),l.getFileFlag(e),i,(t,e)=>{e?s(t,this.getFdForFile(e)):s(t)})}catch(t){s(t)}}openSync(t,e,n=420){return this.getFdForFile(d(this.root).openSync(y(t),l.getFileFlag(e),p(n,420)))}readFile(t,e={},n=w){const r=g(e,null,"r",null),i=f(n="function"==typeof e?e:n,2);try{const e=l.getFileFlag(r.flag);return e.isReadable()?d(this.root).readFile(y(t),r.encoding,e,i):i(new o(a.EINVAL,"Flag passed to readFile must allow for reading."))}catch(t){return i(t)}}readFileSync(t,e={}){const n=g(e,null,"r",null),r=l.getFileFlag(n.flag);if(!r.isReadable())throw new o(a.EINVAL,"Flag passed to readFile must allow for reading.");return d(this.root).readFileSync(y(t),n.encoding,r)}writeFile(t,e,n={},r=w){const i=g(n,"utf8","w",420),s=f(r="function"==typeof n?n:r,1);try{const n=l.getFileFlag(i.flag);return n.isWriteable()?d(this.root).writeFile(y(t),e,i.encoding,n,i.mode,s):s(new o(a.EINVAL,"Flag passed to writeFile must allow for writing."))}catch(t){return s(t)}}writeFileSync(t,e,n){const r=g(n,"utf8","w",420),i=l.getFileFlag(r.flag);if(!i.isWriteable())throw new o(a.EINVAL,"Flag passed to writeFile must allow for writing.");return d(this.root).writeFileSync(y(t),e,r.encoding,i,r.mode)}appendFile(t,e,n,r=w){const i=g(n,"utf8","a",420),s=f(r="function"==typeof n?n:r,1);try{const n=l.getFileFlag(i.flag);if(!n.isAppendable())return s(new o(a.EINVAL,"Flag passed to appendFile must allow for appending."));d(this.root).appendFile(y(t),e,i.encoding,n,i.mode,s)}catch(t){s(t)}}appendFileSync(t,e,n){const r=g(n,"utf8","a",420),i=l.getFileFlag(r.flag);if(!i.isAppendable())throw new o(a.EINVAL,"Flag passed to appendFile must allow for appending.");return d(this.root).appendFileSync(y(t),e,r.encoding,i,r.mode)}fstat(t,e=w){const n=f(e,2);try{const e=this.fd2file(t);e.stat(n)}catch(t){n(t)}}fstatSync(t){return this.fd2file(t).statSync()}close(t,e=w){const n=f(e,1);try{this.fd2file(t).close(e=>{e||this.closeFd(t),n(e)})}catch(t){n(t)}}closeSync(t){this.fd2file(t).closeSync(),this.closeFd(t)}ftruncate(t,e,n=w){const r="number"==typeof e?e:0,i=f(n="function"==typeof e?e:n,1);try{const e=this.fd2file(t);if(r<0)throw new o(a.EINVAL);e.truncate(r,i)}catch(t){i(t)}}ftruncateSync(t,e=0){const n=this.fd2file(t);if(e<0)throw new o(a.EINVAL);n.truncateSync(e)}fsync(t,e=w){const n=f(e,1);try{this.fd2file(t).sync(n)}catch(t){n(t)}}fsyncSync(t){this.fd2file(t).syncSync()}fdatasync(t,e=w){const n=f(e,1);try{this.fd2file(t).datasync(n)}catch(t){n(t)}}fdatasyncSync(t){this.fd2file(t).datasyncSync()}write(t,e,n,r,i,s=w){let l,c,h,d=null;if("string"==typeof e){let t="utf8";switch(typeof n){case"function":s=n;break;case"number":d=n,t="string"==typeof r?r:"utf8",s="function"==typeof i?i:s;break;default:return(s="function"==typeof r?r:"function"==typeof i?i:s)(new o(a.EINVAL,"Invalid arguments."))}l=u.from(e,t),c=0,h=l.length}else l=e,c=n,h=r,d="number"==typeof i?i:null,s="function"==typeof i?i:s;const p=f(s,3);try{const e=this.fd2file(t);void 0!==d&&null!==d||(d=e.getPos()),e.write(l,c,h,d,p)}catch(t){p(t)}}writeSync(t,e,n,r,i){let s,o,a,l=0;if("string"==typeof e){a="number"==typeof n?n:null;const t="string"==typeof r?r:"utf8";l=0,s=u.from(e,t),o=s.length}else s=e,l=n,o=r,a="number"==typeof i?i:null;const c=this.fd2file(t);return void 0!==a&&null!==a||(a=c.getPos()),c.writeSync(s,l,o,a)}read(t,e,n,r,i,s=w){let o,a,l,c,h;if("number"==typeof e){l=e,o=n;const t=r;s="function"==typeof i?i:s,a=0,c=u.alloc(l),h=f((e,n,r)=>{if(e)return s(e);s(e,r.toString(t),n)},3)}else c=e,a=n,l=r,o=i,h=f(s,3);try{const e=this.fd2file(t);void 0!==o&&null!==o||(o=e.getPos()),e.read(c,a,l,o,h)}catch(t){h(t)}}readSync(t,e,n,r,i){let s,o,a,l,c=!1,h="utf8";"number"==typeof e?(a=e,l=n,h=r,o=0,s=u.alloc(a),c=!0):(s=e,o=n,a=r,l=i);const f=this.fd2file(t);void 0!==l&&null!==l||(l=f.getPos());const d=f.readSync(s,o,a,l);return c?[s.toString(h),d]:d}fchown(t,e,n,r=w){const i=f(r,1);try{this.fd2file(t).chown(e,n,i)}catch(t){i(t)}}fchownSync(t,e,n){this.fd2file(t).chownSync(e,n)}fchmod(t,e,n){const r=f(n,1);try{const n="string"==typeof e?parseInt(e,8):e;this.fd2file(t).chmod(n,r)}catch(t){r(t)}}fchmodSync(t,e){const n="string"==typeof e?parseInt(e,8):e;this.fd2file(t).chmodSync(n)}futimes(t,e,n,r=w){const i=f(r,1);try{const r=this.fd2file(t);"number"==typeof e&&(e=new Date(1e3*e)),"number"==typeof n&&(n=new Date(1e3*n)),r.utimes(e,n,i)}catch(t){i(t)}}futimesSync(t,e,n){this.fd2file(t).utimesSync(m(e),m(n))}rmdir(t,e=w){const n=f(e,1);try{t=y(t),d(this.root).rmdir(t,n)}catch(t){n(t)}}rmdirSync(t){return t=y(t),d(this.root).rmdirSync(t)}mkdir(t,e,n=w){"function"==typeof e&&(n=e,e=511);const r=f(n,1);try{t=y(t),d(this.root).mkdir(t,e,r)}catch(t){r(t)}}mkdirSync(t,e){d(this.root).mkdirSync(y(t),p(e,511))}readdir(t,e=w){const n=f(e,2);try{t=y(t),d(this.root).readdir(t,n)}catch(t){n(t)}}readdirSync(t){return t=y(t),d(this.root).readdirSync(t)}link(t,e,n=w){const r=f(n,1);try{t=y(t),e=y(e),d(this.root).link(t,e,r)}catch(t){r(t)}}linkSync(t,e){return t=y(t),e=y(e),d(this.root).linkSync(t,e)}symlink(t,e,n,r=w){const i="string"==typeof n?n:"file",s=f(r="function"==typeof n?n:r,1);try{if("file"!==i&&"dir"!==i)return s(new o(a.EINVAL,"Invalid type: "+i));t=y(t),e=y(e),d(this.root).symlink(t,e,i,s)}catch(t){s(t)}}symlinkSync(t,e,n){if(n){if("file"!==n&&"dir"!==n)throw new o(a.EINVAL,"Invalid type: "+n)}else n="file";return t=y(t),e=y(e),d(this.root).symlinkSync(t,e,n)}readlink(t,e=w){const n=f(e,2);try{t=y(t),d(this.root).readlink(t,n)}catch(t){n(t)}}readlinkSync(t){return t=y(t),d(this.root).readlinkSync(t)}chown(t,e,n,r=w){const i=f(r,1);try{t=y(t),d(this.root).chown(t,!1,e,n,i)}catch(t){i(t)}}chownSync(t,e,n){t=y(t),d(this.root).chownSync(t,!1,e,n)}lchown(t,e,n,r=w){const i=f(r,1);try{t=y(t),d(this.root).chown(t,!0,e,n,i)}catch(t){i(t)}}lchownSync(t,e,n){t=y(t),d(this.root).chownSync(t,!0,e,n)}chmod(t,e,n=w){const r=f(n,1);try{const n=p(e,-1);if(n<0)throw new o(a.EINVAL,"Invalid mode.");d(this.root).chmod(y(t),!1,n,r)}catch(t){r(t)}}chmodSync(t,e){const n=p(e,-1);if(n<0)throw new o(a.EINVAL,"Invalid mode.");t=y(t),d(this.root).chmodSync(t,!1,n)}lchmod(t,e,n=w){const r=f(n,1);try{const n=p(e,-1);if(n<0)throw new o(a.EINVAL,"Invalid mode.");d(this.root).chmod(y(t),!0,n,r)}catch(t){r(t)}}lchmodSync(t,e){const n=p(e,-1);if(n<1)throw new o(a.EINVAL,"Invalid mode.");d(this.root).chmodSync(y(t),!0,n)}utimes(t,e,n,r=w){const i=f(r,1);try{d(this.root).utimes(y(t),m(e),m(n),i)}catch(t){i(t)}}utimesSync(t,e,n){d(this.root).utimesSync(y(t),m(e),m(n))}realpath(t,e,n=w){const r="object"==typeof e?e:{},i=f("function"==typeof e?e:w,2);try{t=y(t),d(this.root).realpath(t,r,i)}catch(t){i(t)}}realpathSync(t,e={}){return t=y(t),d(this.root).realpathSync(t,e)}watchFile(t,e,n=w){throw new o(a.ENOTSUP)}unwatchFile(t,e=w){throw new o(a.ENOTSUP)}watch(t,e,n=w){throw new o(a.ENOTSUP)}access(t,e,n=w){throw new o(a.ENOTSUP)}accessSync(t,e){throw new o(a.ENOTSUP)}createReadStream(t,e){throw new o(a.ENOTSUP)}createWriteStream(t,e){throw new o(a.ENOTSUP)}wrapCallbacks(t){h=t}getFdForFile(t){const e=this.nextFd++;return this.fdMap[e]=t,e}fd2file(t){const e=this.fdMap[t];if(e)return e;throw new o(a.EBADF,"Invalid file descriptor.")}closeFd(t){delete this.fdMap[t]}}return k.Stats=c,k}),define("skylark-browserfs/core/node_fs",["./FS"],function(t){"use strict";let e=new t;const n={},r=t.prototype,i=Object.getOwnPropertyNames(r);return i.forEach(t=>{"function"==typeof e[t]?n[t]=function(){return e[t].apply(e,arguments)}:n[t]=e[t]}),n.changeFSModule=function(t){e=t},n.getFSModule=function(){return e},n.FS=t,n.Stats=t.Stats,n}),define("skylark-browserfs/core/levenshtein",[],function(){"use strict";function t(t,e,n,r,i){return t<e||n<e?t>n?n+1:t+1:r===i?e:e+1}return function(e,n){if(e===n)return 0;if(e.length>n.length){const t=e;e=n,n=t}let r=e.length,i=n.length;for(;r>0&&e.charCodeAt(r-1)===n.charCodeAt(i-1);)r--,i--;let s=0;for(;s<r&&e.charCodeAt(s)===n.charCodeAt(s);)s++;if(i-=s,0==(r-=s)||1===i)return i;const o=new Array(r<<1);for(let t=0;t<r;)o[r+t]=e.charCodeAt(s+t),o[t]=++t;let a,l,c,u,h;for(a=0;a+3<i;){const e=n.charCodeAt(s+(l=a)),i=n.charCodeAt(s+(c=a+1)),f=n.charCodeAt(s+(u=a+2)),d=n.charCodeAt(s+(h=a+3));let p=a+=4;for(let n=0;n<r;){const s=o[r+n],a=o[n];l=t(a,l,c,e,s),c=t(l,c,u,i,s),u=t(c,u,h,f,s),p=t(u,h,p,d,s),o[n++]=p,h=u,u=c,c=l,l=a}}let f=0;for(;a<i;){const t=n.charCodeAt(s+(l=a));f=++a;for(let e=0;e<r;e++){const n=o[e];o[e]=f=n<l||f<l?n>f?f+1:n+1:t===o[r+e]?l:l+1,l=n}}return f}}),define("skylark-browserfs/core/util",["../libs/buffers","./api_error","./levenshtein","../libs/path"],function(t,e,n,r){"use strict";const{ErrorCode:i,ApiError:s}=e,{Buffer:o}=t;const a="undefined"!=typeof navigator&&!(!/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())&&-1===navigator.userAgent.indexOf("Trident")),l="undefined"==typeof window;function c(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function u(t){return t instanceof o?t:0===t.byteOffset&&t.byteLength===t.buffer.byteLength?h(t.buffer):o.from(t.buffer,t.byteOffset,t.byteLength)}function h(t){return o.from(t)}let f=null;function d(){return f||(f=o.alloc(0))}return{deprecationMessage:function(t,e,n){t&&console.warn(`[${e}] Direct file system constructor usage is deprecated for this file system, and will be removed in the next major version. Please use the '${e}.Create(${JSON.stringify(n)}, callback)' method instead. See https://github.com/jvilk/BrowserFS/issues/176 for more details.`)},isIE:a,isWebWorker:l,fail:function(){throw new Error("BFS has reached an impossible code path; please file a bug.")},mkdirpSync:function t(e,n,i){i.existsSync(e)||(t(r.dirname(e),n,i),i.mkdirSync(e,n))},buffer2ArrayBuffer:function(t){const e=c(t),n=e.byteOffset,r=e.byteLength;return 0===n&&r===e.buffer.byteLength?e.buffer:e.buffer.slice(n,n+r)},buffer2Uint8array:c,arrayish2Buffer:function(t){return t instanceof o?t:t instanceof Uint8Array?u(t):o.from(t)},uint8Array2Buffer:u,arrayBuffer2Buffer:h,copyingSlice:function(t,e=0,n=t.length){if(e<0||n<0||n>t.length||e>n)throw new TypeError(`Invalid slice bounds on buffer of length ${t.length}: [${e}, ${n}]`);if(0===t.length)return d();{const r=c(t),i=t[0],s=(i+1)%255;return t[0]=s,r[0]===s?(r[0]=i,u(r.slice(e,n))):(t[0]=i,u(r.subarray(e,n)))}},emptyBuffer:d,bufferValidator:function(t,e){o.isBuffer(t)?e():e(new s(i.EINVAL,"option must be a Buffer."))},checkOptions:function(t,e,r){const o=t.Options,a=t.Name;let l=0,c=!1,u=!1;function h(t){c||(t&&(c=!0,r(t)),0===--l&&u&&r())}for(const t in o)if(o.hasOwnProperty(t)){const u=o[t],f=e[t];if(void 0===f||null===f){if(!u.optional){const l=Object.keys(e).filter(t=>!(t in o)).map(e=>({str:e,distance:n(t,e)})).filter(t=>t.distance<5).sort((t,e)=>t.distance-e.distance);if(c)return;return c=!0,r(new s(i.EINVAL,`[${a}] Required option '${t}' not provided.${l.length>0?` You provided unrecognized option '${l[0].str}'; perhaps you meant to type '${t}'.`:""}\nOption description: ${u.description}`))}}else{let e=!1;if(!(e=Array.isArray(u.type)?-1!==u.type.indexOf(typeof f):typeof f===u.type)){if(c)return;return c=!0,r(new s(i.EINVAL,`[${a}] Value provided for option ${t} is not the proper type. Expected ${Array.isArray(u.type)?`one of {${u.type.join(", ")}}`:u.type}, but received ${typeof f}\nOption description: ${u.description}`))}u.validator&&(l++,u.validator(f,h))}}u=!0,0!==l||c||r()}}}),define("skylark-browserfs/generic/emscripten_fs",["../core/node_fs","../core/util"],function(t,e){"use strict";const{uint8Array2Buffer:n}=e;class r{constructor(t){this.fs=t,this.nodefs=t.getNodeFS(),this.FS=t.getFS(),this.PATH=t.getPATH(),this.ERRNO_CODES=t.getERRNO_CODES()}open(t){const e=this.fs.realPath(t.node),n=this.FS;try{n.isFile(t.node.mode)&&(t.nfd=this.nodefs.openSync(e,this.fs.flagsToPermissionString(t.flags)))}catch(t){if(!t.code)throw t;throw new n.ErrnoError(this.ERRNO_CODES[t.code])}}close(t){const e=this.FS;try{e.isFile(t.node.mode)&&t.nfd&&this.nodefs.closeSync(t.nfd)}catch(t){if(!t.code)throw t;throw new e.ErrnoError(this.ERRNO_CODES[t.code])}}read(t,e,r,i,s){try{return this.nodefs.readSync(t.nfd,n(e),r,i,s)}catch(t){throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}write(t,e,r,i,s){try{return this.nodefs.writeSync(t.nfd,n(e),r,i,s)}catch(t){throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}llseek(t,e,n){let r=e;if(1===n)r+=t.position;else if(2===n&&this.FS.isFile(t.node.mode))try{const e=this.nodefs.fstatSync(t.nfd);r+=e.size}catch(t){throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}if(r<0)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return t.position=r,r}}class i{constructor(t){this.fs=t,this.nodefs=t.getNodeFS(),this.FS=t.getFS(),this.PATH=t.getPATH(),this.ERRNO_CODES=t.getERRNO_CODES()}getattr(t){const e=this.fs.realPath(t);let n;try{n=this.nodefs.lstatSync(e)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}return{dev:n.dev,ino:n.ino,mode:n.mode,nlink:n.nlink,uid:n.uid,gid:n.gid,rdev:n.rdev,size:n.size,atime:n.atime,mtime:n.mtime,ctime:n.ctime,blksize:n.blksize,blocks:n.blocks}}setattr(t,e){const n=this.fs.realPath(t);try{if(void 0!==e.mode&&(this.nodefs.chmodSync(n,e.mode),t.mode=e.mode),void 0!==e.timestamp){const t=new Date(e.timestamp);this.nodefs.utimesSync(n,t,t)}}catch(t){if(!t.code)throw t;if("ENOTSUP"!==t.code)throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}if(void 0!==e.size)try{this.nodefs.truncateSync(n,e.size)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}lookup(t,e){const n=this.PATH.join2(this.fs.realPath(t),e),r=this.fs.getMode(n);return this.fs.createNode(t,e,r)}mknod(t,e,n,r){const i=this.fs.createNode(t,e,n,r),s=this.fs.realPath(i);try{this.FS.isDir(i.mode)?this.nodefs.mkdirSync(s,i.mode):this.nodefs.writeFileSync(s,"",{mode:i.mode})}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}return i}rename(t,e,n){const r=this.fs.realPath(t),i=this.PATH.join2(this.fs.realPath(e),n);try{this.nodefs.renameSync(r,i),t.name=n,t.parent=e}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}unlink(t,e){const n=this.PATH.join2(this.fs.realPath(t),e);try{this.nodefs.unlinkSync(n)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}rmdir(t,e){const n=this.PATH.join2(this.fs.realPath(t),e);try{this.nodefs.rmdirSync(n)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}readdir(t){const e=this.fs.realPath(t);try{const t=this.nodefs.readdirSync(e);return t.push(".",".."),t}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}symlink(t,e,n){const r=this.PATH.join2(this.fs.realPath(t),e);try{this.nodefs.symlinkSync(n,r)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}readlink(t){const e=this.fs.realPath(t);try{return this.nodefs.readlinkSync(e)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}}return class{constructor(e=self.FS,n=self.PATH,s=self.ERRNO_CODES,o=t){this.flagsToPermissionStringMap={0:"r",1:"r+",2:"r+",64:"r",65:"r+",66:"r+",129:"rx+",193:"rx+",514:"w+",577:"w",578:"w+",705:"wx",706:"wx+",1024:"a",1025:"a",1026:"a+",1089:"a",1090:"a+",1153:"ax",1154:"ax+",1217:"ax",1218:"ax+",4096:"rs",4098:"rs+"},this.nodefs=o,this.FS=e,this.PATH=n,this.ERRNO_CODES=s,this.node_ops=new i(this),this.stream_ops=new r(this)}mount(t){return this.createNode(null,"/",this.getMode(t.opts.root),0)}createNode(t,e,n,r){const i=this.FS;if(!i.isDir(n)&&!i.isFile(n)&&!i.isLink(n))throw new i.ErrnoError(this.ERRNO_CODES.EINVAL);const s=i.createNode(t,e,n);return s.node_ops=this.node_ops,s.stream_ops=this.stream_ops,s}getMode(t){let e;try{e=this.nodefs.lstatSync(t)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}return e.mode}realPath(t){const e=[];for(;t.parent!==t;)e.push(t.name),t=t.parent;return e.push(t.mount.opts.root),e.reverse(),this.PATH.join.apply(null,e)}flagsToPermissionString(t){let e="string"==typeof t?parseInt(t,10):t;return(e&=8191)in this.flagsToPermissionStringMap?this.flagsToPermissionStringMap[e]:t}getNodeFS(){return this.nodefs}getFS(){return this.FS}getPATH(){return this.PATH}getERRNO_CODES(){return this.ERRNO_CODES}}}),define("skylark-browserfs/core/file_system",["../libs/buffers","./api_error","./file_flag","../libs/path","./util"],function(t,e,n,r,i){"use strict";const{ApiError:s,ErrorCode:o}=e,{FileFlag:a,ActionType:l}=n,{fail:c}=i;class u{supportsLinks(){return!1}diskSpace(t,e){e(0,0)}openFile(t,e,n){throw new s(o.ENOTSUP)}createFile(t,e,n,r){throw new s(o.ENOTSUP)}open(t,e,n,i){this.stat(t,!1,(a,u)=>{if(a)switch(e.pathNotExistsAction()){case l.CREATE_FILE:return this.stat(r.dirname(t),!1,(o,a)=>{o?i(o):a&&!a.isDirectory()?i(s.ENOTDIR(r.dirname(t))):this.createFile(t,e,n,i)});case l.THROW_EXCEPTION:return i(s.ENOENT(t));default:return i(new s(o.EINVAL,"Invalid FileFlag object."))}else{if(u&&u.isDirectory())return i(s.EISDIR(t));switch(e.pathExistsAction()){case l.THROW_EXCEPTION:return i(s.EEXIST(t));case l.TRUNCATE_FILE:return this.openFile(t,e,(t,e)=>{t?i(t):e?e.truncate(0,()=>{e.sync(()=>{i(null,e)})}):c()});case l.NOP:return this.openFile(t,e,i);default:return i(new s(o.EINVAL,"Invalid FileFlag object."))}}})}rename(t,e,n){n(new s(o.ENOTSUP))}renameSync(t,e){throw new s(o.ENOTSUP)}stat(t,e,n){n(new s(o.ENOTSUP))}statSync(t,e){throw new s(o.ENOTSUP)}openFileSync(t,e,n){throw new s(o.ENOTSUP)}createFileSync(t,e,n){throw new s(o.ENOTSUP)}openSync(t,e,n){let i;try{i=this.statSync(t,!1)}catch(i){switch(e.pathNotExistsAction()){case l.CREATE_FILE:const i=this.statSync(r.dirname(t),!1);if(!i.isDirectory())throw s.ENOTDIR(r.dirname(t));return this.createFileSync(t,e,n);case l.THROW_EXCEPTION:throw s.ENOENT(t);default:throw new s(o.EINVAL,"Invalid FileFlag object.")}}if(i.isDirectory())throw s.EISDIR(t);switch(e.pathExistsAction()){case l.THROW_EXCEPTION:throw s.EEXIST(t);case l.TRUNCATE_FILE:return this.unlinkSync(t),this.createFileSync(t,e,i.mode);case l.NOP:return this.openFileSync(t,e,n);default:throw new s(o.EINVAL,"Invalid FileFlag object.")}}unlink(t,e){e(new s(o.ENOTSUP))}unlinkSync(t){throw new s(o.ENOTSUP)}rmdir(t,e){e(new s(o.ENOTSUP))}rmdirSync(t){throw new s(o.ENOTSUP)}mkdir(t,e,n){n(new s(o.ENOTSUP))}mkdirSync(t,e){throw new s(o.ENOTSUP)}readdir(t,e){e(new s(o.ENOTSUP))}readdirSync(t){throw new s(o.ENOTSUP)}exists(t,e){this.stat(t,null,function(t){e(!t)})}existsSync(t){try{return this.statSync(t,!0),!0}catch(t){return!1}}realpath(t,e,n){if(this.supportsLinks()){const e=t.split(r.sep);for(let t=0;t<e.length;t++){const n=e.slice(0,t+1);e[t]=r.join.apply(null,n)}}else this.exists(t,function(e){e?n(null,t):n(s.ENOENT(t))})}realpathSync(t,e){if(this.supportsLinks()){const e=t.split(r.sep);for(let t=0;t<e.length;t++){const n=e.slice(0,t+1);e[t]=r.join.apply(r,n)}return e.join(r.sep)}if(this.existsSync(t))return t;throw s.ENOENT(t)}truncate(t,e,n){this.open(t,a.getFileFlag("r+"),420,function(t,r){if(t)return n(t);r.truncate(e,function(t){r.close(function(e){n(t||e)})})})}truncateSync(t,e){const n=this.openSync(t,a.getFileFlag("r+"),420);try{n.truncateSync(e)}catch(t){throw t}finally{n.closeSync()}}readFile(t,e,n,r){const i=r;this.open(t,n,420,(t,n)=>{if(t)return r(t);r=function(t,e){n.close(function(n){return t||(t=n),i(t,e)})},n.stat((t,i)=>{if(t)return r(t);const s=Buffer.alloc(i.size);n.read(s,0,i.size,0,t=>{if(t)return r(t);if(null===e)return r(t,s);try{r(null,s.toString(e))}catch(t){r(t)}})})})}readFileSync(t,e,n){const r=this.openSync(t,n,420);try{const t=r.statSync(),n=Buffer.alloc(t.size);return r.readSync(n,0,t.size,0),r.closeSync(),null===e?n:n.toString(e)}finally{r.closeSync()}}writeFile(t,e,n,r,i,s){const o=s;this.open(t,r,420,function(t,r){if(t)return s(t);s=function(t){r.close(function(e){o(t||e)})};try{"string"==typeof e&&(e=Buffer.from(e,n))}catch(t){return s(t)}r.write(e,0,e.length,0,s)})}writeFileSync(t,e,n,r,i){const s=this.openSync(t,r,i);try{"string"==typeof e&&(e=Buffer.from(e,n)),s.writeSync(e,0,e.length,0)}finally{s.closeSync()}}appendFile(t,e,n,r,i,s){const o=s;this.open(t,r,i,function(t,r){if(t)return s(t);s=function(t){r.close(function(e){o(t||e)})},"string"==typeof e&&(e=Buffer.from(e,n)),r.write(e,0,e.length,null,s)})}appendFileSync(t,e,n,r,i){const s=this.openSync(t,r,i);try{"string"==typeof e&&(e=Buffer.from(e,n)),s.writeSync(e,0,e.length,null)}finally{s.closeSync()}}chmod(t,e,n,r){r(new s(o.ENOTSUP))}chmodSync(t,e,n){throw new s(o.ENOTSUP)}chown(t,e,n,r,i){i(new s(o.ENOTSUP))}chownSync(t,e,n,r){throw new s(o.ENOTSUP)}utimes(t,e,n,r){r(new s(o.ENOTSUP))}utimesSync(t,e,n){throw new s(o.ENOTSUP)}link(t,e,n){n(new s(o.ENOTSUP))}linkSync(t,e){throw new s(o.ENOTSUP)}symlink(t,e,n,r){r(new s(o.ENOTSUP))}symlinkSync(t,e,n){throw new s(o.ENOTSUP)}readlink(t,e){e(new s(o.ENOTSUP))}readlinkSync(t){throw new s(o.ENOTSUP)}}return{BaseFileSystem:u,SynchronousFileSystem:class extends u{supportsSynch(){return!0}rename(t,e,n){try{this.renameSync(t,e),n()}catch(t){n(t)}}stat(t,e,n){try{n(null,this.statSync(t,e))}catch(t){n(t)}}open(t,e,n,r){try{r(null,this.openSync(t,e,n))}catch(t){r(t)}}unlink(t,e){try{this.unlinkSync(t),e()}catch(t){e(t)}}rmdir(t,e){try{this.rmdirSync(t),e()}catch(t){e(t)}}mkdir(t,e,n){try{this.mkdirSync(t,e),n()}catch(t){n(t)}}readdir(t,e){try{e(null,this.readdirSync(t))}catch(t){e(t)}}chmod(t,e,n,r){try{this.chmodSync(t,e,n),r()}catch(t){r(t)}}chown(t,e,n,r,i){try{this.chownSync(t,e,n,r),i()}catch(t){i(t)}}utimes(t,e,n,r){try{this.utimesSync(t,e,n),r()}catch(t){r(t)}}link(t,e,n){try{this.linkSync(t,e),n()}catch(t){n(t)}}symlink(t,e,n,r){try{this.symlinkSync(t,e,n),r()}catch(t){r(t)}}readlink(t,e){try{e(null,this.readlinkSync(t))}catch(t){e(t)}}}}}),define("skylark-browserfs/core/file",["./api_error"],function(t){"use strict";const{ApiError:e,ErrorCode:n}=t;return{BaseFile:class{sync(t){t(new e(n.ENOTSUP))}syncSync(){throw new e(n.ENOTSUP)}datasync(t){this.sync(t)}datasyncSync(){return this.syncSync()}chown(t,r,i){i(new e(n.ENOTSUP))}chownSync(t,r){throw new e(n.ENOTSUP)}chmod(t,r){r(new e(n.ENOTSUP))}chmodSync(t){throw new e(n.ENOTSUP)}utimes(t,r,i){i(new e(n.ENOTSUP))}utimesSync(t,r){throw new e(n.ENOTSUP)}}}}),define("skylark-browserfs/generic/preload_file",["../libs/buffers","../core/file","../core/node_fs_stats","../core/api_error","../core/node_fs","../core/util"],function(t,e,n,r,i,s){"use strict";const{BaseFile:o}=e,{ApiError:a,ErrorCode:l}=r,{emptyBuffer:c}=s,{Buffer:u}=t;class h extends o{constructor(t,e,n,r,i){if(super(),this._pos=0,this._dirty=!1,this._fs=t,this._path=e,this._flag=n,this._stat=r,this._buffer=i||c(),this._stat.size!==this._buffer.length&&this._flag.isReadable())throw new Error(`Invalid buffer: Buffer is ${this._buffer.length} long, yet Stats object specifies that file is ${this._stat.size} long.`)}getBuffer(){return this._buffer}getStats(){return this._stat}getFlag(){return this._flag}getPath(){return this._path}getPos(){return this._flag.isAppendable()?this._stat.size:this._pos}advancePos(t){return this._pos+=t}setPos(t){return this._pos=t}sync(t){try{this.syncSync(),t()}catch(e){t(e)}}syncSync(){throw new a(l.ENOTSUP)}close(t){try{this.closeSync(),t()}catch(e){t(e)}}closeSync(){throw new a(l.ENOTSUP)}stat(t){try{t(null,n.clone(this._stat))}catch(e){t(e)}}statSync(){return n.clone(this._stat)}truncate(t,e){try{this.truncateSync(t),this._flag.isSynchronous()&&!i.getRootFS().supportsSynch()&&this.sync(e),e()}catch(t){return e(t)}}truncateSync(t){if(this._dirty=!0,!this._flag.isWriteable())throw new a(l.EPERM,"File not opened with a writeable mode.");if(this._stat.mtimeMs=Date.now(),t>this._buffer.length){const e=u.alloc(t-this._buffer.length,0);return this.writeSync(e,0,e.length,this._buffer.length),void(this._flag.isSynchronous()&&i.getRootFS().supportsSynch()&&this.syncSync())}this._stat.size=t;const e=u.alloc(t);this._buffer.copy(e,0,0,t),this._buffer=e,this._flag.isSynchronous()&&i.getRootFS().supportsSynch()&&this.syncSync()}write(t,e,n,r,i){try{i(null,this.writeSync(t,e,n,r),t)}catch(t){i(t)}}writeSync(t,e,n,r){if(this._dirty=!0,void 0!==r&&null!==r||(r=this.getPos()),!this._flag.isWriteable())throw new a(l.EPERM,"File not opened with a writeable mode.");const i=r+n;if(i>this._stat.size&&(this._stat.size=i,i>this._buffer.length)){const t=u.alloc(i);this._buffer.copy(t),this._buffer=t}const s=t.copy(this._buffer,r,e,e+n);return this._stat.mtimeMs=Date.now(),this._flag.isSynchronous()?(this.syncSync(),s):(this.setPos(r+s),s)}read(t,e,n,r,i){try{i(null,this.readSync(t,e,n,r),t)}catch(t){i(t)}}readSync(t,e,n,r){if(!this._flag.isReadable())throw new a(l.EPERM,"File not opened with a readable mode.");void 0!==r&&null!==r||(r=this.getPos());const i=r+n;i>this._stat.size&&(n=this._stat.size-r);const s=this._buffer.copy(t,e,r,r+n);return this._stat.atimeMs=Date.now(),this._pos=r+n,s}chmod(t,e){try{this.chmodSync(t),e()}catch(t){e(t)}}chmodSync(t){if(!this._fs.supportsProps())throw new a(l.ENOTSUP);this._dirty=!0,this._stat.chmod(t),this.syncSync()}isDirty(){return this._dirty}resetDirty(){this._dirty=!1}}return{PreloadFile:h,NoSyncFile:class extends h{constructor(t,e,n,r,i){super(t,e,n,r,i)}sync(t){t()}syncSync(){}close(t){t()}closeSync(){}}}}),define("skylark-browserfs/backend/AsyncMirror",["../core/file_system","../core/api_error","../core/file_flag","../generic/preload_file","../libs/path"],function(t,e,n,r,i){"use strict";const{SynchronousFileSystem:s}=t,{ApiError:o,ErrorCode:a}=e,{FileFlag:l}=n,{PreloadFile:c}=r;class u extends c{constructor(t,e,n,r,i){super(t,e,n,r,i)}syncSync(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())}closeSync(){this.syncSync()}}class h extends s{constructor(t,e){super(),this._queue=[],this._queueRunning=!1,this._isInitialized=!1,this._initializeCallbacks=[],this._sync=t,this._async=e}static Create(t,e){try{const n=new h(t.sync,t.async);n._initialize(t=>{t?e(t):e(null,n)})}catch(t){e(t)}}static isAvailable(){return!0}getName(){return h.Name}_syncSync(t){this._sync.writeFileSync(t.getPath(),t.getBuffer(),null,l.getFileFlag("w"),t.getStats().mode),this.enqueueOp({apiMethod:"writeFile",arguments:[t.getPath(),t.getBuffer(),null,t.getFlag(),t.getStats().mode]})}isReadOnly(){return!1}supportsSynch(){return!0}supportsLinks(){return!1}supportsProps(){return this._sync.supportsProps()&&this._async.supportsProps()}renameSync(t,e){this._sync.renameSync(t,e),this.enqueueOp({apiMethod:"rename",arguments:[t,e]})}statSync(t,e){return this._sync.statSync(t,e)}openSync(t,e,n){const r=this._sync.openSync(t,e,n);return r.closeSync(),new u(this,t,e,this._sync.statSync(t,!1),this._sync.readFileSync(t,null,l.getFileFlag("r")))}unlinkSync(t){this._sync.unlinkSync(t),this.enqueueOp({apiMethod:"unlink",arguments:[t]})}rmdirSync(t){this._sync.rmdirSync(t),this.enqueueOp({apiMethod:"rmdir",arguments:[t]})}mkdirSync(t,e){this._sync.mkdirSync(t,e),this.enqueueOp({apiMethod:"mkdir",arguments:[t,e]})}readdirSync(t){return this._sync.readdirSync(t)}existsSync(t){return this._sync.existsSync(t)}chmodSync(t,e,n){this._sync.chmodSync(t,e,n),this.enqueueOp({apiMethod:"chmod",arguments:[t,e,n]})}chownSync(t,e,n,r){this._sync.chownSync(t,e,n,r),this.enqueueOp({apiMethod:"chown",arguments:[t,e,n,r]})}utimesSync(t,e,n){this._sync.utimesSync(t,e,n),this.enqueueOp({apiMethod:"utimes",arguments:[t,e,n]})}_initialize(t){const e=this._initializeCallbacks,n=t=>{this._isInitialized=!t,this._initializeCallbacks=[],e.forEach(e=>e(t))};if(this._isInitialized)t();else if(1===e.push(t)){const t=(t,e,n)=>{"/"!==t&&this._sync.mkdirSync(t,e),this._async.readdir(t,(e,s)=>{let o=0;e?n(e):function e(a){a?n(a):o<s.length?(r(i.join(t,s[o]),e),o++):n()}()})},e=(t,e,n)=>{this._async.readFile(t,null,l.getFileFlag("r"),(r,i)=>{if(r)n(r);else try{this._sync.writeFileSync(t,i,null,l.getFileFlag("w"),e)}catch(t){r=t}finally{n(r)}})},r=(n,r)=>{this._async.stat(n,!1,(i,s)=>{i?r(i):s.isDirectory()?t(n,s.mode,r):e(n,s.mode,r)})};t("/",0,n)}}enqueueOp(t){if(this._queue.push(t),!this._queueRunning){this._queueRunning=!0;const t=e=>{if(e)throw new Error(`WARNING: File system has desynchronized. Received following error: ${e}\n$`);if(this._queue.length>0){const e=this._queue.shift(),n=e.arguments;n.push(t),this._async[e.apiMethod].apply(this._async,n)}else this._queueRunning=!1};t()}}}return h.Name="AsyncMirror",h.Options={sync:{type:"object",description:"The synchronous file system to mirror the asynchronous file system to.",validator:(t,e)=>{t&&"function"==typeof t.supportsSynch&&t.supportsSynch()?e():e(new o(a.EINVAL,"'sync' option must be a file system that supports synchronous operations"))}},async:{type:"object",description:"The asynchronous file system to mirror."}},h}),define("skylark-browserfs/backend/Dropbox",["../libs/buffers","../generic/preload_file","../core/file_system","../core/node_fs_stats","../core/api_error","../core/util","../generic/setImmediate","../libs/path"],function(t,e,n,r,i,s,o,a){"use strict";const{BaseFileSystem:l}=n,{Stats:c,FileType:u}=r,{ApiError:h,ErrorCode:f}=i,{arrayBuffer2Buffer:d,buffer2ArrayBuffer:p}=s,{dirname:m}=a,{PreloadFile:y}=e,{Buffer:g}=t;function w(t){return"/"===t?"":t}function k(t){const e=t.error;if(e[".tag"])return e;if(e.error){const t=e.error;return t[".tag"]?t:t.reason&&t.reason[".tag"]?t.reason:t}if("string"==typeof e)try{const n=JSON.parse(e);if(n.error&&n.error.reason&&n.error.reason[".tag"])return n.error.reason}catch(t){}return e}function x(t){if(t.user_message)return t.user_message.text;if(t.error_summary)return t.error_summary;if("string"==typeof t.error)return t.error;if("object"==typeof t.error)return x(t.error);throw new Error(`Dropbox's servers gave us a garbage error message: ${JSON.stringify(t)}`)}function v(t,e,n){switch(t[".tag"]){case"malformed_path":return new h(f.EBADF,n,e);case"not_found":return h.ENOENT(e);case"not_file":return h.EISDIR(e);case"not_folder":return h.ENOTDIR(e);case"restricted_content":return h.EPERM(e);case"other":default:return new h(f.EIO,n,e)}}function _(t,e,n){switch(t[".tag"]){case"malformed_path":case"disallowed_name":return new h(f.EBADF,n,e);case"conflict":case"no_write_permission":case"team_folder":return h.EPERM(e);case"insufficient_space":return new h(f.ENOSPC,n);case"other":default:return new h(f.EIO,n,e)}}function b(t,e,n){const r={path:w(e)};t.filesDeleteV2(r).then(()=>{n()}).catch(r=>{const i=k(r);switch(i[".tag"]){case"path_lookup":n(v(i.path_lookup,e,x(r)));break;case"path_write":n(_(i.path_write,e,x(r)));break;case"too_many_write_operations":setTimeout(()=>b(t,e,n),500+300*Math.random());break;case"other":default:n(new h(f.EIO,x(r),e))}})}class E extends y{constructor(t,e,n,r,i){super(t,e,n,r,i)}sync(t){this._fs._syncFile(this.getPath(),this.getBuffer(),t)}close(t){this.sync(t)}}class S extends l{constructor(t){super(),this._client=t}static Create(t,e){e(null,new S(t.client))}static isAvailable(){return"undefined"!=typeof Dropbox}getName(){return S.Name}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!1}supportsSynch(){return!1}empty(t){this.readdir("/",(e,n)=>{if(n){const e=r=>{0===n.length?t():b(this._client,n.shift(),e)};e()}else t(e)})}rename(t,e,n){this.stat(e,!1,(r,i)=>{const s=()=>{const r={from_path:w(t),to_path:w(e)};this._client.filesMoveV2(r).then(()=>n()).catch(function(r){const i=k(r);switch(i[".tag"]){case"from_lookup":n(v(i.from_lookup,t,x(r)));break;case"from_write":n(_(i.from_write,t,x(r)));break;case"to":n(_(i.to,e,x(r)));break;case"cant_copy_shared_folder":case"cant_nest_shared_folder":n(new h(f.EPERM,x(r),t));break;case"cant_move_folder_into_itself":case"duplicated_or_nested_paths":n(new h(f.EBADF,x(r),t));break;case"too_many_files":n(new h(f.ENOSPC,x(r),t));break;case"other":default:n(new h(f.EIO,x(r),t))}})};r?s():t===e?r?n(h.ENOENT(e)):n():i&&i.isDirectory()?n(h.EISDIR(e)):this.unlink(e,t=>{t?n(t):s()})})}stat(t,e,n){if("/"===t)return void o(function(){n(null,new c(u.DIRECTORY,4096))});const r={path:w(t)};this._client.filesGetMetadata(r).then(e=>{switch(e[".tag"]){case"file":const r=e;n(null,new c(u.FILE,r.size));break;case"folder":n(null,new c(u.DIRECTORY,4096));break;case"deleted":n(h.ENOENT(t))}}).catch(e=>{const r=k(e);switch(r[".tag"]){case"path":n(v(r.path,t,x(e)));break;default:n(new h(f.EIO,x(e),t))}})}openFile(t,e,n){const r={path:w(t)};this._client.filesDownload(r).then(r=>{const i=r.fileBlob,s=new FileReader;s.onload=(()=>{const r=s.result;n(null,new E(this,t,e,new c(u.FILE,r.byteLength),d(r)))}),s.readAsArrayBuffer(i)}).catch(e=>{const r=k(e);switch(r[".tag"]){case"path":const i=r;n(v(i.path,t,x(e)));break;case"other":default:n(new h(f.EIO,x(e),t))}})}createFile(t,e,n,r){const i=g.alloc(0),s=new Blob([p(i)],{type:"octet/stream"}),o={contents:s,path:w(t)};this._client.filesUpload(o).then(n=>{r(null,new E(this,t,e,new c(u.FILE,0),i))}).catch(i=>{const s=k(i);switch(s[".tag"]){case"path":const o=s;r(_(o.path.reason,t,x(i)));break;case"too_many_write_operations":setTimeout(()=>this.createFile(t,e,n,r),500+300*Math.random());break;case"other":default:r(new h(f.EIO,x(i),t))}})}unlink(t,e){this.stat(t,!1,(n,r)=>{r?r.isDirectory()?e(h.EISDIR(t)):b(this._client,t,e):e(n)})}rmdir(t,e){this.readdir(t,(n,r)=>{r?r.length>0?e(h.ENOTEMPTY(t)):b(this._client,t,e):e(n)})}mkdir(t,e,n){const r=m(t);this.stat(r,!1,(i,s)=>{if(i)n(i);else if(s&&!s.isDirectory())n(h.ENOTDIR(r));else{const r={path:w(t)};this._client.filesCreateFolderV2(r).then(()=>n()).catch(r=>{const i=k(r);"too_many_write_operations"===i[".tag"]?setTimeout(()=>this.mkdir(t,e,n),500+300*Math.random()):n(_(k(r).path,t,x(r)))})}})}readdir(t,e){const n={path:w(t)};this._client.filesListFolder(n).then(n=>{!function t(e,n,r,i,s){const o=r.entries.map(t=>t.path_display).filter(t=>!!t);const a=i.concat(o);if(r.has_more){const i={cursor:r.cursor};e.filesListFolderContinue(i).then(r=>{t(e,n,r,a,s)}).catch(t=>{T(t,n,s)})}else s(null,a)}(this._client,t,n,[],e)}).catch(n=>{T(n,t,e)})}_syncFile(t,e,n){const r=new Blob([p(e)],{type:"octet/stream"}),i={contents:r,path:w(t),mode:{".tag":"overwrite"}};this._client.filesUpload(i).then(()=>{n()}).catch(r=>{const i=k(r);switch(i[".tag"]){case"path":const s=i;n(_(s.path.reason,t,x(r)));break;case"too_many_write_operations":setTimeout(()=>this._syncFile(t,e,n),500+300*Math.random());break;case"other":default:n(new h(f.EIO,x(r),t))}})}}function T(t,e,n){const r=k(t);switch(r[".tag"]){case"path":const i=r;n(v(i.path,e,x(t)));break;case"other":default:n(new h(f.EIO,x(t),e))}}return S.Name="DropboxV2",S.Options={client:{type:"object",description:"An *authenticated* Dropbox client. Must be from the 2.5.x JS SDK."}},S.DropboxFile=E,S}),define("skylark-browserfs/backend/Emscripten",["../libs/buffers","../core/file_system","../core/node_fs_stats","../core/file","../core/util","../core/api_error"],function(t,e,n,r,i,s){"use strict";const{SynchronousFileSystem:o}=e,{Stats:a,FileType:l}=n,{BaseFile:c}=r,{uint8Array2Buffer:u,buffer2Uint8array:h}=i,{ApiError:f,ErrorCode:d,ErrorStrings:p}=s,{Buffer:m}=t;function y(t,e=""){const n=t.errno;let r=t.node;const i=[];for(;r&&(i.unshift(r.name),r!==r.parent);)r=r.parent;return new f(n,p[n],i.length>0?"/"+i.join("/"):e)}class g extends c{constructor(t,e,n,r){super(),this._fs=t,this._FS=e,this._path=n,this._stream=r}getPos(){}close(t){let e=null;try{this.closeSync()}catch(t){e=t}finally{t(e)}}closeSync(){try{this._FS.close(this._stream)}catch(t){throw y(t,this._path)}}stat(t){try{t(null,this.statSync())}catch(e){t(e)}}statSync(){try{return this._fs.statSync(this._path,!1)}catch(t){throw y(t,this._path)}}truncate(t,e){let n=null;try{this.truncateSync(t)}catch(t){n=t}finally{e(n)}}truncateSync(t){try{this._FS.ftruncate(this._stream.fd,t)}catch(t){throw y(t,this._path)}}write(t,e,n,r,i){try{i(null,this.writeSync(t,e,n,r),t)}catch(t){i(t)}}writeSync(t,e,n,r){try{const i=h(t),s=null===r?void 0:r;return this._FS.write(this._stream,i,e,n,s)}catch(t){throw y(t,this._path)}}read(t,e,n,r,i){try{i(null,this.readSync(t,e,n,r),t)}catch(t){i(t)}}readSync(t,e,n,r){try{const i=h(t),s=null===r?void 0:r;return this._FS.read(this._stream,i,e,n,s)}catch(t){throw y(t,this._path)}}sync(t){t()}syncSync(){}chown(t,e,n){let r=null;try{this.chownSync(t,e)}catch(t){r=t}finally{n(r)}}chownSync(t,e){try{this._FS.fchown(this._stream.fd,t,e)}catch(t){throw y(t,this._path)}}chmod(t,e){let n=null;try{this.chmodSync(t)}catch(t){n=t}finally{e(n)}}chmodSync(t){try{this._FS.fchmod(this._stream.fd,t)}catch(t){throw y(t,this._path)}}utimes(t,e,n){let r=null;try{this.utimesSync(t,e)}catch(t){r=t}finally{n(r)}}utimesSync(t,e){this._fs.utimesSync(this._path,t,e)}}class w extends o{constructor(t){super(),this._FS=t}static Create(t,e){e(null,new w(t.FS))}static isAvailable(){return!0}getName(){return this._FS.DB_NAME()}isReadOnly(){return!1}supportsLinks(){return!0}supportsProps(){return!0}supportsSynch(){return!0}renameSync(t,e){try{this._FS.rename(t,e)}catch(n){throw n.errno===d.ENOENT?y(n,this.existsSync(t)?e:t):y(n)}}statSync(t,e){try{const n=e?this._FS.lstat(t):this._FS.stat(t),r=this.modeToFileType(n.mode);return new a(r,n.size,n.mode,n.atime.getTime(),n.mtime.getTime(),n.ctime.getTime())}catch(e){throw y(e,t)}}openSync(t,e,n){try{const r=this._FS.open(t,e.getFlagString(),n);if(this._FS.isDir(r.node.mode))throw this._FS.close(r),f.EISDIR(t);return new g(this,this._FS,t,r)}catch(e){throw y(e,t)}}unlinkSync(t){try{this._FS.unlink(t)}catch(e){throw y(e,t)}}rmdirSync(t){try{this._FS.rmdir(t)}catch(e){throw y(e,t)}}mkdirSync(t,e){try{this._FS.mkdir(t,e)}catch(e){throw y(e,t)}}readdirSync(t){try{return this._FS.readdir(t).filter(t=>"."!==t&&".."!==t)}catch(e){throw y(e,t)}}truncateSync(t,e){try{this._FS.truncate(t,e)}catch(e){throw y(e,t)}}readFileSync(t,e,n){try{const r=this._FS.readFile(t,{flags:n.getFlagString()}),i=u(r);return e?i.toString(e):i}catch(e){throw y(e,t)}}writeFileSync(t,e,n,r,i){try{n&&(e=m.from(e,n));const s=h(e);this._FS.writeFile(t,s,{flags:r.getFlagString(),encoding:"binary"}),this._FS.chmod(t,i)}catch(e){throw y(e,t)}}chmodSync(t,e,n){try{e?this._FS.lchmod(t,n):this._FS.chmod(t,n)}catch(e){throw y(e,t)}}chownSync(t,e,n,r){try{e?this._FS.lchown(t,n,r):this._FS.chown(t,n,r)}catch(e){throw y(e,t)}}symlinkSync(t,e,n){try{this._FS.symlink(t,e)}catch(t){throw y(t)}}readlinkSync(t){try{return this._FS.readlink(t)}catch(e){throw y(e,t)}}utimesSync(t,e,n){try{this._FS.utime(t,e.getTime(),n.getTime())}catch(e){throw y(e,t)}}modeToFileType(t){if(this._FS.isDir(t))return l.DIRECTORY;if(this._FS.isFile(t))return l.FILE;if(this._FS.isLink(t))return l.SYMLINK;throw f.EPERM(`Invalid mode: ${t}`)}}return w.Name="EmscriptenFileSystem",w.Options={FS:{type:"object",description:"The Emscripten file system to use (the `FS` variable)"}},w.EmscriptenFile=g,w}),define("skylark-browserfs/backend/FolderAdapter",["../core/file_system","../libs/path","../core/api_error"],function(t,e,n){"use strict";const{BaseFileSystem:r}=t,{ApiError:i}=n;class s extends r{constructor(t,e){super(),this._folder=t,this._wrapped=e}static Create(t,e){const n=new s(t.folder,t.wrapped);n._initialize(function(t){t?e(t):e(null,n)})}static isAvailable(){return!0}getName(){return this._wrapped.getName()}isReadOnly(){return this._wrapped.isReadOnly()}supportsProps(){return this._wrapped.supportsProps()}supportsSynch(){return this._wrapped.supportsSynch()}supportsLinks(){return!1}_initialize(t){this._wrapped.exists(this._folder,e=>{e?t():this._wrapped.isReadOnly()?t(i.ENOENT(this._folder)):this._wrapped.mkdir(this._folder,511,t)})}}function o(t,n){if(null!==n&&"object"==typeof n){const r=n;let i=r.path;i&&(i="/"+e.relative(t,i),r.message=r.message.replace(r.path,i),r.path=i)}return n}function a(t,n,r){return"Sync"!==t.slice(t.length-4)?function(){var i,s;return arguments.length>0&&(n&&(arguments[0]=e.join(this._folder,arguments[0])),r&&(arguments[1]=e.join(this._folder,arguments[1])),arguments[arguments.length-1]=(i=this._folder,"function"==typeof(s=arguments[arguments.length-1])?function(t){arguments.length>0&&(arguments[0]=o(i,t)),s.apply(null,arguments)}:s)),this._wrapped[t].apply(this._wrapped,arguments)}:function(){try{return n&&(arguments[0]=e.join(this._folder,arguments[0])),r&&(arguments[1]=e.join(this._folder,arguments[1])),this._wrapped[t].apply(this._wrapped,arguments)}catch(t){throw o(this._folder,t)}}}return s.Name="FolderAdapter",s.Options={folder:{type:"string",description:"The folder to use as the root directory"},wrapped:{type:"object",description:"The file system to wrap"}},["diskSpace","stat","statSync","open","openSync","unlink","unlinkSync","rmdir","rmdirSync","mkdir","mkdirSync","readdir","readdirSync","exists","existsSync","realpath","realpathSync","truncate","truncateSync","readFile","readFileSync","writeFile","writeFileSync","appendFile","appendFileSync","chmod","chmodSync","chown","chownSync","utimes","utimesSync","readlink","readlinkSync"].forEach(t=>{s.prototype[t]=a(t,!0,!1)}),["rename","renameSync","link","linkSync","symlink","symlinkSync"].forEach(t=>{s.prototype[t]=a(t,!0,!0)}),s}),define("skylark-browserfs/backend/HTML5FS",["skylark-langx-async","../generic/preload_file","../core/file_system","../core/api_error","../core/file_flag","../core/node_fs_stats","../libs/path","../core/global","../core/util"],function(t,e,n,r,i,s,o,a,l){"use strict";const{BaseFileSystem:c}=n,{ApiError:u,ErrorCode:h}=r,{ActionType:f}=i,{Stats:d,FileType:p}=s,m=t.each,{buffer2ArrayBuffer:y,arrayBuffer2Buffer:g}=l,{PreloadFile:w}=e;const k=a.webkitRequestFileSystem||a.requestFileSystem||null;function x(t,e,n){switch(t.name){case"PathExistsError":return u.EEXIST(e);case"QuotaExceededError":return u.FileError(h.ENOSPC,e);case"NotFoundError":return u.ENOENT(e);case"SecurityError":return u.FileError(h.EACCES,e);case"InvalidModificationError":return u.FileError(h.EPERM,e);case"TypeMismatchError":return u.FileError(n?h.ENOTDIR:h.EISDIR,e);case"EncodingError":case"InvalidStateError":case"NoModificationAllowedError":default:return u.FileError(h.EINVAL,e)}}class v extends w{constructor(t,e,n,r,i,s){super(t,n,r,i,s),this._entry=e}sync(t){if(!this.isDirty())return t();this._entry.createWriter(e=>{const n=this.getBuffer(),r=new Blob([y(n)]),i=r.size;e.onwriteend=(n=>{e.onwriteend=null,e.onerror=null,e.truncate(i),this.resetDirty(),t()}),e.onerror=(e=>{t(x(e,this.getPath(),!1))}),e.write(r)})}close(t){this.sync(t)}}class _ extends c{constructor(t=5,e=a.PERSISTENT){super(),this.size=1048576*t,this.type=e}static Create(t,e){const n=new _(t.size,t.type);n._allocate(t=>t?e(t):e(null,n))}static isAvailable(){return!!k}getName(){return _.Name}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!1}supportsSynch(){return!1}empty(t){this._readdir("/",(e,n)=>{if(e)t(e);else{const r=n=>{e?t(e):t()},i=(t,e)=>{const n=()=>{e()},r=n=>{e(x(n,t.fullPath,!t.isDirectory))};t.isDirectory?t.removeRecursively(n,r):t.remove(n,r)};m(n,i,r)}})}rename(t,e,n){let r=2,i=0;const s=this.fs.root;let a=t;const l=t=>{--r<=0&&n(x(t,a,!1))},c=r=>2==++i?n(new u(h.EINVAL,"Something was identified as both a file and a directory. This should never happen.")):t===e?n():(a=o.dirname(e),void s.getDirectory(a,{},i=>{a=o.basename(e),r.moveTo(i,a,t=>{n()},i=>{r.isDirectory?(a=e,this.unlink(e,r=>{r?l(i):this.rename(t,e,n)})):l(i)})},l));s.getFile(t,{},c,l),s.getDirectory(t,{},c,l)}stat(t,e,n){const r={create:!1},i=t=>{const e=new d(p.DIRECTORY,4096);n(null,e)},s=e=>{n(x(e,t,!1))};this.fs.root.getFile(t,r,t=>{t.file(t=>{const e=new d(p.FILE,t.size);n(null,e)},s)},()=>{this.fs.root.getDirectory(t,r,i,s)})}open(t,e,n,r){const i=n=>{"InvalidModificationError"===n.name&&e.isExclusive()?r(u.EEXIST(t)):r(x(n,t,!1))};this.fs.root.getFile(t,{create:e.pathNotExistsAction()===f.CREATE_FILE,exclusive:e.isExclusive()},n=>{n.file(s=>{const o=new FileReader;o.onloadend=(i=>{const a=this._makeFile(t,n,e,s,o.result);r(null,a)}),o.onerror=(t=>{i(o.error)}),o.readAsArrayBuffer(s)},i)},i)}unlink(t,e){this._remove(t,e,!0)}rmdir(t,e){this.readdir(t,(n,r)=>{n?e(n):r.length>0?e(u.ENOTEMPTY(t)):this._remove(t,e,!1)})}mkdir(t,e,n){this.fs.root.getDirectory(t,{create:!0,exclusive:!0},t=>{n()},e=>{n(x(e,t,!0))})}readdir(t,e){this._readdir(t,(t,n)=>{if(!n)return e(t);{const t=[];for(const e of n)t.push(e.name);e(null,t)}})}_makeFile(t,e,n,r,i=new ArrayBuffer(0)){const s=new d(p.FILE,r.size),o=g(i);return new v(this,e,t,n,s,o)}_readdir(t,e){const n=n=>{e(x(n,t,!0))};var r;this.fs.root.getDirectory(t,{create:!1},t=>{const i=t.createReader();let s=[];const o=()=>{i.readEntries(t=>{t.length?(s=s.concat((r=t,Array.prototype.slice.call(r||[],0))),o()):e(null,s)},n)};o()},n)}_allocate(t){const e=e=>{this.fs=e,t()},n=e=>{t(x(e,"/",!0))};this.type===a.PERSISTENT?function(t,e,n,r){if(void 0!==navigator.webkitPersistentStorage)switch(t){case a.PERSISTENT:navigator.webkitPersistentStorage.requestQuota(e,n,r);break;case a.TEMPORARY:navigator.webkitTemporaryStorage.requestQuota(e,n,r);break;default:r(new TypeError(`Invalid storage type: ${t}`))}else a.webkitStorageInfo.requestQuota(t,e,n,r)}(this.type,this.size,t=>{k(this.type,t,e,n)},n):k(this.type,this.size,e,n)}_remove(t,e,n){const r=r=>{r.remove(()=>{e()},r=>{e(x(r,t,!n))})},i=r=>{e(x(r,t,!n))},s={create:!1};n?this.fs.root.getFile(t,s,r,i):this.fs.root.getDirectory(t,s,r,i)}}return _.Name="HTML5FS",_.Options={size:{type:"number",optional:!0,description:"Storage quota to request, in megabytes. Allocated value may be less. Defaults to 5."},type:{type:"number",optional:!0,description:"window.PERSISTENT or window.TEMPORARY. Defaults to PERSISTENT."}},_.HTML5FSFile=v,_}),define("skylark-browserfs/generic/inode",["../libs/buffers","../core/node_fs_stats"],function(t,e){"use strict";const{Stats:n,FileType:r}=e,{Buffer:i}=t;class s{constructor(t,e,n,r,i,s){this.id=t,this.size=e,this.mode=n,this.atime=r,this.mtime=i,this.ctime=s}static fromBuffer(t){if(void 0===t)throw new Error("NO");return new s(t.toString("ascii",30),t.readUInt32LE(0),t.readUInt16LE(4),t.readDoubleLE(6),t.readDoubleLE(14),t.readDoubleLE(22))}toStats(){return new n((61440&this.mode)===r.DIRECTORY?r.DIRECTORY:r.FILE,this.size,this.mode,this.atime,this.mtime,this.ctime)}getSize(){return 30+this.id.length}toBuffer(t=i.alloc(this.getSize())){return t.writeUInt32LE(this.size,0),t.writeUInt16LE(this.mode,4),t.writeDoubleLE(this.atime,6),t.writeDoubleLE(this.mtime,14),t.writeDoubleLE(this.ctime,22),t.write(this.id,30,this.id.length,"ascii"),t}update(t){let e=!1;this.size!==t.size&&(this.size=t.size,e=!0),this.mode!==t.mode&&(this.mode=t.mode,e=!0);const n=t.atime.getTime();this.atime!==n&&(this.atime=n,e=!0);const r=t.mtime.getTime();this.mtime!==r&&(this.mtime=r,e=!0);const i=t.ctime.getTime();return this.ctime!==i&&(this.ctime=i,e=!0),e}isFile(){return(61440&this.mode)===r.FILE}isDirectory(){return(61440&this.mode)===r.DIRECTORY}}return s}),define("skylark-browserfs/generic/key_value_filesystem",["../libs/buffers","../core/file_system","../core/api_error","../core/node_fs_stats","../libs/path","../generic/inode","../generic/preload_file","../core/util"],function(t,e,n,r,i,s,o,a){"use strict";const{BaseFileSystem:l,SynchronousFileSystem:c}=e,{ApiError:u,ErrorCode:h}=n,{FileType:f}=r,{emptyBuffer:d}=a,{PreloadFile:p}=o,{Buffer:m}=t,y="/";let g=null;function w(){return g||(g=m.from("{}"))}function k(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0,n="x"===t?e:3&e|8;return n.toString(16)})}function x(t,e){return!t||(e(t),!1)}function v(t,e,n){return!t||(e.abort(()=>{n(t)}),!1)}class _{constructor(t,e){this.key=t,this.value=e,this.prev=null,this.next=null}}class b{constructor(t){this.limit=t,this.size=0,this.map={},this.head=null,this.tail=null}set(t,e){const n=new _(t,e);this.map[t]?(this.map[t].value=n.value,this.remove(n.key)):this.size>=this.limit&&(delete this.map[this.tail.key],this.size--,this.tail=this.tail.prev,this.tail.next=null),this.setHead(n)}get(t){if(this.map[t]){const e=this.map[t].value,n=new _(t,e);return this.remove(t),this.setHead(n),e}return null}remove(t){const e=this.map[t];e&&(null!==e.prev?e.prev.next=e.next:this.head=e.next,null!==e.next?e.next.prev=e.prev:this.tail=e.prev,delete this.map[t],this.size--)}removeAll(){this.size=0,this.map={},this.head=null,this.tail=null}setHead(t){t.next=this.head,t.prev=null,null!==this.head&&(this.head.prev=t),this.head=t,null===this.tail&&(this.tail=t),this.size++,this.map[t.key]=t}}class E extends p{constructor(t,e,n,r,i){super(t,e,n,r,i)}syncSync(){this.isDirty()&&(this._fs._syncSync(this.getPath(),this.getBuffer(),this.getStats()),this.resetDirty())}closeSync(){this.syncSync()}}class S extends p{constructor(t,e,n,r,i){super(t,e,n,r,i)}sync(t){this.isDirty()?this._fs._sync(this.getPath(),this.getBuffer(),this.getStats(),e=>{e||this.resetDirty(),t(e)}):t()}close(t){this.sync(t)}}return{SimpleSyncRWTransaction:class{constructor(t){this.store=t,this.originalData={},this.modifiedKeys=[]}get(t){const e=this.store.get(t);return this.stashOldValue(t,e),e}put(t,e,n){return this.markModified(t),this.store.put(t,e,n)}del(t){this.markModified(t),this.store.del(t)}commit(){}abort(){for(const t of this.modifiedKeys){const e=this.originalData[t];e?this.store.put(t,e,!0):this.store.del(t)}}stashOldValue(t,e){this.originalData.hasOwnProperty(t)||(this.originalData[t]=e)}markModified(t){-1===this.modifiedKeys.indexOf(t)&&(this.modifiedKeys.push(t),this.originalData.hasOwnProperty(t)||(this.originalData[t]=this.store.get(t)))}},SyncKeyValueFile:E,SyncKeyValueFileSystem:class extends c{static isAvailable(){return!0}constructor(t){super(),this.store=t.store,this.makeRootDirectory()}getName(){return this.store.name()}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!1}supportsSynch(){return!0}empty(){this.store.clear(),this.makeRootDirectory()}renameSync(t,e){const n=this.store.beginTransaction("readwrite"),r=i.dirname(t),s=i.basename(t),o=i.dirname(e),a=i.basename(e),l=this.findINode(n,r),c=this.getDirListing(n,r,l);if(!c[s])throw u.ENOENT(t);const f=c[s];if(delete c[s],0===(o+"/").indexOf(t+"/"))throw new u(h.EBUSY,r);let d,p;if(o===r?(d=l,p=c):(d=this.findINode(n,o),p=this.getDirListing(n,o,d)),p[a]){const t=this.getINode(n,e,p[a]);if(!t.isFile())throw u.EPERM(e);try{n.del(t.id),n.del(p[a])}catch(t){throw n.abort(),t}}p[a]=f;try{n.put(l.id,m.from(JSON.stringify(c)),!0),n.put(d.id,m.from(JSON.stringify(p)),!0)}catch(t){throw n.abort(),t}n.commit()}statSync(t,e){return this.findINode(this.store.beginTransaction("readonly"),t).toStats()}createFileSync(t,e,n){const r=this.store.beginTransaction("readwrite"),i=d(),s=this.commitNewFile(r,t,f.FILE,n,i);return new E(this,t,e,s.toStats(),i)}openFileSync(t,e){const n=this.store.beginTransaction("readonly"),r=this.findINode(n,t),i=n.get(r.id);if(void 0===i)throw u.ENOENT(t);return new E(this,t,e,r.toStats(),i)}unlinkSync(t){this.removeEntry(t,!1)}rmdirSync(t){if(this.readdirSync(t).length>0)throw u.ENOTEMPTY(t);this.removeEntry(t,!0)}mkdirSync(t,e){const n=this.store.beginTransaction("readwrite"),r=m.from("{}");this.commitNewFile(n,t,f.DIRECTORY,e,r)}readdirSync(t){const e=this.store.beginTransaction("readonly");return Object.keys(this.getDirListing(e,t,this.findINode(e,t)))}_syncSync(t,e,n){const r=this.store.beginTransaction("readwrite"),s=this._findINode(r,i.dirname(t),i.basename(t)),o=this.getINode(r,t,s),a=o.update(n);try{r.put(o.id,e,!0),a&&r.put(s,o.toBuffer(),!0)}catch(t){throw r.abort(),t}r.commit()}makeRootDirectory(){const t=this.store.beginTransaction("readwrite");if(void 0===t.get(y)){const e=(new Date).getTime(),n=new s(k(),4096,511|f.DIRECTORY,e,e,e);t.put(n.id,w(),!1),t.put(y,n.toBuffer(),!1),t.commit()}}_findINode(t,e,n){const r=r=>{const s=this.getDirListing(t,e,r);if(s[n])return s[n];throw u.ENOENT(i.resolve(e,n))};return"/"===e?""===n?y:r(this.getINode(t,e,y)):r(this.getINode(t,e+i.sep+n,this._findINode(t,i.dirname(e),i.basename(e))))}findINode(t,e){return this.getINode(t,e,this._findINode(t,i.dirname(e),i.basename(e)))}getINode(t,e,n){const r=t.get(n);if(void 0===r)throw u.ENOENT(e);return s.fromBuffer(r)}getDirListing(t,e,n){if(!n.isDirectory())throw u.ENOTDIR(e);const r=t.get(n.id);if(void 0===r)throw u.ENOENT(e);return JSON.parse(r.toString())}addNewNode(t,e){let n;for(;;)try{return n=k(),t.put(n,e,!1),n}catch(t){}throw new u(h.EIO,"Unable to commit data to key-value store.")}commitNewFile(t,e,n,r,o){const a=i.dirname(e),l=i.basename(e),c=this.findINode(t,a),h=this.getDirListing(t,a,c),f=(new Date).getTime();if("/"===e)throw u.EEXIST(e);if(h[l])throw u.EEXIST(e);let d;try{const e=this.addNewNode(t,o);d=new s(e,o.length,r|n,f,f,f);const i=this.addNewNode(t,d.toBuffer());h[l]=i,t.put(c.id,m.from(JSON.stringify(h)),!0)}catch(e){throw t.abort(),e}return t.commit(),d}removeEntry(t,e){const n=this.store.beginTransaction("readwrite"),r=i.dirname(t),s=this.findINode(n,r),o=this.getDirListing(n,r,s),a=i.basename(t);if(!o[a])throw u.ENOENT(t);const l=o[a];delete o[a];const c=this.getINode(n,t,l);if(!e&&c.isDirectory())throw u.EISDIR(t);if(e&&!c.isDirectory())throw u.ENOTDIR(t);try{n.del(c.id),n.del(l),n.put(s.id,m.from(JSON.stringify(o)),!0)}catch(t){throw n.abort(),t}n.commit()}},AsyncKeyValueFile:S,AsyncKeyValueFileSystem:class extends l{constructor(t){super(),this._cache=null,t>0&&(this._cache=new b(t))}static isAvailable(){return!0}init(t,e){this.store=t,this.makeRootDirectory(e)}getName(){return this.store.name()}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!1}supportsSynch(){return!1}empty(t){this._cache&&this._cache.removeAll(),this.store.clear(e=>{x(e,t)&&this.makeRootDirectory(t)})}rename(t,e,n){if(this._cache){const t=this._cache;this._cache=null,t.removeAll();const e=n;n=(n=>{this._cache=t,e(n)})}const r=this.store.beginTransaction("readwrite"),s=i.dirname(t),o=i.basename(t),a=i.dirname(e),l=i.basename(e),c={},f={};let d=!1;if(0===(a+"/").indexOf(t+"/"))return n(new u(h.EBUSY,s));const p=()=>{if(d||!f.hasOwnProperty(s)||!f.hasOwnProperty(a))return;const i=f[s],h=c[s],p=f[a],y=c[a];if(i[o]){const t=i[o];delete i[o];const c=()=>{p[l]=t,r.put(h.id,m.from(JSON.stringify(i)),!0,t=>{v(t,r,n)&&(s===a?r.commit(n):r.put(y.id,m.from(JSON.stringify(p)),!0,t=>{v(t,r,n)&&r.commit(n)}))})};p[l]?this.getINode(r,e,p[l],(t,i)=>{v(t,r,n)&&(i.isFile()?r.del(i.id,t=>{v(t,r,n)&&r.del(p[l],t=>{v(t,r,n)&&c()})}):r.abort(t=>{n(u.EPERM(e))}))}):c()}else n(u.ENOENT(t))},y=t=>{this.findINodeAndDirListing(r,t,(e,i,s)=>{e?d||(d=!0,r.abort(()=>{n(e)})):(c[t]=i,f[t]=s,p())})};y(s),s!==a&&y(a)}stat(t,e,n){const r=this.store.beginTransaction("readonly");this.findINode(r,t,(t,e)=>{x(t,n)&&n(null,e.toStats())})}createFile(t,e,n,r){const i=this.store.beginTransaction("readwrite"),s=d();this.commitNewFile(i,t,f.FILE,n,s,(n,i)=>{x(n,r)&&r(null,new S(this,t,e,i.toStats(),s))})}openFile(t,e,n){const r=this.store.beginTransaction("readonly");this.findINode(r,t,(i,s)=>{x(i,n)&&r.get(s.id,(r,i)=>{x(r,n)&&(void 0===i?n(u.ENOENT(t)):n(null,new S(this,t,e,s.toStats(),i)))})})}unlink(t,e){this.removeEntry(t,!1,e)}rmdir(t,e){this.readdir(t,(n,r)=>{n?e(n):r.length>0?e(u.ENOTEMPTY(t)):this.removeEntry(t,!0,e)})}mkdir(t,e,n){const r=this.store.beginTransaction("readwrite"),i=m.from("{}");this.commitNewFile(r,t,f.DIRECTORY,e,i,n)}readdir(t,e){const n=this.store.beginTransaction("readonly");this.findINode(n,t,(r,i)=>{x(r,e)&&this.getDirListing(n,t,i,(t,n)=>{x(t,e)&&e(null,Object.keys(n))})})}_sync(t,e,n,r){const s=this.store.beginTransaction("readwrite");this._findINode(s,i.dirname(t),i.basename(t),(i,o)=>{v(i,s,r)&&this.getINode(s,t,o,(t,i)=>{if(v(t,s,r)){const t=i.update(n);s.put(i.id,e,!0,e=>{v(e,s,r)&&(t?s.put(o,i.toBuffer(),!0,t=>{v(t,s,r)&&s.commit(r)}):s.commit(r))})}})})}makeRootDirectory(t){const e=this.store.beginTransaction("readwrite");e.get(y,(n,r)=>{if(n||void 0===r){const n=(new Date).getTime(),r=new s(k(),4096,511|f.DIRECTORY,n,n,n);e.put(r.id,w(),!1,n=>{v(n,e,t)&&e.put(y,r.toBuffer(),!1,n=>{n?e.abort(()=>{t(n)}):e.commit(t)})})}else e.commit(t)})}_findINode(t,e,n,r){if(this._cache){const t=this._cache.get(i.join(e,n));if(t)return r(null,t)}const s=(t,s,o)=>{if(t)r(t);else if(o[n]){const t=o[n];this._cache&&this._cache.set(i.join(e,n),t),r(null,t)}else r(u.ENOENT(i.resolve(e,n)))};"/"===e?""===n?(this._cache&&this._cache.set(i.join(e,n),y),r(null,y)):this.getINode(t,e,y,(n,i)=>{x(n,r)&&this.getDirListing(t,e,i,(t,e)=>{s(t,i,e)})}):this.findINodeAndDirListing(t,e,s)}findINode(t,e,n){this._findINode(t,i.dirname(e),i.basename(e),(r,i)=>{x(r,n)&&this.getINode(t,e,i,n)})}getINode(t,e,n,r){t.get(n,(t,n)=>{x(t,r)&&(void 0===n?r(u.ENOENT(e)):r(null,s.fromBuffer(n)))})}getDirListing(t,e,n,r){n.isDirectory()?t.get(n.id,(t,n)=>{if(x(t,r))try{r(null,JSON.parse(n.toString()))}catch(t){r(u.ENOENT(e))}}):r(u.ENOTDIR(e))}findINodeAndDirListing(t,e,n){this.findINode(t,e,(r,i)=>{x(r,n)&&this.getDirListing(t,e,i,(t,e)=>{x(t,n)&&n(null,i,e)})})}addNewNode(t,e,n){let r,i=0;const s=()=>{5==++i?n(new u(h.EIO,"Unable to commit data to key-value store.")):(r=k(),t.put(r,e,!1,(t,e)=>{t||!e?s():n(null,r)}))};s()}commitNewFile(t,e,n,r,o,a){const l=i.dirname(e),c=i.basename(e),h=(new Date).getTime();if("/"===e)return a(u.EEXIST(e));this.findINodeAndDirListing(t,l,(i,l,f)=>{v(i,t,a)&&(f[c]?t.abort(()=>{a(u.EEXIST(e))}):this.addNewNode(t,o,(e,i)=>{if(v(e,t,a)){const e=new s(i,o.length,r|n,h,h,h);this.addNewNode(t,e.toBuffer(),(n,r)=>{v(n,t,a)&&(f[c]=r,t.put(l.id,m.from(JSON.stringify(f)),!0,n=>{v(n,t,a)&&t.commit(n=>{v(n,t,a)&&a(null,e)})}))})}}))})}removeEntry(t,e,n){this._cache&&this._cache.remove(t);const r=this.store.beginTransaction("readwrite"),s=i.dirname(t),o=i.basename(t);this.findINodeAndDirListing(r,s,(i,s,a)=>{if(v(i,r,n))if(a[o]){const i=a[o];delete a[o],this.getINode(r,t,i,(o,l)=>{v(o,r,n)&&(!e&&l.isDirectory()?r.abort(()=>{n(u.EISDIR(t))}):e&&!l.isDirectory()?r.abort(()=>{n(u.ENOTDIR(t))}):r.del(l.id,t=>{v(t,r,n)&&r.del(i,t=>{v(t,r,n)&&r.put(s.id,m.from(JSON.stringify(a)),!0,t=>{v(t,r,n)&&r.commit(n)})})}))})}else r.abort(()=>{n(u.ENOENT(t))})})}}}}),define("skylark-browserfs/backend/InMemory",["../generic/key_value_filesystem"],function(t){"use strict";const{SimpleSyncRWTransaction:e,SyncKeyValueFileSystem:n}=t;class r{constructor(){this.store={}}name(){return i.Name}clear(){this.store={}}beginTransaction(t){return new e(this)}get(t){return this.store[t]}put(t,e,n){return!(!n&&this.store.hasOwnProperty(t))&&(this.store[t]=e,!0)}del(t){delete this.store[t]}}class i extends n{constructor(){super({store:new r})}static Create(t,e){e(null,new i)}}return i.Name="InMemory",i.Options={},i.InMemoryStore=r,i}),define("skylark-browserfs/backend/IndexedDB",["../generic/key_value_filesystem","../core/api_error","../core/global","../core/util"],function(t,e,n,r){"use strict";const{AsyncKeyValueFileSystem:i}=t,{ApiError:s,ErrorCode:o}=e,{arrayBuffer2Buffer:a,buffer2ArrayBuffer:l}=r,c=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB;function u(t,e=t.toString()){switch(t.name){case"NotFoundError":return new s(o.ENOENT,e);case"QuotaExceededError":return new s(o.ENOSPC,e);default:return new s(o.EIO,e)}}function h(t,e=o.EIO,n=null){return function(r){r.preventDefault(),t(new s(e,null!==n?n:void 0))}}class f{constructor(t,e){this.tx=t,this.store=e}get(t,e){try{const n=this.store.get(t);n.onerror=h(e),n.onsuccess=(t=>{const n=t.target.result;e(null,void 0===n?n:a(n))})}catch(t){e(u(t))}}}class d extends f{constructor(t,e){super(t,e)}put(t,e,n,r){try{const i=l(e);let s;(s=n?this.store.put(i,t):this.store.add(i,t)).onerror=h(r),s.onsuccess=(t=>{r(null,!0)})}catch(t){r(u(t))}}del(t,e){try{const n=this.store.delete(t);n.onerror=h(e),n.onsuccess=(t=>{e()})}catch(t){e(u(t))}}commit(t){setTimeout(t,0)}abort(t){let e=null;try{this.tx.abort()}catch(t){e=u(t)}finally{t(e)}}}class p{constructor(t,e){this.db=t,this.storeName=e}static Create(t,e){const n=c.open(t,1);n.onupgradeneeded=(e=>{const n=e.target.result;n.objectStoreNames.contains(t)&&n.deleteObjectStore(t),n.createObjectStore(t)}),n.onsuccess=(n=>{e(null,new p(n.target.result,t))}),n.onerror=h(e,o.EACCES)}name(){return m.Name+" - "+this.storeName}clear(t){try{const e=this.db.transaction(this.storeName,"readwrite"),n=e.objectStore(this.storeName),r=n.clear();r.onsuccess=(e=>{setTimeout(t,0)}),r.onerror=h(t)}catch(e){t(u(e))}}beginTransaction(t="readonly"){const e=this.db.transaction(this.storeName,t),n=e.objectStore(this.storeName);if("readwrite"===t)return new d(e,n);if("readonly"===t)return new f(e,n);throw new s(o.EINVAL,"Invalid transaction type.")}}class m extends i{constructor(t){super(t)}static Create(t={},e){p.Create(t.storeName?t.storeName:"browserfs",(n,r)=>{if(r){const n=new m("number"==typeof t.cacheSize?t.cacheSize:100);n.init(r,t=>{t?e(t):e(null,n)})}else e(n)})}static isAvailable(){try{return void 0!==c&&null!==c.open("__browserfs_test__")}catch(t){return!1}}}return m.Name="IndexedDB",m.Options={storeName:{type:"string",optional:!0,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."},cacheSize:{type:"number",optional:!0,description:"The size of the inode cache. Defaults to 100. A size of 0 or below disables caching."}},m.IndexedDBROTransaction=f,m.IndexedDBRWTransaction=d,m.IndexedDBStore=p,m}),define("skylark-browserfs/backend/LocalStorage",["../libs/buffers","../generic/key_value_filesystem","../core/api_error","../core/global"],function(t,e,n,r){"use strict";const{SyncKeyValueFileSystem:i,SimpleSyncRWTransaction:s}=e,{ApiError:o,ErrorCode:a}=n,{Buffer:l}=t;let c,u=!1;try{r.localStorage.setItem("__test__",String.fromCharCode(55296)),u=r.localStorage.getItem("__test__")===String.fromCharCode(55296)}catch(t){u=!1}c=u?"binary_string":"binary_string_ie",l.isEncoding(c)||(c="base64");class h{name(){return f.Name}clear(){r.localStorage.clear()}beginTransaction(t){return new s(this)}get(t){try{const e=r.localStorage.getItem(t);if(null!==e)return l.from(e,c)}catch(t){}}put(t,e,n){try{return!(!n&&null!==r.localStorage.getItem(t))&&(r.localStorage.setItem(t,e.toString(c)),!0)}catch(t){throw new o(a.ENOSPC,"LocalStorage is full.")}}del(t){try{r.localStorage.removeItem(t)}catch(e){throw new o(a.EIO,"Unable to delete key "+t+": "+e)}}}class f extends i{constructor(){super({store:new h})}static Create(t,e){e(null,new f)}static isAvailable(){return void 0!==r.localStorage}}return f.Name="LocalStorage",f.Options={},f.LocalStorageStore=h,f}),define("skylark-browserfs/backend/MountableFileSystem",["../core/file_system","./InMemory","../core/api_error","../core/node_fs","../libs/path","../core/util"],function(t,e,n,r,i,s){"use strict";const{BaseFileSystem:o}=t,{InMemoryFileSystem:a}=e,{ApiError:l,ErrorCode:c}=n,{mkdirpSync:u}=s;class h extends o{constructor(t){super(),this.mountList=[],this.mntMap={},this.rootFs=t}static Create(t,e){a.Create({},(n,r)=>{if(r){const i=new h(r);try{Object.keys(t).forEach(e=>{i.mount(e,t[e])})}catch(n){return e(n)}e(null,i)}else e(n)})}static isAvailable(){return!0}mount(t,e){if("/"!==t[0]&&(t=`/${t}`),t=i.resolve(t),this.mntMap[t])throw new l(c.EINVAL,"Mount point "+t+" is already taken.");u(t,511,this.rootFs),this.mntMap[t]=e,this.mountList.push(t),this.mountList=this.mountList.sort((t,e)=>e.length-t.length)}umount(t){if("/"!==t[0]&&(t=`/${t}`),t=i.resolve(t),!this.mntMap[t])throw new l(c.EINVAL,"Mount point "+t+" is already unmounted.");for(delete this.mntMap[t],this.mountList.splice(this.mountList.indexOf(t),1);"/"!==t&&0===this.rootFs.readdirSync(t).length;)this.rootFs.rmdirSync(t),t=i.dirname(t)}_getFs(t){const e=this.mountList,n=e.length;for(let r=0;r<n;r++){const n=e[r];if(n.length<=t.length&&0===t.indexOf(n))return""===(t=t.substr(n.length>1?n.length:0))&&(t="/"),{fs:this.mntMap[n],path:t,mountPoint:n}}return{fs:this.rootFs,path:t,mountPoint:"/"}}getName(){return h.Name}diskSpace(t,e){e(0,0)}isReadOnly(){return!1}supportsLinks(){return!1}supportsProps(){return!1}supportsSynch(){return!0}standardizeError(t,e,n){const r=t.message.indexOf(e);return-1!==r&&(t.message=t.message.substr(0,r)+n+t.message.substr(r+e.length),t.path=n),t}rename(t,e,n){const i=this._getFs(t),s=this._getFs(e);return i.fs===s.fs?i.fs.rename(i.path,s.path,r=>{r&&this.standardizeError(this.standardizeError(r,i.path,t),s.path,e),n(r)}):r.readFile(t,function(i,s){if(i)return n(i);r.writeFile(e,s,function(e){if(e)return n(e);r.unlink(t,n)})})}renameSync(t,e){const n=this._getFs(t),i=this._getFs(e);if(n.fs===i.fs)try{return n.fs.renameSync(n.path,i.path)}catch(r){throw this.standardizeError(this.standardizeError(r,n.path,t),i.path,e),r}const s=r.readFileSync(t);return r.writeFileSync(e,s),r.unlinkSync(t)}readdirSync(t){const e=this._getFs(t);let n=null;if(e.fs!==this.rootFs)try{n=this.rootFs.readdirSync(t)}catch(t){}try{const r=e.fs.readdirSync(e.path);return null===n?r:r.concat(n.filter(t=>-1===r.indexOf(t)))}catch(r){if(null===n)throw this.standardizeError(r,e.path,t);return n}}readdir(t,e){const n=this._getFs(t);n.fs.readdir(n.path,(r,i)=>{if(n.fs!==this.rootFs)try{const s=this.rootFs.readdirSync(t);i=i?i.concat(s.filter(t=>-1===i.indexOf(t))):s}catch(i){if(r)return e(this.standardizeError(r,n.path,t))}else if(r)return e(this.standardizeError(r,n.path,t));e(null,i)})}realpathSync(t,e){const n=this._getFs(t);try{const e=n.fs.realpathSync(n.path,{});return i.resolve(i.join(n.mountPoint,e))}catch(e){throw this.standardizeError(e,n.path,t)}}realpath(t,e,n){const r=this._getFs(t);r.fs.realpath(r.path,{},(e,s)=>{e?n(this.standardizeError(e,r.path,t)):n(null,i.resolve(i.join(r.mountPoint,s)))})}rmdirSync(t){const e=this._getFs(t);if(this._containsMountPt(t))throw l.ENOTEMPTY(t);try{e.fs.rmdirSync(e.path)}catch(n){throw this.standardizeError(n,e.path,t)}}rmdir(t,e){const n=this._getFs(t);this._containsMountPt(t)?e(l.ENOTEMPTY(t)):n.fs.rmdir(n.path,r=>{e(r?this.standardizeError(r,n.path,t):null)})}_containsMountPt(t){const e=this.mountList,n=e.length;for(let r=0;r<n;r++){const n=e[r];if(n.length>=t.length&&n.slice(0,t.length)===t)return!0}return!1}}function f(t,e,n){return e?function(...e){const n=e[0],r=this._getFs(n);e[0]=r.path;try{return r.fs[t].apply(r.fs,e)}catch(t){throw this.standardizeError(t,r.path,n),t}}:function(...e){const n=e[0],r=this._getFs(n);if(e[0]=r.path,"function"==typeof e[e.length-1]){const t=e[e.length-1];e[e.length-1]=((...e)=>{e.length>0&&e[0]instanceof l&&this.standardizeError(e[0],r.path,n),t.apply(null,e)})}return r.fs[t].apply(r.fs,e)}}h.Name="MountableFileSystem",h.Options={};const d=[["exists","unlink","readlink"],["stat","mkdir","truncate"],["open","readFile","chmod","utimes"],["chown"],["writeFile","appendFile"]];for(let t=0;t<d.length;t++){const e=d[t];for(const n of e)h.prototype[n]=f(n,!1,t+1),h.prototype[n+"Sync"]=f(n+"Sync",!0,t+1)}return h}),define("skylark-browserfs/generic/mutex",["../generic/setImmediate"],function(t){"use strict";return class{constructor(){this._locked=!1,this._waiters=[]}lock(t){this._locked?this._waiters.push(t):(this._locked=!0,t())}unlock(){if(!this._locked)throw new Error("unlock of a non-locked mutex");const e=this._waiters.shift();e?t(e):this._locked=!1}tryLock(){return!this._locked&&(this._locked=!0,!0)}isLocked(){return this._locked}}}),define("skylark-browserfs/generic/locked_fs",["./mutex"],function(t){"use strict";return class{constructor(e){this._fs=e,this._mu=new t}getName(){return"LockedFS<"+this._fs.getName()+">"}getFSUnlocked(){return this._fs}diskSpace(t,e){this._fs.diskSpace(t,e)}isReadOnly(){return this._fs.isReadOnly()}supportsLinks(){return this._fs.supportsLinks()}supportsProps(){return this._fs.supportsProps()}supportsSynch(){return this._fs.supportsSynch()}rename(t,e,n){this._mu.lock(()=>{this._fs.rename(t,e,t=>{this._mu.unlock(),n(t)})})}renameSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.renameSync(t,e)}stat(t,e,n){this._mu.lock(()=>{this._fs.stat(t,e,(t,e)=>{this._mu.unlock(),n(t,e)})})}statSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.statSync(t,e)}open(t,e,n,r){this._mu.lock(()=>{this._fs.open(t,e,n,(t,e)=>{this._mu.unlock(),r(t,e)})})}openSync(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.openSync(t,e,n)}unlink(t,e){this._mu.lock(()=>{this._fs.unlink(t,t=>{this._mu.unlock(),e(t)})})}unlinkSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.unlinkSync(t)}rmdir(t,e){this._mu.lock(()=>{this._fs.rmdir(t,t=>{this._mu.unlock(),e(t)})})}rmdirSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.rmdirSync(t)}mkdir(t,e,n){this._mu.lock(()=>{this._fs.mkdir(t,e,t=>{this._mu.unlock(),n(t)})})}mkdirSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.mkdirSync(t,e)}readdir(t,e){this._mu.lock(()=>{this._fs.readdir(t,(t,n)=>{this._mu.unlock(),e(t,n)})})}readdirSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readdirSync(t)}exists(t,e){this._mu.lock(()=>{this._fs.exists(t,t=>{this._mu.unlock(),e(t)})})}existsSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.existsSync(t)}realpath(t,e,n){this._mu.lock(()=>{this._fs.realpath(t,e,(t,e)=>{this._mu.unlock(),n(t,e)})})}realpathSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.realpathSync(t,e)}truncate(t,e,n){this._mu.lock(()=>{this._fs.truncate(t,e,t=>{this._mu.unlock(),n(t)})})}truncateSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.truncateSync(t,e)}readFile(t,e,n,r){this._mu.lock(()=>{this._fs.readFile(t,e,n,(t,e)=>{this._mu.unlock(),r(t,e)})})}readFileSync(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readFileSync(t,e,n)}writeFile(t,e,n,r,i,s){this._mu.lock(()=>{this._fs.writeFile(t,e,n,r,i,t=>{this._mu.unlock(),s(t)})})}writeFileSync(t,e,n,r,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.writeFileSync(t,e,n,r,i)}appendFile(t,e,n,r,i,s){this._mu.lock(()=>{this._fs.appendFile(t,e,n,r,i,t=>{this._mu.unlock(),s(t)})})}appendFileSync(t,e,n,r,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.appendFileSync(t,e,n,r,i)}chmod(t,e,n,r){this._mu.lock(()=>{this._fs.chmod(t,e,n,t=>{this._mu.unlock(),r(t)})})}chmodSync(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chmodSync(t,e,n)}chown(t,e,n,r,i){this._mu.lock(()=>{this._fs.chown(t,e,n,r,t=>{this._mu.unlock(),i(t)})})}chownSync(t,e,n,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chownSync(t,e,n,r)}utimes(t,e,n,r){this._mu.lock(()=>{this._fs.utimes(t,e,n,t=>{this._mu.unlock(),r(t)})})}utimesSync(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.utimesSync(t,e,n)}link(t,e,n){this._mu.lock(()=>{this._fs.link(t,e,t=>{this._mu.unlock(),n(t)})})}linkSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.linkSync(t,e)}symlink(t,e,n,r){this._mu.lock(()=>{this._fs.symlink(t,e,n,t=>{this._mu.unlock(),r(t)})})}symlinkSync(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.symlinkSync(t,e,n)}readlink(t,e){this._mu.lock(()=>{this._fs.readlink(t,(t,n)=>{this._mu.unlock(),e(t,n)})})}readlinkSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readlinkSync(t)}}}),define("skylark-browserfs/backend/OverlayFS",["../core/file_system","../core/api_error","../core/file_flag","../core/node_fs_stats","../generic/preload_file","../generic/locked_fs","../libs/path"],function(t,e,n,r,i,s,o){"use strict";const{BaseFileSystem:a}=t,{ApiError:l,ErrorCode:c}=e,{FileFlag:u,ActionType:h}=n,{Stats:f}=r,{PreloadFile:d}=i,p="/.deletedFiles.log";function m(t){return 146|t}function y(t){return u.getFileFlag(t)}class g extends d{constructor(t,e,n,r,i){super(t,e,n,r,i)}sync(t){this.isDirty()?this._fs._syncAsync(this,e=>{this.resetDirty(),t(e)}):t(null)}syncSync(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())}close(t){this.sync(t)}closeSync(){this.syncSync()}}class w extends a{constructor(t,e){if(super(),this._isInitialized=!1,this._initializeCallbacks=[],this._deletedFiles={},this._deleteLog="",this._deleteLogUpdatePending=!1,this._deleteLogUpdateNeeded=!1,this._deleteLogError=null,this._writable=t,this._readable=e,this._writable.isReadOnly())throw new l(c.EINVAL,"Writable file system must be writable.")}static isAvailable(){return!0}getOverlayedFileSystems(){return{readable:this._readable,writable:this._writable}}_syncAsync(t,e){this.createParentDirectoriesAsync(t.getPath(),n=>{if(n)return e(n);this._writable.writeFile(t.getPath(),t.getBuffer(),null,y("w"),t.getStats().mode,e)})}_syncSync(t){this.createParentDirectories(t.getPath()),this._writable.writeFileSync(t.getPath(),t.getBuffer(),null,y("w"),t.getStats().mode)}getName(){return k.Name}_initialize(t){const e=this._initializeCallbacks,n=t=>{this._isInitialized=!t,this._initializeCallbacks=[],e.forEach(e=>e(t))};if(this._isInitialized)return t();e.push(t),1===e.length&&this._writable.readFile(p,"utf8",y("r"),(t,e)=>{if(t){if(t.errno!==c.ENOENT)return n(t)}else this._deleteLog=e;this._reparseDeletionLog(),n()})}isReadOnly(){return!1}supportsSynch(){return this._readable.supportsSynch()&&this._writable.supportsSynch()}supportsLinks(){return!1}supportsProps(){return this._readable.supportsProps()&&this._writable.supportsProps()}getDeletionLog(){return this._deleteLog}restoreDeletionLog(t){this._deleteLog=t,this._reparseDeletionLog(),this.updateLog("")}rename(t,e,n){if(this.checkInitAsync(n)&&!this.checkPathAsync(t,n)&&!this.checkPathAsync(e,n))return t===p||e===p?n(l.EPERM("Cannot rename deletion log.")):t===e?n():void this.stat(t,!1,(r,i)=>r?n(r):this.stat(e,!1,(r,s)=>{const a=this;function u(r){const i=r.shift();if(!i)return n();const s=o.resolve(t,i),l=o.resolve(e,i);a.rename(s,l,t=>{if(t)return n(t);u(r)})}let h=511;if(i.isDirectory()){if(r)return r.errno!==c.ENOENT?n(r):this._writable.exists(t,r=>{if(r)return this._writable.rename(t,e,n);this._writable.mkdir(e,h,e=>{if(e)return n(e);this._readable.readdir(t,(t,e)=>{if(t)return n();u(e)})})});if(h=s.mode,!s.isDirectory())return n(l.ENOTDIR(e));this.readdir(e,(r,i)=>{if(i&&i.length)return n(l.ENOTEMPTY(e));this._readable.readdir(t,(t,e)=>{if(t)return n();u(e)})})}if(s&&s.isDirectory())return n(l.EISDIR(e));this.readFile(t,null,y("r"),(r,s)=>r?n(r):this.writeFile(e,s,null,y("w"),i.mode,e=>e?n(e):this.unlink(t,n)))}))}renameSync(t,e){if(this.checkInitialized(),this.checkPath(t),this.checkPath(e),t===p||e===p)throw l.EPERM("Cannot rename deletion log.");const n=this.statSync(t,!1);if(n.isDirectory()){if(t===e)return;let n=511;if(this.existsSync(e)){const t=this.statSync(e,!1);if(n=t.mode,!t.isDirectory())throw l.ENOTDIR(e);if(this.readdirSync(e).length>0)throw l.ENOTEMPTY(e)}this._writable.existsSync(t)?this._writable.renameSync(t,e):this._writable.existsSync(e)||this._writable.mkdirSync(e,n),this._readable.existsSync(t)&&this._readable.readdirSync(t).forEach(n=>{this.renameSync(o.resolve(t,n),o.resolve(e,n))})}else{if(this.existsSync(e)&&this.statSync(e,!1).isDirectory())throw l.EISDIR(e);this.writeFileSync(e,this.readFileSync(t,null,y("r")),null,y("w"),n.mode)}t!==e&&this.existsSync(t)&&this.unlinkSync(t)}stat(t,e,n){this.checkInitAsync(n)&&this._writable.stat(t,e,(r,i)=>{r&&r.errno===c.ENOENT?(this._deletedFiles[t]&&n(l.ENOENT(t)),this._readable.stat(t,e,(t,e)=>{e&&((e=f.clone(e)).mode=m(e.mode)),n(t,e)})):n(r,i)})}statSync(t,e){this.checkInitialized();try{return this._writable.statSync(t,e)}catch(n){if(this._deletedFiles[t])throw l.ENOENT(t);const r=f.clone(this._readable.statSync(t,e));return r.mode=m(r.mode),r}}open(t,e,n,r){this.checkInitAsync(r)&&!this.checkPathAsync(t,r)&&this.stat(t,!1,(i,s)=>{if(s)switch(e.pathExistsAction()){case h.TRUNCATE_FILE:return this.createParentDirectoriesAsync(t,i=>{if(i)return r(i);this._writable.open(t,e,n,r)});case h.NOP:return this._writable.exists(t,i=>{i?this._writable.open(t,e,n,r):((s=f.clone(s)).mode=n,this._readable.readFile(t,null,y("r"),(n,i)=>{if(n)return r(n);-1===s.size&&(s.size=i.length);const o=new g(this,t,e,s,i);r(null,o)}))});default:return r(l.EEXIST(t))}else switch(e.pathNotExistsAction()){case h.CREATE_FILE:return this.createParentDirectoriesAsync(t,i=>i?r(i):this._writable.open(t,e,n,r));default:return r(l.ENOENT(t))}})}openSync(t,e,n){if(this.checkInitialized(),this.checkPath(t),t===p)throw l.EPERM("Cannot open deletion log.");if(this.existsSync(t))switch(e.pathExistsAction()){case h.TRUNCATE_FILE:return this.createParentDirectories(t),this._writable.openSync(t,e,n);case h.NOP:if(this._writable.existsSync(t))return this._writable.openSync(t,e,n);{const r=this._readable.readFileSync(t,null,y("r")),i=f.clone(this._readable.statSync(t,!1));return i.mode=n,new g(this,t,e,i,r)}default:throw l.EEXIST(t)}else switch(e.pathNotExistsAction()){case h.CREATE_FILE:return this.createParentDirectories(t),this._writable.openSync(t,e,n);default:throw l.ENOENT(t)}}unlink(t,e){this.checkInitAsync(e)&&!this.checkPathAsync(t,e)&&this.exists(t,n=>{if(!n)return e(l.ENOENT(t));this._writable.exists(t,n=>{if(n)return this._writable.unlink(t,n=>{if(n)return e(n);this.exists(t,n=>{n&&this.deletePath(t),e(null)})});this.deletePath(t),e(null)})})}unlinkSync(t){if(this.checkInitialized(),this.checkPath(t),!this.existsSync(t))throw l.ENOENT(t);this._writable.existsSync(t)&&this._writable.unlinkSync(t),this.existsSync(t)&&this.deletePath(t)}rmdir(t,e){if(!this.checkInitAsync(e))return;const n=()=>{this.readdir(t,(n,r)=>n?e(n):r.length?e(l.ENOTEMPTY(t)):(this.deletePath(t),void e(null)))};this.exists(t,r=>{if(!r)return e(l.ENOENT(t));this._writable.exists(t,r=>{r?this._writable.rmdir(t,r=>{if(r)return e(r);this._readable.exists(t,t=>{t?n():e()})}):n()})})}rmdirSync(t){if(this.checkInitialized(),!this.existsSync(t))throw l.ENOENT(t);if(this._writable.existsSync(t)&&this._writable.rmdirSync(t),this.existsSync(t)){if(this.readdirSync(t).length>0)throw l.ENOTEMPTY(t);this.deletePath(t)}}mkdir(t,e,n){this.checkInitAsync(n)&&this.exists(t,r=>{if(r)return n(l.EEXIST(t));this.createParentDirectoriesAsync(t,r=>{if(r)return n(r);this._writable.mkdir(t,e,n)})})}mkdirSync(t,e){if(this.checkInitialized(),this.existsSync(t))throw l.EEXIST(t);this.createParentDirectories(t),this._writable.mkdirSync(t,e)}readdir(t,e){this.checkInitAsync(e)&&this.stat(t,!1,(n,r)=>n?e(n):r.isDirectory()?void this._writable.readdir(t,(n,r)=>{if(n&&"ENOENT"!==n.code)return e(n);!n&&r||(r=[]),this._readable.readdir(t,(n,i)=>{!n&&i||(i=[]);const s={},o=r.concat(i.filter(e=>!this._deletedFiles[`${t}/${e}`])).filter(t=>{const e=!s[t];return s[t]=!0,e});e(null,o)})}):e(l.ENOTDIR(t)))}readdirSync(t){this.checkInitialized();const e=this.statSync(t,!1);if(!e.isDirectory())throw l.ENOTDIR(t);let n=[];try{n=n.concat(this._writable.readdirSync(t))}catch(t){}try{n=n.concat(this._readable.readdirSync(t).filter(e=>!this._deletedFiles[`${t}/${e}`]))}catch(t){}const r={};return n.filter(t=>{const e=!r[t];return r[t]=!0,e})}exists(t,e){this.checkInitialized(),this._writable.exists(t,n=>{if(n)return e(!0);this._readable.exists(t,n=>{e(n&&!0!==this._deletedFiles[t])})})}existsSync(t){return this.checkInitialized(),this._writable.existsSync(t)||this._readable.existsSync(t)&&!0!==this._deletedFiles[t]}chmod(t,e,n,r){this.checkInitAsync(r)&&this.operateOnWritableAsync(t,i=>{if(i)return r(i);this._writable.chmod(t,e,n,r)})}chmodSync(t,e,n){this.checkInitialized(),this.operateOnWritable(t,()=>{this._writable.chmodSync(t,e,n)})}chown(t,e,n,r,i){this.checkInitAsync(i)&&this.operateOnWritableAsync(t,s=>{if(s)return i(s);this._writable.chown(t,e,n,r,i)})}chownSync(t,e,n,r){this.checkInitialized(),this.operateOnWritable(t,()=>{this._writable.chownSync(t,e,n,r)})}utimes(t,e,n,r){this.checkInitAsync(r)&&this.operateOnWritableAsync(t,i=>{if(i)return r(i);this._writable.utimes(t,e,n,r)})}utimesSync(t,e,n){this.checkInitialized(),this.operateOnWritable(t,()=>{this._writable.utimesSync(t,e,n)})}deletePath(t){this._deletedFiles[t]=!0,this.updateLog(`d${t}\n`)}updateLog(t){this._deleteLog+=t,this._deleteLogUpdatePending?this._deleteLogUpdateNeeded=!0:(this._deleteLogUpdatePending=!0,this._writable.writeFile(p,this._deleteLog,"utf8",u.getFileFlag("w"),420,t=>{this._deleteLogUpdatePending=!1,t?this._deleteLogError=t:this._deleteLogUpdateNeeded&&(this._deleteLogUpdateNeeded=!1,this.updateLog(""))}))}_reparseDeletionLog(){this._deletedFiles={},this._deleteLog.split("\n").forEach(t=>{this._deletedFiles[t.slice(1)]="d"===t.slice(0,1)})}checkInitialized(){if(!this._isInitialized)throw new l(c.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.");if(null!==this._deleteLogError){const t=this._deleteLogError;throw this._deleteLogError=null,t}}checkInitAsync(t){if(!this._isInitialized)return t(new l(c.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.")),!1;if(null!==this._deleteLogError){const e=this._deleteLogError;return this._deleteLogError=null,t(e),!1}return!0}checkPath(t){if(t===p)throw l.EPERM(t)}checkPathAsync(t,e){return t===p&&(e(l.EPERM(t)),!0)}createParentDirectoriesAsync(t,e){let n=o.dirname(t);const r=[],i=this;this._writable.stat(n,!1,function t(s,a){s?"/"===n?e(new l(c.EBUSY,"Invariant failed: root does not exist!")):(r.push(n),n=o.dirname(n),i._writable.stat(n,!1,t)):function t(){if(!r.length)return e();const n=r.pop();i._readable.stat(n,!1,(r,s)=>{if(!s)return e();i._writable.mkdir(n,s.mode,n=>{if(n)return e(n);t()})})}()})}createParentDirectories(t){let e=o.dirname(t),n=[];for(;!this._writable.existsSync(e);)n.push(e),e=o.dirname(e);(n=n.reverse()).forEach(t=>{this._writable.mkdirSync(t,this.statSync(t,!1).mode)})}operateOnWritable(t,e){if(!this.existsSync(t))throw l.ENOENT(t);this._writable.existsSync(t)||this.copyToWritable(t),e()}operateOnWritableAsync(t,e){this.exists(t,n=>{if(!n)return e(l.ENOENT(t));this._writable.exists(t,n=>{if(!n)return this.copyToWritableAsync(t,e);e()})})}copyToWritable(t){const e=this.statSync(t,!1);e.isDirectory()?this._writable.mkdirSync(t,e.mode):this.writeFileSync(t,this._readable.readFileSync(t,null,y("r")),null,y("w"),this.statSync(t,!1).mode)}copyToWritableAsync(t,e){this.stat(t,!1,(n,r)=>n?e(n):r.isDirectory()?this._writable.mkdir(t,r.mode,e):void this._readable.readFile(t,null,y("r"),(n,i)=>{if(n)return e(n);this.writeFile(t,i,null,y("w"),r.mode,e)}))}}class k extends s{constructor(t,e){super(new w(t,e))}static Create(t,e){try{const n=new k(t.writable,t.readable);n._initialize(t=>{e(t,n)})}catch(t){e(t)}}static isAvailable(){return w.isAvailable()}getOverlayedFileSystems(){return super.getFSUnlocked().getOverlayedFileSystems()}unwrap(){return super.getFSUnlocked()}_initialize(t){super.getFSUnlocked()._initialize(t)}}return k.Name="OverlayFS",k.Options={writable:{type:"object",description:"The file system to write modified files to."},readable:{type:"object",description:"The file system that initially populates this file system."}},k}),define("skylark-browserfs/backend/WorkerFS",["../libs/buffers","../core/file_system","../core/api_error","../core/file_flag","../core/util","../core/file","../core/node_fs_stats","../generic/preload_file","../core/global","../core/node_fs"],function(t,e,n,r,i,s,o,a,l,c){"use strict";const{BaseFileSystem:u}=e,{ApiError:h,ErrorCode:f}=n,{FileFlag:d}=r,{buffer2ArrayBuffer:p,arrayBuffer2Buffer:m,emptyBuffer:y}=i,{BaseFile:g}=s,{Stats:w}=o,{PreloadFile:k}=a,{Buffer:x}=t;var v;!function(t){t[t.CB=0]="CB",t[t.FD=1]="FD",t[t.API_ERROR=2]="API_ERROR",t[t.STATS=3]="STATS",t[t.PROBE=4]="PROBE",t[t.FILEFLAG=5]="FILEFLAG",t[t.BUFFER=6]="BUFFER",t[t.ERROR=7]="ERROR"}(v||(v={}));class _{constructor(){this._callbacks={},this._nextId=0}toRemoteArg(t){const e=this._nextId++;return this._callbacks[e]=t,{type:v.CB,id:e}}toLocalArg(t){const e=this._callbacks[t];return delete this._callbacks[t],e}}class b{constructor(){this._fileDescriptors={},this._nextId=0}toRemoteArg(t,e,n,r){const i=this._nextId++;let s,o;this._fileDescriptors[i]=t,t.stat((a,l)=>{a?r(a):(o=M(l.toBuffer()),n.isReadable()?t.read(x.alloc(l.size),0,l.size,0,(t,a,l)=>{t?r(t):(s=M(l),r(null,{type:v.FD,id:i,data:s,stat:o,path:e,flag:n.getFlagString()}))}):r(null,{type:v.FD,id:i,data:new ArrayBuffer(0),stat:o,path:e,flag:n.getFlagString()}))})}applyFdAPIRequest(t,e){const n=t.args[0];this._applyFdChanges(n,(r,i)=>{r?e(r):i[t.method](r=>{"close"===t.method&&delete this._fileDescriptors[n.id],e(r)})})}_applyFdChanges(t,e){const n=this._fileDescriptors[t.id],r=N(t.data),i=w.fromBuffer(N(t.stat)),s=d.getFileFlag(t.flag);s.isWriteable()?n.write(r,0,r.length,s.isAppendable()?n.getPos():0,t=>{function o(){n.stat((t,r)=>{t?e(t):r.mode!==i.mode?n.chmod(i.mode,t=>{e(t,n)}):e(t,n)})}t?e(t):s.isAppendable()?o():n.truncate(r.length,()=>{o()})}):e(null,n)}}function E(t){return{type:v.API_ERROR,errorData:M(t.writeToBuffer())}}function S(t){return h.fromBuffer(N(t.errorData))}function T(t){return{type:v.ERROR,name:t.name,message:t.message,stack:t.stack}}function I(t){let e=l[t.name];"function"!=typeof e&&(e=Error);const n=new e(t.message);return n.stack=t.stack,n}function F(t){return{type:v.STATS,statsData:M(t.toBuffer())}}function A(t){return w.fromBuffer(N(t.statsData))}function C(t){return{type:v.FILEFLAG,flagStr:t.getFlagString()}}function O(t){return d.getFileFlag(t.flagStr)}function M(t){return p(t)}function N(t){return m(t)}function D(t){return{type:v.BUFFER,data:M(t)}}function z(t){return N(t.data)}class L extends k{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._remoteFdId=i}getRemoteFdId(){return this._remoteFdId}toRemoteArg(){return{type:v.FD,id:this._remoteFdId,data:M(this.getBuffer()),stat:M(this.getStats().toBuffer()),path:this.getPath(),flag:this.getFlag().getFlagString()}}sync(t){this._syncClose("sync",t)}close(t){this._syncClose("close",t)}_syncClose(t,e){this.isDirty()?this._fs.syncClose(t,this,t=>{t||this.resetDirty(),e(t)}):e()}}class P extends u{constructor(t){var e;super(),this._callbackConverter=new _,this._isInitialized=!1,this._isReadOnly=!1,this._supportLinks=!1,this._supportProps=!1,this._worker=t,this._worker.addEventListener("message",t=>{const n=t.data;if((e=n)&&"object"==typeof e&&e.hasOwnProperty("browserfsMessage")&&e.browserfsMessage){let t;const e=n.args,r=new Array(e.length);for(t=0;t<r.length;t++)r[t]=this._argRemote2Local(e[t]);this._callbackConverter.toLocalArg(n.cbId).apply(null,r)}})}static Create(t,e){const n=new P(t.worker);n._initialize(()=>{e(null,n)})}static isAvailable(){return"undefined"!=typeof importScripts||"undefined"!=typeof Worker}static attachRemoteListener(t){const e=new b;function n(t,n,r){switch(typeof t){case"object":t instanceof w?r(null,F(t)):t instanceof h?r(null,E(t)):t instanceof g?r(null,e.toRemoteArg(t,n[0],n[1],r)):t instanceof d?r(null,C(t)):t instanceof x?r(null,D(t)):t instanceof Error?r(null,T(t)):r(null,t);break;default:r(null,t)}}function r(e,r){if(!e)return e;switch(typeof e){case"object":if("number"!=typeof e.type)return e;{const i=e;switch(i.type){case v.CB:const s=e.id;return function(){let e;const i=new Array(arguments.length);let o,a=arguments.length;function l(e){a>0&&(a=-1,o={browserfsMessage:!0,cbId:s,args:[E(e)]},t.postMessage(o))}for(e=0;e<arguments.length;e++)((e,c)=>{n(c,r,(n,r)=>{i[e]=r,n?l(n):0==--a&&(o={browserfsMessage:!0,cbId:s,args:i},t.postMessage(o))})})(e,arguments[e]);0===arguments.length&&(o={browserfsMessage:!0,cbId:s,args:i},t.postMessage(o))};case v.API_ERROR:return S(i);case v.STATS:return A(i);case v.FILEFLAG:return O(i);case v.BUFFER:return z(i);case v.ERROR:return I(i);default:return e}}default:return e}}var i;t.addEventListener("message",n=>{const s=n.data;if((i=s)&&"object"==typeof i&&i.hasOwnProperty("browserfsMessage")&&i.browserfsMessage){const n=s.args,i=new Array(n.length);switch(s.method){case"close":case"sync":(()=>{const r=n[1];e.applyFdAPIRequest(s,e=>{const n={browserfsMessage:!0,cbId:r.id,args:e?[E(e)]:[]};t.postMessage(n)})})();break;case"probe":(()=>{const e=c.getRootFS(),r=n[1],i={type:v.PROBE,isReadOnly:e.isReadOnly(),supportsLinks:e.supportsLinks(),supportsProps:e.supportsProps()},s={browserfsMessage:!0,cbId:r.id,args:[i]};t.postMessage(s)})();break;default:for(let t=0;t<n.length;t++)i[t]=r(n[t],i);const o=c.getRootFS();o[s.method].apply(o,i)}}})}getName(){return P.Name}isReadOnly(){return this._isReadOnly}supportsSynch(){return!1}supportsLinks(){return this._supportLinks}supportsProps(){return this._supportProps}rename(t,e,n){this._rpc("rename",arguments)}stat(t,e,n){this._rpc("stat",arguments)}open(t,e,n,r){this._rpc("open",arguments)}unlink(t,e){this._rpc("unlink",arguments)}rmdir(t,e){this._rpc("rmdir",arguments)}mkdir(t,e,n){this._rpc("mkdir",arguments)}readdir(t,e){this._rpc("readdir",arguments)}exists(t,e){this._rpc("exists",arguments)}realpath(t,e,n){this._rpc("realpath",arguments)}truncate(t,e,n){this._rpc("truncate",arguments)}readFile(t,e,n,r){this._rpc("readFile",arguments)}writeFile(t,e,n,r,i,s){this._rpc("writeFile",arguments)}appendFile(t,e,n,r,i,s){this._rpc("appendFile",arguments)}chmod(t,e,n,r){this._rpc("chmod",arguments)}chown(t,e,n,r,i){this._rpc("chown",arguments)}utimes(t,e,n,r){this._rpc("utimes",arguments)}link(t,e,n){this._rpc("link",arguments)}symlink(t,e,n,r){this._rpc("symlink",arguments)}readlink(t,e){this._rpc("readlink",arguments)}syncClose(t,e,n){this._worker.postMessage({browserfsMessage:!0,method:t,args:[e.toRemoteArg(),this._callbackConverter.toRemoteArg(n)]})}_initialize(t){if(this._isInitialized)t();else{const e={browserfsMessage:!0,method:"probe",args:[this._argLocal2Remote(y()),this._callbackConverter.toRemoteArg(e=>{this._isInitialized=!0,this._isReadOnly=e.isReadOnly,this._supportLinks=e.supportsLinks,this._supportProps=e.supportsProps,t()})]};this._worker.postMessage(e)}}_argRemote2Local(t){if(!t)return t;switch(typeof t){case"object":if("number"!=typeof t.type)return t;{const e=t;switch(e.type){case v.API_ERROR:return S(e);case v.FD:const n=e;return new L(this,n.path,d.getFileFlag(n.flag),w.fromBuffer(N(n.stat)),n.id,N(n.data));case v.STATS:return A(e);case v.FILEFLAG:return O(e);case v.BUFFER:return z(e);case v.ERROR:return I(e);default:return t}}default:return t}}_rpc(t,e){const n=new Array(e.length);for(let t=0;t<e.length;t++)n[t]=this._argLocal2Remote(e[t]);const r={browserfsMessage:!0,method:t,args:n};this._worker.postMessage(r)}_argLocal2Remote(t){if(!t)return t;switch(typeof t){case"object":return t instanceof w?F(t):t instanceof h?E(t):t instanceof L?t.toRemoteArg():t instanceof d?C(t):t instanceof x?D(t):t instanceof Error?T(t):"Unknown argument";case"function":return this._callbackConverter.toRemoteArg(t);default:return t}}}return P.Name="WorkerFS",P.Options={worker:{type:"object",description:"The target worker that you want to connect to, or the current worker if in a worker context.",validator:function(t,e){t.postMessage?e():e(new h(f.EINVAL,"option must be a Web Worker instance."))}}},P}),define("skylark-browserfs/generic/xhr",["../libs/buffers","../core/util","../core/api_error"],function(t,e,n){"use strict";const{isIE:r,emptyBuffer:i}=e,{ApiError:s,ErrorCode:o}=n,{Buffer:a}=t,l="undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest;function c(t,e,n){const r=new XMLHttpRequest;r.open("HEAD",e,t),r.onreadystatechange=function(t){if(4===r.readyState){if(200!==r.status)return n(new s(o.EIO,`XHR HEAD error: response returned code ${r.status}`));try{return n(null,parseInt(r.getResponseHeader("Content-Length")||"-1",10))}catch(t){return n(new s(o.EIO,"XHR HEAD error: Could not read content-length."))}}},r.send()}let u=function(t,e,n){const r=new XMLHttpRequest;r.open("GET",t,!0);let l=!0;switch(e){case"buffer":r.responseType="arraybuffer";break;case"json":try{r.responseType="json",l="json"===r.responseType}catch(t){l=!1}break;default:return n(new s(o.EINVAL,"Invalid download type: "+e))}r.onreadystatechange=function(t){if(4===r.readyState){if(200!==r.status)return n(new s(o.EIO,`XHR error: response returned code ${r.status}`));switch(e){case"buffer":return n(null,r.response?a.from(r.response):i());case"json":return n(null,l?r.response:JSON.parse(r.responseText))}}},r.send()},h=r&&"undefined"!=typeof Blob?function(t,e){const n=new XMLHttpRequest;switch(n.open("GET",t,!1),e){case"buffer":n.responseType="arraybuffer";break;case"json":break;default:throw new s(o.EINVAL,"Invalid download type: "+e)}let r,i;if(n.onreadystatechange=function(t){if(4===n.readyState)if(200===n.status)switch(e){case"buffer":r=a.from(n.response);break;case"json":r=JSON.parse(n.response)}else i=new s(o.EIO,`XHR error: response returned code ${n.status}`)},n.send(),i)throw i;return r}:function(t,e){const n=new XMLHttpRequest;n.open("GET",t,!1);let r=null,i=null;if(n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(t){if(4===n.readyState){if(200!==n.status)return void(i=new s(o.EIO,`XHR error: response returned code ${n.status}`));switch(e){case"buffer":const t=n.responseText;r=a.alloc(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return;case"json":return void(r=JSON.parse(n.responseText))}}},n.send(),i)throw i;return r};return{xhrIsAvailable:l,asyncDownloadFile:u,syncDownloadFile:h,getFileSizeSync:function(t){let e=-1;return c(!1,t,function(t,n){if(t)throw t;e=n}),e},getFileSizeAsync:function(t,e){c(!0,t,e)}}}),define("skylark-browserfs/generic/fetch",["../libs/buffers","../core/api_error"],function(t,e){"use strict";const{ApiError:n,ErrorCode:r}=e,i="undefined"!=typeof fetch&&null!==fetch,{Buffer:s}=t;return{fetchIsAvailable:i,fetchFileAsync:function(t,e,i){let o;try{o=fetch(t)}catch(t){return i(new n(r.EINVAL,t.message))}o.then(t=>{if(!t.ok)return i(new n(r.EIO,`fetch error: response returned code ${t.status}`));switch(e){case"buffer":t.arrayBuffer().then(t=>i(null,s.from(t))).catch(t=>i(new n(r.EIO,t.message)));break;case"json":t.json().then(t=>i(null,t)).catch(t=>i(new n(r.EIO,t.message)));break;default:i(new n(r.EINVAL,"Invalid download type: "+e))}}).catch(t=>i(new n(r.EIO,t.message)))},fetchFileSizeAsync:function(t,e){fetch(t,{method:"HEAD"}).then(t=>t.ok?e(null,parseInt(t.headers.get("Content-Length")||"-1",10)):e(new n(r.EIO,`fetch HEAD error: response returned code ${t.status}`))).catch(t=>e(new n(r.EIO,t.message)))}}}),define("skylark-browserfs/generic/file_index",["../core/node_fs_stats","../libs/path"],function(t,e){"use strict";const{Stats:n,FileType:r}=t;class i{constructor(){this._index={},this.addPath("/",new o)}static fromListing(t){const e=new i,a=new o;e._index["/"]=a;const l=[["",t,a]];for(;l.length>0;){let t;const i=l.pop(),a=i[0],c=i[1],u=i[2];for(const i in c)if(c.hasOwnProperty(i)){const h=c[i],f=`${a}/${i}`;h?(e._index[f]=t=new o,l.push([f,h,t])):t=new s(new n(r.FILE,-1,365)),u&&(u._ls[i]=t)}}return e}fileIterator(t){for(const e in this._index)if(this._index.hasOwnProperty(e)){const n=this._index[e],r=n.getListing();for(const e of r){const r=n.getItem(e);a(r)&&t(r.getData())}}}addPath(t,e){if(!e)throw new Error("Inode must be specified");if("/"!==t[0])throw new Error("Path must be absolute, got: "+t);if(this._index.hasOwnProperty(t))return this._index[t]===e;const n=this._split_path(t),r=n[0],i=n[1];let s=this._index[r];return!(void 0===s&&"/"!==t&&(s=new o,!this.addPath(r,s)))&&(!("/"!==t&&!s.addItem(i,e))&&(l(e)&&(this._index[t]=e),!0))}addPathFast(t,e){const n=t.lastIndexOf("/"),r=0===n?"/":t.substring(0,n),i=t.substring(n+1);let s=this._index[r];return void 0===s&&(s=new o,this.addPathFast(r,s)),!!s.addItem(i,e)&&(e.isDir()&&(this._index[t]=e),!0)}removePath(t){const e=this._split_path(t),n=e[0],r=e[1],i=this._index[n];if(void 0===i)return null;const s=i.remItem(r);if(null===s)return null;if(l(s)){const e=s.getListing();for(const n of e)this.removePath(t+"/"+n);"/"!==t&&delete this._index[t]}return s}ls(t){const e=this._index[t];return void 0===e?null:e.getListing()}getInode(t){const e=this._split_path(t),n=e[0],r=e[1],i=this._index[n];return void 0===i?null:n===t?i:i.getItem(r)}_split_path(t){const n=e.dirname(t),r=t.substr(n.length+("/"===n?0:1));return[n,r]}}class s{constructor(t){this.data=t}isFile(){return!0}isDir(){return!1}getData(){return this.data}setData(t){this.data=t}}class o{constructor(t=null){this.data=t,this._ls={}}isFile(){return!1}isDir(){return!0}getData(){return this.data}getStats(){return new n(r.DIRECTORY,4096,365)}getListing(){return Object.keys(this._ls)}getItem(t){const e=this._ls[t];return e||null}addItem(t,e){return!(t in this._ls)&&(this._ls[t]=e,!0)}remItem(t){const e=this._ls[t];return void 0===e?null:(delete this._ls[t],e)}}function a(t){return!!t&&t.isFile()}function l(t){return!!t&&t.isDir()}return{FileIndex:i,FileInode:s,DirInode:o,isFileInode:a,isDirInode:l}}),define("skylark-browserfs/backend/HTTPRequest",["../core/file_system","../core/api_error","../core/file_flag","../core/util","../core/node_fs_stats","../generic/preload_file","../generic/xhr","../generic/fetch","../generic/file_index"],function(t,e,n,r,i,s,o,a,l){"use strict";const{BaseFileSystem:c}=t,{ApiError:u,ErrorCode:h}=e,{ActionType:f}=n,{copyingSlice:d}=r,{Stats:p}=i,{NoSyncFile:m}=s,{xhrIsAvailable:y,asyncDownloadFile:g,syncDownloadFile:w,getFileSizeAsync:k,getFileSizeSync:x}=o,{fetchIsAvailable:v,fetchFileAsync:_,fetchFileSizeAsync:b}=a,{FileIndex:E,isFileInode:S,isDirInode:T}=l;function I(){throw new u(h.ENOTSUP,"Synchronous HTTP download methods are not available in this environment.")}class F extends c{constructor(t,e="",n=!1){super(),e.length>0&&"/"!==e.charAt(e.length-1)&&(e+="/"),this.prefixUrl=e,this._index=E.fromListing(t),!v||n&&y?(this._requestFileAsyncInternal=g,this._requestFileSizeAsyncInternal=k):(this._requestFileAsyncInternal=_,this._requestFileSizeAsyncInternal=b),y?(this._requestFileSyncInternal=w,this._requestFileSizeSyncInternal=x):(this._requestFileSyncInternal=I,this._requestFileSizeSyncInternal=I)}static Create(t,e){void 0===t.index&&(t.index="index.json"),"string"==typeof t.index?g(t.index,"json",(n,r)=>{n?e(n):e(null,new F(r,t.baseUrl))}):e(null,new F(t.index,t.baseUrl))}static isAvailable(){return y||v}empty(){this._index.fileIterator(function(t){t.fileData=null})}getName(){return F.Name}diskSpace(t,e){e(0,0)}isReadOnly(){return!0}supportsLinks(){return!1}supportsProps(){return!1}supportsSynch(){return y}preloadFile(t,e){const n=this._index.getInode(t);if(!S(n))throw u.EISDIR(t);{if(null===n)throw u.ENOENT(t);const r=n.getData();r.size=e.length,r.fileData=e}}stat(t,e,n){const r=this._index.getInode(t);if(null===r)return n(u.ENOENT(t));let i;S(r)?(i=r.getData()).size<0?this._requestFileSizeAsync(t,function(t,e){if(t)return n(t);i.size=e,n(null,p.clone(i))}):n(null,p.clone(i)):T(r)?(i=r.getStats(),n(null,i)):n(u.FileError(h.EINVAL,t))}statSync(t,e){const n=this._index.getInode(t);if(null===n)throw u.ENOENT(t);let r;if(S(n))(r=n.getData()).size<0&&(r.size=this._requestFileSizeSync(t));else{if(!T(n))throw u.FileError(h.EINVAL,t);r=n.getStats()}return r}open(t,e,n,r){if(e.isWriteable())return r(new u(h.EPERM,t));const i=this,s=this._index.getInode(t);if(null===s)return r(u.ENOENT(t));if(!S(s))return r(u.EISDIR(t));{const n=s.getData();switch(e.pathExistsAction()){case f.THROW_EXCEPTION:case f.TRUNCATE_FILE:return r(u.EEXIST(t));case f.NOP:if(n.fileData)return r(null,new m(i,t,e,p.clone(n),n.fileData));this._requestFileAsync(t,"buffer",function(s,o){return s?r(s):(n.size=o.length,n.fileData=o,r(null,new m(i,t,e,p.clone(n),o)))});break;default:return r(new u(h.EINVAL,"Invalid FileMode object."))}}}openSync(t,e,n){if(e.isWriteable())throw new u(h.EPERM,t);const r=this._index.getInode(t);if(null===r)throw u.ENOENT(t);if(!S(r))throw u.EISDIR(t);{const n=r.getData();switch(e.pathExistsAction()){case f.THROW_EXCEPTION:case f.TRUNCATE_FILE:throw u.EEXIST(t);case f.NOP:if(n.fileData)return new m(this,t,e,p.clone(n),n.fileData);const r=this._requestFileSync(t,"buffer");return n.size=r.length,n.fileData=r,new m(this,t,e,p.clone(n),r);default:throw new u(h.EINVAL,"Invalid FileMode object.")}}}readdir(t,e){try{e(null,this.readdirSync(t))}catch(t){e(t)}}readdirSync(t){const e=this._index.getInode(t);if(null===e)throw u.ENOENT(t);if(T(e))return e.getListing();throw u.ENOTDIR(t)}readFile(t,e,n,r){const i=r;this.open(t,n,420,function(t,n){if(t)return r(t);r=function(t,e){n.close(function(n){return t||(t=n),i(t,e)})};const s=n,o=s.getBuffer();null===e?r(t,d(o)):function(t,e,n){try{n(null,t.toString(e))}catch(t){n(t)}}(o,e,r)})}readFileSync(t,e,n){const r=this.openSync(t,n,420);try{const t=r,n=t.getBuffer();return null===e?d(n):n.toString(e)}finally{r.closeSync()}}_getHTTPPath(t){return"/"===t.charAt(0)&&(t=t.slice(1)),this.prefixUrl+t}_requestFileAsync(t,e,n){this._requestFileAsyncInternal(this._getHTTPPath(t),e,n)}_requestFileSync(t,e){return this._requestFileSyncInternal(this._getHTTPPath(t),e)}_requestFileSizeAsync(t,e){this._requestFileSizeAsyncInternal(this._getHTTPPath(t),e)}_requestFileSizeSync(t){return this._requestFileSizeSyncInternal(this._getHTTPPath(t))}}return F.Name="HTTPRequest",F.Options={index:{type:["string","object"],optional:!0,description:"URL to a file index as a JSON file or the file index object itself, generated with the make_http_index script. Defaults to `index.json`."},baseUrl:{type:"string",optional:!0,description:"Used as the URL prefix for fetched files. Default: Fetch files relative to the index."},preferXHR:{type:"boolean",optional:!0,description:"Whether to prefer XmlHttpRequest or fetch for async operations if both are available. Default: false"}},F}),define("skylark-browserfs/generic/extended_ascii",[],function(){"use strict";class t{static str2byte(e,n){const r=e.length>n.length?n.length:e.length;for(let i=0;i<r;i++){let r=e.charCodeAt(i);if(r>127){const n=t.extendedChars.indexOf(e.charAt(i));n>-1&&(r=n+128)}n[r]=i}return r}static byte2str(e){const n=new Array(e.length);for(let r=0;r<e.length;r++){const i=e[r];n[r]=i>127?t.extendedChars[i-128]:String.fromCharCode(i)}return n.join("")}static byteLength(t){return t.length}}return t.extendedChars=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","_","_","_","","","","","","","","","+","+","","","+","+","-","-","+","-","+","","","+","+","-","-","","-","+","","","","","","","i","","","","+","+","_","_","","","_","","","","","","","","","","","","","","","","","","","_","","","","","","","","","","","","_"," "],t}),define("skylark-browserfs/backend/ZipFS",["../core/api_error","../core/node_fs_stats","../core/file_system","../core/file_flag","../generic/preload_file","../core/util","../generic/extended_ascii","../generic/setImmediate","../generic/file_index"],function(t,e,n,r,i,s,o,a,l){"use strict";const{ApiError:c,ErrorCode:u}=t,{Stats:h,FileType:f}=e,{SynchronousFileSystem:d}=n,{ActionType:p}=r,{NoSyncFile:m}=i,{arrayish2Buffer:y,copyingSlice:g,bufferValidator:w}=s;let k;try{k=require("pako/lib/inflate").inflateRaw}catch(t){console.warn(t)}const{FileIndex:x,DirInode:v,FileInode:_,isDirInode:b,isFileInode:E}="../generic/file_index",S={};var T,I;function F(t,e){const n=31&e,r=(e>>5&15)-1,i=1980+(e>>9),s=31&t,o=t>>5&63,a=t>>11;return new Date(i,r,n,a,o,s)}function A(t,e,n,r){return 0===r?"":e?t.toString("utf8",n,n+r):o.byte2str(t.slice(n,n+r))}!function(t){t[t.MSDOS=0]="MSDOS",t[t.AMIGA=1]="AMIGA",t[t.OPENVMS=2]="OPENVMS",t[t.UNIX=3]="UNIX",t[t.VM_CMS=4]="VM_CMS",t[t.ATARI_ST=5]="ATARI_ST",t[t.OS2_HPFS=6]="OS2_HPFS",t[t.MAC=7]="MAC",t[t.Z_SYSTEM=8]="Z_SYSTEM",t[t.CP_M=9]="CP_M",t[t.NTFS=10]="NTFS",t[t.MVS=11]="MVS",t[t.VSE=12]="VSE",t[t.ACORN_RISC=13]="ACORN_RISC",t[t.VFAT=14]="VFAT",t[t.ALT_MVS=15]="ALT_MVS",t[t.BEOS=16]="BEOS",t[t.TANDEM=17]="TANDEM",t[t.OS_400=18]="OS_400",t[t.OSX=19]="OSX"}(T||(T={})),function(t){t[t.STORED=0]="STORED",t[t.SHRUNK=1]="SHRUNK",t[t.REDUCED_1=2]="REDUCED_1",t[t.REDUCED_2=3]="REDUCED_2",t[t.REDUCED_3=4]="REDUCED_3",t[t.REDUCED_4=5]="REDUCED_4",t[t.IMPLODE=6]="IMPLODE",t[t.DEFLATE=8]="DEFLATE",t[t.DEFLATE64=9]="DEFLATE64",t[t.TERSE_OLD=10]="TERSE_OLD",t[t.BZIP2=12]="BZIP2",t[t.LZMA=14]="LZMA",t[t.TERSE_NEW=18]="TERSE_NEW",t[t.LZ77=19]="LZ77",t[t.WAVPACK=97]="WAVPACK",t[t.PPMD=98]="PPMD"}(I||(I={}));class C{constructor(t){if(this.data=t,67324752!==t.readUInt32LE(0))throw new c(u.EINVAL,"Invalid Zip file: Local file header has invalid signature: "+this.data.readUInt32LE(0))}versionNeeded(){return this.data.readUInt16LE(4)}flags(){return this.data.readUInt16LE(6)}compressionMethod(){return this.data.readUInt16LE(8)}lastModFileTime(){return F(this.data.readUInt16LE(10),this.data.readUInt16LE(12))}rawLastModFileTime(){return this.data.readUInt32LE(10)}crc32(){return this.data.readUInt32LE(14)}fileNameLength(){return this.data.readUInt16LE(26)}extraFieldLength(){return this.data.readUInt16LE(28)}fileName(){return A(this.data,this.useUTF8(),30,this.fileNameLength())}extraField(){const t=30+this.fileNameLength();return this.data.slice(t,t+this.extraFieldLength())}totalSize(){return 30+this.fileNameLength()+this.extraFieldLength()}useUTF8(){return 2048==(2048&this.flags())}}class O{constructor(t,e,n){this.header=t,this.record=e,this.data=n}decompress(){const t=this.header.compressionMethod(),e=S[t];if(e)return e(this.data,this.record.compressedSize(),this.record.uncompressedSize(),this.record.flag());{let e=I[t];throw e||(e=`Unknown: ${t}`),new c(u.EINVAL,`Invalid compression method on file '${this.header.fileName()}': ${e}`)}}getHeader(){return this.header}getRecord(){return this.record}getRawData(){return this.data}}class M{constructor(t,e){if(this.zipData=t,this.data=e,33639248!==this.data.readUInt32LE(0))throw new c(u.EINVAL,`Invalid Zip file: Central directory record has invalid signature: ${this.data.readUInt32LE(0)}`);this._filename=this.produceFilename()}versionMadeBy(){return this.data.readUInt16LE(4)}versionNeeded(){return this.data.readUInt16LE(6)}flag(){return this.data.readUInt16LE(8)}compressionMethod(){return this.data.readUInt16LE(10)}lastModFileTime(){return F(this.data.readUInt16LE(12),this.data.readUInt16LE(14))}rawLastModFileTime(){return this.data.readUInt32LE(12)}crc32(){return this.data.readUInt32LE(16)}compressedSize(){return this.data.readUInt32LE(20)}uncompressedSize(){return this.data.readUInt32LE(24)}fileNameLength(){return this.data.readUInt16LE(28)}extraFieldLength(){return this.data.readUInt16LE(30)}fileCommentLength(){return this.data.readUInt16LE(32)}diskNumberStart(){return this.data.readUInt16LE(34)}internalAttributes(){return this.data.readUInt16LE(36)}externalAttributes(){return this.data.readUInt32LE(38)}headerRelativeOffset(){return this.data.readUInt32LE(42)}produceFilename(){const t=A(this.data,this.useUTF8(),46,this.fileNameLength());return t.replace(/\\/g,"/")}fileName(){return this._filename}rawFileName(){return this.data.slice(46,46+this.fileNameLength())}extraField(){const t=44+this.fileNameLength();return this.data.slice(t,t+this.extraFieldLength())}fileComment(){const t=46+this.fileNameLength()+this.extraFieldLength();return A(this.data,this.useUTF8(),t,this.fileCommentLength())}rawFileComment(){const t=46+this.fileNameLength()+this.extraFieldLength();return this.data.slice(t,t+this.fileCommentLength())}totalSize(){return 46+this.fileNameLength()+this.extraFieldLength()+this.fileCommentLength()}isDirectory(){const t=this.fileName();return!!(16&this.externalAttributes())||"/"===t.charAt(t.length-1)}isFile(){return!this.isDirectory()}useUTF8(){return 2048==(2048&this.flag())}isEncrypted(){return 1==(1&this.flag())}getFileData(){const t=this.headerRelativeOffset(),e=new C(this.zipData.slice(t));return new O(e,this,this.zipData.slice(t+e.totalSize()))}getData(){return this.getFileData().decompress()}getRawData(){return this.getFileData().getRawData()}getStats(){return new h(f.FILE,this.uncompressedSize(),365,Date.now(),this.lastModFileTime().getTime())}}class N{constructor(t){if(this.data=t,101010256!==this.data.readUInt32LE(0))throw new c(u.EINVAL,`Invalid Zip file: End of central directory record has invalid signature: ${this.data.readUInt32LE(0)}`)}diskNumber(){return this.data.readUInt16LE(4)}cdDiskNumber(){return this.data.readUInt16LE(6)}cdDiskEntryCount(){return this.data.readUInt16LE(8)}cdTotalEntryCount(){return this.data.readUInt16LE(10)}cdSize(){return this.data.readUInt32LE(12)}cdOffset(){return this.data.readUInt32LE(16)}cdZipCommentLength(){return this.data.readUInt16LE(20)}cdZipComment(){return A(this.data,!0,22,this.cdZipCommentLength())}rawCdZipComment(){return this.data.slice(22,22+this.cdZipCommentLength())}}class D{constructor(t,e,n,r){this.index=t,this.directoryEntries=e,this.eocd=n,this.data=r}}class z extends d{constructor(t,e=""){super(),this.name=e,this._index=new x,this._directoryEntries=[],this._eocd=null,this._index=t.index,this._directoryEntries=t.directoryEntries,this._eocd=t.eocd,this.data=t.data}static Create(t,e){try{z._computeIndex(t.zipData,(n,r)=>{if(r){const n=new z(r,t.name);e(null,n)}else e(n)})}catch(t){e(t)}}static isAvailable(){return!0}static RegisterDecompressionMethod(t,e){S[t]=e}static _getEOCD(t){const e=Math.min(65557,t.length-1);for(let n=22;n<e;n++)if(101010256===t.readUInt32LE(t.length-n))return new N(t.slice(t.length-n));throw new c(u.EINVAL,"Invalid ZIP file: Could not locate End of Central Directory signature.")}static _addToIndex(t,e){let n=t.fileName();if("/"===n.charAt(0))throw new c(u.EPERM,"Unexpectedly encountered an absolute path in a zip file. Please file a bug.");"/"===n.charAt(n.length-1)&&(n=n.substr(0,n.length-1)),t.isDirectory()?e.addPathFast("/"+n,new v(t)):e.addPathFast("/"+n,new _(t))}static _computeIndex(t,e){try{const n=new x,r=z._getEOCD(t);if(r.diskNumber()!==r.cdDiskNumber())return e(new c(u.EINVAL,"ZipFS does not support spanned zip files."));const i=r.cdOffset();if(4294967295===i)return e(new c(u.EINVAL,"ZipFS does not support Zip64."));const s=i+r.cdSize();z._computeIndexResponsive(t,n,i,s,e,[],r)}catch(t){e(t)}}static _computeIndexResponsiveTrampoline(t,e,n,r,i,s,o){try{z._computeIndexResponsive(t,e,n,r,i,s,o)}catch(t){i(t)}}static _computeIndexResponsive(t,e,n,r,i,s,o){if(n<r){let l=0;for(;l++<200&&n<r;){const r=new M(t,t.slice(n));z._addToIndex(r,e),n+=r.totalSize(),s.push(r)}a(()=>{z._computeIndexResponsiveTrampoline(t,e,n,r,i,s,o)})}else i(null,new D(e,s,o,t))}getName(){return z.Name+(""!==this.name?` ${this.name}`:"")}getCentralDirectoryEntry(t){const e=this._index.getInode(t);if(null===e)throw c.ENOENT(t);if(E(e))return e.getData();if(b(e))return e.getData();throw c.EPERM(`Invalid inode: ${e}`)}getCentralDirectoryEntryAt(t){const e=this._directoryEntries[t];if(!e)throw new RangeError(`Invalid directory index: ${t}.`);return e}getNumberOfCentralDirectoryEntries(){return this._directoryEntries.length}getEndOfCentralDirectory(){return this._eocd}diskSpace(t,e){e(this.data.length,0)}isReadOnly(){return!0}supportsLinks(){return!1}supportsProps(){return!1}supportsSynch(){return!0}statSync(t,e){const n=this._index.getInode(t);if(null===n)throw c.ENOENT(t);let r;if(E(n))r=n.getData().getStats();else{if(!b(n))throw new c(u.EINVAL,"Invalid inode.");r=n.getStats()}return r}openSync(t,e,n){if(e.isWriteable())throw new c(u.EPERM,t);const r=this._index.getInode(t);if(!r)throw c.ENOENT(t);if(!E(r))throw c.EISDIR(t);{const n=r.getData(),i=n.getStats();switch(e.pathExistsAction()){case p.THROW_EXCEPTION:case p.TRUNCATE_FILE:throw c.EEXIST(t);case p.NOP:return new m(this,t,e,i,n.getData());default:throw new c(u.EINVAL,"Invalid FileMode object.")}}}readdirSync(t){const e=this._index.getInode(t);if(e){if(b(e))return e.getListing();throw c.ENOTDIR(t)}throw c.ENOENT(t)}readFileSync(t,e,n){const r=this.openSync(t,n,420);try{const t=r,n=t.getBuffer();return null===e?g(n):n.toString(e)}finally{r.closeSync()}}}return z.Name="ZipFS",z.Options={zipData:{type:"object",description:"The zip file as a Buffer object.",validator:w},name:{type:"string",optional:!0,description:"The name of the zip file (optional)."}},z.CompressionMethod=I,z.RegisterDecompressionMethod(I.DEFLATE,(t,e,n)=>y(k(t.slice(0,e),{chunkSize:n}))),z.RegisterDecompressionMethod(I.STORED,(t,e,n)=>g(t,0,n)),z}),define("skylark-browserfs/backend/IsoFS",["../core/api_error","../core/node_fs_stats","../core/file_system","../core/file_flag","../generic/preload_file","../core/util","../libs/path"],function(t,e,n,r,i,s,o){"use strict";const{ApiError:a,ErrorCode:l}=t,{Stats:c,FileType:u}=e,{SynchronousFileSystem:h}=n,{ActionType:f}=r,{NoSyncFile:d}=i,{copyingSlice:p,bufferValidator:m}=s,y="IEEE_P1282";function g(t,e,n){return t.toString("ascii",e,e+n).trim()}function w(t,e,n){if(1===n)return String.fromCharCode(t[e]);const r=Math.floor(n/2),i=new Array(r);for(let n=0;n<r;n++){const r=e+(n<<1);i[n]=String.fromCharCode(t[r+1]|t[r]<<8)}return i.join("")}function k(t,e){const n=parseInt(g(t,e,4),10),r=parseInt(g(t,e+4,2),10),i=parseInt(g(t,e+6,2),10),s=parseInt(g(t,e+8,2),10),o=parseInt(g(t,e+10,2),10),a=parseInt(g(t,e+12,2),10),l=parseInt(g(t,e+14,2),10);return new Date(n,r,i,s,o,a,100*l)}function x(t,e){const n=t[e],r=t[e+1],i=t[e+2],s=t[e+3],o=t[e+4],a=t[e+5];return new Date(n,r-1,i,s,o,a)}function v(t,e){const n=t.slice(e),r=new C(n);switch(r.signatureWord()){case 17221:return new O(n);case 20548:return new M(n);case 21328:return new N(n);case 21332:return new D(n);case 17746:return new z(n);case 17747:return new L(n);case 20568:return new R(n);case 20558:return new j(n);case 21324:return new B(n);case 20045:return new $(n);case 17228:return new q(n);case 20556:return new W(n);case 21061:return new H(n);case 21574:return new V(n);case 21318:return new X(n);case 21074:return new P(n);default:return r}}function _(t,e,n,r){n-=4;let i=new Array;for(;e<n;){const n=v(t,e),s=n.length();if(0===s)return i;if(e+=s,n instanceof D)break;n instanceof O?i=i.concat(n.getEntries(r)):i.push(n)}return i}class b{constructor(t){this._data=t}type(){return this._data[0]}standardIdentifier(){return g(this._data,1,5)}version(){return this._data[6]}data(){return this._data.slice(7,2048)}}class E extends b{constructor(t){super(t),this._root=null}systemIdentifier(){return this._getString32(8)}volumeIdentifier(){return this._getString32(40)}volumeSpaceSize(){return this._data.readUInt32LE(80)}volumeSetSize(){return this._data.readUInt16LE(120)}volumeSequenceNumber(){return this._data.readUInt16LE(124)}logicalBlockSize(){return this._data.readUInt16LE(128)}pathTableSize(){return this._data.readUInt32LE(132)}locationOfTypeLPathTable(){return this._data.readUInt32LE(140)}locationOfOptionalTypeLPathTable(){return this._data.readUInt32LE(144)}locationOfTypeMPathTable(){return this._data.readUInt32BE(148)}locationOfOptionalTypeMPathTable(){return this._data.readUInt32BE(152)}rootDirectoryEntry(t){return null===this._root&&(this._root=this._constructRootDirectoryRecord(this._data.slice(156)),this._root.rootCheckForRockRidge(t)),this._root}volumeSetIdentifier(){return this._getString(190,128)}publisherIdentifier(){return this._getString(318,128)}dataPreparerIdentifier(){return this._getString(446,128)}applicationIdentifier(){return this._getString(574,128)}copyrightFileIdentifier(){return this._getString(702,38)}abstractFileIdentifier(){return this._getString(740,36)}bibliographicFileIdentifier(){return this._getString(776,37)}volumeCreationDate(){return k(this._data,813)}volumeModificationDate(){return k(this._data,830)}volumeExpirationDate(){return k(this._data,847)}volumeEffectiveDate(){return k(this._data,864)}fileStructureVersion(){return this._data[881]}applicationUsed(){return this._data.slice(883,1395)}reserved(){return this._data.slice(1395,2048)}_getString32(t){return this._getString(t,32)}}class S extends E{constructor(t){if(super(t),1!==this.type())throw new a(l.EIO,"Invalid primary volume descriptor.")}name(){return"ISO9660"}_constructRootDirectoryRecord(t){return new F(t,-1)}_getString(t,e){return this._getString(t,e)}}class T extends E{constructor(t){if(super(t),2!==this.type())throw new a(l.EIO,"Invalid supplementary volume descriptor.");const e=this.escapeSequence(),n=e[2];if(37!==e[0]||47!==e[1]||64!==n&&67!==n&&69!==n)throw new a(l.EIO,`Unrecognized escape sequence for SupplementaryVolumeDescriptor: ${e.toString()}`)}name(){return"Joliet"}escapeSequence(){return this._data.slice(88,120)}_constructRootDirectoryRecord(t){return new A(t,-1)}_getString(t,e){return w(this._data,t,e)}}class I{constructor(t,e){this._suEntries=null,this._fileOrDir=null,this._data=t,this._rockRidgeOffset=e}hasRockRidge(){return this._rockRidgeOffset>-1}getRockRidgeOffset(){return this._rockRidgeOffset}rootCheckForRockRidge(t){const e=this.getDirectory(t);this._rockRidgeOffset=e.getDotEntry(t)._getRockRidgeOffset(t),this._rockRidgeOffset>-1&&(this._fileOrDir=null)}length(){return this._data[0]}extendedAttributeRecordLength(){return this._data[1]}lba(){return 2048*this._data.readUInt32LE(2)}dataLength(){return this._data.readUInt32LE(10)}recordingDate(){return x(this._data,18)}fileFlags(){return this._data[25]}fileUnitSize(){return this._data[26]}interleaveGapSize(){return this._data[27]}volumeSequenceNumber(){return this._data.readUInt16LE(28)}identifier(){return this._getString(33,this._data[32])}fileName(t){if(this.hasRockRidge()){const e=this._rockRidgeFilename(t);if(null!==e)return e}const e=this.identifier();if(this.isDirectory(t))return e;const n=e.indexOf(";");return-1===n?e:"."===e[n-1]?e.slice(0,n-1):e.slice(0,n)}isDirectory(t){let e=!!(2&this.fileFlags());return!e&&this.hasRockRidge()&&(e=this.getSUEntries(t).filter(t=>t instanceof q).length>0),e}isSymlink(t){return this.hasRockRidge()&&this.getSUEntries(t).filter(t=>t instanceof B).length>0}getSymlinkPath(t){let e="";const n=this.getSUEntries(t),r=this._getGetString();for(const t of n)if(t instanceof B){const n=t.componentRecords();for(const t of n){const n=t.flags();2&n?e+="./":4&n?e+="../":8&n?e+="/":(e+=t.content(r),1&n||(e+="/"))}if(!t.continueFlag())break}return e.length>1&&"/"===e[e.length-1]?e.slice(0,e.length-1):e}getFile(t){if(this.isDirectory(t))throw new Error("Tried to get a File from a directory.");return null===this._fileOrDir&&(this._fileOrDir=t.slice(this.lba(),this.lba()+this.dataLength())),this._fileOrDir}getDirectory(t){if(!this.isDirectory(t))throw new Error("Tried to get a Directory from a file.");return null===this._fileOrDir&&(this._fileOrDir=this._constructDirectory(t)),this._fileOrDir}getSUEntries(t){return this._suEntries||this._constructSUEntries(t),this._suEntries}_rockRidgeFilename(t){const e=this.getSUEntries(t).filter(t=>t instanceof $);if(0===e.length||6&e[0].flags())return null;let n="";const r=this._getGetString();for(const t of e)if(n+=t.name(r),!(1&t.flags()))break;return n}_constructSUEntries(t){let e=33+this._data[32];e%2==1&&e++,e+=this._rockRidgeOffset,this._suEntries=_(this._data,e,this.length(),t)}_getRockRidgeOffset(t){this._rockRidgeOffset=0;const e=this.getSUEntries(t);if(e.length>0){const t=e[0];if(t instanceof N&&t.checkBytesPass())for(let n=1;n<e.length;n++){const r=e[n];if(r instanceof P||r instanceof z&&r.extensionIdentifier()===y)return t.bytesSkipped()}}return this._rockRidgeOffset=-1,-1}}class F extends I{constructor(t,e){super(t,e)}_getString(t,e){return g(this._data,t,e)}_constructDirectory(t){return new Z(this,t)}_getGetString(){return g}}class A extends I{constructor(t,e){super(t,e)}_getString(t,e){return w(this._data,t,e)}_constructDirectory(t){return new K(this,t)}_getGetString(){return w}}class C{constructor(t){this._data=t}signatureWord(){return this._data.readUInt16BE(0)}signatureWordString(){return g(this._data,0,2)}length(){return this._data[2]}suVersion(){return this._data[3]}}class O extends C{constructor(t){super(t),this._entries=null}continuationLba(){return this._data.readUInt32LE(4)}continuationLbaOffset(){return this._data.readUInt32LE(12)}continuationLength(){return this._data.readUInt32LE(20)}getEntries(t){if(!this._entries){const e=2048*this.continuationLba()+this.continuationLbaOffset();this._entries=_(t,e,this.continuationLength(),t)}return this._entries}}class M extends C{constructor(t){super(t)}}class N extends C{constructor(t){super(t)}checkBytesPass(){return 190===this._data[4]&&239===this._data[5]}bytesSkipped(){return this._data[6]}}class D extends C{constructor(t){super(t)}}class z extends C{constructor(t){super(t)}identifierLength(){return this._data[4]}descriptorLength(){return this._data[5]}sourceLength(){return this._data[6]}extensionVersion(){return this._data[7]}extensionIdentifier(){return g(this._data,8,this.identifierLength())}extensionDescriptor(){return g(this._data,8+this.identifierLength(),this.descriptorLength())}extensionSource(){return g(this._data,8+this.identifierLength()+this.descriptorLength(),this.sourceLength())}}class L extends C{constructor(t){super(t)}extensionSequence(){return this._data[4]}}class P extends C{constructor(t){super(t)}}class R extends C{constructor(t){super(t)}mode(){return this._data.readUInt32LE(4)}fileLinks(){return this._data.readUInt32LE(12)}uid(){return this._data.readUInt32LE(20)}gid(){return this._data.readUInt32LE(28)}inode(){return this._data.readUInt32LE(36)}}class j extends C{constructor(t){super(t)}devTHigh(){return this._data.readUInt32LE(4)}devTLow(){return this._data.readUInt32LE(12)}}class B extends C{constructor(t){super(t)}flags(){return this._data[4]}continueFlag(){return 1&this.flags()}componentRecords(){const t=new Array;let e=5;for(;e<this.length();){const n=new U(this._data.slice(e));t.push(n),e+=n.length()}return t}}class U{constructor(t){this._data=t}flags(){return this._data[0]}length(){return 2+this.componentLength()}componentLength(){return this._data[1]}content(t){return t(this._data,2,this.componentLength())}}class $ extends C{constructor(t){super(t)}flags(){return this._data[4]}name(t){return t(this._data,5,this.length()-5)}}class q extends C{constructor(t){super(t)}childDirectoryLba(){return this._data.readUInt32LE(4)}}class W extends C{constructor(t){super(t)}parentDirectoryLba(){return this._data.readUInt32LE(4)}}class H extends C{constructor(t){super(t)}}class V extends C{constructor(t){super(t)}flags(){return this._data[4]}creation(){return 1&this.flags()?this._longFormDates()?k(this._data,5):x(this._data,5):null}modify(){if(2&this.flags()){const t=1&this.flags()?1:0;return this._longFormDates?k(this._data,5+17*t):x(this._data,5+7*t)}return null}access(){if(4&this.flags()){let t=1&this.flags()?1:0;return t+=2&this.flags()?1:0,this._longFormDates?k(this._data,5+17*t):x(this._data,5+7*t)}return null}backup(){if(16&this.flags()){let t=1&this.flags()?1:0;return t+=2&this.flags()?1:0,t+=4&this.flags()?1:0,this._longFormDates?k(this._data,5+17*t):x(this._data,5+7*t)}return null}expiration(){if(32&this.flags()){let t=1&this.flags()?1:0;return t+=2&this.flags()?1:0,t+=4&this.flags()?1:0,t+=16&this.flags()?1:0,this._longFormDates?k(this._data,5+17*t):x(this._data,5+7*t)}return null}effective(){if(64&this.flags()){let t=1&this.flags()?1:0;return t+=2&this.flags()?1:0,t+=4&this.flags()?1:0,t+=16&this.flags()?1:0,t+=32&this.flags()?1:0,this._longFormDates?k(this._data,5+17*t):x(this._data,5+7*t)}return null}_longFormDates(){return!!this.flags()}}class X extends C{constructor(t){super(t)}virtualSizeHigh(){return this._data.readUInt32LE(4)}virtualSizeLow(){return this._data.readUInt32LE(12)}tableDepth(){return this._data[20]}}class Y{constructor(t,e){this._fileList=[],this._fileMap={},this._record=t;let n=t.lba(),r=n+t.dataLength();if(!(2&t.fileFlags())){const i=t.getSUEntries(e).filter(t=>t instanceof q)[0];n=2048*i.childDirectoryLba(),r=1/0}for(;n<r;){const t=e[n];if(0===t){n++;continue}const i=this._constructDirectoryRecord(e.slice(n)),s=i.fileName(e);"\0"!==s&&""!==s?i.hasRockRidge()&&0!==i.getSUEntries(e).filter(t=>t instanceof H).length||(this._fileMap[s]=i,this._fileList.push(s)):r===1/0&&(r=n+i.dataLength()),n+=i.length()}}getRecord(t){return this._fileMap[t]}getFileList(){return this._fileList}getDotEntry(t){return this._constructDirectoryRecord(t.slice(this._record.lba()))}}class Z extends Y{constructor(t,e){super(t,e)}_constructDirectoryRecord(t){return new F(t,this._record.getRockRidgeOffset())}}class K extends Y{constructor(t,e){super(t,e)}_constructDirectoryRecord(t){return new A(t,this._record.getRockRidgeOffset())}}class G extends h{constructor(t,e=""){super(),this._data=t;let n=!1,r=32768;const i=new Array;for(;!n;){const e=t.slice(r),s=new b(e);switch(s.type()){case 1:i.push(new S(e));break;case 2:i.push(new T(e));break;case 255:n=!0}r+=2048}if(0===i.length)throw new a(l.EIO,"Unable to find a suitable volume descriptor.");i.forEach(t=>{this._pvd&&2===this._pvd.type()||(this._pvd=t)}),this._root=this._pvd.rootDirectoryEntry(t),this._name=e}static Create(t,e){try{e(null,new G(t.data,t.name))}catch(t){e(t)}}static isAvailable(){return!0}getName(){let t=`IsoFS${this._name}${this._pvd?`-${this._pvd.name()}`:""}`;return this._root&&this._root.hasRockRidge()&&(t+="-RockRidge"),t}diskSpace(t,e){e(this._data.length,0)}isReadOnly(){return!0}supportsLinks(){return!1}supportsProps(){return!1}supportsSynch(){return!0}statSync(t,e){const n=this._getDirectoryRecord(t);if(null===n)throw a.ENOENT(t);return this._getStats(t,n)}openSync(t,e,n){if(e.isWriteable())throw new a(l.EPERM,t);const r=this._getDirectoryRecord(t);if(!r)throw a.ENOENT(t);if(r.isSymlink(this._data))return this.openSync(o.resolve(t,r.getSymlinkPath(this._data)),e,n);if(r.isDirectory(this._data))throw a.EISDIR(t);{const n=r.getFile(this._data),i=this._getStats(t,r);switch(e.pathExistsAction()){case f.THROW_EXCEPTION:case f.TRUNCATE_FILE:throw a.EEXIST(t);case f.NOP:return new d(this,t,e,i,n);default:throw new a(l.EINVAL,"Invalid FileMode object.")}}}readdirSync(t){const e=this._getDirectoryRecord(t);if(e){if(e.isDirectory(this._data))return e.getDirectory(this._data).getFileList().slice(0);throw a.ENOTDIR(t)}throw a.ENOENT(t)}readFileSync(t,e,n){const r=this.openSync(t,n,420);try{const t=r,n=t.getBuffer();return null===e?p(n):n.toString(e)}finally{r.closeSync()}}_getDirectoryRecord(t){if("/"===t)return this._root;const e=t.split("/").slice(1);let n=this._root;for(const t of e){if(!n.isDirectory(this._data))return null;if(!(n=n.getDirectory(this._data).getRecord(t)))return null}return n}_getStats(t,e){if(e.isSymlink(this._data)){const n=o.resolve(t,e.getSymlinkPath(this._data)),r=this._getDirectoryRecord(n);return r?this._getStats(n,r):null}{const t=e.dataLength();let n=365;const r=e.recordingDate().getTime();let i=r,s=r,o=r;if(e.hasRockRidge()){const t=e.getSUEntries(this._data);for(const e of t)if(e instanceof R)n=e.mode();else if(e instanceof V){const t=e.flags();4&t&&(i=e.access().getTime()),2&t&&(s=e.modify().getTime()),1&t&&(o=e.creation().getTime())}}return n&=365,new c(e.isDirectory(this._data)?u.DIRECTORY:u.FILE,t,n,i,s,o)}}}return G.Name="IsoFS",G.Options={data:{type:"object",description:"The ISO file in a buffer",validator:m}},G}),define("skylark-browserfs/core/backends",["./util","../backend/AsyncMirror","../backend/Dropbox","../backend/Emscripten","../backend/FolderAdapter","../backend/HTML5FS","../backend/InMemory","../backend/IndexedDB","../backend/LocalStorage","../backend/MountableFileSystem","../backend/OverlayFS","../backend/WorkerFS","../backend/HTTPRequest","../backend/ZipFS","../backend/IsoFS"],function(t,e,n,r,i,s,o,a,l,c,u,h,f,d,p){"use strict";const{checkOptions:m}=t;[e,n,r,i,s,o,a,p,l,c,u,h,f,d].forEach(t=>{const e=t.Create;t.Create=function(n,r){const i="function"==typeof n,s=i?n:r,o=i?{}:n;m(t,o,function(n){n?s(n):e.call(t,o,s)})}});const y={AsyncMirror:e,Dropbox:n,Emscripten:r,FolderAdapter:i,HTML5FS:s,InMemory:o,IndexedDB:a,IsoFS:p,LocalStorage:l,MountableFileSystem:c,OverlayFS:u,WorkerFS:h,HTTPRequest:f,XmlHttpRequest:f,ZipFS:d};return y}),define("skylark-browserfs/core/browserfs",["../libs/process","../libs/buffers","./node_fs","../libs/path","../generic/emscripten_fs","./backends","./util","./api_error","../generic/setImmediate"],function(t,e,n,r,i,s,o,a,l){"use strict";const{Buffer:c}=e;function u(module){switch(module){case"fs":return n;case"path":return r;case"buffer":return buffer;case"process":return t;case"bfs_utils":return o;default:return s[module]}}function h(t){return n.initialize(t)}function f(t,e){const n=t.fs;if(!n)return e(new a.ApiError(a.ErrorCode.EPERM,'Missing "fs" property on configuration object.'));const r=t.options;let i=0,o=!1;function l(){if(!o){o=!0;const t=s[n];t?t.Create(r,e):e(new a.ApiError(a.ErrorCode.EPERM,`File system ${n} is not available in BrowserFS.`))}}if(null!==r&&"object"==typeof r){let t=!1;const n=Object.keys(r).filter(t=>"fs"!==t);n.forEach(n=>{const s=r[n];null!==s&&"object"==typeof s&&s.fs&&(i++,f(s,function(s,a){if(i--,s){if(o)return;o=!0,e(s)}else r[n]=a,0===i&&t&&l()}))}),t=!0}0===i&&l()}return t.initializeTTYs&&t.initializeTTYs(),{install:function(e){e.Buffer=c,e.process=t;const n=e.require?e.require:null;e.require=function(t){const e=u(t);return e||n.apply(null,Array.prototype.slice.call(arguments,0))}},registerFileSystem:function(t,e){s[t]=e},BFSRequire:u,initialize:h,configure:function(t,e){f(t,(t,n)=>{n?(h(n),e()):e(t)})},getFileSystem:f,EmscriptenFS:i,FileSystem:s,Errors:a,setImmediate:l}}),define("skylark-browserfs/main",["./core/browserfs"],function(t){return t}),define("skylark-browserfs",["skylark-browserfs/main"],function(t){return t}),define("skylark-98js/helpers",["skylark-jquery","./win98"],function(t,e){Math.PI,Math.PI,t(window);const n=location.href.match(/98.js.org/)?location.href.match(/.*98.js.org/)[0]+"/":"/";return{Cursor:function(t){return"url(images/cursors/"+t[0]+".png) "+t[1].join(" ")+", "+t[2]},DESKTOP_ICON_SIZE:32,TASKBAR_ICON_SIZE:16,TITLEBAR_ICON_SIZE:16,getIconPath:function(t,e){return n+"images/icons/"+t+"-"+e+"x"+e+".png"},Canvas:function(t,e){var n=(i="canvas",document.createElement(i)),r=n.getContext("2d");var i;if(r.imageSmoothingEnabled=!1,r.mozImageSmoothingEnabled=!1,r.webkitImageSmoothingEnabled=!1,t&&e)n.width=t,n.height=e;else{var s=t;s&&(n.width=s.width,n.height=s.height,r.drawImage(s,0,0))}return n.ctx=r,n},mustHaveMethods:function(t,e){for(const n of e)if("function"!=typeof t[n])throw console.error("Missing method",n,"on object",t),new TypeError("missing method "+n);return!0},windowInterfaceMethods:["close","minimize","unminimize","bringToFront","getTitle","getIconAtSize","focus","blur","onFocus","onBlur","onClosed"],file_name_from_path:function(t){return t.split("\\").pop().split("/").pop()},file_extension_from_path:function(t){return(t.match(/\.(\w+)$/)||[,""])[1]}}}),define("skylark-98js/FolderViewItem",["skylark-jquery","./win98","./helpers"],function(t,e,n){"use strict";return function(e){var r,i=t("<div class='desktop-icon' draggable='true' tabindex=-1/>"),s=t("<div class='icon-wrapper'/>").appendTo(i),o=t("<div class='selection-effect'/>").appendTo(s),a=t("<div class='title'/>").text(e.title);let l;i.append(s,a),i.on("dblclick",t=>{t.ctrlKey||t.metaKey||t.shiftKey||t.altKey||(e.open(),clearTimeout(l))}),a.on("click",()=>{i[0]._was_selected_at_pointerdown&&(l=setTimeout(()=>{i.hasClass("selected")&&this.start_rename()},500))}),e.shortcut&&i.addClass("shortcut");i[0].dataset.filePath=e.file_path,this.element=i[0],this.icons=e.icons,this.iconSize=e.iconSize||n.DESKTOP_ICON_SIZE,this.file_path=e.file_path,this.is_system_folder=e.is_system_folder,this._update_icon=(()=>{if(this.icons){const e=r,n=this.icons[this.iconSize];(r=t("<img class='icon'/>")).attr({draggable:!1,src:n,width:this.iconSize,height:this.iconSize}),o[0].style.setProperty("--icon-image",`url("${n}")`),e?e.replaceWith(r):s.prepend(r)}else r&&r.remove(),r=null,o[0].style.setProperty("--icon-image","none");s[0].style.setProperty("--icon-size",this.iconSize+"px"),s[0].style.setProperty("--shortcut-icon",`url("${n.getIconPath("shortcut",this.iconSize)}")`)}),this.setIcons=(t=>{this.icons=t,this._update_icon()}),this.setIconSize=(t=>{this.iconSize!==t&&(this.iconSize=t,this._update_icon())}),this._update_icon(),this.start_rename=(()=>{if(!e.rename)return;if(i.hasClass("renaming"))return;i.addClass("renaming"),i.attr("draggable",!1);const n=a.text(),r=t("<input type='text'/>");r.val(n),r.on("keydown",t=>{"Enter"===t.key?(i.focus(),t.preventDefault()):"Escape"===t.key&&(r.val(n),i.focus(),t.preventDefault())}),r.on("blur",()=>{const t=r.val();""!==t.trim()?(r.remove(),a.text(t),i.removeClass("renaming"),i.attr("draggable",!0),t!==n&&e.rename(t).catch(t=>{a.text(n),alert("Failed to rename:\n\n"+t)})):showMessageBox({title:"Rename",message:"You must type a filename.",iconID:"error"}).then(()=>{r.focus()})}),a.empty().append(r),r[0].focus(),r[0].select()})}}),define("skylark-98js/filesystem-setup",["skylark-jquery","skylark-browserfs","./win98"],function(t,e,n){var r,i,s,o=[];const a=location.href.match(/98.js.org/)?location.href.match(/.*98.js.org/)[0]+"/":"/";return e.configure({fs:"OverlayFS",options:{writable:{fs:"IndexedDB",options:{storeName:"C:"}},readable:{fs:"XmlHttpRequest",options:{index:a+"filesystem-index.json",baseUrl:a}}}},function(t){if(t)throw i=!0,o.length&&alert("The filesystem is not available. It failed to initialize."),o=[],t;r=!0;for(var e=0;e<o.length;e++)o[e]();o=[]}),setTimeout(function(){s=!0,o.length&&alert("The filesystem is not working."),o=[]},5e3),{withFilesystem:function(t){r?t():i?alert("The filesystem is not available. It failed to initialize."):s?alert("The filesystem is not working."):o.push(t)}}}),define("skylark-98js/FolderView",["skylark-jquery","skylark-browserfs","./win98","./FolderViewItem","./filesystem-setup","./helpers"],function(t,e,n,r,i,s){const o=75,a=75,l=150,c=17;window.resetAllFolderCustomizations=(()=>{for(let t=0;t<localStorage.length;t++)localStorage.key(t).startsWith("folder-config:")&&localStorage.removeItem(localStorage.key(t))});const u={LARGE_ICONS:32,SMALL_ICONS:16,DETAILS:16,LIST:16,DESKTOP:32};m.VIEW_MODES={THUMBNAILS:"THUMBNAILS",LARGE_ICONS:"LARGE_ICONS",SMALL_ICONS:"SMALL_ICONS",DETAILS:"DETAILS",LIST:"LIST",DESKTOP:"DESKTOP"},m.SORT_MODES={NAME:"NAME",TYPE:"TYPE",SIZE:"SIZE",DATE:"DATE"};var h={txt:"notepad-file",md:"notepad-file",json:"notepad-file",js:"notepad-file",css:"notepad-file",html:"notepad-file",gitattributes:"notepad-file",gitignore:"notepad-file",png:"image-gif",jpg:"image-jpeg",jpeg:"image-jpeg",gif:"image-gif",webp:"image-other",bmp:"paint-file",tif:"kodak-imaging-file",tiff:"kodak-imaging-file",wav:"sound",mp3:"sound",ogg:"sound",wma:"sound",exe:"task",htm:"html",html:"html",url:"html",theme:"themes",themepack:"themes"};const f={"/":"(C:)","/my-pictures/":"My Pictures","/my-documents/":"My Documents","/network-neighborhood/":"Network Neighborhood","/desktop/":"Desktop","/programs/":"Program Files","/recycle-bin/":"Recycle Bin"},d=Object.fromEntries(Object.entries(f).map(([t,e])=>[e,t])),p=(Object.fromEntries(Object.entries(d).map(([t,e])=>[t.toLowerCase(),e])),t=>{window.dragging_file_paths=t;let e=window;for(;e!==e.parent;)(e=e.parent).dragging_file_paths=t});function m(n,{asDesktop:d=!1,onStatus:y,openFolder:g,openFileOrFolder:w,onConfigure:k}={}){const x=this;var v=t('<div class="folder-view" tabindex="0">');this.element=v[0],this.items=[],this.add_item=(t=>{v.append(t.element),this.items.push(t)}),this.config={};var _=`folder-config:${d?"desktop":n}`;try{const t=localStorage.getItem(_),e=JSON.parse(t);e&&Object.assign(this.config,e)}catch(t){console.error("Failed to read folder config:",t)}m.VIEW_MODES[this.config.view_mode]||(this.config.view_mode=d?m.VIEW_MODES.DESKTOP:m.VIEW_MODES.LARGE_ICONS),m.SORT_MODES[this.config.sort_mode]||(this.config.sort_mode=m.SORT_MODES.NAME),this.config.view_as_web_page||(this.config.view_as_web_page="/desktop/"!==n),this.element.dataset.viewMode=this.config.view_mode,this.configure=(t=>{Object.assign(this.config,t),t.view_mode&&(this.element.dataset.viewMode=t.view_mode),this.arrange_icons();try{localStorage.setItem(_,JSON.stringify(this.config))}catch(t){console.error("Can't write to localStorage:",t)}k&&k(t)}),this.cycle_view_mode=(()=>{const t=[m.VIEW_MODES.LARGE_ICONS,m.VIEW_MODES.SMALL_ICONS,m.VIEW_MODES.LIST],e=t.indexOf(this.config.view_mode),n=(e+1)%t.length;this.configure({view_mode:t[n]})});let b=!1;function E(){y&&y({items:x.items,selectedItems:x.items.filter(t=>t.element.classList.contains("selected"))})}function S(t,e){if(t.statSync(e).isDirectory()){for(const n of t.readdirSync(e))S(e+"/"+n);t.rmdirSync(e)}else t.unlinkSync(e)}this.arrange_icons=(()=>{if(b)return;if(!x.element.isConnected)return;const e=this.items.map(t=>t.pendingStatPromise).filter(Boolean),n=e.length>0;n&&(b||Promise.allSettled(e).then(()=>{b=!1,x.arrange_icons()}),b=!0);const r=this.config.view_mode===m.VIEW_MODES.LARGE_ICONS||this.config.view_mode===m.VIEW_MODES.SMALL_ICONS,i=this.config.view_mode===m.VIEW_MODES.LARGE_ICONS||this.config.view_mode===m.VIEW_MODES.DESKTOP,s=u[this.config.view_mode]||32,h=i?o:l,f=i?a:c;var d=0,p=0;const y=t=>t.is_system_folder?2:t.resolvedStats&&t.resolvedStats.isDirectory()?1:0,g=t=>(t.file_path||"").split(".").pop();this.config.sort_mode===m.SORT_MODES.NAME?this.items.sort((t,e)=>y(e)-y(t)||(t.title||"").localeCompare(e.title||"")):this.config.sort_mode===m.SORT_MODES.TYPE?this.items.sort((t,e)=>y(e)-y(t)||(g(t)||"").localeCompare(g(e)||"")):this.config.sort_mode===m.SORT_MODES.SIZE?this.items.sort((t,e)=>y(e)-y(t)||(t.resolvedStats.size||0)-(e.resolvedStats&&e.resolvedStats.size||0)):this.config.sort_mode===m.SORT_MODES.DATE&&this.items.sort((t,e)=>y(e)-y(t)||(t.resolvedStats&&t.resolvedStats.mtime||0)-(e.resolvedStats&&e.resolvedStats.mtime||0));for(const e of this.items)t(e.element).css({left:d,top:p}),r?(d+=h)+h>v[0].clientWidth&&(p+=f,d=0):(p+=f)+f>v[0].clientHeight&&(d+=h,p=0),e.setIconSize(s);n||(this.items.forEach((t,e)=>{t.element.classList.toggle("focused",0===e)}),this.items[0]&&this.items[0].element.focus(),E())}),x.focus=function(){v.is(":focus-within")||(v.focus(),0===v.find(".desktop-icon.focused").length&&this.items[0]&&this.items[0].element.focus())},x.select_all=function(){v.find(".desktop-icon").addClass("selected"),E()},x.select_inverse=function(){v.find(".desktop-icon").each(function(){t(this).toggleClass("selected")}),E()},x.delete_selected=function(){const t=v.find(".desktop-icon.selected").toArray().map(t=>t.dataset.filePath).filter(t=>void 0===f[t]);if(0===t.length)return;const n=v.find(".desktop-icon.selected .title").text().replace(/\.([^.]+)$/,"");showMessageBox({title:1===t.length?"Confirm File Delete":"Confirm Multiple File Delete",message:1===t.length?`Are you sure you want to delete '${n}'?`:`Are you sure you want to delete these ${t.length} items?`,buttons:[{label:"Yes",value:"yes",default:!0},{label:"No",value:"no"}],iconID:"nuke"}).then(n=>{"yes"===n&&i.withFilesystem(function(){const n=e.BFSRequire("fs");let r=0;for(const e of t){let t=!1;try{S(n,e),t=!0,r+=1}catch(t){console.log("failed to delete",e,t)}t&&x.items.forEach(t=>{t.element.dataset.filePath===e&&(t.element.remove(),E())})}r<t.length&&alert(`Failed to delete ${t.length-r} items.`)})})},x.start_rename=(()=>{for(const t of x.items)if(t.element.classList.contains("focused")){t.start_rename();break}}),i.withFilesystem(function(){var t=e.BFSRequire("fs");t.readdir(n,function(t,e){if(t)throw alert("Failed to read contents of the directory "+n),t;for(var r=0;r<e.length;r++){var i=e[r];D(i,-1e3,-1e3)}x.arrange_icons()})});const T=new ResizeObserver(t=>{x.arrange_icons()});T.observe(x.element),function(){var e=t("<div class='marquee'/>").appendTo(v).hide(),n={x:0,y:0},r={x:0,y:0},i=!1,s=function(){var i=Math.min(n.x,r.x),s=Math.min(n.y,r.y),o=Math.max(n.x,r.x),a=Math.max(n.y,r.y);e.show().css({position:"absolute",left:i,top:s,width:o-i,height:a-s}),v.find(".desktop-icon").each(function(e,n){t(n).offset();var r=parseFloat(t(n).css("left")),l=parseFloat(t(n).css("top")),c=t(n).width(),u=t(n).height();n.classList.toggle("selected",r<o&&l<a&&r+c>i&&l+u>s)}),E()};function o(t){var e=x.element.getBoundingClientRect();r={x:t.pageX-e.left+v[0].scrollLeft,y:t.pageY-e.top+v[0].scrollTop};const n=v.width()-v[0].clientWidth,o=v.height()-v[0].clientHeight,a=v[0].scrollLeft,l=v[0].scrollTop,c=v.width()+v[0].scrollLeft-n,u=v.height()+v[0].scrollTop-o;if(r.x=Math.max(a,Math.min(c,r.x)),r.y=Math.max(l,Math.min(u,r.y)),i){s();const t=10;r.x===a?v[0].scrollLeft-=t:r.x===c&&(v[0].scrollLeft+=t),r.y===l?v[0].scrollTop-=t:r.y===u&&(v[0].scrollTop+=t)}}function a(){e.hide(),i=!1,p([]),t(v[0].ownerDocument).off("pointermove",o),t(v[0].ownerDocument).off("pointerup blur",a)}v.on("pointerdown",".desktop-icon",function(t){const e=t.currentTarget;e._was_selected_at_pointerdown=e.classList.contains("selected"),C(e,t,!0)}),v.on("pointerdown",function(l){var c=v.is(":focus-within");x.focus();var u=t(l.target).closest(".desktop-icon");e.hide();var h=x.element.getBoundingClientRect();if(n={x:l.pageX-h.left+v[0].scrollLeft,y:l.pageY-h.top+v[0].scrollTop},r={x:l.pageX-h.left+v[0].scrollLeft,y:l.pageY-h.top+v[0].scrollTop},u.length>0)e.hide(),p(t(".desktop-icon.selected").get().map(t=>t.dataset.filePath).filter(t=>t));else{p([]);let t=v[0].offsetWidth-v[0].clientWidth,e=v[0].offsetHeight-v[0].clientHeight;t+=2,e+=2;const n=v[0].getBoundingClientRect(),r=l.clientX>n.right-t||l.clientY>n.bottom-e;(i=!r)&&c&&s()}t(v[0].ownerDocument).on("pointermove",o),t(v[0].ownerDocument).on("pointerup blur",a)})}();let I,F="";var A;function C(e,n,r){const i=e instanceof Element?e:e.element,s=n.shiftKey;A&&!x.items.some(t=>t.element===A)&&(A=null),s&&!A&&(A=x.items.find(t=>t.element.classList.contains("focused")).element||i),v.find(".desktop-icon").each(function(e,r){if(s){const e=A.getBoundingClientRect(),n=i.getBoundingClientRect(),s=r.getBoundingClientRect(),o={top:Math.min(e.top,n.top),left:Math.min(e.left,n.left),bottom:Math.max(e.bottom,n.bottom),right:Math.max(e.right,n.right)};t(r).toggleClass("selected",s.top>=o.top&&s.left>=o.left&&s.bottom<=o.bottom&&s.right<=o.right)}else"pointerdown"===n.type&&(n.ctrlKey||n.metaKey)?r===i&&t(r).toggleClass("selected"):n.ctrlKey||n.metaKey||r.classList.toggle("selected",r===i);r.classList.toggle("focused",r===i)}),r?setTimeout(()=>{i.scrollIntoView({block:"nearest"})},500):i.scrollIntoView({block:"nearest"}),E(),n.shiftKey||(A=i)}function O(e,n,r){let i=v.find(".desktop-icon.focused");if(0==i.length&&(i=v.find(".desktop-icon")),0==i.length)return!1;const s=i.outerWidth(),o=i.outerHeight(),a=i[0].getBoundingClientRect();let l=a.left,c=a.top;l+=e*s,c+=n*o;const u=v.find(".desktop-icon").toArray().sort(function(t,e){const n=t.getBoundingClientRect(),r=e.getBoundingClientRect(),i=Math.abs(n.left-l)+Math.abs(n.top-c),s=Math.abs(r.left-l)+Math.abs(r.top-c);return i-s}),h=t(u[0]);return h.length>0&&(C(h[0],r),!0)}v.on("keydown",function(t){if("INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName)if("Enter"==t.key)v.find(".desktop-icon.selected").trigger("dblclick");else if(t.ctrlKey&&"a"==t.key)folder_view.select_all(),t.preventDefault();else if("Delete"==t.key)x.delete_selected(),t.preventDefault();else if("ArrowLeft"==t.key||"ArrowRight"==t.key||"ArrowUp"==t.key||"ArrowDown"==t.key){t.preventDefault();const e="ArrowLeft"==t.key?-1:"ArrowRight"==t.key?1:0,n="ArrowUp"==t.key?-1:"ArrowDown"==t.key?1:0;O(e,n,t)}else if("PageUp"==t.key||"PageDown"==t.key)if(t.preventDefault(),x.config.view_mode===m.VIEW_MODES.LIST){const e="PageUp"==t.key?-1:1,n=v.width(),r=v.find(".desktop-icon").outerWidth(),i=n-r;for(let n=i;n>0&&!O(e*n/r,0,t);n-=r);}else{const e="PageUp"==t.key?-1:1,n=v.height(),r=v.find(".desktop-icon").outerHeight(),i=n-r;for(let n=i;n>0&&!O(0,e*n/r,t);n-=r);}else if("Home"==t.key)t.preventDefault(),C(x.items[0],t);else if("End"==t.key)t.preventDefault(),C(x.items[x.items.length-1],t);else if(" "==t.key&&0===F.length)t.preventDefault(),(t.ctrlKey||t.metaKey)&&v.find(".desktop-icon.selected").length>0?v.find(".desktop-icon.focused").toggleClass("selected"):v.find(".desktop-icon.focused").addClass("selected"),E();else if("F2"===t.key)t.preventDefault(),x.start_rename();else{if(t.isDefaultPrevented()||t.ctrlKey||t.altKey||t.metaKey)return;if(I&&clearTimeout(I),F===t.key){const e=x.items.filter(t=>{const e=t.element.querySelector(".title").textContent;return e.toLocaleLowerCase().startsWith(F.toLocaleLowerCase())});if(e.length>0){const n=e.findIndex(t=>t.element.classList.contains("focused"));C(-1===n?e[0]:e[(n+1)%e.length],t)}}else if("Shift"!==t.key&&"Compose"!==t.key&&(F+=t.key),I=setTimeout(function(){F=""},1e3),F.length>0)for(const t of x.items){const e=t.element.querySelector(".title").textContent;if(e.toLocaleLowerCase().startsWith(F.toLocaleLowerCase())){C(t,{});break}}}});var M=function(t,e){if(t.isDirectory())return"folder";var n=s.file_extension_from_path(e),r=h[n.toLowerCase()];return r||"document"},N=function(t){return{16:s.getIconPath(t,16),32:s.getIconPath(t,32),48:s.getIconPath(t,48)}},D=function(i,s,o){var a,l,c=n+i,h=new r({title:i,open:async function(){if(g){let t=h.resolvedStats;if(!t){if(!h.pendingStatPromise)return void alert(`Cannot open '${h.file_path}'. File type information not available.`);try{t=await h.pendingStatPromise}catch(t){return void alert(`Failed to get info about '${h.file_path}':\n\n${t}`)}}if(t.isDirectory())return void g(h.file_path)}w?w(h.file_path):alert("No handler for opening files or folders.")},rename:t=>{var r=e.BFSRequire("fs");return new Promise(function(e,i){const s=n+t;r.rename(h.file_path,s,function(n){if(n)return i(n);if(e(),h.file_path=s,h.title=t,h.element.dataset.filePath=s,h.resolvedStats){const t=M(h.resolvedStats,s);h.setIcons(N(t))}})})},shortcut:c.match(/\.url$/),file_path:c,iconSize:u[x.config.view_mode]});h.pendingStatPromise=(a=c,l=e.BFSRequire("fs"),new Promise(function(t,e){l.stat(a,function(n,r){if(n)return e(n);t(r)})})),h.pendingStatPromise.then(t=>{h.pendingStatPromise=null,h.resolvedStats=t;const e=M(t,h.file_path);h.setIcons(N(e))},t=>{h.pendingStatPromise=null}),x.add_item(h),t(h.element).css({left:s,top:o})},z=0;v.on("dragover",function(t){t.preventDefault(),z=t.originalEvent.pageX,t.originalEvent.pageY}),v.on("drop",function(r){r.preventDefault();var i=r.originalEvent.pageX||z,s=r.originalEvent.pageY||r.dragover_pageY;withFilesystem(function(){var o=r.originalEvent.dataTransfer.files;t.map(o,function(t){!function(t,r,i){var s=e.BFSRequire("buffer").Buffer,o=e.BFSRequire("fs"),a=n+t.name,l=new FileReader;l.onerror=function(t){throw t},l.onload=function(e){var n=s.from(l.result);o.writeFile(a,n,{flag:"wx"},function(e){if(e)throw"EEXIST"===e.code&&alert("File already exists!"),e;D(t.name,r,i)})},l.readAsArrayBuffer(t)}(t,i,s)})})})}return m}),define("skylark-98js/os-gui/$Window",["skylark-jquery","../win98"],function(t,e){function n(t){return document.createElement(t)}function r(t){return"object"==typeof t&&"tagName"in t?t.tagName.toLowerCase()+(t.id?"#"+t.id:"")+(t.className?"."+t.className.split(" ").join("."):"")+(t.src?`[src="${t.src}"]`:"")+(t.srcdoc?"[srcdoc]":"")+(t.href?`[href="${t.href}"]`:""):t?t.constructor.name:`${t}`}function i(e){const n=t(e);let r=n.find("\n\t\t\tinput:enabled,\n\t\t\ttextarea:enabled,\n\t\t\tselect:enabled,\n\t\t\tbutton:enabled,\n\t\t\ta[href],\n\t\t\t[tabIndex='0'],\n\t\t\tdetails summary,\n\t\t\tiframe,\n\t\t\tobject,\n\t\t\tembed,\n\t\t\tvideo[controls],\n\t\t\taudio[controls],\n\t\t\t[contenteditable]:not([contenteditable='false'])\n\t\t").filter(":visible");const i={},s=[];for(const t of r.toArray())"input"===t.nodeName.toLowerCase()&&"radio"===t.type&&(i[t.name]?t.checked?(s.push(i[t.name]),i[t.name]=t):s.push(t):i[t.name]=t);const o=r.not(s);return o}var s=t(window);a.Z_INDEX=5;var o=[];function a(e){e=e||{};var l=t(n("div")).addClass("window os-window").appendTo("body");l[0].$window=l,l.element=l[0],l[0].id=`os-window-${Math.random().toString(36).substr(2,9)}`,l.$titlebar=t(n("div")).addClass("window-titlebar").appendTo(l),l.$title_area=t(n("div")).addClass("window-title-area").appendTo(l.$titlebar),l.$title=t(n("span")).addClass("window-title").appendTo(l.$title_area),e.toolWindow&&(e.minimizeButton=!1,e.maximizeButton=!1),!1!==e.minimizeButton&&(l.$minimize=t(n("button")).addClass("window-minimize-button window-action-minimize window-button").appendTo(l.$titlebar),l.$minimize.attr("aria-label","Minimize window"),l.$minimize.append("<span class='window-button-icon'></span>")),!1!==e.maximizeButton&&(l.$maximize=t(n("button")).addClass("window-maximize-button window-action-maximize window-button").appendTo(l.$titlebar),l.$maximize.attr("aria-label","Maximize or restore window"),e.resizable||l.$maximize.attr("disabled",!0),l.$maximize.append("<span class='window-button-icon'></span>")),!1!==e.closeButton&&(l.$x=t(n("button")).addClass("window-close-button window-action-close window-button").appendTo(l.$titlebar),l.$x.attr("aria-label","Close window"),l.$x.append("<span class='window-button-icon'></span>")),l.$content=t(n("div")).addClass("window-content").appendTo(l),l.$content.attr("tabIndex","-1"),l.$content.css("outline","none"),e.toolWindow&&l.addClass("tool-window"),e.parentWindow&&(e.parentWindow.addChildWindow(l),e.toolWindow&&(l[0].dataset.semanticParent=e.parentWindow[0].id));var c=e.$component;if("object"==typeof e.icon&&"tagName"in e.icon)e.icons={any:e.icon};else if(e.icon){if(console.warn("DEPRECATED: use options.icons instead of options.icon, e.g. new $Window({icons: {16: 'app-16x16.png', any: 'app-icon.svg'}})"),"undefined"==typeof $Icon||"undefined"==typeof TITLEBAR_ICON_SIZE)throw new Error("Use {icon: img_element} or {icons: {16: url_or_img_element}} options");l.icon_name=e.icon,l.$icon=$Icon(e.icon,TITLEBAR_ICON_SIZE).prependTo(l.$titlebar)}l.icons=e.icons||{};let u=16;l.setTitlebarIconSize=function(e){l.icons&&(l.$icon&&l.$icon.remove(),l.$icon=t(l.getIconAtSize(e)),l.$icon.prependTo(l.$titlebar)),u=e,l.trigger("icon-change")},l.getTitlebarIconSize=function(){return u},l.getIconAtSize=function(e){let r;if(l.icons[e])r=e;else if(l.icons.any)r="any";else{const t=Object.keys(l.icons).filter(t=>isFinite(t)&&isFinite(parseFloat(t)));t.sort((t,n)=>Math.abs(t-e)-Math.abs(n-e)),r=t[0]}if(r){const i=l.icons[r];let s;if(void 0!==i.nodeType)s=i.cloneNode(!0);else{s=n("img");const o=t(s);i.srcset?o.attr("srcset",i.srcset):o.attr("src",i.src||i),o.attr({width:r,height:r,draggable:!1}),o.css({width:e,height:e})}return s}return null},l.setTitlebarIconSize(u),l.getIconName=(()=>(console.warn("DEPRECATED: use $w.icons object instead of $w.icon_name"),l.icon_name)),l.setIconByID=(t=>{console.warn("DEPRECATED: use $w.setIcons(icons) instead of $w.setIconByID(icon_name)");var e=l.$icon;return l.$icon=$Icon(t,TITLEBAR_ICON_SIZE),e.replaceWith(l.$icon),l.icon_name=t,l.task&&l.task.updateIcon(),l.trigger("icon-change"),l}),l.setIcons=(t=>{l.icons=t,l.setTitlebarIconSize(u),l.task&&l.task.updateIcon()}),c&&l.addClass("component-window"),setTimeout(()=>{"rtl"==(window.get_direction?window.get_direction():getComputedStyle(l[0]).direction)&&l.addClass("rtl")},0);const h=t({}),f=t=>e=>{const n=()=>{e()};h.on(t,n);return()=>{h.off(t,n)}};l.onFocus=f("focus"),l.onBlur=f("blur"),l.onClosed=f("closed"),l.setDimensions=(({innerWidth:t,innerHeight:e,outerWidth:n,outerHeight:r})=>{let i,s;if(t&&(i=l.outerWidth()-l.$content.outerWidth()),e){s=l.outerHeight()-l.$content.outerHeight();const t=l.$content.find(".menus");t.length&&(s+=t.outerHeight())}n&&l.outerWidth(n),r&&l.outerHeight(r),t&&l.outerWidth(t+i),e&&l.outerHeight(e+s)}),l.setDimensions(e);let d=[];l.addChildWindow=(t=>{d.push(t)});const p=()=>{l.hasClass("focused")||(l.addClass("focused"),h.triggerHandler("focus"),l.trigger("focus"))},m=()=>{l.hasClass("focused")&&(l.removeClass("focused"),h.triggerHandler("blur"),l.trigger("blur"))};if(l.focus=(()=>{l.bringToFront(),D()}),l.blur=(()=>{m(),document.activeElement&&document.activeElement.closest(".window")==l[0]&&document.activeElement.blur()}),e.toolWindow)e.parentWindow?(e.parentWindow.onFocus(p),e.parentWindow.onBlur(m),document.activeElement&&document.activeElement.closest(".window")==e.parentWindow[0]&&p()):(t(window).on("focus",p),t(window).on("blur",m),document.hasFocus()&&p());else{const t=w(l[0],!0);function y(t){if(!E.has(t)){const e=w(t,!1);E.set(t,e),setTimeout(()=>{try{const n=e=>{"complete"==t.contentDocument.readyState?e():setTimeout(()=>{n(e)},100)};n(()=>{t.contentWindow.addEventListener("focusin",e),t.contentWindow.addEventListener("focusout",e),t.contentWindow.addEventListener("blur",e),t.contentWindow.addEventListener("focus",e),g(t.contentDocument)})}catch(e){F(t,e)}},100)}}function g(t){const e=new MutationObserver(t=>{for(const e of t)for(const t of e.addedNodes)"IFRAME"==t.tagName&&y(t)});e.observe(t,{childList:!0,subtree:!0});for(const e of t.querySelectorAll("iframe"))y(e)}function w(t,e){return function(n){const r="IFRAME"==t.tagName?t.contentDocument:t,i=r.ownerDocument||r;let s=n?"focusout"===n.type||"blur"===n.type?n.relatedTarget:n.target:i.activeElement;n&&"blur"===n.type&&(s=null),i.activeElement&&"IFRAME"===i.activeElement.tagName&&(n&&"focusout"===n.type||n&&"blur"===n.type)&&!s&&(s=i.activeElement);const o=!s||s.window===s||!r.contains(s),a=o&&r!==s;if(a&&e&&m(),o||"HTML"===s.tagName||"BODY"===s.tagName||s===r||s.matches(".window-content")||s.closest(".menus")||s.closest(".window-titlebar")||(b.set(t,s),A(i,r,s,e)),!o&&"IFRAME"===s.tagName){const t=s;try{const n=t.contentDocument.activeElement;n&&"HTML"!==n.tagName&&"BODY"!==n.tagName&&!n.closest(".menus")&&(b.set(t,n),A(t.contentDocument,t.contentDocument,n,e))}catch(e){F(t,e)}}if(e)for(;;){const t=s&&s.closest&&s.closest("[data-semantic-parent]");if(!t)break;{const e=t.dataset.semanticParent,n=t.ownerDocument.getElementById(e);if(s=n,!n){console.warn("semantic parent not found with id",e);break}}}if(s&&s.window!==s&&r.contains(s)){if(p(),l.bringToFront(),!e){let e=t;for(;e;)e.dispatchEvent(new Event("focusin",{bubbles:!0,target:e,view:e.ownerDocument.defaultView})),e=e.currentView&&e.currentView.frameElement}}else e&&m()}}window.addEventListener("focusin",t),window.addEventListener("focusout",t),window.addEventListener("blur",t),window.addEventListener("focus",t),g(l.$content[0])}l.css("touch-action","none");let k,x,v,_=null;l.setMinimizeTarget=function(t){_=t},Object.defineProperty(l,"task",{get:()=>k,set(t){console.warn("DEPRECATED: use $w.setMinimizeTarget(taskbar_button_el) instead of setting $window.task object"),k=t}}),l.minimize=(()=>{if(_=_||k&&k.$task[0],$)q.push(l.minimize);else if(l.is(":visible"))if(_&&!l.hasClass("minimized-without-taskbar")){const t=l.$titlebar[0].getBoundingClientRect(),e=_.getBoundingClientRect();l.animateTitlebar(t,e,()=>{l.hide(),l.blur()})}else{const t=150,e=10;if(l.hasClass("minimized-without-taskbar"))o[l._minimize_slot_index]=null;else{let t=0;for(;o[t];)t++;l._minimize_slot_index=t,o[t]=l}const n=l._minimize_slot_index*(t+e)+10,r=l.$titlebar.outerHeight();let i;const s=()=>{x={position:l.css("position"),left:l.css("left"),top:l.css("top"),width:l.css("width"),height:l.css("height")},l.addClass("minimized-without-taskbar"),l.hasClass("maximized")&&(l.removeClass("maximized"),l.addClass("was-maximized"),l.$maximize.removeClass("window-action-restore"),l.$maximize.addClass("window-action-maximize")),l.$minimize.removeClass("window-action-minimize"),l.$minimize.addClass("window-action-restore"),i?l.css({position:i.position,left:i.left,top:i.top,width:i.width,height:i.height}):l.css({position:"fixed",top:`calc(100% - ${r+5}px)`,left:n,width:t,height:r})},a=()=>{i={position:l.css("position"),left:l.css("left"),top:l.css("top"),width:l.css("width"),height:l.css("height")},l.removeClass("minimized-without-taskbar"),l.hasClass("was-maximized")&&(l.removeClass("was-maximized"),l.addClass("maximized"),l.$maximize.removeClass("window-action-maximize"),l.$maximize.addClass("window-action-restore")),l.$minimize.removeClass("window-action-restore"),l.$minimize.addClass("window-action-minimize"),l.css({width:"",height:""}),x&&l.css({position:x.position,left:x.left,top:x.top,width:x.width,height:x.height})},c=l.$titlebar[0].getBoundingClientRect();let u;l.css("transform",""),l.hasClass("minimized-without-taskbar")?(a(),u=l.$titlebar[0].getBoundingClientRect(),s()):(s(),u=l.$titlebar[0].getBoundingClientRect(),a()),l.animateTitlebar(c,u,()=>{l.hasClass("minimized-without-taskbar")?a():(s(),l.blur())})}}),l.unminimize=(()=>{if($)q.push(l.unminimize);else if(l.hasClass("minimized-without-taskbar"))l.minimize();else if(l.is(":hidden")){const t=_.getBoundingClientRect();l.show();const e=l.$titlebar[0].getBoundingClientRect();l.hide(),l.animateTitlebar(t,e,()=>{l.show(),l.bringToFront(),l.focus()})}}),l.maximize=(()=>{if(!e.resizable)return;if($)return void q.push(l.maximize);if(l.hasClass("minimized-without-taskbar"))return void l.minimize();const n=()=>{v={position:l.css("position"),left:l.css("left"),top:l.css("top"),width:l.css("width"),height:l.css("height")},l.addClass("maximized");const e=t(".taskbar"),n=window.innerWidth-t(window).width(),r=window.innerHeight-t(window).height(),i=e.length?e.outerHeight()+1:0;l.css({position:"fixed",top:0,left:0,width:`calc(100vw - ${n}px)`,height:`calc(100vh - ${r}px - ${i}px)`})},r=()=>{l.removeClass("maximized"),l.css({width:"",height:""}),v&&l.css({position:v.position,left:v.left,top:v.top,width:v.width,height:v.height})},i=l.$titlebar[0].getBoundingClientRect();let s;l.css("transform","");const o=l.hasClass("maximized");o?(r(),s=l.$titlebar[0].getBoundingClientRect(),n()):(n(),s=l.$titlebar[0].getBoundingClientRect(),r()),l.animateTitlebar(i,s,()=>{o?(r(),l.$maximize.removeClass("window-action-restore"),l.$maximize.addClass("window-action-maximize")):(n(),l.$maximize.removeClass("window-action-maximize"),l.$maximize.addClass("window-action-restore"))})}),l.restore=(()=>{l.is(".minimized-without-taskbar, .minimized")?l.unminimize():l.is(".maximized")&&l.maximize()}),l.$minimize&&l.$minimize.on("click",t=>{l.minimize()}),l.$maximize&&l.$maximize.on("click",t=>{l.maximize()}),l.$x&&l.$x.on("click",t=>{l.close()}),l.$title_area.on("dblclick",t=>{l.maximize()}),l.css({position:"absolute",zIndex:a.Z_INDEX++}),l.bringToFront=(()=>{l.css({zIndex:a.Z_INDEX++});for(const t of d)t.bringToFront()});var b=new Map,E=new Map,S=new Map,T=[],I=new WeakSet;const F=(t,n)=>{const i=e=>[`OS-GUI.js failed to access an iframe (${r(t)}) for focus integration.\n\t${e}\n\tOriginal error:\n\t`,n];let s;if(t.srcdoc)s=!1;else try{const e=new URL(t.src);s=e.origin!==window.location.origin}catch(t){return void console.error(...i(`This may be a bug in OS-GUI. Is this a cross-origin iframe? Failed to parse URL (${t}).`))}s?e.iframes&&e.iframes.ignoreCrossOrigin&&!I.has(t)&&(console.warn(...i("Only same-origin iframes can work with focus integration (showing window as focused, refocusing last focused controls).\n\tIf you can re-host the content on the same origin, you can resolve this and enable focus integration.\n\tYou can also disable this warning by passing {iframes: {ignoreCrossOrigin: true}} to $Window.")),I.add(t)):console.error(...i("This may be a bug in OS-GUI, since it doesn't appear to be a cross-origin iframe."))},A=(t,e,n,r)=>{if(!a.DEBUG_FOCUS)return;let i=S.get(e);i||((i=t.createElementNS("http://www.w3.org/2000/svg","svg")).style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.pointerEvents="none",i.style.zIndex="100000000",i.style.direction="ltr",S.set(e,i),T.push(i),t.body.appendChild(i)),i._container_el=e,i._descendant_el=n,i._is_root=r,M()},C=t=>{const e=t._container_el,n=t._descendant_el,i=t._is_root;for(;t.lastChild;)t.removeChild(t.lastChild);const s=n.getBoundingClientRect&&n.getBoundingClientRect()||{left:0,top:0,width:innerWidth,height:innerHeight,right:innerWidth,bottom:innerHeight},o=e.getBoundingClientRect&&ontainer_el.getBoundingClientRect()||{left:0,top:0,width:innerWidth,height:innerHeight,right:innerWidth,bottom:innerHeight};for(const a of[s,o]){const o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("x",a.left),o.setAttribute("y",a.top),o.setAttribute("width",a.width),o.setAttribute("height",a.height),o.setAttribute("stroke","#f44"),o.setAttribute("stroke-width","2"),o.setAttribute("fill","none"),i||o.setAttribute("stroke-dasharray","5,5"),t.appendChild(o);const l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",a.left),l.setAttribute("y",a.top+(a===s?20:0)),l.setAttribute("fill",a===s?"#f44":"aqua"),l.setAttribute("font-size","20"),l.style.textShadow="1px 1px 1px black, 0 0 10px black",l.textContent=r(a===s?n:e),t.appendChild(l)}const a=[[s.left,s.top,o.left,o.top],[s.right,s.top,o.right,o.top],[s.left,s.bottom,o.left,o.bottom],[s.right,s.bottom,o.right,o.bottom]];for(const e of a){const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",e[0]),n.setAttribute("y1",e[1]),n.setAttribute("x2",e[2]),n.setAttribute("y2",e[3]),n.setAttribute("stroke","green"),n.setAttribute("stroke-width","2"),t.appendChild(n)}};let O;const M=()=>{if(cancelAnimationFrame(O),a.DEBUG_FOCUS){O=requestAnimationFrame(M);for(const t of T)C(t)}else N()},N=()=>{cancelAnimationFrame(O);for(const t of T)t.remove();T.length=0,S.clear()},D=(t=l.$content[0])=>{const n=t.matches(".window-content")?l[0]:t,r=b.get(n);if(r){if(r.focus({preventScroll:!0}),"IFRAME"===r.tagName)try{D(r)}catch(t){F(r,t)}return}const s=i(t),o=s.filter(".default");if(o.length)o[0].focus({preventScroll:!0});else if(s.length)if("IFRAME"===s[0].tagName)try{D(s[0])}catch(t){F(s[0],t)}else s[0].focus({preventScroll:!0});else if(e.toolWindow&&e.parentWindow)e.parentWindow.triggerHandler("refocus-window");else if(t.focus({preventScroll:!0}),"IFRAME"===t.tagName)try{D(t.contentDocument.body)}catch(e){F(t,e)}};var z,L,P,R,j;l.on("refocus-window",()=>{D()}),l.on("pointerdown mousedown",function(t){l.bringToFront(),requestAnimationFrame(()=>{const e=b.get(window);if(document.activeElement&&document.activeElement!==document&&document.activeElement!==document.body&&document.activeElement!==l.$content[0]&&document.activeElement!==e)return;if(document.activeElement&&document.activeElement.closest&&document.activeElement.closest(".menus, .menu-popup"))return;const n=getComputedStyle(t.target);if("none"!==n.userSelect)return l.$content.focus(),void l.one("pointerup pointercancel",()=>{requestAnimationFrame(()=>{getSelection().toString().trim()||D()})});D()})}),s.on("focusin",t=>{b.set(window,t.target)}),l.on("keydown",e=>{if(e.isDefaultPrevented())return;if(e.ctrlKey||e.altKey||e.metaKey)return;if(e.target.closest(".menus"))return;const n=l.$content.find("button"),r=t(document.activeElement),s=n.index(r);switch(e.keyCode){case 40:case 39:r.is("button")&&!e.shiftKey&&s<n.length-1&&(n[s+1].focus(),e.preventDefault());break;case 38:case 37:r.is("button")&&!e.shiftKey&&s>0&&(n[s-1].focus(),e.preventDefault());break;case 32:case 13:if(r.is("button")&&!e.shiftKey){r.addClass("pressed");const e=()=>{r.removeClass("pressed"),r.off("focusout",e),t(window).off("keyup",n)},n=t=>{32!==t.keyCode&&13!==t.keyCode||e()};r.on("focusout",e),t(window).on("keyup",n)}break;case 9:{const t=i(l.$content[0]);if(t.length>0){const n=t.index(r);e.shiftKey?0===n&&(e.preventDefault(),t[t.length-1].focus()):n===t.length-1&&(e.preventDefault(),t[0].focus())}break}case 27:l.close()}}),l.applyBounds=(()=>{const t=Math.max(document.body.scrollWidth,innerWidth),e=Math.max(document.body.scrollHeight,innerHeight);l.css({left:Math.max(0,Math.min(t-l.width(),l.position().left)),top:Math.max(0,Math.min(e-l.height(),l.position().top))})}),l.bringTitleBarInBounds=(()=>{const t=Math.max(document.body.scrollWidth,innerWidth),e=Math.max(document.body.scrollHeight,innerHeight);l.css({left:Math.max(40-l.outerWidth(),Math.min(t-40,l.position().left)),top:Math.max(0,Math.min(e-l.$titlebar.outerHeight()-5,l.position().top))})}),l.center=(()=>{l.css({left:(innerWidth-l.width())/2+window.scrollX,top:(innerHeight-l.height())/2+window.scrollY}),l.applyBounds()}),s.on("resize",l.bringTitleBarInBounds);var B=t=>{j===(t.pointerId||t.originalEvent.pointerId)&&(P=t.clientX||P,R=t.clientY||R),l.css({left:P+scrollX-z,top:R+scrollY-L})};if(l.$titlebar.css("touch-action","none"),l.$titlebar.on("selectstart",t=>{t.preventDefault()}),l.$titlebar.on("mousedown","button",e=>{D();const n=e.currentTarget;if(!t(n).is(":enabled"))return;n.classList.add("pressing");const r=e=>{e&&"blur"===e.type&&document.hasFocus()||(n.classList.remove("pressing"),s.off("mouseup blur",r),t(n).off("mouseenter",i),t(n).off("mouseleave",o))},i=()=>{n.classList.add("pressing")},o=()=>{n.classList.remove("pressing")};s.on("mouseup blur",r),t(n).on("mouseenter",i),t(n).on("mouseleave",o)}),l.$titlebar.on("pointerdown",e=>{if(t(e.target).closest("button").length)return;if(l.hasClass("maximized"))return;const n=t.Event("window-drag-start");l.trigger(n),n.isDefaultPrevented()||(z=e.clientX+scrollX-l.position().left,L=e.clientY+scrollY-l.position().top,P=e.clientX,R=e.clientY,j=e.pointerId||e.originalEvent.pointerId,s.on("pointermove",B),s.on("scroll",B),t("body").addClass("dragging"))}),s.on("pointerup pointercancel",e=>{(e.pointerId||e.originalEvent.pointerId)===j&&(s.off("pointermove",B),s.off("scroll",B),t("body").removeClass("dragging"),l.bringTitleBarInBounds(),j=-1)}),l.$titlebar.on("dblclick",t=>{c&&c.dock()}),e.resizable){const n=0,r=-1,i=1,o=r,a=i,c=r,u=i;[[c,a],[c,n],[c,o],[n,o],[u,o],[u,n],[u,a],[n,a]].forEach(([r,i])=>{const h=t("<div>").addClass("handle").appendTo(l);let f="";r===c&&(f+="n"),r===u&&(f+="s"),i===o&&(f+="w"),i===a&&(f+="e"),f+="-resize";const d=(l.outerWidth()-l.width())/2,p=(l.outerWidth()-l.innerWidth())/2,m=l.outerHeight()-l.$content.outerHeight(),y=l.outerWidth()-l.$content.outerWidth();let g,w,k,x,v,_;function b(t){(t.pointerId||t.originalEvent.pointerId)===_&&(x=t.clientX,v=t.clientY,S())}function E(e){(e.pointerId||e.originalEvent.pointerId)===_&&(s.off("pointermove",b),s.off("scroll",onscroll),t("body").removeClass("dragging"),s.off("pointerup pointercancel",E),l.bringTitleBarInBounds())}function S(){const t=x+scrollX-w,n=v+scrollY-k;let s,h,f=0,d=0;i===a?(f=0,s=~~(t-g.x)):i===o?(f=~~(t-g.x),s=~~(g.x+g.width-t)):s=~~g.width,r===u?(d=0,h=~~(n-g.y)):r===c?(d=~~(n-g.y),h=~~(g.y+g.height-n)):h=~~g.height;let p={x:g.x+f,y:g.y+d,width:s,height:h};p.width=Math.max(1,p.width),p.height=Math.max(1,p.height),e.constrainRect&&(p=e.constrainRect(p,i,r)),p.width=Math.max(p.width,e.minOuterWidth||100),p.height=Math.max(p.height,e.minOuterHeight||0),p.width=Math.max(p.width,(e.minInnerWidth||0)+y),p.height=Math.max(p.height,(e.minInnerHeight||0)+m),i===o&&(p.x=Math.min(p.x,g.x+g.width-p.width)),r===c&&(p.y=Math.min(p.y,g.y+g.height-p.height)),l.css({top:p.y,left:p.x}),l.outerWidth(p.width),l.outerHeight(p.height)}h.css({position:"absolute",top:r===c?-p:r===n?`calc(${d}px - ${p}px)`:"",bottom:r===u?-p:"",left:i===o?-p:i===n?`calc(${d}px - ${p}px)`:"",right:i===a?-p:"",width:i===n?`calc(100% - ${d}px * 2 + ${2*p}px)`:`${d}px`,height:r===n?`calc(100% - ${d}px * 2 + ${2*p}px)`:`${d}px`,touchAction:"none",cursor:f}),h.on("pointerdown",e=>{e.preventDefault(),s.on("pointermove",b),s.on("scroll",S),t("body").addClass("dragging"),s.on("pointerup pointercancel",E),g={x:l.position().left,y:l.position().top,width:l.outerWidth(),height:l.outerHeight()},w=e.clientX+scrollX-g.x-(i===a?g.width:0),k=e.clientY+scrollY-g.y-(r===u?g.height:0),x=e.clientX,v=e.clientY,_=e.pointerId||e.originalEvent.pointerId,h[0].setPointerCapture(_)})})}l.$Button=((e,r)=>{var i=t(n("button")).appendTo(l.$content).text(e).on("click",()=>{r&&r(),l.close()});return i}),l.title=(t=>t?(l.$title.text(t),l.trigger("title-change"),l.task&&l.task.updateTitle(),l):l.$title.text()),l.getTitle=(()=>l.title());let U,$=!1,q=[];return l.animateTitlebar=((t,e,n=(()=>{}))=>{$=!0;const r=l.$titlebar.clone(!0);r.find("button").remove(),r.appendTo("body");const i=a.OVERRIDE_TRANSITION_DURATION||200,s=`${i}ms`;r.css({transition:`left ${s} linear, top ${s} linear, width ${s} linear, height ${s} linear`,position:"fixed",zIndex:1e7,pointerEvents:"none",left:t.left,top:t.top,width:t.width,height:t.height}),setTimeout(()=>{r.css({left:e.left,top:e.top,width:e.width,height:e.height})},5);let o=!1;const c=()=>{if(o)return;o=!0,$=!1,r.remove(),n();let t=q.shift();t&&t()};r.on("transitionend transitioncancel",c),setTimeout(c,1.2*i)}),l.close=(e=>{if(e&&!0!==e)throw new TypeError("force must be a boolean or undefined, not "+Object.prototype.toString.call(e));if(!e){var n=t.Event("close");if(l.trigger(n),n.isDefaultPrevented())return}c&&c.detach(),l.closed=!0,h.triggerHandler("closed"),l.trigger("closed"),l.remove();var r=t(t(".window:visible").toArray().sort((t,e)=>e.style.zIndex-t.style.zIndex)[0]);r.triggerHandler("refocus-window"),N()}),l.closed=!1,l.setMenuBar=(t=>{U&&U.element.remove(),t&&(l.$titlebar.after(t.element),t.setKeyboardScope(l[0]),U=t)}),e.title&&l.title(e.title),c||l.center(),l}return a.$FormWindow=function(e){var r=new a;return r.title(e),r.$form=t(n("form")).appendTo(r.$content),r.$main=t(n("div")).appendTo(r.$form),r.$buttons=t(n("div")).appendTo(r.$form).addClass("button-group"),r.$Button=((e,i)=>{var s=t(n("button")).appendTo(r.$buttons).text(e);return s.on("click",t=>{t.preventDefault(),i()}),s.on("pointerdown",()=>{s.focus()}),s}),r},a}),define("skylark-98js/iframe-windows",["skylark-jquery","./win98","./os-gui/$Window"],function(t,e,n){var r=0,i=t(window);function s(e){var n=t(e);t("body").addClass("loading-program"),r+=1,n.on("load",function(){--r<=0&&t("body").removeClass("loading-program");try{console.assert(e.contentWindow.document===e.contentDocument)}catch(t){return void console.warn(`[enhance_iframe] iframe integration is not available for '${e.src}'`)}if(window.themeCSSProperties&&applyTheme(themeCSSProperties,e.contentDocument.documentElement),e.contentDocument.addEventListener("mousedown",t=>{var n=function(){if(e.contentWindow&&e.contentWindow.jQuery&&e.contentWindow.jQuery("body").trigger("pointerup"),e.contentWindow){const t=new e.contentWindow.MouseEvent("mouseup",{button:0});e.contentWindow.dispatchEvent(t);const n=new e.contentWindow.MouseEvent("mouseup",{button:2});e.contentWindow.dispatchEvent(n)}r()};function r(){i.off("mouseup blur",n),e.contentDocument.removeEventListener("mouseup",r)}i.on("mouseup blur",n),e.contentDocument.addEventListener("mouseup",r)}),o(e),e.contentDocument.querySelector("#error #livewebInfo.available")){var s=document.createElement("div");s.style.position="absolute",s.style.left="0",s.style.right="0",s.style.top="0",s.style.bottom="0",s.style.background="#c0c0c0",s.style.color="#000",s.style.padding="50px",e.contentDocument.body.appendChild(s),s.innerHTML='<a target="_blank">Save this url in the Wayback Machine</a>',s.querySelector("a").href="https://web.archive.org/save/https://98.js.org/"+e.src.replace(/.*https:\/\/98.js.org\/?/,""),s.querySelector("a").style.color="blue"}var a=t(e.contentWindow);a.on("pointerdown click",function(n){e.$window&&e.$window.focus(),t(".menu-button").trigger("release"),t(".menu-popup").hide()}),a.on("pointerdown",function(e){n.css("pointer-events","all"),t("body").addClass("drag")}),a.on("pointerup",function(e){t("body").removeClass("drag"),n.css("pointer-events","")}),e.contentWindow.close=function(){e.$window&&e.$window.close()},e.contentWindow.showMessageBox=(t=>showMessageBox({title:t.title||e.contentWindow.defaultMessageBoxTitle,...t}))}),n.css({minWidth:0,minHeight:0,flex:1,border:0})}function o(t){for(const e of["keyup","keydown","keypress"])t.contentWindow.addEventListener(e,n=>{const r=new KeyboardEvent(e,{target:t,view:t.ownerDocument.defaultView,bubbles:!0,cancelable:!0,key:n.key,keyCode:n.keyCode,which:n.which,code:n.code,shiftKey:n.shiftKey,ctrlKey:n.ctrlKey,metaKey:n.metaKey,altKey:n.altKey,repeat:n.repeat}),i=t.dispatchEvent(r);i||n.preventDefault()},!0)}return t(window).on("pointerdown",function(e){t("body").addClass("drag")}),t(window).on("pointerup dragend blur",function(e){"blur"===e.type&&document.activeElement.tagName.match(/iframe/i)||(t("body").removeClass("drag"),t("iframe").css("pointer-events",""))}),{enhance_iframe:s,proxy_keyboard_events:o,make_iframe_window:function(e){void 0==e.resizable&&(e.resizable=!0);var r=new n(e),i=r.$iframe=t("<iframe>").attr({src:e.src});return s(i[0]),r.$content.append(i),(r.iframe=i[0]).$window=r,i.on("load",function(){r.show(),r.focus()}),r.$content.css({display:"flex",flexDirection:"column"}),r.center(),r.hide(),r}}}),define("skylark-98js/Task",["skylark-jquery","./win98"],function(t,e){function n(e){n.all_tasks.push(this),this.$window=e;const r=this.$task=t("<button class='task toggle'/>").appendTo(t(".tasks")),i=t("<span class='title'/>");let s;this.updateTitle=(()=>{i.text(e.getTitle())}),this.updateIcon=(()=>{const t=s;(s=e.getIconAtSize(16))?t?t.replaceWith(s):r.prepend(s):t&&t.remove()}),this.updateTitle(),this.updateIcon(),e.on("title-change",this.updateTitle),e.on("icon-change",this.updateIcon),e.setMinimizeTarget(r[0]),r.append(s,i),r.on("pointerdown",function(t){t.preventDefault()}),r.on("click",function(){r.hasClass("selected")?(e.minimize(),e.blur()):(e.unminimize(),e.bringToFront(),e.focus())}),e.on("focus",()=>{r.addClass("selected")}),e.on("blur",()=>{r.removeClass("selected")}),e.on("closed",()=>{r.remove();const t=n.all_tasks.indexOf(this);-1!==t&&n.all_tasks.splice(t,1)}),e.is&&e.is(":visible")&&e.focus()}return n.all_tasks=[],n}),define("skylark-98js/visualizer-overlay",["skylark-jquery","./win98"],function(t,e){window.monkey_patch_render=(t=>t.render());return class{constructor(t,e){this.visualizerCanvas=t,this.wrappyCanvas=document.createElement("canvas"),this.wrappyCtx=this.wrappyCanvas.getContext("2d"),this.overlayCanvases=[],this.animateFns=[],window.monkey_patch_render=(t=>t.audio&&t.renderer?(t.render(),void this.render(e)):t.render())}makeOverlayCanvas(t){const e=document.createElement("canvas"),n=e.getContext("2d");e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.pointerEvents="none",e.style.mixBlendMode="color-dodge",e.style.willChange="opacity",e.className="visualizer-overlay-canvas",t.appendChild(e),this.overlayCanvases.push(e),this.animateFns.push(r=>{n.clearRect(0,0,e.width,e.height);const i=(t.classList.contains("doubled")?2:1)*(window.devicePixelRatio||1);e.width===t.clientWidth*i&&e.height===t.clientHeight*i||(e.width=t.clientWidth*i,e.height=t.clientHeight*i),e.style.width=t.clientWidth+"px",e.style.height=t.clientHeight+"px";const s=t.querySelectorAll("*");Array.from(s).map(t=>{const e=t.clientWidth,n=t.clientHeight,r=e*n;return{element:t,width:e,height:n,area:r}}).filter(({area:t})=>t>0).sort((t,e)=>e.area-t.area).forEach(({element:e,width:s,height:o,area:a})=>{const{offsetLeft:l,offsetTop:c}=function(t,e){let n=t,r=0,i=0;do{r+=n.offsetLeft,i+=n.offsetTop,n=n.offsetParent}while(n&&n!==e);return{offsetLeft:r,offsetTop:i}}(e,t);n.save(),n.scale(i,i),n.translate(l,c),r.stretch?n.drawImage(this.wrappyCanvas,0,0,s,o):n.drawImage(this.wrappyCanvas,0,0,s,o,0,0,s,o),a<900&&(n.globalCompositeOperation="destination-out",n.globalAlpha=.5,n.fillStyle="black",n.fillRect(0,0,s,o)),n.restore()})})}render(t){const{visualizerCanvas:e,wrappyCanvas:n,wrappyCtx:r,animateFns:i}=this,{width:s,height:o}=e;if(t.mirror){const t=()=>{r.drawImage(e,0,0,s,o,0,0,s,o)};n.width=2*s,n.height=2*o,r.save(),t(),r.translate(0,o),r.scale(1,-1),r.translate(0,-o),t(),r.translate(s,0),r.scale(-1,1),r.translate(-s,0),t(),r.translate(0,o),r.scale(1,-1),r.translate(0,-o),t(),r.restore()}else if(t.tile){n.width=2*s,n.height=2*o;for(let t=0;t<2;t++)for(let n=0;n<2;n++)r.drawImage(e,0,0,s,o,s*t,o*n,s,o)}else n.width=s,n.height=o,r.drawImage(e,0,0,s,o);i.forEach(e=>e(t))}cleanUp(){this.overlayCanvases.forEach(t=>{t.remove()}),window.monkey_patch_render=(t=>t.render())}fadeOutAndCleanUp(){this.fadeOut(),this.overlayCanvases[0].addEventListener("transitionend",()=>{this.cleanUp()})}fadeOut(){this.overlayCanvases.forEach(t=>{t.style.transition="opacity 1s cubic-bezier(0.125, 0.960, 0.475, 0.915)",t.style.opacity="0"})}fadeIn(){this.overlayCanvases.forEach(t=>{t.style.transition="opacity 0.2s ease",t.style.opacity="1"})}}}),define("skylark-98js/programs",["skylark-jquery","skylark-browserfs","./win98","./filesystem-setup","./helpers","./FolderViewItem","./iframe-windows","./Task","./visualizer-overlay","./os-gui/$Window"],function(t,e,n,r,i,s,o,a,l,c){let u=o.make_iframe_window;function h(e){const n=c({title:e.title||"Help Topics",icons:P("chm"),resizable:!0});n.addClass("help-window");let r=!0,i=0,s=0;const o=t(E("div")).addClass("main"),l=t(E("div")).addClass("toolbar"),u=(e,r,i,s)=>{const o=t("<button class='lightweight'>").append(t("<span>").text(e)).appendTo(l).on("click",()=>{i()});t("<div class='icon'/>").appendTo(o).css({backgroundPosition:`${55*-r}px 0px`});const a=()=>{o[0].disabled=s&&!s()};return a(),n.on("click","*",a),n.on("update-buttons",a),o},h=()=>g.outerWidth()+parseFloat(getComputedStyle(g[0]).getPropertyValue("margin-left"))+parseFloat(getComputedStyle(g[0]).getPropertyValue("margin-right"))+y.outerWidth(),f=u("Hide",0,()=>{const t=h();g.hide(),y.hide(),f.hide(),d.show(),n.width(n.width()-t),n.css("left",n.offset().left+t)}),d=u("Show",5,()=>{g.show(),y.show(),d.hide(),f.show();const t=h();n.width(n.width()+t),n.css("left",n.offset().left-t),n.offset().left<0&&(n.width(n.width()+n.offset().left),n.css("left",0))}).hide();u("Back",1,()=>{p[0].contentWindow.history.back(),r=!0,i-=1,s+=1},()=>i>0),u("Forward",2,()=>{p[0].contentWindow.history.forward(),r=!0,s-=1,i+=1},()=>s>0),u("Options",3,()=>{},()=>!1),u("Web Help",4,()=>{m.src="help/online_support.htm"});const p=t("<iframe sandbox='allow-same-origin allow-scripts allow-forms allow-modals allow-popups allow-downloads'>").attr({src:"help/default.html"}).addClass("inset-deep"),m=p[0];enhance_iframe(m),m.$window=n;const y=t(E("div")).addClass("resizer"),g=t(E("ul")).addClass("contents inset-deep");p.on("load",()=>{r||(i+=1,s=0),m.contentWindow.location.href,r=!1,n.triggerHandler("update-buttons")}),o.append(g,y,p),n.$content.append(l,o),n.css({width:800,height:600}),p.attr({name:"help-frame"}),p.css({backgroundColor:"white",border:"",margin:"1px"}),g.css({margin:"1px"}),n.center(),o.css({position:"relative"});y.css({cursor:"ew-resize",width:4,boxSizing:"border-box",background:"var(--ButtonFace)",borderLeft:"1px solid var(--ButtonShadow)",boxShadow:"inset 1px 0 0 var(--ButtonHilight)",top:0,bottom:0,zIndex:1}),y.on("pointerdown",t=>{let e,r;const i=t=>Math.min(n.width()-100,Math.max(20,t.clientX-n.$content.offset().left));$G.on("pointermove",e=(t=>{y.css({position:"absolute",left:i(t)}),g.css({marginRight:4})})),$G.on("pointerup",r=(t=>{$G.off("pointermove",e),$G.off("pointerup",r),y.css({position:"",left:""}),g.css({flexBasis:i(t)-4,marginRight:""})}))});const w=t=>{const e={};for(const n of t.children("param").get())e[n.name]=n.value;return e};let k;const x=e=>{const n=t(E("div")).addClass("item").text(e);return n.on("mousedown",()=>{g.find(".item").removeClass("selected"),n.addClass("selected")}),n.on("click",()=>{const t=n.parent();t.is(".folder")&&(k&&k.not(t).removeClass("expanded"),t.toggleClass("expanded"),k=t)}),n},v=t(E("li")).addClass("page");v.append(x("Welcome to Help").on("click",()=>{p.attr({src:"help/default.html"})})),g.append(v),t.get(e.contentsFile,n=>{t(t.parseHTML(n)).filter("ul").children().get().forEach(n=>{!function n(r,i){const s=w(t(r).children("object"));if(t(r).find("li").length>0){const e=t(E("li")).addClass("folder");e.append(x(s.Name)),g.append(e);const i=t(E("ul"));e.append(i),t(r).children("ul").children().get().forEach(t=>{n(t,i)})}else{const n=t(E("li")).addClass("page");n.append(x(s.Name).on("click",()=>{p.attr({src:`${e.root}/${s.Local}`})})),i?i.append(n):g.append(n)}}(n,null)})});var _=new a(n);return _.$help_window=n,_}function f(t){var e=t?file_name_from_path(t):"Untitled",n=e+" - Notepad",r=u({src:"programs/notepad/index.html"+(t?"?path="+t:""),icons:P("notepad"),title:n,outerWidth:480,outerHeight:321,resizable:!0});return new a(r)}function d(t){var n=u({src:"programs/jspaint/index.html",icons:P("paint"),title:"untitled - Paint",outerWidth:275,outerHeight:400,minOuterWidth:275,minOuterHeight:400}),i=n.$iframe[0].contentWindow,s=function(t,e,n){t()?n():setTimeout(s,e,t,e,n)};const o={readBlobFromHandle:t=>new Promise((n,i)=>{r.withFilesystem(()=>{var r=e.BFSRequire("fs");r.readFile(t,(e,r)=>{if(e)return i(e);const s=new Uint8Array(r),o=new Blob([s]),a=t.replace(/.*\//g,""),l=new File([o],a);n(l)})})}),writeBlobToHandle:async(t,n)=>{const i=await n.arrayBuffer();return new Promise((n,s)=>{r.withFilesystem(()=>{const r=e.BFSRequire("fs"),{Buffer:o}=e.BFSRequire("buffer"),a=o.from(i);r.writeFile(t,a,t=>{if(t)return s(t);n()})})})},setWallpaperCentered:t=>{t.toBlob(t=>{setDesktopWallpaper(t,"no-repeat",!0)})},setWallpaperTiled:t=>{t.toBlob(t=>{setDesktopWallpaper(t,"repeat",!0)})}};return s(()=>i.systemHooks,500,()=>{let e;Object.assign(i.systemHooks,o),i.show_help=(()=>{e?e.focus():(e=h({title:"Paint Help",contentsFile:"programs/jspaint/help/mspaint.hhc",root:"programs/jspaint/help"}).$help_window).on("close",()=>{e=null})}),t&&o.readBlobFromHandle(t).then(e=>{e&&i.open_from_file(e,t)},e=>{i.show_error_message(`Failed to open file ${t}`,e)});var r=i.update_title;i.update_title=(()=>{r(),n.title(i.document.title)})}),new a(n)}function p(){var t=u({src:"programs/minesweeper/index.html",icons:P("minesweeper"),title:"Minesweeper",innerWidth:280,innerHeight:341,resizable:!1});return new a(t)}function m(t){var e=t?file_name_from_path(t):"Sound",n=e+" - Sound Recorder",r=u({src:"programs/sound-recorder/index.html"+(t?"?path="+t:""),icons:P("speaker"),title:n,innerWidth:270,innerHeight:129,minInnerWidth:270,minInnerHeight:129});return new a(r)}function y(){var t=u({src:"programs/js-solitaire/index.html",icons:P("solitaire"),title:"Solitaire",innerWidth:585,innerHeight:405});return new a(t)}function g(e){const n=t("<iframe>").attr("src",e),r=t("<div>");r.css({position:"fixed",left:0,top:0,width:"100%",height:"100%",zIndex:c.Z_INDEX+9998,cursor:"none",backgroundColor:"black"}),n.css({position:"fixed",left:0,top:0,width:"100%",height:"100%",zIndex:c.Z_INDEX+9999,border:0,pointerEvents:"none"}),r.appendTo("body"),n.appendTo("body");const i=()=>{r.remove(),n.remove();const e=t=>{t.preventDefault()};t(window).on("contextmenu",e),setTimeout(()=>{t(window).off("contextmenu",e),window.removeEventListener("keydown",s,!0)},500)},s=t=>{["F11","F12","ZoomToggle","PrintScreen","MediaRecord","BrightnessDown","BrightnessUp","Dimmer"].includes(t.key)||(t.preventDefault(),t.stopPropagation(),i())};let o,a;r.on("mousemove pointermove",t=>{void 0===o&&(o=t.pageX,a=t.pageY),Math.hypot(o-t.pageX,a-t.pageY)>15&&i()}),r.on("mousedown pointerdown touchstart",t=>{t.preventDefault(),i()}),window.addEventListener("keydown",s,!0)}function w(){g(`programs/pipes/index.html#${encodeURIComponent(JSON.stringify({hideUI:!0}))}`)}function k(){g("programs/3D-FlowerBox/index.html")}function x(){var t=u({src:"programs/command/index.html",icons:P("msdos"),title:"MS-DOS Prompt",innerWidth:640,innerHeight:400,constrainRect(e,n,r){const i=(t.outerWidth()-t.$content.outerWidth())/2,s={x:e.x+i,y:e.y+i+t.$titlebar.outerHeight(),width:e.width-t.outerWidth()+t.$content.outerWidth(),height:e.height-t.outerHeight()+t.$content.outerHeight()},o={width:8*Math.floor(s.width/8),height:16*Math.floor(s.height/16)},a={x:s.x-i,y:s.y-i-t.$titlebar.outerHeight(),width:o.width+t.outerWidth()-t.$content.outerWidth(),height:o.height+t.outerHeight()-t.$content.outerHeight()};return-1===n&&(a.x=e.x+e.width-a.width),-1===r&&(a.y=e.y+e.height-a.height),a}});return new a(t)}function v(){var t=u({src:"programs/calculator/index.html",icons:P("calculator"),title:"Calculator",innerWidth:256,innerHeight:229,minInnerWidth:256,minInnerHeight:229});return new a(t)}function _(){var e=u({src:"programs/pinball/space-cadet.html",icons:P("pinball"),title:"3D Pinball for Windows - Space Cadet",innerWidth:600,innerHeight:436,minInnerWidth:600,minInnerHeight:436,override_alert:!1});const n=t("<div>").css({position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"url(images/pinball-splash.png) no-repeat center center",backgroundColor:"black",zIndex:c.Z_INDEX+6e3}).appendTo("body");return setTimeout(()=>{n.remove()},5e3),e.$content.find("iframe").on("game-loaded",()=>{n.remove()}),e.$content.find("iframe").on("game-load-failed",()=>{n.remove(),e.title("Wormhole Window - Space Cadet")}),new a(e)}function b(t){var e=t,n=e,r=u({src:"programs/explorer/index.html"+(t?"?address="+encodeURIComponent(t):""),icons:P("folder-open"),title:n,innerWidth:Math.min(856,.9*innerWidth),innerHeight:Math.min(547,.7*innerHeight)});return new a(r)}f.acceptsFilePaths=!0,d.acceptsFilePaths=!0,m.acceptsFilePaths=!0,b.acceptsFilePaths=!0;var S=function(e,n){t.getScript("programs/winamp/lib/webamp.bundle.min.js",()=>{e?t.getScript("programs/winamp/lib/butterchurn.min.js",()=>{t.getScript("programs/winamp/lib/butterchurnPresets.min.js",()=>{n()})}):n()})};const T=()=>{const t=document.createElement("canvas");let e;try{e=t.getContext("webgl2")}catch(t){e=null}const n=!!e,r=!(!window.AudioContext&&!window.webkitAudioContext);return n&&r};let I,F,A,C,O=!1;function M(n){const s=t=>new Promise((n,i)=>{r.withFilesystem(function(){var r=e.BFSRequire("fs");r.readFile(t,function(t,e){if(t)return i(t);const r=new Uint8Array(e),s=new Blob([r]);n(s)})})}),o=async t=>{const e=await s(t),n=URL.createObjectURL(e),r={url:n,defaultName:file_name_from_path(t).replace(/\.[a-z0-9]+$/i,"")};return r},u=async()=>{if("none"===F.css("display")&&C.unminimize(),C.focus(),n)if(n.match(/(\.wsz|\.zip)$/i)){const t=await s(n),e=URL.createObjectURL(t);I.setSkinFromUrl(e)}else if(n.match(/(\.m3u|\.pls)$/i))alert("Sorry, we don't support playlists yet.");else{const t=await o(n);I.setTracksToPlay([t])}O=!1};if(A)return void u();if(O)return;O=!0;const h=T();S(h,function(){const e={initialTracks:[{metaData:{artist:"DJ Mike Llama",title:"Llama Whippin' Intro"},url:"programs/winamp/mp3/llama-2.91.mp3",duration:5.322286}],enableHotkeys:!0,handleTrackDropEvent:t=>Promise.all(dragging_file_paths.map(o))};h&&(e.__butterchurnOptions={importButterchurn:()=>Promise.resolve(window.butterchurn),getPresets:()=>{const t=window.butterchurnPresets.getPresets();return Object.keys(t).map(e=>({name:e,butterchurnPresetObject:t[e]}))},butterchurnOpen:!0},e.__initialWindowLayout={main:{position:{x:0,y:0}},equalizer:{position:{x:0,y:116}},playlist:{position:{x:0,y:232},size:[0,4]},milkdrop:{position:{x:275,y:0},size:[7,12]}}),I=new Webamp(e);var n=document.createElement("div");n.classList.add("webamp-visual-container"),n.style.position="absolute",n.style.left="0",n.style.right="0",n.style.top="0",n.style.bottom="0",n.style.pointerEvents="none",document.body.appendChild(n),I.renderWhenReady(n).then(()=>{window.console&&console.log("Webamp rendered"),(F=t("#webamp")).css({position:"absolute",left:0,top:0,zIndex:c.Z_INDEX++});const e=t({}),n=t=>n=>{const r=()=>{n()};e.on(t,r);return()=>{e.off(t,r)}};let r;(C={}).onFocus=n("focus"),C.onBlur=n("blur"),C.onClosed=n("closed"),C.getIconAtSize=(t=>{32!==t&&16!==t&&(t=32);const e=document.createElement("img");return e.src=i.getIconPath("winamp2",t),e}),C.bringToFront=(()=>{F.css({zIndex:c.Z_INDEX++})}),C.element=C[0]=F[0],C.hasClass=(t=>"focused"===t&&F.hasClass("focused")),C.focus=(()=>{F.hasClass("focused")||(F.addClass("focused"),C.bringToFront(),e.triggerHandler("focus"),F.find("#main-window [tabindex='-1']").focus())}),C.blur=(()=>{F.hasClass("focused")&&(F.removeClass("focused"),e.triggerHandler("blur"))}),C.minimize=(()=>{F.hide()}),C.unminimize=(()=>{F.show()}),C.close=(()=>{I.dispose(),F.remove(),e.triggerHandler("closed"),I=null,F=null,A=null,C=null}),C.getTitle=(()=>{let t="Winamp 2.91";const e=F.find(".playlist-track-titles .track-cell.current");if(e.length)switch(t=`${e.text()} - Winamp`,I.getMediaStatus()){case"STOPPED":t=`${t} [Stopped]`;break;case"PAUSED":t=`${t} [Paused]`}return t}),C.setMinimizeTarget=(()=>{}),C.on=((t,e)=>{"title-change"===t?I.onTrackDidChange(e):"icon-change"===t||console.warn(`Unsupported event: ${t}`)}),i.mustHaveMethods(C,i.windowInterfaceMethods),A=new a(C),I.onClose(function(){C.close(),cancelAnimationFrame(r),s.fadeOutAndCleanUp()}),I.onMinimize(function(){C.minimize()}),F.on("focusin",()=>{C.focus()}),F.on("focusout",()=>{document.activeElement&&document.activeElement.closest&&document.activeElement.closest("#webamp")||C.blur()});const s=new l(F.find(".gen-window canvas")[0],{mirror:!0,stretch:!0}),o=()=>{const e=t(".os-window, .window:not(.gen-window)").toArray();e.forEach(t=>{t.hasOverlayCanvas||(s.makeOverlayCanvas(t),t.hasOverlayCanvas=!0)}),"PLAYING"===I.getMediaStatus()?s.fadeIn():s.fadeOut(),r=requestAnimationFrame(o)};r=requestAnimationFrame(o),u()},t=>{alert("Failed to render Webamp:\n\n"+t),console.error(t)})})}function N(t){r.withFilesystem(function(){var n=e.BFSRequire("fs");n.readFile(t,"utf8",function(t,e){if(t)return alert(t);var n=e.match(/URL\s*=\s*([^\n\r]+)/i),r=n?n[1]:e;b(r)})})}function D(t){r.withFilesystem(function(){var n=e.BFSRequire("fs");n.readFile(t,"utf8",function(e,n){if(e)return alert(e);loadThemeFromText(n);try{localStorage.setItem("desktop-theme",n),localStorage.setItem("desktop-theme-path",t)}catch(t){}})})}M.acceptsFilePaths=!0,N.acceptsFilePaths=!0,D.acceptsFilePaths=!0;var z={"":f,ahk:f,ai:d,bat:f,check_cache:f,cmake:f,cmd:f,conf:f,cpp:f,css:f,d:f,editorconfig:f,filters:f,gitattributes:f,gitignore:f,gitrepo:f,h:f,hhc:f,hhk:f,html:f,ini:f,js:f,json:f,log:f,make:f,map:f,marks:f,md:f,prettierignore:f,properties:f,rc:f,rsp:f,sh:f,ts:f,txt:f,vcxproj:f,webmanifest:f,xml:f,yml:f,bmp:d,cur:d,eps:d,gif:d,icns:d,ico:d,jpeg:d,jpg:d,kra:d,pbm:d,pdf:d,pdn:d,pgm:d,png:d,pnm:d,ppm:d,ps:d,psd:d,svg:d,tga:d,tif:d,tiff:d,webp:d,xbm:d,xcf:d,xcfbz2:d,xcfgz:d,xpm:d,wsz:M,zip:M,wav:m,mp3:M,ogg:M,wma:M,m4a:M,aac:M,flac:M,mka:M,mpc:M,"mp+":M,m3u:M,pls:M,htm:b,html:b,url:N,theme:D,themepack:D};function L(t){r.withFilesystem(function(){var n=e.BFSRequire("fs");n.stat(t,function(e,n){if(e)return alert("Failed to get info about "+t+"\n\n"+e);if(n.isDirectory())b(t);else{var r=file_extension_from_path(t),i=z[r.toLowerCase()];if(i){if(!i.acceptsFilePaths)return void alert(i.name+" does not support opening files via the virtual filesystem yet");i(t)}else alert("No program is associated with "+r+" files")}})})}function P(t){return{16:`images/icons/${t}-16x16.png`,32:`images/icons/${t}-32x32.png`}}return{systemExecuteFile:L,initDesktopFolderView:function(t){var e=function(e){t.add_item(new s({icons:{[i.DESKTOP_ICON_SIZE]:i.getIconPath(e.iconID,i.DESKTOP_ICON_SIZE)},...e}))};e({title:"My Computer",iconID:"my-computer",open:function(){L("/")},is_system_folder:!0}),e({title:"My Documents",iconID:"my-documents-folder",open:function(){L("/my-documents")},is_system_folder:!0}),e({title:"Network Neighborhood",iconID:"network",open:function(){L("/network-neighborhood")},is_system_folder:!0}),e({title:"Recycle Bin",iconID:"recycle-bin",open:function(){b("https://www.epa.gov/recycle/")},is_system_folder:!0}),e({title:"My Pictures",iconID:"folder",open:function(){L("/my-pictures")},is_system_folder:!0}),e({title:"Internet Explorer",iconID:"internet-explorer",open:function(){b("https://www.google.com/")}}),e({title:"Paint",iconID:"paint",open:d,shortcut:!0}),e({title:"Minesweeper",iconID:"minesweeper",open:p,shortcut:!0}),e({title:"Sound Recorder",iconID:"speaker",open:m,shortcut:!0}),e({title:"Solitaire",iconID:"solitaire",open:y,shortcut:!0}),e({title:"Notepad",iconID:"notepad",open:f,shortcut:!0}),e({title:"Winamp",iconID:"winamp2",open:M,shortcut:!0}),e({title:"3D Pipes",iconID:"pipes",open:w,shortcut:!0}),e({title:"3D Flower Box",iconID:"pipes",open:k,shortcut:!0}),e({title:"MS-DOS Prompt",iconID:"msdos",open:x,shortcut:!0}),e({title:"Calculator",iconID:"calculator",open:v,shortcut:!0}),e({title:"Pinball",iconID:"pinball",open:_,shortcut:!0}),t.arrange_icons()}}}),define("skylark-98js/$desktop",["skylark-jquery","./win98","./FolderView","./programs"],function(t,e,n,r){"use strict";var i=t(".desktop");i.css("touch-action","none");var s=new n("/desktop/",{asDesktop:!0,openFileOrFolder:t=>{r.systemExecuteFile(t)}});t(s.element).appendTo(i);try{var o=localStorage.getItem("wallpaper-data-url"),a=localStorage.getItem("wallpaper-repeat"),l=localStorage.getItem("desktop-theme");o&&fetch(o).then(t=>t.blob()).then(t=>{!function(t,e,n){const r=URL.createObjectURL(t);if(i.css({backgroundImage:`url(${r})`,backgroundRepeat:e,backgroundPosition:"center",backgroundSize:"auto"}),n){var s=new FileReader;window.fr=s,s.onload=(()=>{localStorage.setItem("wallpaper-data-url",s.result),localStorage.setItem("wallpaper-repeat",e)}),s.onerror=(()=>{console.error("Error reading file (for setting wallpaper)",t)}),s.readAsDataURL(t)}}(t,a,!1)}),l&&u(l)}catch(t){console.error(t)}function c(t){var e=new FileReader;e.onload=(()=>{u(e.result)}),e.readAsText(t)}function u(t){var e=parseThemeFileString(t);!function(t,e=document.documentElement){applyCSSProperties(t,{element:e,recurseIntoIframes:!0})}(e),window.themeCSSProperties=e}return t("html").on("dragover",function(t){t.preventDefault(),t.stopPropagation()}),t("html").on("dragleave",function(t){t.preventDefault(),t.stopPropagation()}),t("html").on("drop",function(t){t.preventDefault(),t.stopPropagation();var e=[...t.originalEvent.dataTransfer.files];for(var n of e)n.name.match(/\.theme(pack)?$/i)&&c(n)}),t(window).on("scroll focusin",()=>{window.scrollTo(0,0)}),r.initDesktopFolderView(s),i.reflow(),e.$desktop=i}),define("skylark-98js/$start-menu",["skylark-jquery","./win98","./os-gui/$Window"],function(t,e,n){var r=t(".start-menu");r.hide();var i=function(){o.removeClass("selected"),r.attr("hidden","hidden"),r.hide()},s=function(){r.is(":hidden")?(o.addClass("selected"),r.attr("hidden",null),r.slideDown(100),r.css({zIndex:++n.Z_INDEX+5001})):i()},o=t(".start-button");return o.on("pointerdown",function(){s()}),t("body").on("pointerdown",function(e){0===t(e.target).closest(".start-menu, .start-button").length&&i()}),t(window).on("keydown",function(t){27===t.which&&i()}),r}),define("skylark-98js/$taskbar-time",["skylark-jquery","./win98"],function(t,e){var n=t(".taskbar-time"),r=function(){n.text((new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),n.attr("title",(new Date).toLocaleString([],{weekday:"long",month:"long",day:"2-digit",minute:"2-digit",hour:"2-digit"})),setTimeout(r,1e3)};return r(),n}),define("skylark-98js/msgbox",["skylark-jquery","./win98","./os-gui/$Window"],function(t,e,n){var r=new Audio("/audio/CHORD.WAV");window.showMessageBox=window.showMessageBox||(({title:e=window.defaultMessageBoxTitle||"Alert",message:i,messageHTML:s,buttons:o=[{label:"OK",value:"ok",default:!0}],iconID:a="warning",windowOptions:l={}})=>{let c,u;const h=new Promise((r,h)=>{c=new n(Object.assign({title:e,resizable:!1,innerWidth:400,maximizeButton:!1,minimizeButton:!1},l)),u=t("<div>").css({textAlign:"left",fontFamily:"MS Sans Serif, Arial, sans-serif",fontSize:"14px",marginTop:"22px",flex:1,minWidth:0,whiteSpace:"normal"}),s?u.html(s):i&&u.text(i).css({whiteSpace:"pre-wrap",wordWrap:"break-word"}),t("<div>").append(t("<img width='32' height='32'>").attr("src",`../../images/icons/${a}-32x32-8bpp.png`).css({margin:"16px",display:"block"}),u).css({display:"flex",flexDirection:"row"}).appendTo(c.$content),c.$content.css({textAlign:"center"});for(const t of o){const e=c.$Button(t.label,()=>{t.action&&t.action(),r(t.value),c.close()});t.default&&(e.addClass("default"),e.focus(),setTimeout(()=>e.focus(),0)),e.css({minWidth:75,height:23,margin:"16px 2px"})}c.on("focusin","button",e=>{t(e.currentTarget).addClass("default")}),c.on("focusout","button",e=>{t(e.currentTarget).removeClass("default")}),c.on("closed",()=>{r("closed")}),c.center()});h.$window=c,h.$message=u,h.promise=h;try{r.play()}catch(t){console.log(`Failed to play ${r.src}: `,t)}return h}),window.alert=(t=>{showMessageBox({message:t})})}),define("skylark-clippy/Queue",["skylark-jquery"],function(t){"use strict";return class{constructor(t){this._queue=[],this._onEmptyCallback=t}queue(t){this._queue.push(t),1!==this._queue.length||this._active||this._progressQueue()}_progressQueue(){if(!this._queue.length)return void this._onEmptyCallback();let e=this._queue.shift();this._active=!0;let n=t.proxy(this.next,this);e(n)}clear(){this._queue=[]}next(){this._active=!1,this._progressQueue()}}}),define("skylark-clippy/Animator",["skylark-jquery"],function(t){"use strict";class e{constructor(e,n,r,i){this._el=e,this._data=r,this._path=n,this._currentFrameIndex=0,this._currentFrame=void 0,this._exiting=!1,this._currentAnimation=void 0,this._endCallback=void 0,this._started=!1,this._sounds={},this.currentAnimationName=void 0,this.preloadSounds(i),this._overlays=[this._el];let s=this._el;this._setupElement(this._el);for(let e=1;e<this._data.overlayCount;e++){let e=this._setupElement(t("<div></div>"));s.append(e),this._overlays.push(e),s=e}}_setupElement(t){let e=this._data.framesize;return t.css("display","none"),t.css({width:e[0],height:e[1]}),t.css("background","url('"+this._path+"/map.png') no-repeat"),t}animations(){let t=[],e=this._data.animations;for(let n in e)t.push(n);return t}preloadSounds(t){for(let e=0;e<this._data.sounds.length;e++){let n=this._data.sounds[e],r=t[n];r&&(this._sounds[n]=new Audio(r))}}hasAnimation(t){return!!this._data.animations[t]}exitAnimation(){this._exiting=!0}showAnimation(t,e){return this._exiting=!1,!!this.hasAnimation(t)&&(this._currentAnimation=this._data.animations[t],this.currentAnimationName=t,this._started||(this._step(),this._started=!0),this._currentFrameIndex=0,this._currentFrame=void 0,this._endCallback=e,!0)}_draw(){let t=[];this._currentFrame&&(t=this._currentFrame.images||[]);for(let e=0;e<this._overlays.length;e++)if(e<t.length){let n=t[e],r=-n[0]+"px "+-n[1]+"px";this._overlays[e].css({"background-position":r,display:"block"})}else this._overlays[e].css("display","none")}_getNextAnimationFrame(){if(!this._currentAnimation)return;if(!this._currentFrame)return 0;let t=this._currentFrame,e=this._currentFrame.branching;if(this._exiting&&void 0!==t.exitBranch)return t.exitBranch;if(e){let t=100*Math.random();for(let n=0;n<e.branches.length;n++){let r=e.branches[n];if(t<=r.weight)return r.frameIndex;t-=r.weight}}return this._currentFrameIndex+1}_playSound(){let t=this._currentFrame.sound;if(!t)return;let e=this._sounds[t];e&&e.play()}_atLastFrame(){return this._currentFrameIndex>=this._currentAnimation.frames.length-1}_step(){if(!this._currentAnimation)return;let n=Math.min(this._getNextAnimationFrame(),this._currentAnimation.frames.length-1),r=!this._currentFrame||this._currentFrameIndex!==n;this._currentFrameIndex=n,this._atLastFrame()&&this._currentAnimation.useExitBranching||(this._currentFrame=this._currentAnimation.frames[this._currentFrameIndex]),this._draw(),this._playSound(),this._loop=window.setTimeout(t.proxy(this._step,this),this._currentFrame.duration),this._endCallback&&r&&this._atLastFrame()&&(this._currentAnimation.useExitBranching&&!this._exiting?this._endCallback(this.currentAnimationName,e.States.WAITING):this._endCallback(this.currentAnimationName,e.States.EXITED))}pause(){window.clearTimeout(this._loop)}resume(){this._step()}}return e.States={WAITING:1,EXITED:0},e}),define("skylark-clippy/Balloon",["skylark-jquery"],function(t){"use strict";return class{constructor(t){this._targetEl=t,this._hidden=!0,this._setup(),this.WORD_SPEAK_TIME=200,this.CLOSE_BALLOON_DELAY=2e3,this._BALLOON_MARGIN=15}_setup(){this._balloon=t('<div class="clippy-balloon"><div class="clippy-tip"></div><div class="clippy-content"></div></div> ').hide(),this._content=this._balloon.find(".clippy-content"),t(document.body).append(this._balloon)}reposition(){let t=["top-left","top-right","bottom-left","bottom-right"];for(let e=0;e<t.length;e++){let n=t[e];if(this._position(n),!this._isOut())break}}_position(e){let n=this._targetEl.offset(),r=this._targetEl.height(),i=this._targetEl.width();n.top-=t(window).scrollTop(),n.left-=t(window).scrollLeft();let s,o,a=this._balloon.outerHeight(),l=this._balloon.outerWidth();switch(this._balloon.removeClass("clippy-top-left"),this._balloon.removeClass("clippy-top-right"),this._balloon.removeClass("clippy-bottom-right"),this._balloon.removeClass("clippy-bottom-left"),e){case"top-left":s=n.left+i-l,o=n.top-a-this._BALLOON_MARGIN;break;case"top-right":s=n.left,o=n.top-a-this._BALLOON_MARGIN;break;case"bottom-right":s=n.left,o=n.top+r+this._BALLOON_MARGIN;break;case"bottom-left":s=n.left+i-l,o=n.top+r+this._BALLOON_MARGIN}this._balloon.css({top:o,left:s}),this._balloon.addClass("clippy-"+e)}_isOut(){let e=this._balloon.offset(),n=this._balloon.outerHeight(),r=this._balloon.outerWidth(),i=t(window).width(),s=t(window).height(),o=t(document).scrollTop(),a=t(document).scrollLeft(),l=e.top-o,c=e.left-a;return l-5<0||c-5<0||(l+n+5>s||c+r+5>i)}speak(t,e,n){this._hidden=!1,this.show();let r=this._content;r.height("auto"),r.width("auto"),r.text(e),r.height(r.height()),r.width(r.width()),r.text(""),this.reposition(),this._complete=t,this._sayWords(e,n,t)}show(){this._hidden||this._balloon.show()}hide(e){e?this._balloon.hide():this._hiding=window.setTimeout(t.proxy(this._finishHideBalloon,this),this.CLOSE_BALLOON_DELAY)}_finishHideBalloon(){this._active||(this._balloon.hide(),this._hidden=!0,this._hiding=null)}_sayWords(e,n,r){this._active=!0,this._hold=n;let i=e.split(/[^\S-]/),s=this.WORD_SPEAK_TIME,o=this._content,a=1;this._addWord=t.proxy(function(){this._active&&(a>i.length?(delete this._addWord,this._active=!1,this._hold||(r(),this.hide())):(o.text(i.slice(0,a).join(" ")),a++,this._loop=window.setTimeout(t.proxy(this._addWord,this),s)))},this),this._addWord()}close(){this._active?this._hold=!1:this._hold&&this._complete()}pause(){window.clearTimeout(this._loop),this._hiding&&(window.clearTimeout(this._hiding),this._hiding=null)}resume(){this._addWord?this._addWord():this._hold||this._hidden||(this._hiding=window.setTimeout(t.proxy(this._finishHideBalloon,this),this.CLOSE_BALLOON_DELAY))}}}),define("skylark-clippy/Agent",["skylark-jquery","./Queue","./Animator","./Balloon"],function(t,e,n,r){"use strict";return class{constructor(i,s,o){this.path=i,this._queue=new e(t.proxy(this._onQueueEmpty,this)),this._el=t('<div class="clippy"></div>').hide(),t(document.body).append(this._el),this._animator=new n(this._el,i,s,o),this._balloon=new r(this._el),this._setupEvents()}gestureAt(t,e){let n=this._getDirection(t,e),r="Gesture"+n,i="Look"+n,s=this.hasAnimation(r)?r:i;return this.play(s)}hide(t,e){this._hidden=!0;let n=this._el;return this.stop(),t?(this._el.hide(),this.stop(),this.pause(),void(e&&e())):this._playInternal("Hide",function(){n.hide(),this.pause(),e&&e()})}moveTo(e,r,i){let s=this._getDirection(e,r),o="Move"+s;void 0===i&&(i=1e3),this._addToQueue(function(s){if(0===i)return this._el.css({top:r,left:e}),this.reposition(),void s();if(!this.hasAnimation(o))return void this._el.animate({top:r,left:e},i,s);let a=t.proxy(function(o,a){a===n.States.EXITED&&s(),a===n.States.WAITING&&this._el.animate({top:r,left:e},i,t.proxy(function(){this._animator.exitAnimation()},this))},this);this._playInternal(o,a)},this)}_playInternal(e,n){this._isIdleAnimation()&&this._idleDfd&&"pending"===this._idleDfd.state()&&this._idleDfd.done(t.proxy(function(){this._playInternal(e,n)},this)),this._animator.showAnimation(e,n)}play(e,r,i){return!!this.hasAnimation(e)&&(void 0===r&&(r=5e3),this._addToQueue(function(s){let o=!1;r&&window.setTimeout(t.proxy(function(){o||this._animator.exitAnimation()},this),r),this._playInternal(e,function(t,e){e===n.States.EXITED&&(o=!0,i&&i(),s())})},this),!0)}show(e){if(this._hidden=!1,e)return this._el.show(),this.resume(),void this._onQueueEmpty();if("auto"===this._el.css("top")||"auto"===!this._el.css("left")){let e=.8*t(window).width(),n=.8*(t(window).height()+t(document).scrollTop());this._el.css({top:n,left:e})}return this.resume(),this.play("Show")}speak(t,e){this._addToQueue(function(n){this._balloon.speak(n,t,e)},this)}closeBalloon(){this._balloon.hide()}delay(t){t=t||250,this._addToQueue(function(e){this._onQueueEmpty(),window.setTimeout(e,t)})}stopCurrent(){this._animator.exitAnimation(),this._balloon.close()}stop(){this._queue.clear(),this._animator.exitAnimation(),this._balloon.hide()}hasAnimation(t){return this._animator.hasAnimation(t)}animations(){return this._animator.animations()}animate(){let t=this.animations(),e=t[Math.floor(Math.random()*t.length)];return 0===e.indexOf("Idle")?this.animate():this.play(e)}_getDirection(t,e){let n=this._el.offset(),r=this._el.height(),i=this._el.width(),s=n.left+i/2,o=n.top+r/2,a=o-e,l=s-t,c=Math.round(180*Math.atan2(a,l)/Math.PI);return-45<=c&&c<45?"Right":45<=c&&c<135?"Up":135<=c&&c<=180||-180<=c&&c<-135?"Left":-135<=c&&c<-45?"Down":"Top"}_onQueueEmpty(){if(this._hidden||this._isIdleAnimation())return;let e=this._getIdleAnimation();this._idleDfd=t.Deferred(),this._animator.showAnimation(e,t.proxy(this._onIdleComplete,this))}_onIdleComplete(t,e){e===n.States.EXITED&&this._idleDfd.resolve()}_isIdleAnimation(){let t=this._animator.currentAnimationName;return t&&0===t.indexOf("Idle")}_getIdleAnimation(){let t=this.animations(),e=[];for(let n=0;n<t.length;n++){let r=t[n];0===r.indexOf("Idle")&&e.push(r)}let n=Math.floor(Math.random()*e.length);return e[n]}_setupEvents(){t(window).on("resize",t.proxy(this.reposition,this)),this._el.on("mousedown",t.proxy(this._onMouseDown,this)),this._el.on("dblclick",t.proxy(this._onDoubleClick,this))}_onDoubleClick(){this.play("ClickedOn")||this.animate()}reposition(){if(!this._el.is(":visible"))return;let e=this._el.offset(),n=this._el.outerHeight(),r=this._el.outerWidth(),i=t(window).width(),s=t(window).height(),o=t(window).scrollTop(),a=t(window).scrollLeft(),l=e.top-o,c=e.left-a;l-5<0?l=5:l+n+5>s&&(l=s-n-5),c-5<0?c=5:c+r+5>i&&(c=i-r-5),this._el.css({left:c,top:l}),this._balloon.reposition()}_onMouseDown(t){t.preventDefault(),this._startDrag(t)}_startDrag(e){this.pause(),this._balloon.hide(!0),this._offset=this._calculateClickOffset(e),this._moveHandle=t.proxy(this._dragMove,this),this._upHandle=t.proxy(this._finishDrag,this),t(window).on("mousemove",this._moveHandle),t(window).on("mouseup",this._upHandle),this._dragUpdateLoop=window.setTimeout(t.proxy(this._updateLocation,this),10)}_calculateClickOffset(t){let e=t.pageX,n=t.pageY,r=this._el.offset();return{top:n-r.top,left:e-r.left}}_updateLocation(){this._el.css({top:this._targetY,left:this._targetX}),this._dragUpdateLoop=window.setTimeout(t.proxy(this._updateLocation,this),10)}_dragMove(t){t.preventDefault();let e=t.clientX-this._offset.left,n=t.clientY-this._offset.top;this._targetX=e,this._targetY=n}_finishDrag(){window.clearTimeout(this._dragUpdateLoop),t(window).off("mousemove",this._moveHandle),t(window).off("mouseup",this._upHandle),this._balloon.show(),this.reposition(),this.resume()}_addToQueue(e,n){n&&(e=t.proxy(e,n)),this._queue.queue(e)}pause(){this._animator.pause(),this._balloon.pause()}resume(){this._animator.resume(),this._balloon.resume()}}}),define("skylark-clippy/loads",["skylark-jquery","./Agent"],function(t,e){"use strict";class n{constructor(r,i,s,o){let a,l,c=(o=o||window.CLIPPY_CDN||"https://gitcdn.xyz/repo/pi0/clippyjs/master/assets/agents/")+r,u=n._loadMap(c),h=n._loadAgent(r,c),f=n._loadSounds(r,c);h.done(function(t){a=t}),f.done(function(t){l=t});t.when(u,h,f).done(function(){let t=new e(c,a,l);i(t)}).fail(s)}static _loadMap(e){let r=n._maps[e];if(r)return r;r=n._maps[e]=t.Deferred();let i=e+"/map.png",s=new Image;return s.onload=r.resolve,s.onerror=r.reject,s.setAttribute("src",i),r.promise()}static _loadSounds(e,r){let i=n._sounds[e];if(i)return i;i=n._sounds[e]=t.Deferred();let s=document.createElement("audio"),o=!!s.canPlayType&&""!==s.canPlayType("audio/mpeg"),a=!!s.canPlayType&&""!==s.canPlayType('audio/ogg; codecs="vorbis"');if(o||a){let t=r+(o?"/sounds-mp3.js":"/sounds-ogg.js");n._loadScript(t)}else i.resolve({});return i.promise()}static _loadAgent(t,e){let r=n._data[t];if(r)return r;r=n._getAgentDfd(t);let i=e+"/agent.js";return n._loadScript(i),r.promise()}static _loadScript(t){let e=document.createElement("script");e.setAttribute("src",t),e.setAttribute("async","async"),e.setAttribute("type","text/javascript"),document.head.appendChild(e)}static _getAgentDfd(e){let r=n._data[e];return r||(r=n._data[e]=t.Deferred()),r}}return n._maps={},n._sounds={},n._data={},{load:n,ready:function(t,e){n._getAgentDfd(t).resolve(e)},soundsReady:function(e,r){let i=n._sounds[e];i||(i=n._sounds[e]=t.Deferred());i.resolve(r)}}}),define("skylark-clippy/main",["skylark-langx/skylark","./Agent","./Animator","./Queue","./Balloon","./loads"],function(t,e,n,r,i,s){"use strict";const o={Agent:e,Animator:n,Queue:r,Balloon:i,load:s.load,ready:s.ready,soundsReady:s.soundsReady};return t.attach("intg.clippy",o)}),define("skylark-clippy",["skylark-clippy/main"],function(t){return t}),define("skylark-98js/window-switcher",["skylark-jquery","skylark-clippy","./win98","./Task"],function(t,e,n,r){var i,s,o=t("<div class='window-switcher outset-deep'>"),a=t("<ul class='window-switcher-list'>").appendTo(o),l=t("<div class='window-switcher-window-name inset-deep'>").appendTo(o),c=!1;function u(t){t.unminimize(),t.bringToFront(),t.focus()}function h(e){const n=o.find(".window-switcher-item").toArray(),r=o.find(".active"),i=n.indexOf(r[0]),s=(i+(e?-1:1)+n.length)%n.length;r.removeClass("active");const a=n[s];t(a).addClass("active"),l.text(t(a).data("$window").getTitle())}function f(){o.remove()}window.addEventListener("keydown",function(e){if(e.altKey&&("4"===e.key||"F4"===e.key)){e.preventDefault();const t=e.target.closest(".os-window")&&e.target.closest(".os-window").$window;console.log("Alt+4 detected, closing window",t,e.target),t&&t.close()}!e.altKey||"Backquote"!==e.code&&"Tab"!==e.code?f():function(e){if(o.is(":visible"))return void h(e);a.empty();const n=r.all_tasks;if(1===n.length)return u(n[0].$window),void(c||(i&&i.stopCurrent(),i&&i.speak("If there's only one window, Alt+` will switch to it right away.")));if(n.length<2)return;n.sort((t,e)=>e.$window[0].style.zIndex-t.$window[0].style.zIndex);for(const e of n){var s=e.$window,l=t("<li>").addClass("window-switcher-item");l.append(s.getIconAtSize(32)||t("<img>").attr({src:"/images/icons/task-32x32.png",width:32,height:32,alt:s.getTitle()})),l.data("$window",s),a.append(l),s.hasClass("focused")&&l.addClass("active")}h(e),o.appendTo("body"),c||(i&&i.stopCurrent(),i&&i.speak("There you go! Press grave accent until you get to the window you want."),c=!0)}(e.shiftKey);"Alt"===e.key&&(d=!0,clearInterval(s),s=setInterval(m,200))},!0),window.addEventListener("keyup",function(t){t.altKey||(d=!1,clearInterval(s),function(){if(!o.is(":visible"))return;const t=o.find(".active");if(0===t.length)return;u(t.data("$window")),o.remove()}())},!0),window.addEventListener("blur",f);var d=!1,p=!1;function m(){if(d&&!top.document.hasFocus()){if((!top.document.activeElement||top.document.activeElement===top.document.body||top.document.activeElement===top.document.documentElement)&&(top.focus(),top.document.hasFocus()))return;if(clearInterval(s),d=!1,r.all_tasks.length<2)return;p||(new e.load("Clippy",function(e){(i=e).show();i.speak("It looks like you're trying to switch windows.\n\nUse Alt+` (grave accent) instead of Alt+Tab within the 98.js desktop.\n\nAlso, use Alt+4 instead of Alt+F4 to close windows.",!0),t(i._el).one("dblclick",function(){i.stopCurrent(),i.animate()})}),p=!0)}}}),define("skylark-98js/main",["./$desktop","./$start-menu","./$taskbar-time","./filesystem-setup","./FolderView","./FolderViewItem","./msgbox","./Task","./visualizer-overlay","./window-switcher"],function(){}),define("skylark-98js",["skylark-98js/main"],function(t){return t})}(define,require),!isAmd){var skylarkjs=require("skylark-langx-ns");isCmd?module.exports=skylarkjs:globals.skylarkjs=skylarkjs}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-98js-all.js.map
