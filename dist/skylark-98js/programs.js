/**
 * skylark-98js - A version of 98js.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-98js/
 * @license MIT
 */
define(["skylark-jquery","skylark-browserfs","./win98","./filesystem-setup","./helpers","./FolderViewItem","./iframe-windows","./Task","./visualizer-overlay","./os-gui/$Window"],function(e,t,n,o,i,r,s,a,l,c){let d=s.make_iframe_window;function p(t){const n=c({title:t.title||"Help Topics",icons:M("chm"),resizable:!0});n.addClass("help-window");let o=!0,i=0,r=0;const s=e(E("div")).addClass("main"),l=e(E("div")).addClass("toolbar"),d=(t,o,i,r)=>{const s=e("<button class='lightweight'>").append(e("<span>").text(t)).appendTo(l).on("click",()=>{i()});e("<div class='icon'/>").appendTo(s).css({backgroundPosition:`${55*-o}px 0px`});const a=()=>{s[0].disabled=r&&!r()};return a(),n.on("click","*",a),n.on("update-buttons",a),s},p=()=>g.outerWidth()+parseFloat(getComputedStyle(g[0]).getPropertyValue("margin-left"))+parseFloat(getComputedStyle(g[0]).getPropertyValue("margin-right"))+w.outerWidth(),m=d("Hide",0,()=>{const e=p();g.hide(),w.hide(),m.hide(),u.show(),n.width(n.width()-e),n.css("left",n.offset().left+e)}),u=d("Show",5,()=>{g.show(),w.show(),u.hide(),m.show();const e=p();n.width(n.width()+e),n.css("left",n.offset().left-e),n.offset().left<0&&(n.width(n.width()+n.offset().left),n.css("left",0))}).hide();d("Back",1,()=>{h[0].contentWindow.history.back(),o=!0,i-=1,r+=1},()=>i>0),d("Forward",2,()=>{h[0].contentWindow.history.forward(),o=!0,r-=1,i+=1},()=>r>0),d("Options",3,()=>{},()=>!1),d("Web Help",4,()=>{f.src="help/online_support.htm"});const h=e("<iframe sandbox='allow-same-origin allow-scripts allow-forms allow-modals allow-popups allow-downloads'>").attr({src:"help/default.html"}).addClass("inset-deep"),f=h[0];enhance_iframe(f),f.$window=n;const w=e(E("div")).addClass("resizer"),g=e(E("ul")).addClass("contents inset-deep");h.on("load",()=>{o||(i+=1,r=0),f.contentWindow.location.href,o=!1,n.triggerHandler("update-buttons")}),s.append(g,w,h),n.$content.append(l,s),n.css({width:800,height:600}),h.attr({name:"help-frame"}),h.css({backgroundColor:"white",border:"",margin:"1px"}),g.css({margin:"1px"}),n.center(),s.css({position:"relative"});w.css({cursor:"ew-resize",width:4,boxSizing:"border-box",background:"var(--ButtonFace)",borderLeft:"1px solid var(--ButtonShadow)",boxShadow:"inset 1px 0 0 var(--ButtonHilight)",top:0,bottom:0,zIndex:1}),w.on("pointerdown",e=>{let t,o;const i=e=>Math.min(n.width()-100,Math.max(20,e.clientX-n.$content.offset().left));$G.on("pointermove",t=(e=>{w.css({position:"absolute",left:i(e)}),g.css({marginRight:4})})),$G.on("pointerup",o=(e=>{$G.off("pointermove",t),$G.off("pointerup",o),w.css({position:"",left:""}),g.css({flexBasis:i(e)-4,marginRight:""})}))});const b=e=>{const t={};for(const n of e.children("param").get())t[n.name]=n.value;return t};let y;const v=t=>{const n=e(E("div")).addClass("item").text(t);return n.on("mousedown",()=>{g.find(".item").removeClass("selected"),n.addClass("selected")}),n.on("click",()=>{const e=n.parent();e.is(".folder")&&(y&&y.not(e).removeClass("expanded"),e.toggleClass("expanded"),y=e)}),n},x=e(E("li")).addClass("page");x.append(v("Welcome to Help").on("click",()=>{h.attr({src:"help/default.html"})})),g.append(x),e.get(t.contentsFile,n=>{e(e.parseHTML(n)).filter("ul").children().get().forEach(n=>{!function n(o,i){const r=b(e(o).children("object"));if(e(o).find("li").length>0){const t=e(E("li")).addClass("folder");t.append(v(r.Name)),g.append(t);const i=e(E("ul"));t.append(i),e(o).children("ul").children().get().forEach(e=>{n(e,i)})}else{const n=e(E("li")).addClass("page");n.append(v(r.Name).on("click",()=>{h.attr({src:`${t.root}/${r.Local}`})})),i?i.append(n):g.append(n)}}(n,null)})});var k=new a(n);return k.$help_window=n,k}function m(e){var t=(e?file_name_from_path(e):"Untitled")+" - Notepad",n=d({src:"programs/notepad/index.html"+(e?"?path="+e:""),icons:M("notepad"),title:t,outerWidth:480,outerHeight:321,resizable:!0});return new a(n)}function u(e){var n=d({src:"programs/jspaint/index.html",icons:M("paint"),title:"untitled - Paint",outerWidth:275,outerHeight:400,minOuterWidth:275,minOuterHeight:400}),i=n.$iframe[0].contentWindow,r=function(e,t,n){e()?n():setTimeout(r,t,e,t,n)};const s={readBlobFromHandle:e=>new Promise((n,i)=>{o.withFilesystem(()=>{t.BFSRequire("fs").readFile(e,(t,o)=>{if(t)return i(t);const r=new Uint8Array(o),s=new Blob([r]),a=e.replace(/.*\//g,""),l=new File([s],a);n(l)})})}),writeBlobToHandle:async(e,n)=>{const i=await n.arrayBuffer();return new Promise((n,r)=>{o.withFilesystem(()=>{const o=t.BFSRequire("fs"),{Buffer:s}=t.BFSRequire("buffer"),a=s.from(i);o.writeFile(e,a,e=>{if(e)return r(e);n()})})})},setWallpaperCentered:e=>{e.toBlob(e=>{setDesktopWallpaper(e,"no-repeat",!0)})},setWallpaperTiled:e=>{e.toBlob(e=>{setDesktopWallpaper(e,"repeat",!0)})}};return r(()=>i.systemHooks,500,()=>{let t;Object.assign(i.systemHooks,s),i.show_help=(()=>{t?t.focus():(t=p({title:"Paint Help",contentsFile:"programs/jspaint/help/mspaint.hhc",root:"programs/jspaint/help"}).$help_window).on("close",()=>{t=null})}),e&&s.readBlobFromHandle(e).then(t=>{t&&i.open_from_file(t,e)},t=>{i.show_error_message(`Failed to open file ${e}`,t)});var o=i.update_title;i.update_title=(()=>{o(),n.title(i.document.title)})}),new a(n)}function h(){var e=d({src:"programs/minesweeper/index.html",icons:M("minesweeper"),title:"Minesweeper",innerWidth:280,innerHeight:341,resizable:!1});return new a(e)}function f(e){var t=(e?file_name_from_path(e):"Sound")+" - Sound Recorder",n=d({src:"programs/sound-recorder/index.html"+(e?"?path="+e:""),icons:M("speaker"),title:t,innerWidth:270,innerHeight:129,minInnerWidth:270,minInnerHeight:129});return new a(n)}function w(){var e=d({src:"programs/js-solitaire/index.html",icons:M("solitaire"),title:"Solitaire",innerWidth:585,innerHeight:405});return new a(e)}function g(t){const n=e("<iframe>").attr("src",t),o=e("<div>");o.css({position:"fixed",left:0,top:0,width:"100%",height:"100%",zIndex:c.Z_INDEX+9998,cursor:"none",backgroundColor:"black"}),n.css({position:"fixed",left:0,top:0,width:"100%",height:"100%",zIndex:c.Z_INDEX+9999,border:0,pointerEvents:"none"}),o.appendTo("body"),n.appendTo("body");const i=()=>{o.remove(),n.remove();const t=e=>{e.preventDefault()};e(window).on("contextmenu",t),setTimeout(()=>{e(window).off("contextmenu",t),window.removeEventListener("keydown",r,!0)},500)},r=e=>{["F11","F12","ZoomToggle","PrintScreen","MediaRecord","BrightnessDown","BrightnessUp","Dimmer"].includes(e.key)||(e.preventDefault(),e.stopPropagation(),i())};let s,a;o.on("mousemove pointermove",e=>{void 0===s&&(s=e.pageX,a=e.pageY),Math.hypot(s-e.pageX,a-e.pageY)>15&&i()}),o.on("mousedown pointerdown touchstart",e=>{e.preventDefault(),i()}),window.addEventListener("keydown",r,!0)}function b(){g(`programs/pipes/index.html#${encodeURIComponent(JSON.stringify({hideUI:!0}))}`)}function y(){g("programs/3D-FlowerBox/index.html")}function v(){var e=d({src:"programs/command/index.html",icons:M("msdos"),title:"MS-DOS Prompt",innerWidth:640,innerHeight:400,constrainRect(t,n,o){const i=(e.outerWidth()-e.$content.outerWidth())/2,r=t.x+i,s=t.y+i+e.$titlebar.outerHeight(),a=t.width-e.outerWidth()+e.$content.outerWidth(),l=t.height-e.outerHeight()+e.$content.outerHeight(),c=8*Math.floor(a/8),d=16*Math.floor(l/16),p={x:r-i,y:s-i-e.$titlebar.outerHeight(),width:c+e.outerWidth()-e.$content.outerWidth(),height:d+e.outerHeight()-e.$content.outerHeight()};return-1===n&&(p.x=t.x+t.width-p.width),-1===o&&(p.y=t.y+t.height-p.height),p}});return new a(e)}function x(){var e=d({src:"programs/calculator/index.html",icons:M("calculator"),title:"Calculator",innerWidth:256,innerHeight:229,minInnerWidth:256,minInnerHeight:229});return new a(e)}function k(){var t=d({src:"programs/pinball/space-cadet.html",icons:M("pinball"),title:"3D Pinball for Windows - Space Cadet",innerWidth:600,innerHeight:436,minInnerWidth:600,minInnerHeight:436,override_alert:!1});const n=e("<div>").css({position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"url(images/pinball-splash.png) no-repeat center center",backgroundColor:"black",zIndex:c.Z_INDEX+6e3}).appendTo("body");return setTimeout(()=>{n.remove()},5e3),t.$content.find("iframe").on("game-loaded",()=>{n.remove()}),t.$content.find("iframe").on("game-load-failed",()=>{n.remove(),t.title("Wormhole Window - Space Cadet")}),new a(t)}function _(e){var t=e,n=d({src:"programs/explorer/index.html"+(e?"?address="+encodeURIComponent(e):""),icons:M("folder-open"),title:t,innerWidth:Math.min(856,.9*innerWidth),innerHeight:Math.min(547,.7*innerHeight)});return new a(n)}m.acceptsFilePaths=!0,u.acceptsFilePaths=!0,f.acceptsFilePaths=!0,_.acceptsFilePaths=!0;var F=function(t,n){e.getScript("programs/winamp/lib/webamp.bundle.min.js",()=>{t?e.getScript("programs/winamp/lib/butterchurn.min.js",()=>{e.getScript("programs/winamp/lib/butterchurnPresets.min.js",()=>{n()})}):n()})};const I=()=>{const e=document.createElement("canvas");let t;try{t=e.getContext("webgl2")}catch(e){t=null}const n=!!t,o=!(!window.AudioContext&&!window.webkitAudioContext);return n&&o};let C,D,W,S,P=!1;function H(n){const r=e=>new Promise((n,i)=>{o.withFilesystem(function(){t.BFSRequire("fs").readFile(e,function(e,t){if(e)return i(e);const o=new Uint8Array(t),r=new Blob([o]);n(r)})})}),s=async e=>{const t=await r(e);return{url:URL.createObjectURL(t),defaultName:file_name_from_path(e).replace(/\.[a-z0-9]+$/i,"")}},d=async()=>{if("none"===D.css("display")&&S.unminimize(),S.focus(),n)if(n.match(/(\.wsz|\.zip)$/i)){const e=await r(n),t=URL.createObjectURL(e);C.setSkinFromUrl(t)}else if(n.match(/(\.m3u|\.pls)$/i))alert("Sorry, we don't support playlists yet.");else{const e=await s(n);C.setTracksToPlay([e])}P=!1};if(W)return void d();if(P)return;P=!0;const p=I();F(p,function(){const t={initialTracks:[{metaData:{artist:"DJ Mike Llama",title:"Llama Whippin' Intro"},url:"programs/winamp/mp3/llama-2.91.mp3",duration:5.322286}],enableHotkeys:!0,handleTrackDropEvent:e=>Promise.all(dragging_file_paths.map(s))};p&&(t.__butterchurnOptions={importButterchurn:()=>Promise.resolve(window.butterchurn),getPresets:()=>{const e=window.butterchurnPresets.getPresets();return Object.keys(e).map(t=>({name:t,butterchurnPresetObject:e[t]}))},butterchurnOpen:!0},t.__initialWindowLayout={main:{position:{x:0,y:0}},equalizer:{position:{x:0,y:116}},playlist:{position:{x:0,y:232},size:[0,4]},milkdrop:{position:{x:275,y:0},size:[7,12]}}),C=new Webamp(t);var n=document.createElement("div");n.classList.add("webamp-visual-container"),n.style.position="absolute",n.style.left="0",n.style.right="0",n.style.top="0",n.style.bottom="0",n.style.pointerEvents="none",document.body.appendChild(n),C.renderWhenReady(n).then(()=>{window.console&&console.log("Webamp rendered"),(D=e("#webamp")).css({position:"absolute",left:0,top:0,zIndex:c.Z_INDEX++});const t=e({}),n=e=>n=>{const o=()=>{n()};t.on(e,o);return()=>{t.off(e,o)}};let o;(S={}).onFocus=n("focus"),S.onBlur=n("blur"),S.onClosed=n("closed"),S.getIconAtSize=(e=>{32!==e&&16!==e&&(e=32);const t=document.createElement("img");return t.src=i.getIconPath("winamp2",e),t}),S.bringToFront=(()=>{D.css({zIndex:c.Z_INDEX++})}),S.element=S[0]=D[0],S.hasClass=(e=>"focused"===e&&D.hasClass("focused")),S.focus=(()=>{D.hasClass("focused")||(D.addClass("focused"),S.bringToFront(),t.triggerHandler("focus"),D.find("#main-window [tabindex='-1']").focus())}),S.blur=(()=>{D.hasClass("focused")&&(D.removeClass("focused"),t.triggerHandler("blur"))}),S.minimize=(()=>{D.hide()}),S.unminimize=(()=>{D.show()}),S.close=(()=>{C.dispose(),D.remove(),t.triggerHandler("closed"),C=null,D=null,W=null,S=null}),S.getTitle=(()=>{let e="Winamp 2.91";const t=D.find(".playlist-track-titles .track-cell.current");if(t.length)switch(e=`${t.text()} - Winamp`,C.getMediaStatus()){case"STOPPED":e=`${e} [Stopped]`;break;case"PAUSED":e=`${e} [Paused]`}return e}),S.setMinimizeTarget=(()=>{}),S.on=((e,t)=>{"title-change"===e?C.onTrackDidChange(t):"icon-change"===e||console.warn(`Unsupported event: ${e}`)}),i.mustHaveMethods(S,i.windowInterfaceMethods),W=new a(S),C.onClose(function(){S.close(),cancelAnimationFrame(o),r.fadeOutAndCleanUp()}),C.onMinimize(function(){S.minimize()}),D.on("focusin",()=>{S.focus()}),D.on("focusout",()=>{document.activeElement&&document.activeElement.closest&&document.activeElement.closest("#webamp")||S.blur()});const r=new l(D.find(".gen-window canvas")[0],{mirror:!0,stretch:!0}),s=()=>{e(".os-window, .window:not(.gen-window)").toArray().forEach(e=>{e.hasOverlayCanvas||(r.makeOverlayCanvas(e),e.hasOverlayCanvas=!0)}),"PLAYING"===C.getMediaStatus()?r.fadeIn():r.fadeOut(),o=requestAnimationFrame(s)};o=requestAnimationFrame(s),d()},e=>{alert("Failed to render Webamp:\n\n"+e),console.error(e)})})}function $(e){o.withFilesystem(function(){t.BFSRequire("fs").readFile(e,"utf8",function(e,t){if(e)return alert(e);var n=t.match(/URL\s*=\s*([^\n\r]+)/i);_(n?n[1]:t)})})}function z(e){o.withFilesystem(function(){t.BFSRequire("fs").readFile(e,"utf8",function(t,n){if(t)return alert(t);loadThemeFromText(n);try{localStorage.setItem("desktop-theme",n),localStorage.setItem("desktop-theme-path",e)}catch(e){}})})}H.acceptsFilePaths=!0,$.acceptsFilePaths=!0,z.acceptsFilePaths=!0;var B={"":m,ahk:m,ai:u,bat:m,check_cache:m,cmake:m,cmd:m,conf:m,cpp:m,css:m,d:m,editorconfig:m,filters:m,gitattributes:m,gitignore:m,gitrepo:m,h:m,hhc:m,hhk:m,html:m,ini:m,js:m,json:m,log:m,make:m,map:m,marks:m,md:m,prettierignore:m,properties:m,rc:m,rsp:m,sh:m,ts:m,txt:m,vcxproj:m,webmanifest:m,xml:m,yml:m,bmp:u,cur:u,eps:u,gif:u,icns:u,ico:u,jpeg:u,jpg:u,kra:u,pbm:u,pdf:u,pdn:u,pgm:u,png:u,pnm:u,ppm:u,ps:u,psd:u,svg:u,tga:u,tif:u,tiff:u,webp:u,xbm:u,xcf:u,xcfbz2:u,xcfgz:u,xpm:u,wsz:H,zip:H,wav:f,mp3:H,ogg:H,wma:H,m4a:H,aac:H,flac:H,mka:H,mpc:H,"mp+":H,m3u:H,pls:H,htm:_,html:_,url:$,theme:z,themepack:z};function T(e){o.withFilesystem(function(){t.BFSRequire("fs").stat(e,function(t,n){if(t)return alert("Failed to get info about "+e+"\n\n"+t);if(n.isDirectory())_(e);else{var o=file_extension_from_path(e),i=B[o.toLowerCase()];if(i){if(!i.acceptsFilePaths)return void alert(i.name+" does not support opening files via the virtual filesystem yet");i(e)}else alert("No program is associated with "+o+" files")}})})}function M(e){return{16:`images/icons/${e}-16x16.png`,32:`images/icons/${e}-32x32.png`}}return{systemExecuteFile:T,initDesktopFolderView:function(e){var t=function(t){e.add_item(new r({icons:{[i.DESKTOP_ICON_SIZE]:i.getIconPath(t.iconID,i.DESKTOP_ICON_SIZE)},...t}))};t({title:"My Computer",iconID:"my-computer",open:function(){T("/")},is_system_folder:!0}),t({title:"My Documents",iconID:"my-documents-folder",open:function(){T("/my-documents")},is_system_folder:!0}),t({title:"Network Neighborhood",iconID:"network",open:function(){T("/network-neighborhood")},is_system_folder:!0}),t({title:"Recycle Bin",iconID:"recycle-bin",open:function(){_("https://www.epa.gov/recycle/")},is_system_folder:!0}),t({title:"My Pictures",iconID:"folder",open:function(){T("/my-pictures")},is_system_folder:!0}),t({title:"Internet Explorer",iconID:"internet-explorer",open:function(){_("https://www.google.com/")}}),t({title:"Paint",iconID:"paint",open:u,shortcut:!0}),t({title:"Minesweeper",iconID:"minesweeper",open:h,shortcut:!0}),t({title:"Sound Recorder",iconID:"speaker",open:f,shortcut:!0}),t({title:"Solitaire",iconID:"solitaire",open:w,shortcut:!0}),t({title:"Notepad",iconID:"notepad",open:m,shortcut:!0}),t({title:"Winamp",iconID:"winamp2",open:H,shortcut:!0}),t({title:"3D Pipes",iconID:"pipes",open:b,shortcut:!0}),t({title:"3D Flower Box",iconID:"pipes",open:y,shortcut:!0}),t({title:"MS-DOS Prompt",iconID:"msdos",open:v,shortcut:!0}),t({title:"Calculator",iconID:"calculator",open:x,shortcut:!0}),t({title:"Pinball",iconID:"pinball",open:k,shortcut:!0}),e.arrange_icons()}}});
//# sourceMappingURL=sourcemaps/programs.js.map
