{"version":3,"sources":["$desktop.js"],"names":["define","$","win98js","FolderView","programs","$desktop","css","folder_view","asDesktop","openFileOrFolder","path","systemExecuteFile","element","appendTo","wallpaper_data_url","localStorage","getItem","wallpaper_repeat","theme_file_content","fetch","then","r","blob","file","repeat","saveToLocalStorage","blob_url","URL","createObjectURL","backgroundImage","backgroundRepeat","backgroundPosition","backgroundSize","fr","FileReader","window","onload","setItem","result","onerror","console","error","readAsDataURL","setDesktopWallpaper","loadThemeFromText","loadThemeFile","reader","readAsText","fileText","cssProperties","parseThemeFileString","documentElement","document","applyCSSProperties","recurseIntoIframes","applyTheme","themeCSSProperties","on","event","preventDefault","stopPropagation","files","originalEvent","dataTransfer","name","match","scrollTo","initDesktopFolderView","reflow"],"mappings":";;;;;;;AAAAA,QACC,iBACA,UACA,eACA,cACC,SAASC,EAAEC,EAAQC,EAAWC,GAC5B,aAIH,IAAIC,EAAWJ,EAAE,YACjBI,EAASC,IAAI,eAAgB,QAE7B,IAAIC,EAAc,IAAIJ,EALM,aAM3BK,WAAW,EACXC,iBAAmBC,IAClBN,EAASO,kBAAkBD,MAG7BT,EAAEM,EAAYK,SAASC,SAASR,GAuBhC,IACC,IAAIS,EAAqBC,aAAaC,QAAQ,sBAC1CC,EAAmBF,aAAaC,QAAQ,oBACxCE,EAAqBH,aAAaC,QAAQ,iBAC1CF,GACHK,MAAML,GAAoBM,KAAKC,GAAKA,EAAEC,QAAQF,KAAKG,KA1BrD,SAA6BA,EAAMC,EAAQC,GAC1C,MAAMC,EAAWC,IAAIC,gBAAgBL,GAOrC,GANAlB,EAASC,KACRuB,uBAAwBH,KACxBI,iBAAkBN,EAClBO,mBAAoB,SACpBC,eAAgB,SAEbP,EAAoB,CACvB,IAAIQ,EAAK,IAAIC,WACbC,OAAOF,GAAKA,EACZA,EAAGG,OAAS,MACXrB,aAAasB,QAAQ,qBAAsBJ,EAAGK,QAC9CvB,aAAasB,QAAQ,mBAAoBb,KAE1CS,EAAGM,QAAU,MACZC,QAAQC,MAAM,6CAA8ClB,KAE7DU,EAAGS,cAAcnB,IAShBoB,CAAoBpB,EAAMN,GAAkB,KAG1CC,GACH0B,EAAkB1B,GAElB,MAAOuB,GACRD,QAAQC,MAAMA,GAYf,SAASI,EAActB,GACtB,IAAIuB,EAAS,IAAIZ,WACjBY,EAAOV,OAAS,MACfQ,EAAkBE,EAAOR,UAE1BQ,EAAOC,WAAWxB,GAKnB,SAASqB,EAAkBI,GAC1B,IAAIC,EAAgBC,qBAAqBF,IAJ1C,SAAoBC,EAAeE,EAAkBC,SAASD,iBAC7DE,mBAAmBJ,GAAiBrC,QAASuC,EAAiBG,oBAAoB,IAIlFC,CAAWN,GACXd,OAAOqB,mBAAqBP,EAqC7B,OAlCAhD,EAAE,QAAQwD,GAAG,WAAY,SAAUC,GAClCA,EAAMC,iBACND,EAAME,oBAEP3D,EAAE,QAAQwD,GAAG,YAAa,SAAUC,GACnCA,EAAMC,iBACND,EAAME,oBAEP3D,EAAE,QAAQwD,GAAG,OAAQ,SAAUC,GAC9BA,EAAMC,iBACND,EAAME,kBACN,IAAIC,MAAYH,EAAMI,cAAcC,aAAaF,OACjD,IAAK,IAAItC,KAAQsC,EACZtC,EAAKyC,KAAKC,MAAM,qBACnBpB,EAActB,KAUjBtB,EAAEkC,QAAQsB,GAAG,iBAAkB,KAC9BtB,OAAO+B,SAAS,EAAG,KAIpB9D,EAAS+D,sBAAsB5D,GAG/BF,EAAS+D,SAEFlE,EAAQG,SAAWA","file":"../$desktop.js","sourcesContent":["define([\n\t\"skylark-jquery\",\n\t\"./win98\",\n\t\"./FolderView\",\n\t\"./programs\"\n],function($,win98js,FolderView,programs){\n    \"use strict\";\n\n\tconst desktop_folder_path = \"/desktop/\";\n\n\tvar $desktop = $(\".desktop\");\n\t$desktop.css(\"touch-action\", \"none\"); // TODO: should this be in FolderView, or is it to prevent scrolling the page or what?\n\n\tvar folder_view = new FolderView(desktop_folder_path, {\n\t\tasDesktop: true,\n\t\topenFileOrFolder: (path) => { // Note: may not be defined yet, so wrapping with a function.\n\t\t\tprograms.systemExecuteFile(path);\n\t\t},\n\t});\n\t$(folder_view.element).appendTo($desktop);\n\n\tfunction setDesktopWallpaper(file, repeat, saveToLocalStorage) {\n\t\tconst blob_url = URL.createObjectURL(file);\n\t\t$desktop.css({\n\t\t\tbackgroundImage: `url(${blob_url})`,\n\t\t\tbackgroundRepeat: repeat,\n\t\t\tbackgroundPosition: \"center\",\n\t\t\tbackgroundSize: \"auto\",\n\t\t});\n\t\tif (saveToLocalStorage) {\n\t\t\tvar fr = new FileReader();\n\t\t\twindow.fr = fr;\n\t\t\tfr.onload = () => {\n\t\t\t\tlocalStorage.setItem(\"wallpaper-data-url\", fr.result);\n\t\t\t\tlocalStorage.setItem(\"wallpaper-repeat\", repeat);\n\t\t\t};\n\t\t\tfr.onerror = () => {\n\t\t\t\tconsole.error(\"Error reading file (for setting wallpaper)\", file);\n\t\t\t};\n\t\t\tfr.readAsDataURL(file);\n\t\t}\n\t}\n\ttry {\n\t\tvar wallpaper_data_url = localStorage.getItem(\"wallpaper-data-url\");\n\t\tvar wallpaper_repeat = localStorage.getItem(\"wallpaper-repeat\");\n\t\tvar theme_file_content = localStorage.getItem(\"desktop-theme\");\n\t\tif (wallpaper_data_url) {\n\t\t\tfetch(wallpaper_data_url).then(r => r.blob()).then(file => {\n\t\t\t\tsetDesktopWallpaper(file, wallpaper_repeat, false);\n\t\t\t});\n\t\t}\n\t\tif (theme_file_content) {\n\t\t\tloadThemeFromText(theme_file_content);\n\t\t}\n\t} catch (error) {\n\t\tconsole.error(error);\n\t}\n\n\t// Prevent drag and drop from redirecting the page (the browser default behavior for files)\n\t// TODO: only prevent if there are actually files; there's nothing that uses text inputs atm that's not in an iframe, so it doesn't matter YET (afaik)\n\t// $G.on(\"dragover\", function(e){\n\t// \te.preventDefault();\n\t// });\n\t// $G.on(\"drop\", function(e){\n\t// \te.preventDefault();\n\t// });\n\n\tfunction loadThemeFile(file) {\n\t\tvar reader = new FileReader();\n\t\treader.onload = () => {\n\t\t\tloadThemeFromText(reader.result);\n\t\t};\n\t\treader.readAsText(file);\n\t}\n\tfunction applyTheme(cssProperties, documentElement = document.documentElement) {\n\t\tapplyCSSProperties(cssProperties, { element: documentElement, recurseIntoIframes: true });\n\t}\n\tfunction loadThemeFromText(fileText) {\n\t\tvar cssProperties = parseThemeFileString(fileText);\n\t\tapplyTheme(cssProperties);\n\t\twindow.themeCSSProperties = cssProperties;\n\t}\n\n\t$(\"html\").on(\"dragover\", function (event) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t});\n\t$(\"html\").on(\"dragleave\", function (event) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t});\n\t$(\"html\").on(\"drop\", function (event) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t\tvar files = [...event.originalEvent.dataTransfer.files];\n\t\tfor (var file of files) {\n\t\t\tif (file.name.match(/\\.theme(pack)?$/i)) {\n\t\t\t\tloadThemeFile(file);\n\t\t\t}\n\t\t}\n\t});\n\n\t// Despite overflow:hidden on html and body,\n\t// focusing elements that are partially offscreen can still scroll the page.\n\t// For example, with opening Paint and moving it partially offscreen and opening Image > Attributes,\n\t// the default focused button can scroll the entire desktop.\n\t// We need to prevent (reset) scroll, and also avoid scrollIntoView().\n\t$(window).on(\"scroll focusin\", () => {\n\t\twindow.scrollTo(0, 0);\n\t});\n\n\n\tprograms.initDesktopFolderView(folder_view);\n\n\n\t$desktop.reflow();\n\n\treturn win98js.$desktop = $desktop;\n});"]}