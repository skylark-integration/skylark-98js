{"version":3,"sources":["Task.js"],"names":["define","$","win98js","Task","win","all_tasks","push","this","$window","$task","appendTo","$title","$icon","updateTitle","text","getTitle","updateIcon","old_$icon","getIconAtSize","replaceWith","prepend","remove","on","setMinimizeTarget","append","e","preventDefault","hasClass","minimize","blur","unminimize","bringToFront","focus","onFocus","addClass","onBlur","removeClass","onClosed","index","indexOf","splice","is"],"mappings":";;;;;;;AAAAA,QACC,iBACA,WACC,SAASC,EAAEC,GACZ,SAASC,EAAKC,GACbD,EAAKE,UAAUC,KAAKC,MAEpBA,KAAKC,QAAUJ,EAEf,MAAMK,EAAQF,KAAKE,MAAQR,EAAE,iCAAiCS,SAAST,EAAE,WACnEU,EAASV,EAAE,yBAMjB,IAAIW,EAJJL,KAAKM,YAAc,MAClBF,EAAOG,KAAKV,EAAIW,cAIjBR,KAAKS,WAAa,MACjB,MAAMC,EAAYL,GAClBA,EAAQR,EAAIc,cAAc,KAMtBD,EACHA,EAAUE,YAAYP,GAEtBH,EAAMW,QAAQR,GANdK,GAAaA,EAAUI,WAUzBd,KAAKM,cACLN,KAAKS,aAELZ,EAAIkB,GAAG,eAAgBf,KAAKM,aAC5BT,EAAIkB,GAAG,cAAef,KAAKS,YAE3BZ,EAAImB,kBAAkBd,EAAM,IAE5BA,EAAMe,OAAOZ,EAAOD,GACpBF,EAAMa,GAAG,cAAe,SAAUG,GACjCA,EAAEC,mBAGHjB,EAAMa,GAAG,QAAS,WACbb,EAAMkB,SAAS,aAClBvB,EAAIwB,WACJxB,EAAIyB,SAEJzB,EAAI0B,aACJ1B,EAAI2B,eACJ3B,EAAI4B,WAIN5B,EAAI6B,QAAQ,KACXxB,EAAMyB,SAAS,cAEhB9B,EAAI+B,OAAO,KACV1B,EAAM2B,YAAY,cAEnBhC,EAAIiC,SAAS,KACZ5B,EAAMY,SACN,MAAMiB,EAAQnC,EAAKE,UAAUkC,QAAQhC,OACtB,IAAX+B,GACHnC,EAAKE,UAAUmC,OAAOF,EAAO,KAI3BlC,EAAIqC,IAAMrC,EAAIqC,GAAG,aACpBrC,EAAI4B,QAMN,OAFA7B,EAAKE,aAEEF","file":"../Task.js","sourcesContent":["define([\n\t\"skylark-jquery\",\n\t\"./win98\"\n],function($,win98js){\n\tfunction Task(win) {\n\t\tTask.all_tasks.push(this);\n\n\t\tthis.$window = win;\n\t\t\n\t\tconst $task = this.$task = $(\"<button class='task toggle'/>\").appendTo($(\".tasks\"));\n\t\tconst $title = $(\"<span class='title'/>\");\n\n\t\tthis.updateTitle = () => {\n\t\t\t$title.text(win.getTitle());\n\t\t};\n\n\t\tlet $icon;\n\t\tthis.updateIcon = () => {\n\t\t\tconst old_$icon = $icon;\n\t\t\t$icon = win.getIconAtSize(16);\n\t\t\tif (!$icon) {\n\t\t\t\t// $icon = $(\"<img src='images/icons/task-16x16.png'/>\");\n\t\t\t\told_$icon && old_$icon.remove();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (old_$icon) {\n\t\t\t\told_$icon.replaceWith($icon);\n\t\t\t} else {\n\t\t\t\t$task.prepend($icon);\n\t\t\t}\n\t\t};\n\n\t\tthis.updateTitle();\n\t\tthis.updateIcon();\n\n\t\twin.on(\"title-change\", this.updateTitle);\n\t\twin.on(\"icon-change\", this.updateIcon);\n\n\t\twin.setMinimizeTarget($task[0]);\n\n\t\t$task.append($icon, $title);\n\t\t$task.on(\"pointerdown\", function (e) {\n\t\t\te.preventDefault(); // prevent focus, so that the window keeps focus and we can know for minimization if it it should be focused or minimized\n\t\t\t// @TODO: do it on whole taskbar\n\t\t});\n\t\t$task.on(\"click\", function () {\n\t\t\tif ($task.hasClass(\"selected\")) {\n\t\t\t\twin.minimize();\n\t\t\t\twin.blur();\n\t\t\t} else {\n\t\t\t\twin.unminimize();\n\t\t\t\twin.bringToFront();\n\t\t\t\twin.focus();\n\t\t\t}\n\t\t});\n\n\t\twin.onFocus(() => {\n\t\t\t$task.addClass(\"selected\");\n\t\t});\n\t\twin.onBlur(() => {\n\t\t\t$task.removeClass(\"selected\");\n\t\t});\n\t\twin.onClosed(() => {\n\t\t\t$task.remove();\n\t\t\tconst index = Task.all_tasks.indexOf(this);\n\t\t\tif (index !== -1) {\n\t\t\t\tTask.all_tasks.splice(index, 1);\n\t\t\t}\n\t\t});\n\n\t\tif (win.is && win.is(\":visible\")) {\n\t\t\twin.focus();\n\t\t}\n\t}\n\n\tTask.all_tasks = [];\n\n\treturn Task;\n\n})"]}