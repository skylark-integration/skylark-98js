/**
 * skylark-98js - A version of 98js.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-98js/
 * @license MIT
 */
define(["skylark-jquery"],function(e){var exports={};function t(e,t){const n=document.createElement(e);if(t)for(const e in t)"class"===e?n.className=t[e]:n.setAttribute(e,t[e]);return n}let n=0;function i(){return(n++).toString(36)+Math.random().toString(36).slice(2)}function s(e){return e.replace(/([^&]|^)&([^&\s])/,"$1<span class='menu-hotkey'>$2</span>").replace(/&&/g,"&")}const o="MENU_DIVIDER",l=1e3;let a=1;function r(){return"undefined"!=typeof $Window?$Window.Z_INDEX+++l:++a+l}return exports.MenuBar=function e(n){if(!(this instanceof e))return new e(n);const l=t("div",{class:"menus",role:"menubar","aria-label":"Application Menu"});function a(){return window.get_direction?window.get_direction():getComputedStyle(l).direction}l.style.touchAction="none";let u=!1;const d=[];let c,p=-1;const m=new WeakMap,h=new WeakMap,f=new WeakMap,v=()=>[...document.querySelectorAll(".menu-popup")].some(e=>"none"!==e.style.display),y=()=>{for(const{menu_button_el:e}of d)e.dispatchEvent(new CustomEvent("release"),{});const e=document.querySelectorAll(".menu-popup");for(const t of e)if(!window.debugKeepMenusOpen){t.style.display="none",t.querySelectorAll(".menu-item").forEach(e=>e.classList.remove("highlight")),t.removeAttribute("aria-activedescendant");const e=f.get(t);e&&(e.classList.contains("menu-button")||e.classList.remove("highlight"),e.setAttribute("aria-expanded","false"))}},b=()=>{const e=l.closest(".window");e&&e.dispatchEvent(new CustomEvent("refocus-window"))},g=e=>{const t="string"==typeof e?Object.keys(n).indexOf(e):e;-1!==p&&d[p].menu_button_el.classList.remove("highlight"),-1!==t&&d[t].menu_button_el.classList.add("highlight"),p=t};l.addEventListener("pointerleave",()=>{-1!==p&&"none"===d[p].menu_popup_el.style.display&&g(-1)}),window.addEventListener("focusout",e=>{e.relatedTarget&&e.relatedTarget.closest&&e.relatedTarget.closest(".menu-popup, .menus")||g(-1)});const w=e=>"function"==typeof e.enabled?!e.enabled():"boolean"==typeof e.enabled&&!e.enabled;function E(e){const t=e&&e.description||"";if(window.jQuery){const e=new window.jQuery.Event("info",{detail:{description:t}}),n={toString:()=>(console.warn("jQuery extra parameter for info event is deprecated, use event.detail instead"),t)};window.jQuery(l).trigger(e,n)}else l.dispatchEvent(new CustomEvent("info",{detail:{description:t}}))}function k(e){if(e.defaultPrevented)return;const t=e.target.closest(".menu-popup"),n=t&&m.get(t),i=d[p],{menu_button_el:s,open_top_level_menu:o}=i||{},r=t||i&&i.menu_popup_el,u=f.get(t),c=r&&r.querySelector(".menu-item.highlight");switch(e.keyCode){case 37:case 39:const i=39===e.keyCode;if(c&&c.classList.contains("has-submenu")&&"ltr"===a()===i)c.click(),e.preventDefault();else if(u&&!u.classList.contains("menu-button")&&"ltr"===a()!==i)n.parentMenuPopup.element.focus({preventScroll:!0}),t.style.display="none",n.highlight(-1),u.setAttribute("aria-expanded","false"),E(n.parentMenuPopup.menuItems[n.parentMenuPopup.itemElements.indexOf(u)]),e.preventDefault();else if(c||!n||!n.parentMenuPopup){const t=r&&"none"!==r.style.display,n="ltr"===a()===i?1:-1;let o;o=-1===p?1===n?0:d.length-1:(p+n+d.length)%d.length;const l=d[o],u=l.menu_button_el;t?l.open_top_level_menu("keydown"):(s&&s.dispatchEvent(new CustomEvent("release"),{}),u.focus({preventScroll:!0}),g(o)),e.preventDefault()}break;case 40:case 38:const m=40===e.keyCode;if(n){const t=m?1:-1,i=[...r.querySelectorAll(".menu-item")],s=i[(i.indexOf(c)+t+i.length)%i.length];n.highlight(s),E(n.menuItems[n.itemElements.indexOf(s)]),e.preventDefault()}else o&&o("keydown");e.preventDefault();break;case 27:if(v())u&&u!==s?(n.parentMenuPopup.element.focus({preventScroll:!0}),t.style.display="none",n.highlight(-1),u.setAttribute("aria-expanded","false"),E(n.parentMenuPopup.menuItems[n.parentMenuPopup.itemElements.indexOf(u)])):(y(),s.focus({preventScroll:!0})),e.preventDefault();else{const t=l.closest(".window");t&&(t.dispatchEvent(new CustomEvent("refocus-window")),e.preventDefault())}break;case 18:y(),b(),e.preventDefault();break;case 32:break;case 13:s===document.activeElement?(o("keydown"),e.preventDefault()):(c&&c.click(),e.preventDefault());break;default:const h=String.fromCharCode(e.keyCode).toLowerCase(),f=n?[...r.querySelectorAll(".menu-item")]:d.map(e=>e.menu_button_el),w={};for(const e of f){const t=e.querySelector(".menu-hotkey"),n=(t?t.textContent:(e.querySelector(".menu-item-label")||e).textContent[0]).toLowerCase();w[n]=w[n]||[],w[n].push(e)}const k=w[h]||[];if(k.length)if(1===k.length){const t=k[0];t.classList.contains("menu-button")?d.find(e=>e.menu_button_el===t).open_top_level_menu("keydown"):t.click(),e.preventDefault()}else{let t=k.indexOf(c);const i=k[t=-1===t?0:(t+1)%k.length];n.highlight(i),e.preventDefault()}}}l.addEventListener("keydown",k);const C=(e,n)=>{const p=t("div",{class:"menu-button","aria-expanded":"false","aria-haspopup":"true",role:"menuitem"});l.appendChild(p);const v=new function e(n,{parentMenuPopup:l}={}){this.parentMenuPopup=l,this.menuItems=n,this.itemElements=[];const u=t("div",{class:"menu-popup",id:`menu-popup-${i()}`,tabIndex:"-1",role:"menu"});u.style.touchAction="pan-y",u.style.outline="none";const d=t("table",{class:"menu-popup-table"});u.appendChild(d),this.element=u,m.set(u,this);let p,v=[];u.addEventListener("keydown",k),u.addEventListener("pointerleave",()=>{for(const e of v)if("none"!==e.submenu_popup_el.style.display)return void this.highlight(e.item_el);this.highlight(-1)}),u.addEventListener("focusin",e=>{u.focus({preventScroll:!0})}),this.highlight=(e=>{let t=e;"number"==typeof e&&(t=this.itemElements[e]),p&&p!==t&&p.classList.remove("highlight"),t?(t.classList.add("highlight"),u.setAttribute("aria-activedescendant",t.id),p=t):(u.removeAttribute("aria-activedescendant"),p=null)}),0===n.length&&(n=[{label:"(Empty)",enabled:!1}]),n.forEach((n,l)=>{const p=t("tr",{class:"menu-row"});if(this.itemElements.push(p),d.appendChild(p),n===o){const e=t("td",{colspan:4}),n=t("hr",{class:"menu-hr"});e.appendChild(n),p.appendChild(e),n.addEventListener("pointerenter",()=>{this.highlight(-1)})}else{const o=p;o.classList.add("menu-item"),o.id=`menu-item-${i()}`,o.tabIndex=-1,o.setAttribute("role",n.checkbox?"menuitemcheckbox":"menuitem"),o.setAttribute("aria-label",(n.label||n.item).replace(/\s?\(&.\)/,"").replace(/([^&]|^)&([^&\s])/,"$1$2")),o.setAttribute("aria-keyshortcuts",n.ariaKeyShortcuts||n.shortcut||n.shortcutLabel),n.description&&o.setAttribute("aria-description",n.description);const d=t("td",{class:"menu-item-checkbox-area"}),g=t("td",{class:"menu-item-label"}),k=t("td",{class:"menu-item-shortcut"}),C=t("td",{class:"menu-item-submenu-area"});let L,_;if(o.appendChild(d),o.appendChild(g),o.appendChild(k),o.appendChild(C),g.innerHTML=s(n.label||n.item),k.textContent=n.shortcut,u.addEventListener("update",()=>{if(w(n)?(o.setAttribute("disabled",""),o.setAttribute("aria-disabled","true")):(o.removeAttribute("disabled"),o.removeAttribute("aria-disabled")),n.checkbox&&n.checkbox.check){const e=n.checkbox.check();d.querySelector("svg").style.visibility=e?"visible":"hidden",o.setAttribute("aria-checked",e?"true":"false")}}),o.addEventListener("pointerenter",()=>{u.dispatchEvent(new CustomEvent("update"),{}),this.highlight(l),E(n)}),o.addEventListener("pointerleave",e=>{"none"!==u.style.display&&"touch"!==e.pointerType&&E()}),n.checkbox&&(d.innerHTML='\n\t\t\t\t\t\t\t<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\t\t\t\tstyle="fill:currentColor;display:inline-block;vertical-align:middle"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path d="M5 7v3l2 2 5-5V4L7 9Z"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t'),n.submenu){o.classList.add("has-submenu"),C.innerHTML='\n\t\t\t\t\t\t\t<svg width="16" height="16" xmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\t\t\t\tstyle="fill:currentColor;display:inline-block;vertical-align:middle"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path d="m6 4 4 4-4 4z"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t',u.addEventListener("update",()=>{C.querySelector("svg").style.transform="rtl"===a()?"scaleX(-1)":""});const t=new e(n.submenu,{parentMenuPopup:this});function m(){for(const e of v)e.close_submenu();u.focus({preventScroll:!0})}let i,s;_=t.element,document.body&&document.body.appendChild(_),_.style.display="none",o.setAttribute("aria-haspopup","true"),o.setAttribute("aria-expanded","false"),o.setAttribute("aria-controls",_.id),h.set(o,t),f.set(_,o),_.dataset.semanticParent=u.id,u.setAttribute("aria-owns",`${u.getAttribute("aria-owns")||""} ${_.id}`),_.setAttribute("aria-labelledby",o.id),L=((e=!0)=>{if("none"!==_.style.display)return;m(),o.setAttribute("aria-expanded","true"),_.style.display="",_.style.zIndex=r(),_.setAttribute("dir",a()),_.parentElement||document.body.appendChild(_),_.dispatchEvent(new CustomEvent("update"),{}),e?(t.highlight(0),E(t.menuItems[0])):t.highlight(-1);const n=o.getBoundingClientRect();let i=_.getBoundingClientRect();_.style.position="absolute",_.style.left=`${("rtl"===a()?n.left-i.width:n.right)+window.scrollX}px`,_.style.top=`${n.top+window.scrollY}px`,i=_.getBoundingClientRect(),"rtl"===a()?i.left<0&&(_.style.left=`${n.right}px`,(i=_.getBoundingClientRect()).right>innerWidth&&(_.style.left=`${innerWidth-i.width}px`)):i.right>innerWidth&&(_.style.left=`${n.left-i.width}px`,(i=_.getBoundingClientRect()).left<0&&(_.style.left="0")),_.focus({preventScroll:!0}),c=t}),v.push({item_el:o,submenu_popup_el:_,open_submenu:L,close_submenu:function(){if(_.style.display="none",t.highlight(-1),o.setAttribute("aria-expanded","false"),_._submenus)for(const e of _._submenus)e.close_submenu()}}),u._submenus=v,_.addEventListener("pointerenter",()=>{i&&(clearTimeout(i),i=null),s&&(clearTimeout(s),s=null)}),o.addEventListener("pointerenter",()=>{i&&(clearTimeout(i),i=null),s&&(clearTimeout(s),s=null),i=setTimeout(()=>{L(!1)},501)}),o.addEventListener("pointerleave",()=>{i&&(clearTimeout(i),i=null)}),u.addEventListener("pointerenter",e=>{e.target.closest(".menu-item")!==o&&(s||"none"!==_.style.display&&(s=setTimeout(()=>{window.debugKeepMenusOpen||m()},500)))}),u.addEventListener("pointerleave",()=>{s&&(clearTimeout(s),s=null)}),o.addEventListener("pointerdown",()=>{L(!1)})}let x=!1;const A=()=>{x||(x=!0,setTimeout(()=>{x=!1},10),n.checkbox?(n.checkbox.toggle&&n.checkbox.toggle(),u.dispatchEvent(new CustomEvent("update"),{})):n.action&&(y(),b(),n.action()))};o.addEventListener("pointerup",e=>{"mouse"===e.pointerType&&0!==e.button||"touch"!==e.pointerType&&o.click()}),o.addEventListener("click",e=>{n.submenu?L(!0):A()})}})}(n),C=v.element;document.body&&document.body.appendChild(C),h.set(p,v),f.set(C,p),p.id=`menu-button-${e}-${i()}`,C.dataset.semanticParent=p.id,p.setAttribute("aria-controls",C.id),C.setAttribute("aria-labelledby",p.id),l.setAttribute("aria-owns",`${l.getAttribute("aria-owns")||""} ${C.id}`);const _=()=>{const e=p.getBoundingClientRect();let t=C.getBoundingClientRect();C.style.position="absolute",C.style.left=`${("rtl"===a()?e.right-t.width:e.left)+window.scrollX}px`,C.style.top=`${e.bottom+window.scrollY}px`;const n=C.getBoundingClientRect();Math.floor(n.right)>innerWidth&&(C.style.left=`${innerWidth-n.width}px`),Math.ceil(n.left)<0&&(C.style.left="0px")};window.addEventListener("resize",_),C.addEventListener("update",_);const x=e.replace("&","").replace(/ /g,"-").toLowerCase();function A(t="other"){y(),p.classList.add("active"),p.setAttribute("aria-expanded","true"),C.style.display="",C.style.zIndex=r(),C.setAttribute("dir",a()),C.parentElement||document.body.appendChild(C),g(e),C.dispatchEvent(new CustomEvent("update"),{}),u=!0,C.focus({preventScroll:!0}),c=v,"keydown"===t?(v.highlight(0),E(v.menuItems[0])):E()}p.classList.add(`${x}-menu-button`),C.style.display="none",p.innerHTML=s(e),p.tabIndex=-1,p.setAttribute("aria-haspopup","true"),p.setAttribute("aria-controls",C.id),p.addEventListener("focus",()=>{g(e)}),p.addEventListener("pointerdown",e=>{p.classList.contains("active")?(p.dispatchEvent(new CustomEvent("release",{})),b(),e.preventDefault()):A(e.type)}),p.addEventListener("pointerenter",t=>{g(e),"touch"!==t.pointerType&&u&&A(t.type)}),p.addEventListener("release",()=>{u=!1,p.classList.remove("active"),window.debugKeepMenusOpen||(C.style.display="none",v.highlight(-1),p.setAttribute("aria-expanded","false")),l.dispatchEvent(new CustomEvent("default-info",{}))}),d.push({menu_button_el:p,menu_popup_el:C,menus_key:e,hotkey:(L=e,L[function(e){return` ${e}`.search(/[^&]&[^&\s]/)}(L)+1].toUpperCase()),open_top_level_menu:A})};var L;for(const e in n)C(e,n[e]);function _(e){e.target&&e.target.closest&&e.target.closest(".menus, .menu-popup")||y()}window.addEventListener("keydown",e=>{document.activeElement&&document.activeElement.closest&&document.activeElement.closest(".menus, .menu-popup")||27===e.keyCode&&v()&&(y(),e.preventDefault())}),window.addEventListener("blur",e=>{e.isTrusted&&y()}),window.addEventListener("pointerdown",_),window.addEventListener("pointerup",_);let x=[];function A(...e){for(const e of x)e.removeEventListener("keydown",M);x=e;for(const e of x)e.addEventListener("keydown",M)}function M(e){if(!e.ctrlKey&&!e.metaKey||17===e.keyCode||91===e.keyCode||93===e.keyCode||224===e.keyCode){if(!e.defaultPrevented&&e.altKey&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){const t=d.find(t=>t.hotkey.toLowerCase()===String.fromCharCode(e.keyCode).toLowerCase());t&&(e.preventDefault(),t.open_top_level_menu("keydown"))}}else y()}A(window),this.element=l,this.closeMenus=y,this.setKeyboardScope=A},exports.MENU_DIVIDER=o,exports});
//# sourceMappingURL=../sourcemaps/os-gui/MenuBar.js.map
