/**
 * skylark-98js - A version of 98js.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-98js/
 * @license MIT
 */
define(["skylark-jquery","skylark-clippy","./win98","./Task"],function(t,e,n,o){var i,s,a=t("<div class='window-switcher outset-deep'>"),d=t("<ul class='window-switcher-list'>").appendTo(a),l=t("<div class='window-switcher-window-name inset-deep'>").appendTo(a),c=!1;function w(t){t.unminimize(),t.bringToFront(),t.focus()}function r(e){const n=a.find(".window-switcher-item").toArray(),o=a.find(".active"),i=(n.indexOf(o[0])+(e?-1:1)+n.length)%n.length;o.removeClass("active");const s=n[i];t(s).addClass("active"),l.text(t(s).data("$window").getTitle())}function u(){a.remove()}window.addEventListener("keydown",function(e){if(e.altKey&&("4"===e.key||"F4"===e.key)){e.preventDefault();const t=e.target.closest(".os-window")&&e.target.closest(".os-window").$window;console.log("Alt+4 detected, closing window",t,e.target),t&&t.close()}!e.altKey||"Backquote"!==e.code&&"Tab"!==e.code?u():function(e){if(a.is(":visible"))return void r(e);d.empty();const n=o.all_tasks;if(1===n.length)return w(n[0].$window),void(c||(i&&i.stopCurrent(),i&&i.speak("If there's only one window, Alt+` will switch to it right away.")));if(!(n.length<2)){n.sort((t,e)=>e.$window[0].style.zIndex-t.$window[0].style.zIndex);for(const e of n){var s=e.$window,l=t("<li>").addClass("window-switcher-item");l.append(s.getIconAtSize(32)||t("<img>").attr({src:"/images/icons/task-32x32.png",width:32,height:32,alt:s.getTitle()})),l.data("$window",s),d.append(l),s.hasClass("focused")&&l.addClass("active")}r(e),a.appendTo("body"),c||(i&&i.stopCurrent(),i&&i.speak("There you go! Press grave accent until you get to the window you want."),c=!0)}}(e.shiftKey);"Alt"===e.key&&(p=!0,clearInterval(s),s=setInterval(v,200))},!0),window.addEventListener("keyup",function(t){t.altKey||(p=!1,clearInterval(s),function(){if(!a.is(":visible"))return;const t=a.find(".active");0!==t.length&&(w(t.data("$window")),a.remove())}())},!0),window.addEventListener("blur",u);var p=!1,f=!1;function v(){if(p&&!top.document.hasFocus()){if((!top.document.activeElement||top.document.activeElement===top.document.body||top.document.activeElement===top.document.documentElement)&&(top.focus(),top.document.hasFocus()))return;if(clearInterval(s),p=!1,o.all_tasks.length<2)return;f||(new e.load("Clippy",function(e){(i=e).show();i.speak("It looks like you're trying to switch windows.\n\nUse Alt+` (grave accent) instead of Alt+Tab within the 98.js desktop.\n\nAlso, use Alt+4 instead of Alt+F4 to close windows.",!0),t(i._el).one("dblclick",function(){i.stopCurrent(),i.animate()})}),f=!0)}}});
//# sourceMappingURL=sourcemaps/window-switcher.js.map
